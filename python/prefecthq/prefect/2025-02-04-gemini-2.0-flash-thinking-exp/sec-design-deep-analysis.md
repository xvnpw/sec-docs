Okay, I understand the task. I will perform a deep security analysis of Prefect based on the provided Security Design Review document.

Here's the deep analysis:

## Deep Security Analysis of Prefect Workflow Orchestration Platform

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep security analysis is to identify and evaluate potential security vulnerabilities and risks within the Prefect workflow orchestration platform. This analysis will focus on the key components of Prefect, their interactions, and the overall architecture to provide actionable security recommendations for the development team. The goal is to ensure the confidentiality, integrity, and availability of Prefect and the data pipelines it orchestrates, aligning with Prefect's business posture of providing a reliable, scalable, and user-friendly platform.

**Scope:**

This analysis encompasses the following aspects of Prefect, as defined in the Security Design Review:

*   **Architecture and Components:**  Prefect Server, Database (PostgreSQL), Message Queue (Redis/RabbitMQ), Prefect Agent, Prefect Worker, Prefect UI, Prefect CLI, Prefect API.
*   **Deployment Models:** Local, Containerized (Docker Compose), Kubernetes, and Prefect Cloud (inferred from context). Special focus on Kubernetes deployment as a production-ready scenario.
*   **Build Process:** CI/CD pipeline using GitHub Actions, including build, security checks (SAST, SCA, Linting), containerization, and artifact publishing.
*   **Data Flow:** Interactions between components, data sources, users, monitoring tools, and notification systems.
*   **Security Controls:** Existing, accepted, and recommended security controls outlined in the Security Design Review.
*   **Security Requirements:** Authentication, Authorization, Input Validation, and Cryptography requirements.

This analysis will *not* cover:

*   Detailed code-level vulnerability analysis (beyond the scope of a design review).
*   Security of specific data sources or external systems integrated with Prefect workflows (except in the context of Prefect's interaction with them).
*   Security of the underlying infrastructure (cloud providers, on-premise servers) in detail, but will consider infrastructure security best practices relevant to Prefect deployments.
*   Comprehensive compliance audit against specific regulations (GDPR, HIPAA, etc.), but will consider general compliance principles.

**Methodology:**

This deep security analysis will employ the following methodology:

1.  **Architecture Decomposition:**  Break down the Prefect platform into its key components based on the provided C4 diagrams (Context, Container, Deployment, Build) and descriptions.
2.  **Threat Modeling:**  Identify potential threats and vulnerabilities for each component and interaction, considering common attack vectors and the specific context of workflow orchestration. This will be based on STRIDE (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) and other relevant threat modeling methodologies, tailored to the Prefect architecture.
3.  **Security Control Analysis:** Evaluate the existing, accepted, and recommended security controls against the identified threats. Assess the effectiveness of these controls and identify gaps.
4.  **Security Requirement Mapping:**  Map the identified security requirements (Authentication, Authorization, Input Validation, Cryptography) to the Prefect components and assess how well these requirements are addressed in the design and existing controls.
5.  **Risk Assessment:**  Analyze the potential business impact of identified vulnerabilities, considering the critical business processes and data sensitivity outlined in the Security Design Review.
6.  **Mitigation Strategy Development:**  Develop specific, actionable, and tailored mitigation strategies for the identified threats and vulnerabilities, focusing on practical recommendations for the Prefect development team.
7.  **Documentation and Reporting:**  Document the analysis process, findings, identified threats, vulnerabilities, and recommended mitigation strategies in a clear and structured report.

### 2. Security Implications of Key Components

Breaking down the security implications of each key component, based on the Container and Deployment diagrams:

**2.1. Prefect Server (Python, FastAPI)**

*   **Security Implications:**
    *   **API Vulnerabilities:** As the central API endpoint, the Server is a prime target for attacks. Vulnerabilities in the FastAPI application (e.g., injection flaws, authentication bypass, authorization issues) could lead to unauthorized access, data manipulation, and service disruption.
    *   **Authentication and Authorization Flaws:** Weak or improperly implemented authentication and authorization mechanisms could allow unauthorized users to access sensitive data, modify workflows, or control the platform.
    *   **Database Security:** The Server's interaction with the Database is critical. SQL injection vulnerabilities or insecure database configurations could compromise the integrity and confidentiality of stored data (workflow definitions, run history, user credentials).
    *   **Message Queue Security:**  Communication with the Message Queue needs to be secure. If compromised, attackers could inject malicious tasks, disrupt workflow execution, or gain access to queued data.
    *   **Input Validation Weaknesses:**  The Server receives inputs from the UI, CLI, API, Agents, and Workers. Lack of robust input validation can lead to injection attacks (SQL, command, code injection), XSS, and other vulnerabilities.
    *   **Secret Management:** The Server needs to securely manage secrets for database access, message queue connections, and potentially integrations with external services. Insecure secret management can lead to credential compromise.
    *   **Denial of Service (DoS):**  The Server could be targeted by DoS attacks, impacting the availability of the entire Prefect platform.

*   **Specific Recommendations:**
    *   **API Security Hardening:** Implement API security best practices, including input validation, output encoding, rate limiting, and security headers. Utilize FastAPI's security features and middleware for authentication and authorization.
    *   **Robust Authentication and Authorization:** Enforce strong authentication mechanisms (MFA, SSO, API keys) and granular RBAC. Regularly review and update authorization policies. Implement audit logging for all authentication and authorization attempts.
    *   **Secure Database Configuration:** Harden PostgreSQL database configuration, enforce least privilege access, enable encryption at rest and in transit, and regularly patch database software. Implement parameterized queries to prevent SQL injection.
    *   **Message Queue Security:** Secure Redis/RabbitMQ access with authentication and authorization. Consider TLS encryption for communication between Server and Queue.
    *   **Comprehensive Input Validation:** Implement strict input validation on all API endpoints and data processing functions within the Server. Use input sanitization and output encoding to prevent injection and XSS attacks.
    *   **Secure Secret Management:** Integrate with a dedicated secret management solution (e.g., HashiCorp Vault, AWS Secrets Manager, Kubernetes Secrets) to securely store and manage sensitive credentials. Avoid hardcoding secrets in code or configuration files.
    *   **DoS Protection:** Implement rate limiting at the API gateway and within the Server application to mitigate DoS attacks. Consider using a Web Application Firewall (WAF) for advanced DoS protection.

**2.2. Database (PostgreSQL)**

*   **Security Implications:**
    *   **Data Breach:** If the database is compromised, sensitive data like workflow definitions, run history, user credentials, and potentially secrets could be exposed.
    *   **Data Integrity Compromise:** Attackers could modify or delete data in the database, leading to inaccurate workflow execution, loss of audit trails, and system instability.
    *   **Availability Impact:** Database downtime or performance issues can directly impact the availability and performance of the entire Prefect platform.
    *   **Access Control Weaknesses:** Insufficient database access controls could allow unauthorized access from within the Kubernetes cluster or from external networks.

*   **Specific Recommendations:**
    *   **Database Hardening:** Follow PostgreSQL security hardening guides, including disabling unnecessary features, restricting network access, and regularly applying security patches.
    *   **Strong Access Controls:** Implement strict access control policies for the database. Use Kubernetes Network Policies to restrict access to the database pod only from the Prefect Server pod within the `prefect` namespace. Use database-level authentication and authorization.
    *   **Encryption at Rest and in Transit:** Enable encryption at rest for the PostgreSQL database to protect data stored on disk. Enforce TLS encryption for all connections to the database server.
    *   **Regular Backups and Recovery:** Implement regular database backups and disaster recovery procedures to ensure data availability and recoverability in case of incidents. Securely store database backups.
    *   **Vulnerability Scanning and Patching:** Regularly scan the PostgreSQL database for vulnerabilities and promptly apply security patches.

**2.3. Message Queue (Redis/RabbitMQ)**

*   **Security Implications:**
    *   **Message Interception:** If communication with the Message Queue is not encrypted, attackers could intercept messages containing task information, potentially including sensitive data or workflow details.
    *   **Message Injection/Tampering:** Unauthorized access to the Message Queue could allow attackers to inject malicious tasks or tamper with existing messages, disrupting workflow execution or causing unintended actions.
    *   **Denial of Service:**  Flooding the Message Queue with messages or exploiting vulnerabilities in the queue software could lead to DoS attacks.
    *   **Access Control Weaknesses:**  Insufficient access controls to the Message Queue could allow unauthorized access from within the Kubernetes cluster or from external networks.

*   **Specific Recommendations:**
    *   **Secure Access Controls:** Implement authentication and authorization for accessing Redis/RabbitMQ. Use Kubernetes Network Policies to restrict access to the queue pods only from the Prefect Server and Agent pods within the `prefect` namespace.
    *   **Encryption in Transit:** Enable TLS encryption for communication between Prefect Server, Agents, and the Message Queue to protect message confidentiality and integrity.
    *   **Message Security (Optional but Recommended for Sensitive Workflows):** For workflows handling highly sensitive data, consider message encryption within the queue itself. This adds complexity but provides an extra layer of security.
    *   **Rate Limiting and DoS Protection:** Configure rate limiting and resource limits on the Message Queue to mitigate DoS attacks.
    *   **Vulnerability Scanning and Patching:** Regularly scan the Redis/RabbitMQ software for vulnerabilities and promptly apply security patches.

**2.4. Prefect Agent (Python)**

*   **Security Implications:**
    *   **Agent Compromise:** If an Agent is compromised, attackers could gain control over workflow deployments and executions, potentially leading to unauthorized access to data sources, execution of malicious code within workers, and disruption of workflows.
    *   **Credential Exposure:** Agents need to securely handle credentials for connecting to the Prefect Server and potentially for deploying workers in different environments. Insecure credential management on Agents can lead to compromise.
    *   **Communication Security:**  Insecure communication between Agents and the Server could allow man-in-the-middle attacks, message interception, or tampering.

*   **Specific Recommendations:**
    *   **Secure Agent Deployment:** Deploy Agents in secure environments with appropriate access controls. Minimize the attack surface of Agent pods by removing unnecessary components and hardening the container image.
    *   **Secure Credential Management:** Agents should retrieve credentials securely from a secret management solution rather than storing them locally or in environment variables. Use short-lived credentials where possible.
    *   **Mutual TLS Authentication:** Enforce mutual TLS (mTLS) authentication for communication between Agents and the Prefect Server to ensure both parties are authenticated and communication is encrypted.
    *   **Agent Isolation:**  Isolate Agent pods using Kubernetes namespaces, Network Policies, and Pod Security Policies to limit the impact of a potential Agent compromise.
    *   **Regular Updates and Patching:** Keep Agent software and dependencies up-to-date with the latest security patches.

**2.5. Prefect Worker (Python)**

*   **Security Implications:**
    *   **Workflow Execution Vulnerabilities:**  Vulnerabilities in workflow code or dependencies executed by Workers could be exploited to gain unauthorized access to data sources, execute arbitrary code, or compromise the worker environment.
    *   **Data Source Access Control Issues:** Workers need to securely access data sources. Misconfigured access controls or insecure credential handling within workflows can lead to data breaches.
    *   **Secret Exposure in Workflows:**  If secrets are not handled securely within workflows, they could be exposed in logs, error messages, or worker environments, leading to credential compromise.
    *   **Worker Isolation Issues:** Insufficient isolation between worker pods or from the underlying infrastructure could allow for container breakouts or cross-worker contamination.

*   **Specific Recommendations:**
    *   **Secure Workflow Development Practices:**  Educate workflow developers on secure coding practices, including input validation, output encoding, secure dependency management, and secure secret handling.
    *   **Least Privilege Data Source Access:** Grant Workers only the necessary permissions to access data sources. Use service accounts and RBAC to control access.
    *   **Secure Secret Management in Workflows:**  Force workflows to use secure secret management solutions (Prefect Secrets, integrations with Vault, etc.) to access credentials and sensitive data. Avoid hardcoding secrets in workflow code.
    *   **Worker Environment Isolation:**  Enforce strong isolation for worker pods using Kubernetes namespaces, Network Policies, Pod Security Policies, and container runtime security features (e.g., gVisor, Kata Containers).
    *   **Workflow Input Validation and Sanitization:** Implement robust input validation and sanitization within workflows to prevent injection attacks and other vulnerabilities.
    *   **Regular Security Audits of Workflows:** Conduct periodic security audits of critical workflows to identify and remediate potential vulnerabilities.

**2.6. Prefect UI (React)**

*   **Security Implications:**
    *   **Cross-Site Scripting (XSS):** Vulnerabilities in the React application could allow attackers to inject malicious scripts into the UI, potentially stealing user credentials, session tokens, or performing actions on behalf of users.
    *   **Cross-Site Request Forgery (CSRF):**  Lack of CSRF protection could allow attackers to trick users into performing unintended actions on the Prefect platform.
    *   **Authentication and Authorization Bypass:**  Vulnerabilities in the UI's authentication and authorization mechanisms could allow unauthorized access to the Prefect platform.
    *   **Information Disclosure:**  Improperly configured UI or server responses could leak sensitive information to unauthorized users.

*   **Specific Recommendations:**
    *   **XSS Prevention:** Implement robust XSS prevention measures in the React application, including input sanitization, output encoding, and using a Content Security Policy (CSP).
    *   **CSRF Protection:** Implement CSRF protection mechanisms, such as synchronizer tokens, to prevent CSRF attacks.
    *   **Secure Authentication and Authorization:**  Ensure the UI properly integrates with the Prefect Server's authentication and authorization mechanisms. Enforce strong authentication and RBAC.
    *   **Security Headers:** Configure web server security headers (e.g., HSTS, X-Frame-Options, X-Content-Type-Options) to enhance UI security.
    *   **Regular UI Security Audits:** Conduct regular security audits and penetration testing of the Prefect UI to identify and remediate vulnerabilities.

**2.7. Prefect CLI (Python)**

*   **Security Implications:**
    *   **Credential Exposure:**  If users store Prefect CLI credentials insecurely (e.g., in plain text configuration files), they could be compromised.
    *   **Command Injection:**  Vulnerabilities in the CLI's command parsing or execution logic could allow command injection attacks.
    *   **Phishing and Social Engineering:**  Attackers could use social engineering tactics to trick users into executing malicious CLI commands.

*   **Specific Recommendations:**
    *   **Secure Credential Storage:**  Recommend and document secure methods for storing Prefect CLI credentials, such as using credential managers or environment variables with restricted access. Avoid storing credentials in plain text files.
    *   **Input Validation in CLI:** Implement input validation in the CLI to prevent command injection vulnerabilities.
    *   **User Education on CLI Security:** Educate users about the risks of running untrusted CLI commands and best practices for CLI security.

**2.8. Prefect API (GraphQL)**

*   **Security Implications:**
    *   **GraphQL Specific Vulnerabilities:** GraphQL APIs can be susceptible to specific vulnerabilities like excessive data fetching, batching attacks, and introspection abuse.
    *   **Authentication and Authorization Bypass:**  Weaknesses in the API's authentication and authorization mechanisms could allow unauthorized access and data manipulation.
    *   **Rate Limiting Issues:**  Insufficient rate limiting could lead to DoS attacks or abuse of API resources.
    *   **Information Disclosure:**  GraphQL schemas and error messages can sometimes leak sensitive information.

*   **Specific Recommendations:**
    *   **GraphQL Security Best Practices:** Implement GraphQL security best practices, including query complexity analysis, rate limiting, disabling introspection in production (if appropriate), and input validation.
    *   **Robust Authentication and Authorization:** Enforce strong authentication (API keys, OAuth 2.0) and granular authorization for API access. Implement RBAC for API endpoints.
    *   **Rate Limiting and DoS Protection:** Implement rate limiting on API endpoints to prevent DoS attacks and abuse.
    *   **Schema Security:** Review the GraphQL schema to ensure it does not expose unnecessary sensitive information. Carefully handle error messages to avoid information leakage.

### 3. Architecture, Components, and Data Flow Inference

Based on the provided diagrams and descriptions, the architecture, components, and data flow can be summarized as follows:

*   **Centralized Control Plane:** Prefect Server acts as the central control plane, managing workflow definitions, deployments, scheduling, and state. It relies on a PostgreSQL database for persistent storage and a Redis/RabbitMQ message queue for asynchronous task communication.
*   **Decentralized Execution Plane:** Prefect Agents are lightweight processes that poll the Server for scheduled workflow runs. Agents deploy and monitor Workers, which are responsible for executing the actual workflow tasks. Workers can run in various environments, providing flexibility.
*   **User Interaction:** Users (Data Engineers, Data Scientists, DevOps Engineers) interact with Prefect through the UI, CLI, and API to define, deploy, monitor, and manage workflows.
*   **Data Flow:**
    1.  Users define workflows and deployments via UI, CLI, or API, which are stored in the Prefect Server database.
    2.  The Server schedules workflow runs and queues tasks in the Message Queue.
    3.  Agents poll the Message Queue for tasks.
    4.  Agents deploy Workers to execute tasks.
    5.  Workers execute workflow tasks, interacting with Data Sources to process data.
    6.  Workers send logs and status updates back to the Server.
    7.  The Server provides metrics to Monitoring Tools and sends notifications via Notification services.
    8.  Users monitor workflow execution and platform status through the UI and Monitoring Tools.

**Inferred Security Considerations based on Architecture and Data Flow:**

*   **Trust Boundary between Control and Execution Plane:**  The communication between the Server and Agents, and between Agents and Workers, represents a critical trust boundary. Secure communication and authentication are essential to prevent unauthorized control and data manipulation.
*   **Data Flow Security:** Data flows from Data Sources to Workers, and logs/status flow from Workers back to the Server. Securing these data flows, especially when sensitive data is involved, is crucial.
*   **Secret Management Across Components:** Secrets are needed for database access, message queue access, Agent-Server communication, and workflow execution (data source credentials). Secure secret management across all components is vital.
*   **Scalability and Security:** As Prefect scales, security controls must scale accordingly. Kubernetes deployment provides scalability, but also introduces Kubernetes-specific security considerations.
*   **Open-Source Security Model:** Reliance on community contributions and open-source dependencies requires robust security practices in the development lifecycle, including vulnerability scanning, code reviews, and a clear vulnerability response process.

### 4. Tailored Security Considerations and Recommendations

Given the nature of Prefect as a workflow orchestration platform, the security considerations are specifically tailored to:

*   **Data Pipeline Reliability:** Security vulnerabilities can directly impact the reliability of data pipelines. For example, a compromised Server or Agent could disrupt workflow execution.
*   **Data Integrity and Accuracy:**  Tampering with workflows or data during execution can compromise data integrity and accuracy.
*   **Sensitive Data Handling:** Workflows often process sensitive data. Security controls must protect this data throughout the workflow lifecycle, from data sources to processing and storage.
*   **Automation and Orchestration Security:** Security of the orchestration platform itself is paramount. A compromised orchestration platform can have cascading effects on all managed workflows.
*   **Developer and Operator Security:** Security considerations must address both developers defining workflows and operators managing the Prefect platform.

**Specific Tailored Recommendations (Building on previous component-level recommendations):**

*   **Implement a Security-Focused SDLC:** Integrate security into every stage of the Software Development Lifecycle (SDLC). This includes security requirements gathering, secure design, secure coding practices, security testing (SAST, DAST, SCA), and security reviews.
*   **Prioritize Vulnerability Management:** Establish a formal vulnerability disclosure and response process. Implement automated vulnerability scanning in CI/CD pipelines and for deployed components. Track and remediate vulnerabilities promptly.
*   **Develop Security Hardening Guides:** Create and maintain security hardening guides and best practices for deploying and configuring Prefect in different environments (Kubernetes, Docker, etc.). These guides should be specific to Prefect components and configurations.
*   **Conduct Regular Penetration Testing and Security Audits:**  Perform regular penetration testing and security audits of the Prefect platform, both internally and by engaging external security experts. Focus on both infrastructure and application-level security.
*   **Enhance Authentication and Authorization Features:**  Expand and strengthen authentication and authorization capabilities in Prefect. Implement MFA, SSO integrations, and fine-grained RBAC. Provide clear documentation and examples for users to configure authentication and authorization securely.
*   **Provide Secure Secret Management Solutions:**  Offer built-in or well-documented integrations with various secret management solutions. Guide users on how to securely manage secrets within workflows and avoid insecure practices. Consider features like secret rotation and auditing.
*   **Focus on Kubernetes Security (for Kubernetes Deployments):** For Kubernetes deployments, emphasize Kubernetes-specific security best practices, including RBAC, Network Policies, Pod Security Policies/Admission Controllers, container security, and regular security updates of the Kubernetes cluster.
*   **Educate Users on Security Best Practices:**  Provide comprehensive documentation and training for users on security best practices for developing secure workflows, configuring Prefect securely, and managing secrets. Include security considerations in workflow examples and templates.
*   **Promote Security Awareness within the Community:**  As an open-source project, actively promote security awareness within the Prefect community. Encourage security contributions, bug reports, and code reviews. Publicly acknowledge and address security issues transparently.

### 5. Actionable and Tailored Mitigation Strategies

Here are actionable and tailored mitigation strategies applicable to the identified threats, focusing on concrete steps for the Prefect development team:

| Threat/Vulnerability                                  | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              