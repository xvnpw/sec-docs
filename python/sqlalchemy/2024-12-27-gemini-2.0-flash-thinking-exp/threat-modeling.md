
## High and Critical SQLAlchemy Threats

| Threat | Description (Attacker Action & Mechanism) | Impact | Affected SQLAlchemy Component | Risk Severity | Mitigation Strategies |
|---|---|---|---|---|---|
| **SQL Injection (Direct SQL)** | An attacker injects malicious SQL code into dynamically constructed SQL queries (using `text()` without proper parameterization). This allows them to execute arbitrary SQL commands, potentially reading, modifying, or deleting data, bypassing security controls, or even gaining control of the database server. | **Critical** - Data breach, data manipulation, data loss, potential system compromise. | `sqlalchemy.sql.expression.text` | Critical | **Always use parameterized queries with `bindparam()` when using `text()` for dynamic values.** Avoid string formatting or concatenation of user input directly into SQL strings. |
| **SQL Injection (ORM-Based Filtering)** | An attacker manipulates user input that is directly used in ORM `filter()` conditions (e.g., using string-based conditions or unsafe attribute access). This allows them to inject malicious SQL, potentially accessing or modifying data they shouldn't. | **High** - Unauthorized data access, data manipulation. | `sqlalchemy.orm.query.Query.filter` | High | **Use SQLAlchemy's built-in filtering mechanisms with operators and bind parameters.** Avoid string-based conditions where possible. Sanitize or validate user input before using it in `filter()`. |
| **Database Credential Exposure** | An attacker gains access to database credentials (username, password, connection string) that are stored insecurely (e.g., hardcoded in code, in plain text configuration files). This allows them to directly access and manipulate the database, bypassing application security. | **Critical** - Full database access, data breach, data manipulation, data loss. | `sqlalchemy.create_engine` (configuration) | Critical | **Store database credentials securely using environment variables, secure configuration management tools (e.g., HashiCorp Vault), or operating system keychains.** Avoid hardcoding credentials in the code or plain text configuration files. Restrict access to configuration files. |
| **Bypassing Authentication/Authorization through Incorrect Query Construction** | An attacker exploits flaws in how the application uses SQLAlchemy to filter data based on user roles or permissions. Incorrectly constructed queries might not properly enforce authorization rules, allowing access to data the user shouldn't see. | **High** - Unauthorized data access, potential privilege escalation. | `sqlalchemy.orm.query.Query.filter` | High | **Implement robust authentication and authorization mechanisms.** Ensure that SQLAlchemy queries always incorporate necessary filters based on user roles and permissions. Use SQLAlchemy's event system to enforce security policies if needed. |