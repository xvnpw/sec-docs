Okay, let's perform a deep security analysis of the Django REST Framework (DRF) based on the provided design review.

**1. Objective, Scope, and Methodology**

*   **Objective:** To conduct a thorough security analysis of the key components of the Django REST Framework, identifying potential vulnerabilities, weaknesses, and areas for improvement.  The analysis will focus on how DRF's features *can be misused or misconfigured*, leading to security issues, and how to mitigate those risks *specifically within the context of DRF*.  We aim to go beyond generic security advice and provide DRF-specific recommendations.

*   **Scope:** The analysis will cover the core components of DRF as outlined in the security design review, including:
    *   Authentication
    *   Authorization
    *   Throttling
    *   Input Validation (Serializers)
    *   Output Encoding (Serializers)
    *   CORS Handling
    *   Dependency Management
    *   Interactions with other system components (Databases, Third-party APIs, Email Servers)

*   **Methodology:**
    1.  **Component Breakdown:** We will analyze each component individually, examining its intended functionality, potential security implications, and DRF-specific best practices.
    2.  **Threat Modeling:** For each component, we will consider common attack vectors and how DRF's features can be used (or misused) to facilitate or prevent those attacks.
    3.  **Codebase and Documentation Review:** We will infer architectural details and data flow from the provided C4 diagrams, the security design review, and our knowledge of DRF's codebase and official documentation (https://www.django-rest-framework.org/).
    4.  **Mitigation Strategies:** We will provide actionable, DRF-specific mitigation strategies for each identified threat.  These will go beyond general security advice and focus on how to use DRF's features correctly and securely.

**2. Security Implications of Key Components**

Let's break down each component and analyze its security implications:

**2.1 Authentication**

*   **Functionality:** DRF supports various authentication schemes (Basic, Session, Token, OAuth2 via extensions).  It determines *who* is making a request.

*   **Threats & DRF-Specific Considerations:**
    *   **Brute-Force Attacks:**  While DRF doesn't *directly* handle password storage (that's Django's responsibility), using `TokenAuthentication` without proper throttling on the login endpoint can make brute-force attacks against tokens feasible.  A compromised token grants full access.
    *   **Session Fixation:** If using `SessionAuthentication`, improper session management (e.g., not regenerating session IDs on login) can lead to session fixation attacks.
    *   **Weak Token Generation:**  If using `TokenAuthentication`, the token generation mechanism must be cryptographically secure.  DRF uses Django's `SECRET_KEY` for signing, so protecting this key is paramount.  Custom token generation implementations are high-risk.
    *   **Token Leakage:** Tokens must be transmitted over HTTPS.  Logging tokens, storing them in insecure locations (e.g., client-side storage without proper protection), or exposing them in URLs can lead to compromise.
    *   **OAuth2 Misconfiguration (Third-Party):**  If using an OAuth2 provider, misconfiguration of redirect URIs, client secrets, or scopes can lead to account takeover.  This is a risk inherited from the third-party library.
    *  **Lack of Expiration of the Token:** If using `TokenAuthentication`, by default tokens do not expire.

*   **DRF-Specific Mitigations:**
    *   **Throttling:**  Apply DRF's throttling mechanisms (`AnonRateThrottle`, `UserRateThrottle`, or custom throttles) *specifically to authentication endpoints* (e.g., login views).  This is crucial for preventing brute-force attacks against both usernames/passwords and tokens.
    *   **Session Management:**  If using `SessionAuthentication`, ensure Django's session settings are secure (`SESSION_COOKIE_SECURE = True`, `SESSION_COOKIE_HTTPONLY = True`, `SESSION_EXPIRE_AT_BROWSER_CLOSE = True`).  Use Django's built-in logout functionality to properly invalidate sessions.
    *   **Token Handling:**  If using `TokenAuthentication`:
        *   **HTTPS Enforcement:**  Enforce HTTPS strictly using Django's `SECURE_SSL_REDIRECT = True` and HSTS headers.
        *   **Token Storage:**  Advise users *against* storing tokens in easily accessible client-side storage (e.g., localStorage, cookies without HttpOnly and Secure flags).  Recommend using HTTP-only, secure cookies if server-side rendering is involved.
        *   **Token Expiration:** Implement token expiration.  DRF's built-in `TokenAuthentication` does *not* expire tokens by default.  You *must* implement this manually (e.g., by adding an expiry timestamp to the token model and checking it in a custom authentication backend or middleware) or use a third-party package like `djangorestframework-simplejwt` which provides expiring tokens.
        * **Token Revocation:** Implement a mechanism for token revocation.
    *   **OAuth2:**  If using OAuth2, thoroughly vet the third-party library (e.g., `django-oauth-toolkit`).  Follow the provider's security guidelines meticulously.  Use a well-maintained library and keep it updated.
    * **Multi-Factor Authentication (MFA):** Encourage the use of MFA. While DRF doesn't have built-in MFA, it can be integrated using Django libraries (e.g., `django-otp`).

**2.2 Authorization**

*   **Functionality:** DRF's permission classes control *what* an authenticated user can do.  They determine access to views and objects.

*   **Threats & DRF-Specific Considerations:**
    *   **Incorrect Permission Configuration:** The most common vulnerability.  Using overly permissive permissions (e.g., `AllowAny` when it's not needed) or failing to apply permissions at all can expose data and functionality.
    *   **Object-Level Permissions Bypass:**  If using object-level permissions (e.g., `has_object_permission`), failing to check permissions *consistently* in all relevant views (e.g., update, delete) can lead to bypasses.  A user might be able to modify an object they shouldn't.
    *   **Insecure Direct Object Reference (IDOR):**  If object-level permissions are not implemented correctly, an attacker might be able to access or modify objects by simply changing an ID in a URL or request parameter.
    *   **Default Permissions:** Relying on the global `DEFAULT_PERMISSION_CLASSES` setting without carefully considering its implications for *all* views.

*   **DRF-Specific Mitigations:**
    *   **Principle of Least Privilege:**  Emphasize the principle of least privilege.  Use the most restrictive permission class that meets the requirements.  Favor `IsAuthenticated`, `IsAdminUser`, or custom permission classes over `AllowAny`.
    *   **Explicit Permission Checks:**  Always explicitly apply permission classes to *every* view, even if you think the default settings are sufficient.  Don't rely on assumptions.
    *   **Object-Level Permission Consistency:**  If using object-level permissions, ensure they are checked in *all* views that interact with the object (create, retrieve, update, delete).  Use DRF's `get_object_or_404` utility, which automatically checks object-level permissions.
    *   **IDOR Prevention:**  Combine object-level permissions with robust input validation.  Don't rely solely on permissions to prevent IDOR.  Validate that the user is authorized to access the object *and* that the provided ID is valid and belongs to the user (if applicable).
    *   **Custom Permission Classes:**  Encourage the use of custom permission classes for complex authorization logic.  This makes the logic more readable, testable, and reusable.
    *   **Testing:**  Thoroughly test permission classes, including edge cases and negative tests (e.g., testing that unauthorized users *cannot* access resources).

**2.3 Throttling**

*   **Functionality:** DRF's throttling mechanisms limit the rate of requests from a single user or IP address.

*   **Threats & DRF-Specific Considerations:**
    *   **Denial of Service (DoS):**  Without throttling, an attacker can overwhelm the API with requests, making it unavailable to legitimate users.
    *   **Brute-Force Attacks (Authentication):**  As mentioned earlier, throttling is crucial for preventing brute-force attacks against authentication endpoints.
    *   **Resource Exhaustion:**  Even without malicious intent, a single user or client could consume excessive resources (e.g., database connections, CPU) if requests are not throttled.
    *   **Incorrect Throttle Scope:** Using the wrong throttle scope (e.g., `AnonRateThrottle` for authenticated users) can lead to ineffective throttling.
    *   **Bypass via IP Rotation:** Attackers can bypass IP-based throttling by rotating their IP addresses.

*   **DRF-Specific Mitigations:**
    *   **Multiple Throttle Classes:**  Use a combination of throttle classes to provide layered protection.  For example, use `AnonRateThrottle` for unauthenticated users and `UserRateThrottle` for authenticated users.
    *   **Custom Throttle Classes:**  Create custom throttle classes to implement more sophisticated throttling logic, such as:
        *   **Per-Endpoint Throttling:**  Apply different throttle rates to different API endpoints based on their resource consumption or sensitivity.
        *   **Dynamic Throttling:**  Adjust throttle rates based on server load or other factors.
        *   **User-Specific Throttling:**  Implement different throttle rates for different users or user groups.
    *   **Throttle Scope:**  Carefully choose the appropriate throttle scope (`user`, `ip`, or a custom scope).
    *   **Monitoring:**  Monitor throttle rates and adjust them as needed.  Look for patterns of abuse.
    *   **CAPTCHA Integration:**  For critical endpoints (e.g., login, registration), consider integrating a CAPTCHA to deter automated attacks, especially if IP rotation is a concern.  This is *not* a DRF feature, but a recommended addition.
    *   **Fail2Ban Integration:** Consider integrating Fail2Ban to automatically block IPs that exhibit malicious behavior.

**2.4 Input Validation (Serializers)**

*   **Functionality:** DRF's serializers validate and sanitize data input, converting it to Python data types and checking for errors.

*   **Threats & DRF-Specific Considerations:**
    *   **Injection Attacks (SQL, NoSQL, Command, etc.):**  If input is not properly validated and sanitized, an attacker can inject malicious code into database queries or system commands.
    *   **Cross-Site Scripting (XSS):**  While primarily an output encoding issue, input validation can help prevent XSS by rejecting or sanitizing potentially dangerous input (e.g., HTML tags).
    *   **Data Type Mismatches:**  Incorrectly handling data types can lead to unexpected behavior or errors.
    *   **Business Logic Validation:**  Serializers can also be used to enforce business rules (e.g., ensuring that a start date is before an end date).  Failing to do so can lead to data inconsistencies.
    *   **Nested Serializers:**  Carefully handle nested serializers to ensure that validation is applied recursively to all levels of the data.
    *   **`validated_data`:**  Always use the `validated_data` attribute of the serializer after calling `is_valid()`.  Do *not* access the raw input data directly.

*   **DRF-Specific Mitigations:**
    *   **Strict Validation:**  Use DRF's built-in validators (e.g., `required`, `max_length`, `email`, `regex`) to enforce strict validation rules.
    *   **Whitelist Validation:**  Whenever possible, use whitelist validation (e.g., specifying a list of allowed values) instead of blacklist validation.
    *   **Custom Validators:**  Create custom validators for complex validation logic.
    *   **Field-Level Validation:**  Use `validate_<field_name>` methods in serializers for field-specific validation.
    *   **Object-Level Validation:**  Use the `validate` method in serializers for object-level validation (e.g., validating relationships between fields).
    *   **Nested Serializer Validation:**  Ensure that nested serializers are properly validated.  Use the `many=True` argument for list fields containing nested objects.
    *   **`validated_data`:**  Always use the `validated_data` attribute after calling `is_valid()`. This ensures you're working with the sanitized and validated data.
    *   **Regular Expression Caution:**  Be extremely careful with regular expressions.  Poorly crafted regexes can lead to ReDoS (Regular Expression Denial of Service) vulnerabilities.  Use well-tested and established regex patterns.
    * **File Uploads:** If handling file uploads, use DRF's `FileField` or `ImageField` and configure Django's `MEDIA_ROOT` and `MEDIA_URL` settings securely.  *Never* store uploaded files in a location accessible directly by the web server.  Use a separate storage service (e.g., AWS S3) or a database.  Scan uploaded files for viruses.

**2.5 Output Encoding (Serializers)**

*   **Functionality:** Serializers handle the conversion of Python objects to JSON, XML, or other formats for API responses.

*   **Threats & DRF-Specific Considerations:**
    *   **Cross-Site Scripting (XSS):**  If data returned in API responses is not properly encoded, an attacker can inject malicious JavaScript code that will be executed in the client's browser.  This is particularly relevant if the API data is later rendered in a web page.
    *   **Data Leakage:**  Inadvertently exposing sensitive data in API responses (e.g., including internal IDs or debugging information).

*   **DRF-Specific Mitigations:**
    *   **Default JSON Encoding:** DRF's default JSON renderer (`JSONRenderer`) uses Python's `json` library, which automatically escapes HTML characters, mitigating XSS.  This is generally safe *if the data is consumed as JSON*.
    *   **HTML Rendering (Caution):**  If you are using DRF to generate HTML (e.g., using `TemplateHTMLRenderer`), you *must* ensure that data is properly escaped using Django's template engine and its auto-escaping features.  This is *not* DRF's primary use case, so be extra cautious.
    *   **Custom Renderers:**  If you create custom renderers, you are responsible for ensuring that output is properly encoded to prevent XSS.
    *   **Data Filtering:**  Carefully control which fields are included in API responses.  Use serializer fields to explicitly define the data to be serialized.  Avoid returning more data than necessary.
    *   **Exclude Sensitive Fields:**  Use the `exclude` option in serializer Meta classes or explicitly define `fields` to prevent sensitive data from being included in responses.

**2.6 CORS Handling**

*   **Functionality:** DRF supports Cross-Origin Resource Sharing (CORS) configuration, allowing you to control which origins (domains) can access your API.

*   **Threats & DRF-Specific Considerations:**
    *   **Cross-Site Request Forgery (CSRF):**  While CORS is primarily about controlling access from different origins, misconfigured CORS can exacerbate CSRF vulnerabilities.  If you allow requests from any origin (`*`), you are effectively disabling CSRF protection for those requests.
    *   **Data Exfiltration:**  An attacker can use a malicious website to make requests to your API from a victim's browser, potentially exfiltrating sensitive data.

*   **DRF-Specific Mitigations:**
    *   **`django-cors-headers`:**  Use the `django-cors-headers` package (recommended by DRF) to configure CORS.
    *   **Whitelist Origins:**  *Avoid* using `CORS_ALLOW_ALL_ORIGINS = True`.  Instead, explicitly whitelist the allowed origins using `CORS_ALLOWED_ORIGINS` or `CORS_ALLOWED_ORIGIN_REGEXES`.
    *   **`CORS_ALLOW_CREDENTIALS`:**  Be very careful with `CORS_ALLOW_CREDENTIALS = True`.  This allows cookies and authorization headers to be sent with cross-origin requests, which can increase the risk of CSRF attacks.  Only enable this if absolutely necessary and only for trusted origins.
    *   **CSRF Protection:**  Even with CORS configured, ensure that Django's CSRF protection is enabled and properly configured.  DRF relies on Django's CSRF middleware.

**2.7 Dependency Management**

*   **Functionality:** DRF, like any Django project, relies on third-party packages.

*   **Threats & DRF-Specific Considerations:**
    *   **Vulnerable Dependencies:**  Using outdated or vulnerable dependencies can introduce security risks into your application.

*   **DRF-Specific Mitigations:**
    *   **Regular Updates:**  Keep DRF and all its dependencies up to date.  Use tools like `pip` with the `--upgrade` flag or dependency management tools like `pip-tools` or `Poetry`.
    *   **Vulnerability Scanning:**  Use tools like `pip check`, `safety`, `Snyk`, or Dependabot to scan your dependencies for known vulnerabilities.  Integrate this scanning into your CI/CD pipeline.
    *   **Pin Dependencies:**  Pin your dependencies to specific versions (e.g., `djangorestframework==3.14.0`) to prevent unexpected changes from breaking your application or introducing vulnerabilities. Use requirements files (`requirements.txt`) or lock files (`Pipfile.lock`, `poetry.lock`).

**2.8 Interactions with Other System Components**

*   **Databases:**
    *   **Threat:** SQL Injection (if not using the ORM correctly), unauthorized database access.
    *   **Mitigation:** Use Django's ORM *exclusively* for database interactions.  Avoid raw SQL queries.  Configure database access controls securely (strong passwords, limited privileges).  Use database encryption at rest.
*   **Third-Party APIs:**
    *   **Threat:**  API key leakage, insecure communication, vulnerabilities in the third-party API itself.
    *   **Mitigation:**  Store API keys securely (e.g., using environment variables, a secrets management service).  Use HTTPS for all communication with third-party APIs.  Monitor the security advisories of the third-party APIs you use.
*   **Email Servers:**
    *   **Threat:**  SMTP credentials leakage, email spoofing.
    *   **Mitigation:**  Store SMTP credentials securely.  Use TLS encryption for email communication.  Configure SPF, DKIM, and DMARC records to prevent email spoofing.

**3. Summary of Actionable Mitigations (DRF-Specific)**

This table summarizes the key mitigations, emphasizing DRF-specific aspects:

| Component        | Threat                                      | DRF-Specific Mitigation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 