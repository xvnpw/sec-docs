## Deep Analysis of Security Considerations for the Requests Library

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to conduct a thorough security assessment of the Python Requests library (https://github.com/psf/requests), focusing on its key components, architecture, data flow, and deployment process.  The analysis aims to identify potential security vulnerabilities, assess their impact, and provide actionable mitigation strategies tailored to the library's specific design and usage.  The primary goal is to enhance the library's security posture and provide guidance to developers using Requests to build secure applications.  This includes a specific focus on:

*   **Correctness of HTTPS handling:** Ensuring TLS/SSL is implemented correctly and securely.
*   **Safe handling of authentication:** Preventing credential leakage or misuse.
*   **Input validation:** Preventing injection attacks through malicious URLs, headers, or data.
*   **Dependency security:** Minimizing risks from vulnerabilities in underlying libraries.
*   **Resilience to common web attacks:**  Protecting against attacks like CSRF, SSRF, and header injection.

**Scope:**

This analysis covers the following aspects of the Requests library:

*   **Core Functionality:**  `requests.get()`, `requests.post()`, `requests.put()`, `requests.delete()`, `requests.head()`, `requests.options()`, and related methods.
*   **Session Management:**  The `requests.Session()` object and its handling of cookies, authentication, and persistent connections.
*   **Authentication Mechanisms:**  Built-in support for Basic, Digest, OAuth1, and OAuth2 authentication.
*   **HTTPS/TLS Configuration:**  Certificate verification, custom CA bundles, and TLS version selection.
*   **Proxy Support:**  Handling of HTTP and HTTPS proxies.
*   **Redirection Handling:**  How Requests follows redirects (or not).
*   **Timeout Configuration:**  How timeouts are handled and their security implications.
*   **Header and Cookie Handling:**  How headers and cookies are processed and sent.
*   **Dependency Management:**  The security implications of Requests' dependencies (primarily `urllib3`, `certifi`, `charset_normalizer`, `idna`).
*   **Deployment and Build Process:**  Security considerations related to how Requests is packaged and distributed.

**Methodology:**

The analysis will employ the following methods:

1.  **Code Review:**  Manual inspection of the Requests source code on GitHub, focusing on security-critical areas.
2.  **Documentation Review:**  Analysis of the official Requests documentation, including security-related sections and best practices.
3.  **Dependency Analysis:**  Examination of Requests' dependencies and their known vulnerabilities using tools like `pip-audit` and vulnerability databases.
4.  **Threat Modeling:**  Identification of potential threats and attack vectors based on the library's functionality and architecture.  This will leverage the provided C4 diagrams and risk assessment.
5.  **Inference of Architecture:**  Based on the codebase and documentation, we will infer the internal workings of Requests to identify potential security weaknesses.
6.  **Best Practice Comparison:**  Comparing Requests' implementation against established security best practices for HTTP clients.

### 2. Security Implications of Key Components

This section breaks down the security implications of the key components identified in the scope.

**2.1 Core Functionality (`requests.get()`, `requests.post()`, etc.)**

*   **Threats:**
    *   **Server-Side Request Forgery (SSRF):**  Malicious users could provide crafted URLs to make Requests access internal resources or unintended external services.  This is a *major* concern.
    *   **HTTP Request Smuggling:**  Vulnerabilities in how Requests handles malformed requests could lead to request smuggling attacks, especially when interacting with vulnerable proxy servers or web servers.
    *   **Injection Attacks (Headers/Data):**  Unvalidated user input in headers or request bodies could lead to various injection attacks, depending on the target server.
    *   **Denial of Service (DoS):**  Large request bodies or responses could consume excessive resources, leading to denial of service.
    *   **Unintentional Data Leakage:**  Sensitive data included in URLs (e.g., API keys as query parameters) could be logged or exposed in transit.

*   **Mitigation Strategies:**
    *   **Strict URL Validation:**  Implement robust URL validation *before* making any requests.  This should include:
        *   **Whitelist Approach:**  If possible, restrict allowed URLs to a predefined whitelist of trusted domains and paths.  This is the *most secure* approach.
        *   **Schema Validation:**  Enforce `https://` for all requests unless explicitly configured otherwise (and even then, with extreme caution).
        *   **Domain Validation:**  Use a robust domain name validation library (not just simple string checks) to prevent homograph attacks and other domain spoofing techniques.
        *   **Path Validation:**  Sanitize and validate URL paths to prevent directory traversal attacks (`../` sequences).
        *   **Query Parameter Validation:**  Validate and encode query parameters to prevent injection attacks.  Consider using a structured approach (e.g., a dictionary) rather than directly manipulating URL strings.
    *   **Input Sanitization:**  Sanitize all user-provided data used in headers and request bodies.  The specific sanitization techniques depend on the expected data format (e.g., JSON, XML, form data).
    *   **Limit Request/Response Sizes:**  Implement limits on the maximum size of request bodies and responses to prevent DoS attacks.  Requests should provide a mechanism to configure these limits.
    *   **Avoid Sensitive Data in URLs:**  Never include sensitive data (API keys, passwords, tokens) in URL query parameters.  Use HTTP headers (e.g., `Authorization`) or request bodies instead.
    *   **Request Smuggling Prevention:**  Ensure that Requests uses a consistent and secure method for constructing and sending HTTP requests, minimizing the risk of ambiguities that could be exploited for request smuggling.  This is heavily reliant on `urllib3`.
    *   **SSRF Prevention:**
        *   **Avoid resolving DNS before validation:** Do not resolve the hostname to an IP address *before* validating the URL.  DNS resolution can be manipulated (DNS rebinding attacks).
        *   **Disallow loopback/private IPs:** Explicitly block requests to loopback addresses (127.0.0.1, ::1) and private IP address ranges (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16) unless explicitly required and carefully controlled.
        *   **Disallow unusual schemes:** Only allow `http` and `https` schemes.
        *   **Consider a dedicated network for outbound requests:** If possible, use a separate network or network namespace for making outbound requests, isolating them from internal resources.

**2.2 Session Management (`requests.Session()`)**

*   **Threats:**
    *   **Cookie Theft/Manipulation:**  If cookies are not handled securely, they could be stolen or manipulated by attackers, leading to session hijacking or other attacks.
    *   **Cross-Site Request Forgery (CSRF):**  If Requests automatically sends cookies with cross-origin requests, it could be vulnerable to CSRF attacks.
    *   **Session Fixation:**  If Requests does not properly handle session IDs after authentication, it could be vulnerable to session fixation attacks.
    *   **Credential Leakage:**  If authentication credentials are not stored and transmitted securely, they could be leaked.

*   **Mitigation Strategies:**
    *   **Secure Cookie Handling:**
        *   **`Secure` Flag:**  Ensure that cookies with sensitive data are always sent with the `Secure` flag, meaning they are only transmitted over HTTPS.  Requests should *default* to setting this flag when using HTTPS.
        *   **`HttpOnly` Flag:**  Encourage users to set the `HttpOnly` flag on cookies to prevent access from JavaScript, mitigating XSS attacks.  Requests could provide a helper function for this.
        *   **`SameSite` Attribute:**  Use the `SameSite` attribute (Strict, Lax, or None) to control when cookies are sent with cross-origin requests.  Requests should provide a way to configure this attribute.  `Lax` is a good default.
    *   **CSRF Protection:**  Requests should *not* automatically send cookies with cross-origin requests unless explicitly configured by the user.  Users should be educated about CSRF risks and encouraged to implement CSRF protection mechanisms on the server-side (e.g., CSRF tokens).
    *   **Session Fixation Prevention:**  After successful authentication, Requests should ensure that the session ID is regenerated.  This is typically handled by the server, but Requests should provide a mechanism to clear existing cookies and session data before establishing a new authenticated session.
    *   **Credential Management:**
        *   **Avoid Storing Credentials in Code:**  Never hardcode credentials in the application code.  Use environment variables, configuration files, or secure credential stores.
        *   **Secure Transmission:**  Always transmit credentials over HTTPS.
        *   **Proper Storage:**  If Requests needs to store credentials (e.g., for persistent authentication), it should use a secure storage mechanism, such as the operating system's credential store or a dedicated secrets management solution.

**2.3 Authentication Mechanisms (Basic, Digest, OAuth1, OAuth2)**

*   **Threats:**
    *   **Basic Authentication:**  Transmits credentials in Base64 encoding, which is easily decoded.  Vulnerable to sniffing if not used over HTTPS.
    *   **Digest Authentication:**  More secure than Basic, but still vulnerable to certain attacks (e.g., offline dictionary attacks).
    *   **OAuth 1.0a/2.0:**  Complex protocols with potential vulnerabilities if not implemented correctly.  Token leakage, improper redirect URI validation, and authorization code injection are common issues.
    *   **Credential Stuffing/Brute-Force:**  Attackers could attempt to guess credentials through repeated login attempts.

*   **Mitigation Strategies:**
    *   **HTTPS Enforcement:**  Always use HTTPS with *any* authentication mechanism.  Requests should *warn* or *error* if authentication is attempted over plain HTTP.
    *   **Basic Authentication:**  Discourage the use of Basic authentication unless absolutely necessary.  If used, strongly emphasize the need for HTTPS.
    *   **Digest Authentication:**  Provide clear guidance on the limitations of Digest authentication and recommend stronger alternatives when possible.
    *   **OAuth 1.0a/2.0:**
        *   **Follow Best Practices:**  Adhere strictly to the OAuth specifications and security best practices.
        *   **Validate Redirect URIs:**  Carefully validate redirect URIs to prevent open redirect vulnerabilities.  Use a whitelist approach.
        *   **Protect Tokens:**  Store and transmit access tokens and refresh tokens securely.
        *   **Use PKCE (Proof Key for Code Exchange):**  For public clients (e.g., mobile apps, SPAs), use PKCE to enhance the security of the authorization code flow.
        *   **Consider using a dedicated OAuth library:**  For complex OAuth implementations, consider using a dedicated OAuth library (e.g., `authlib`) that handles the protocol details securely.
    *   **Rate Limiting:**  Implement rate limiting on authentication attempts to mitigate credential stuffing and brute-force attacks.  This is primarily a server-side concern, but Requests could provide guidance or helper functions for detecting rate-limiting responses.

**2.4 HTTPS/TLS Configuration**

*   **Threats:**
    *   **Man-in-the-Middle (MITM) Attacks:**  If TLS/SSL is not configured correctly, attackers could intercept and modify communications.
    *   **Certificate Validation Bypass:**  If certificate verification is disabled or improperly implemented, attackers could present fake certificates.
    *   **Weak Cipher Suites/Protocols:**  Using outdated or weak cipher suites or TLS versions could expose communications to decryption.

*   **Mitigation Strategies:**
    *   **Certificate Verification by Default:**  Requests should *always* verify server certificates by default.  Disabling certificate verification should be strongly discouraged and require explicit user action.
    *   **Use `certifi`:**  Continue using `certifi` to provide a reliable and up-to-date set of root CA certificates.
    *   **TLS Version Enforcement:**  Enforce the use of secure TLS versions (TLS 1.2 or higher).  Deprecate and eventually remove support for older, insecure versions (SSLv2, SSLv3, TLS 1.0, TLS 1.1).
    *   **Cipher Suite Configuration:**  Allow users to configure the allowed cipher suites, but provide secure defaults.  Prioritize strong cipher suites (e.g., those using AEAD ciphers).
    *   **Custom CA Bundles:**  Provide a clear and secure mechanism for users to specify custom CA bundles when necessary (e.g., for interacting with internal services using self-signed certificates).  Ensure that this mechanism is not vulnerable to injection attacks.
    *   **OCSP Stapling/CRL Checking:**  Consider supporting OCSP stapling or CRL checking to verify the revocation status of certificates. This is a more advanced feature, but it enhances security.

**2.5 Proxy Support**

*   **Threats:**
    *   **Proxy Spoofing:**  Attackers could attempt to trick Requests into using a malicious proxy server.
    *   **Data Leakage through Proxies:**  Sensitive data could be logged or intercepted by untrusted proxy servers.
    *   **Proxy Authentication Issues:**  Weak or insecure proxy authentication could expose credentials.

*   **Mitigation Strategies:**
    *   **Secure Proxy Configuration:**  Provide clear guidance on how to configure proxies securely.  Emphasize the importance of using HTTPS proxies for secure communication.
    *   **Proxy Authentication:**  Support secure proxy authentication mechanisms (e.g., Basic, Digest, NTLM) and ensure that credentials are transmitted securely.
    *   **Proxy URL Validation:**  Validate proxy URLs to prevent injection attacks and ensure that they point to legitimate proxy servers.
    *   **`NO_PROXY` Environment Variable:**  Respect the `NO_PROXY` environment variable to allow users to bypass proxies for specific hosts or networks.
    *   **Warn about Plain HTTP Proxies:**  Issue a warning if a user configures an HTTP proxy for an HTTPS request, as this could expose sensitive data.

**2.6 Redirection Handling**

*   **Threats:**
    *   **Open Redirect Vulnerabilities:**  If Requests blindly follows redirects, it could be tricked into redirecting users to malicious websites.
    *   **SSRF via Redirects:**  Attackers could use redirects to bypass SSRF protections and access internal resources.
    *   **Credential Leakage via Redirects:**  If Requests automatically sends authentication headers with redirects, credentials could be leaked to unintended servers.

*   **Mitigation Strategies:**
    *   **Limit Redirects:**  Limit the number of redirects that Requests will follow by default.  A reasonable default (e.g., 30) should be set.
    *   **Validate Redirect URLs:**  Before following a redirect, validate the target URL using the same strict validation rules as for initial requests (see Section 2.1).
    *   **Same-Origin Policy for Headers:**  By default, Requests should *not* send authentication headers (e.g., `Authorization`) with redirects to different origins.  Users should be able to explicitly configure this behavior if needed.
    *   **`allow_redirects=False` Option:**  Provide a clear and easy way for users to disable redirects completely (`allow_redirects=False`).
    *   **Redirect History:**  Provide access to the redirect history so that users can inspect the chain of redirects and potentially detect malicious behavior.

**2.7 Timeout Configuration**

*   **Threats:**
    *   **Denial of Service (DoS):**  Long or infinite timeouts could allow attackers to tie up server resources, leading to denial of service.
    *   **Slowloris Attacks:**  Attackers could exploit slow connections and long timeouts to exhaust server resources.

*   **Mitigation Strategies:**
    *   **Reasonable Default Timeouts:**  Set reasonable default timeouts for both connection establishment and data transfer.  These defaults should be clearly documented.
    *   **Configurable Timeouts:**  Provide a clear and easy way for users to configure timeouts (e.g., `timeout` parameter).
    *   **Separate Connect and Read Timeouts:**  Allow users to specify separate timeouts for connection establishment and data transfer.
    *   **Guidance on Timeout Values:**  Provide guidance on how to choose appropriate timeout values based on the application's requirements and the expected network conditions.

**2.8 Header and Cookie Handling**

*   **Threats:**
    *   **Header Injection:**  Unvalidated user input in headers could lead to various injection attacks, including HTTP response splitting, cache poisoning, and cross-site scripting (XSS).
    *   **Cookie Manipulation:**  Attackers could modify cookies to bypass security controls or impersonate other users.

*   **Mitigation Strategies:**
    *   **Header Validation:**  Validate all user-provided header names and values.  Reject headers with invalid characters or suspicious patterns.
    *   **Header Encoding:**  Properly encode header values to prevent injection attacks.
    *   **Cookie Validation:**  Validate cookie names and values to prevent injection attacks.
    *   **Cookie Security Attributes:**  As discussed in Section 2.2, use the `Secure`, `HttpOnly`, and `SameSite` attributes to enhance cookie security.
    *   **Avoid Sensitive Data in Cookies:**  Minimize the amount of sensitive data stored in cookies.  Use session identifiers instead of storing actual data.

**2.9 Dependency Management**

*   **Threats:**
    *   **Supply Chain Attacks:**  Vulnerabilities in Requests' dependencies could be exploited to compromise applications that use Requests.
    *   **Outdated Dependencies:**  Using outdated dependencies with known vulnerabilities increases the risk of attack.

*   **Mitigation Strategies:**
    *   **Careful Dependency Selection:**  Choose dependencies carefully, prioritizing libraries with a strong security track record and active maintenance.
    *   **Pin Dependencies:**  Pin dependencies to specific versions (or narrow version ranges) to prevent unexpected updates that could introduce vulnerabilities or break compatibility. Use tools like `pip-tools` to manage pinned dependencies.
    *   **Regular Dependency Updates:**  Regularly update dependencies to address security vulnerabilities.  Use automated tools (e.g., Dependabot, Renovate) to monitor for updates and create pull requests.
    *   **Vulnerability Scanning:**  Use tools like `pip-audit`, `safety`, or `snyk` to scan dependencies for known vulnerabilities. Integrate this scanning into the CI/CD pipeline.
    *   **Auditing `urllib3`:** Pay *particular* attention to the security of `urllib3`, as it handles the low-level HTTP communication and TLS/SSL verification.  Monitor for security advisories related to `urllib3`.
    *   **Auditing `certifi`:** Ensure `certifi` is kept up-to-date to provide the latest root CA certificates.

**2.10 Deployment and Build Process**

*   **Threats:**
    *   **Compromised Build Environment:**  If the build environment is compromised, attackers could inject malicious code into the Requests package.
    *   **Compromised PyPI Account:**  If the PyPI account used to publish Requests is compromised, attackers could upload a malicious version of the package.
    *   **Tampering with Downloaded Packages:**  Attackers could intercept and modify the Requests package during download.

*   **Mitigation Strategies:**
    *   **Secure Build Environment:**  Use a secure and isolated build environment (e.g., a dedicated CI/CD server) to build the Requests package.
    *   **Code Signing:**  Digitally sign the Requests package before uploading it to PyPI. This ensures the integrity of the package and verifies its origin.
    *   **Two-Factor Authentication (2FA):**  Enable 2FA for the PyPI account used to publish Requests.
    *   **HTTPS for PyPI:**  Ensure that pip is configured to use HTTPS to download packages from PyPI. This is the default behavior, but it's important to verify.
    *   **Hash Verification:**  Provide SHA256 hashes for released packages. Users can verify the integrity of downloaded packages by comparing their hashes against the published hashes.  `pip` can do this automatically.
    *   **Regular Security Audits:**  Conduct regular security audits of the build and deployment process to identify and address potential vulnerabilities.

### 3. Actionable Mitigation Strategies (Summary)

The following table summarizes the actionable mitigation strategies, categorized by the component they address:

| Component                     | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         