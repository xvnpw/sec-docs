Here is a deep security analysis of urllib3 based on the provided security design review, tailored to your request:

## Deep Security Analysis of urllib3

### 1. Objective, Scope, and Methodology

**Objective:**

The primary objective of this deep security analysis is to thoroughly examine the urllib3 library's architecture and key components to identify potential security vulnerabilities and recommend specific, actionable mitigation strategies. This analysis aims to enhance the security posture of urllib3 and, by extension, the vast ecosystem of Python applications that depend on it.  The focus is on providing practical and targeted recommendations for the urllib3 development team to improve the library's resilience against HTTP-related security threats.

**Scope:**

This analysis focuses on the following key components of urllib3, as outlined in the Container Diagram:

*   **Connection Pool Manager:** Security of connection reuse, session management, and resource handling.
*   **Request Builder:** Prevention of request manipulation vulnerabilities like header injection and request smuggling.
*   **Response Parser:** Robustness against response-based attacks such as response splitting and handling of malformed responses.
*   **Retry Logic:** Security implications of retry mechanisms, including potential for denial-of-service amplification.
*   **URL Parsing:** Vulnerabilities related to URL handling, including URL injection and parsing inconsistencies.
*   **TLS/SSL Handler:** Security of TLS/SSL implementation, certificate validation, and cryptographic configurations.
*   **HTTP/HTTPS Client:** Core network communication layer and its potential vulnerabilities.

The analysis will also consider the overall architecture, data flow, and existing security controls identified in the security design review to provide a holistic perspective.

**Methodology:**

This analysis employs a risk-based approach, utilizing the provided security design review documentation and inferred architecture to:

1.  **Component Decomposition:** Break down urllib3 into its key components as defined in the Container Diagram.
2.  **Threat Modeling:** For each component, identify potential security threats based on common HTTP vulnerabilities, input validation weaknesses, cryptographic misconfigurations, and general software security principles.
3.  **Control Mapping:** Map existing and recommended security controls from the security design review to the identified threats and components.
4.  **Gap Analysis:** Identify gaps between existing controls and potential threats, highlighting areas requiring further security enhancements.
5.  **Mitigation Strategy Formulation:** Develop specific, actionable, and tailored mitigation strategies for each identified threat, focusing on practical implementation within the urllib3 codebase and development processes.
6.  **Prioritization:**  Prioritize mitigation strategies based on the severity of the potential impact and the likelihood of exploitation, considering the business risks outlined in the security design review.

This methodology is based on a document review and architectural analysis. A full code audit and penetration testing would provide a more comprehensive security assessment but are outside the scope of this analysis based on the provided information.

### 2. Security Implications of Key Components

Here's a breakdown of the security implications for each key component of urllib3:

**2.1. Connection Pool Manager:**

*   **Functionality:** Manages pools of HTTP connections to improve performance by reusing connections.
*   **Security Implications:**
    *   **Connection Reuse Security:** If not handled carefully, connection reuse across different requests or users (in a multi-tenant application using urllib3 internally) could lead to information leakage or session hijacking.  While less relevant for a library itself, it's important to ensure no internal state related to a previous request is inadvertently carried over to a new request on a reused connection.
    *   **Connection Limits and DoS:** Improperly configured connection pool limits could lead to resource exhaustion and denial-of-service if an attacker can force urllib3 to open and maintain a large number of connections.
    *   **Session/Cookie Handling:** If the connection pool manager implicitly handles session information or cookies, vulnerabilities in this handling could lead to session fixation or other session-related attacks.  Urllib3 should ensure clear separation of concerns and not introduce implicit session management vulnerabilities.
    *   **Resource Leaks:** Failure to properly close or release connections back to the pool after errors or timeouts could lead to resource leaks, eventually causing performance degradation or denial of service.

**2.2. Request Builder:**

*   **Functionality:** Constructs HTTP requests based on user inputs (URL, headers, body, etc.).
*   **Security Implications:**
    *   **Header Injection:** If user-provided data is directly inserted into HTTP headers without proper sanitization or validation, attackers could inject malicious headers. This can lead to various attacks, including:
        *   **HTTP Response Splitting/Smuggling:** Injecting headers to manipulate the response structure, potentially allowing attackers to inject content or redirect users.
        *   **XSS via Headers:** In certain scenarios, injected headers might be reflected in server responses and lead to Cross-Site Scripting (XSS) vulnerabilities if not properly handled by the receiving application or browser.
    *   **Request Smuggling:** While primarily a server-side vulnerability, vulnerabilities in request building, especially related to handling of Transfer-Encoding and Content-Length headers, could contribute to request smuggling if combined with server-side weaknesses.
    *   **Method Spoofing:**  If the request builder doesn't strictly validate or control the HTTP method, it might be possible to craft requests with unexpected or malicious methods.
    *   **URL Injection (related to URL Parsing):**  If the request builder relies on the URL Parsing component and it has vulnerabilities, it could indirectly lead to URL injection issues.

**2.3. Response Parser:**

*   **Functionality:** Parses HTTP responses received from servers.
*   **Security Implications:**
    *   **Response Splitting:**  If the response parser is not robust and fails to properly handle malformed or malicious response headers, it could be vulnerable to response splitting attacks. This is less common in client libraries but still a potential concern if parsing logic is flawed.
    *   **Denial of Service via Malformed Responses:**  Parsing extremely large headers, bodies, or crafted responses could lead to excessive resource consumption and denial-of-service.
    *   **Information Leakage via Error Handling:** Verbose error messages during response parsing could inadvertently leak sensitive information about the server or internal workings.
    *   **Bypass Security Controls:**  A flawed response parser might fail to correctly interpret security-related headers (e.g., Content-Security-Policy, HSTS), potentially bypassing intended security controls in the application.

**2.4. Retry Logic:**

*   **Functionality:** Implements retry mechanisms for handling transient network errors or server issues.
*   **Security Implications:**
    *   **Denial of Service Amplification:**  Aggressive retry policies, especially with exponential backoff, could amplify denial-of-service attacks if an attacker can intentionally trigger server errors or network disruptions.  Careful configuration and limits on retry attempts are crucial.
    *   **Credential Exposure during Retries:** If authentication is involved, retrying requests with the same credentials repeatedly after failures could increase the risk of brute-force attacks or credential stuffing if not properly rate-limited or protected.
    *   **Unintended Side Effects:** Retrying requests that are not idempotent (e.g., POST requests that modify data) could lead to unintended side effects or data corruption if retries are not carefully managed and the application logic is not designed to handle them.

**2.5. URL Parsing:**

*   **Functionality:** Parses URLs to extract components like scheme, host, port, and path.
*   **Security Implications:**
    *   **URL Injection/Redirection:** Vulnerabilities in URL parsing could allow attackers to inject malicious URLs or manipulate parsed components, leading to:
        *   **Open Redirection:**  If the parsed URL is used for redirection logic in the application, attackers could redirect users to malicious sites.
        *   **Server-Side Request Forgery (SSRF):** If the parsed URL is used to make internal requests, attackers could potentially craft URLs to access internal resources or services.
        *   **Bypass Access Controls:**  URL parsing inconsistencies or normalization issues could be exploited to bypass URL-based access controls.
    *   **Canonicalization Issues:** Inconsistent URL canonicalization (e.g., handling of encoding, case sensitivity, path normalization) could lead to security bypasses or unexpected behavior.
    *   **Denial of Service via Complex URLs:** Parsing extremely long or complex URLs could lead to excessive resource consumption and denial-of-service.

**2.6. TLS/SSL Handler:**

*   **Functionality:** Handles TLS/SSL encryption and certificate validation for HTTPS connections.
*   **Security Implications:**
    *   **Man-in-the-Middle Attacks (MITM):**  Insufficient or improper certificate validation is the primary risk. If certificate validation is disabled or flawed, urllib3 could be vulnerable to MITM attacks, allowing attackers to intercept and modify encrypted traffic.
    *   **Downgrade Attacks:**  If urllib3 supports weak or outdated TLS versions or cipher suites, it could be susceptible to downgrade attacks, forcing the connection to use less secure encryption.
    *   **Cryptographic Misconfigurations:**  Incorrect configuration of TLS options, such as cipher suite selection, TLS version enforcement, or session resumption, could weaken security.
    *   **Dependency Vulnerabilities:**  Urllib3 relies on underlying cryptographic libraries (like `ssl` module in Python). Vulnerabilities in these dependencies directly impact the security of urllib3's TLS/SSL handling.
    *   **Certificate Pinning Issues:** If certificate pinning is implemented (less common in a general-purpose library), improper pinning logic or management of pinned certificates could lead to connection failures or security bypasses.

**2.7. HTTP/HTTPS Client:**

*   **Functionality:** Core component for sending HTTP/HTTPS requests and receiving responses over the network.
*   **Security Implications:**
    *   **Network-Level Attacks:**  While urllib3 itself might not be directly vulnerable to network-level attacks, it needs to be resilient to them.  This includes handling network timeouts, connection resets, and other network anomalies gracefully without introducing vulnerabilities.
    *   **Socket Security:** Secure handling of sockets is crucial.  Improper socket closure or resource management could lead to resource leaks or denial-of-service.
    *   **Protocol Compliance Issues:**  Non-compliance with HTTP/HTTPS protocol specifications could lead to unexpected behavior or vulnerabilities if servers exploit these deviations.
    *   **Timing Attacks (Less likely but consider):** In very specific scenarios, timing differences in network operations or data processing might be exploitable for timing attacks, although this is less likely in a general HTTP client library.

### 3. Architecture, Components, and Data Flow Inference

Based on the provided diagrams and descriptions, the architecture of urllib3 can be inferred as follows:

1.  **User Application Interaction:** Python applications interact with urllib3 through its public API. This API likely provides functions for making HTTP requests, configuring connection pools, handling retries, and managing TLS/SSL settings.
2.  **Request Flow:**
    *   When an application makes a request, the **Request Builder** component constructs the HTTP request message based on the provided parameters (URL, headers, body, etc.).
    *   The **URL Parsing** component is used to parse the target URL, extracting scheme, host, port, and path.
    *   The **Connection Pool Manager** is consulted to obtain an existing connection from the pool or establish a new connection if necessary.
    *   For HTTPS requests, the **TLS/SSL Handler** is invoked to establish a secure TLS/SSL connection with the server, performing certificate validation.
    *   The **HTTP/HTTPS Client** component sends the constructed request over the network connection.
3.  **Response Flow:**
    *   The **HTTP/HTTPS Client** receives the HTTP response from the server.
    *   The **Response Parser** component parses the response, extracting headers, body, and status code.
    *   The **Retry Logic** component checks if the response indicates a transient error or a retryable condition. If so, it may initiate a retry attempt.
    *   The parsed response is returned to the calling Python application.
4.  **Data Flow:** Data flows from the Python application into urllib3 as request parameters, through the components for processing and network communication, and back to the application as parsed HTTP responses. Sensitive data, such as authentication credentials or user data, may be included in requests and responses and must be handled securely throughout this flow, especially during TLS/SSL encryption and decryption.

**Inferred Data Flow Diagram (Simplified):**

```mermaid
graph LR
    A[Python Application] --> B(urllib3 API);
    B --> C[Request Builder];
    B --> D[URL Parsing];
    C --> E[Connection Pool Manager];
    D --> E;
    E --> F{TLS/SSL Handler (HTTPS?)};
    F -- Yes --> G[HTTP/HTTPS Client (TLS)];
    F -- No --> H[HTTP/HTTPS Client (Plain HTTP)];
    G --> I[Network];
    H --> I;
    I --> J[Web/API Server];
    J --> I;
    I --> K[HTTP/HTTPS Client (Receiving)];
    K --> L[Response Parser];
    K --> M[Retry Logic];
    L --> B;
    M --> E;
    B --> A;

    style B fill:#f9f,stroke:#333,stroke-width:2px
```

### 4. Specific and Tailored Security Recommendations for urllib3

Based on the identified security implications and inferred architecture, here are specific and tailored security recommendations for the urllib3 project:

**General Recommendations:**

*   **R1: Formalize Security Vulnerability Reporting Process:** Clearly document the process for reporting security vulnerabilities, including preferred channels (e.g., security mailing list, GitHub security advisories).  Establish a defined SLA for acknowledging and addressing reported vulnerabilities.
*   **R2: Enhance Automated Security Testing in CI/CD:**
    *   **Implement SAST (Static Application Security Testing):** Integrate SAST tools into the CI/CD pipeline to automatically detect potential code-level vulnerabilities (e.g., header injection, format string bugs). Focus SAST rules on areas like input validation, string manipulation, and cryptographic operations.
    *   **Implement DAST (Dynamic Application Security Testing) / Fuzzing:**  While DAST is less directly applicable to a library, consider incorporating fuzzing techniques to test the robustness of URL parsing, response parsing, and other input handling components against malformed or unexpected inputs.
    *   **Dependency Vulnerability Scanning:**  Ensure automated dependency scanning is in place to detect and alert on vulnerabilities in urllib3's dependencies.  Automate updates to dependencies to address vulnerabilities promptly.
*   **R3: Conduct Regular Security Audits:**  Perform periodic security audits by external security experts to review the codebase, architecture, and security controls. Focus audits on areas identified as high-risk in this analysis (e.g., TLS/SSL handling, input validation, parsing logic).
*   **R4: Security Focused Code Reviews:**  Emphasize security considerations during code reviews.  Train maintainers on common HTTP vulnerabilities and secure coding practices.  Specifically review changes related to input handling, parsing, TLS/SSL, and network communication for potential security flaws.
*   **R5: Improve Documentation on Security Best Practices for Users:**  Provide clear documentation for users on how to use urllib3 securely. This should include:
    *   Guidance on secure TLS/SSL configuration options.
    *   Best practices for handling sensitive data in requests and responses.
    *   Warnings about potential security pitfalls and insecure usage patterns.
*   **R6: Consider Signed Releases and SBOM:** Implement signed releases to ensure package integrity and authenticity. Generate and publish SBOM (Software Bill of Materials) for each release to improve supply chain transparency and allow users to track dependencies.

**Component-Specific Recommendations:**

*   **Connection Pool Manager:**
    *   **R7: Review Connection Reuse Logic:**  Thoroughly review the connection reuse logic to ensure no sensitive information or state is leaked between requests using the same connection.  Document the connection reuse behavior clearly.
    *   **R8: Implement Connection Pool Limits and Resource Management:**  Ensure robust configuration options for connection pool limits to prevent resource exhaustion DoS.  Implement proper connection cleanup and resource release mechanisms to avoid leaks.

*   **Request Builder:**
    *   **R9: Implement Strict Header Validation:**  Implement robust input validation and sanitization for HTTP headers to prevent header injection vulnerabilities.  Consider using parameterized request construction methods if applicable to further mitigate injection risks.
    *   **R10:  Method Validation:**  Strictly validate or control the allowed HTTP methods to prevent method spoofing.

*   **Response Parser:**
    *   **R11: Robust Response Header Parsing:**  Strengthen response header parsing to handle malformed or malicious headers robustly and prevent response splitting vulnerabilities.
    *   **R12: DoS Protection in Response Parsing:**  Implement safeguards to prevent denial-of-service attacks via excessively large or complex responses.  Consider limits on header sizes and body sizes during parsing.

*   **Retry Logic:**
    *   **R13:  Implement Retry Limits and Backoff Controls:**  Provide configurable limits on retry attempts and backoff strategies to prevent DoS amplification.  Document the security implications of aggressive retry policies.
    *   **R14:  Contextual Retry Logic:**  Consider making retry logic context-aware, avoiding retries for requests that are known to be non-idempotent or have security implications if retried excessively.

*   **URL Parsing:**
    *   **R15:  Thorough URL Validation and Sanitization:**  Implement comprehensive URL validation and sanitization to prevent URL injection and redirection vulnerabilities.  Use well-vetted URL parsing libraries and ensure consistent URL canonicalization.
    *   **R16:  DoS Protection in URL Parsing:**  Protect against DoS attacks via excessively long or complex URLs by implementing limits on URL length and parsing complexity.

*   **TLS/SSL Handler:**
    *   **R17:  Enforce Secure TLS Configuration Defaults:**  Ensure default TLS configuration uses secure cipher suites, enforces a minimum TLS version (TLS 1.2 or higher), and enables best practices like certificate validation and secure session resumption.
    *   **R18:  Robust Certificate Validation:**  Maintain robust and up-to-date certificate validation logic, ensuring proper handling of certificate chains, revocation checks (OCSP, CRL), and hostname verification.
    *   **R19:  Regularly Update Cryptographic Dependencies:**  Proactively monitor and update underlying cryptographic libraries to address known vulnerabilities.
    *   **R20:  Provide Clear TLS Configuration Options:**  Offer users clear and well-documented options to customize TLS/SSL settings, allowing them to tailor security to their specific needs while providing secure defaults.

*   **HTTP/HTTPS Client:**
    *   **R21:  Secure Socket Handling:**  Review and ensure secure socket handling practices, including proper socket closure, timeout management, and error handling to prevent resource leaks and unexpected behavior.
    *   **R22:  Protocol Compliance Review:**  Periodically review HTTP/HTTPS protocol compliance to ensure adherence to standards and avoid potential vulnerabilities arising from protocol deviations.

### 5. Actionable Mitigation Strategies Applicable to Identified Threats

Here are actionable mitigation strategies for some of the key threats identified, tailored to urllib3:

| Threat                                  | Component Affected        | Actionable Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Header Injection**                        | Request Builder             | **Input Sanitization & Validation (R9):** Implement strict validation rules for header names and values. Sanitize user-provided data before including it in headers. Use dedicated header construction methods provided by libraries that handle escaping and encoding correctly. Consider using Content Security Policy (CSP) headers to mitigate potential XSS if headers are reflected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           