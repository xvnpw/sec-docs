## Deep Security Analysis of Sourcery Code Generation Tool

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to identify and evaluate potential security vulnerabilities and risks associated with the Sourcery code generation tool, as described in the provided security design review document and inferred from its architecture. The analysis will focus on understanding the tool's components, data flow, and potential attack vectors to provide actionable and tailored security recommendations for the Sourcery project.

**Scope:**

The scope of this analysis encompasses the following aspects of Sourcery:

*   **Core Components:** CLI Interface, Swift Parser, Template Engine, Code Generator, and Configuration Manager, as outlined in the C4 Container diagram.
*   **Deployment Architecture:** Primarily focusing on the typical local CLI deployment on developer workstations, and secondarily considering CI/CD integration.
*   **Build Process:**  Analyzing the build pipeline for Sourcery itself, including dependency management and distribution.
*   **Security Controls:** Reviewing existing, accepted, and recommended security controls as listed in the security design review.
*   **Risk Assessment:**  Considering the critical business processes and data involved in using and distributing Sourcery.

The analysis will *not* cover:

*   Detailed code-level vulnerability analysis (e.g., penetration testing or extensive source code review).
*   Security of the underlying operating systems or developer workstations beyond their interaction with Sourcery.
*   Security of specific Swift projects that *use* Sourcery, but rather the security of Sourcery itself.
*   Compliance with specific security standards (SOC 2, ISO 27001) unless explicitly mentioned in the provided documentation.

**Methodology:**

This analysis will employ the following methodology:

1.  **Document Review:**  Thorough review of the provided security design review document, including business posture, security posture, C4 diagrams, deployment architecture, build process, risk assessment, questions, and assumptions.
2.  **Architecture Inference:**  Inferring the detailed architecture, component interactions, and data flow of Sourcery based on the provided diagrams, descriptions, and general knowledge of code generation tools.
3.  **Threat Modeling:** Identifying potential threats and attack vectors targeting Sourcery's components and functionalities, considering the OWASP Top 10 and other relevant security risks for software applications.
4.  **Security Control Analysis:** Evaluating the effectiveness of existing and recommended security controls in mitigating identified threats.
5.  **Tailored Recommendation Generation:**  Developing specific, actionable, and tailored security recommendations and mitigation strategies for Sourcery, focusing on practical improvements within the project's context.
6.  **Prioritization:**  Implicitly prioritizing recommendations based on the severity of the identified risks and the feasibility of implementation.

### 2. Security Implications of Key Components

Based on the C4 Container diagram and component descriptions, the following security implications are identified for each key component of Sourcery:

**2.1. CLI Interface:**

*   **Security Implication:** **Command Injection**. If the CLI interface improperly handles or validates user-provided arguments, especially those related to file paths, template paths, or configuration settings, it could be vulnerable to command injection attacks. An attacker might be able to inject malicious commands that are executed by the underlying operating system with the privileges of the user running Sourcery.
    *   **Threat:** Malicious developer or compromised developer workstation.
    *   **Vulnerability:** Insufficient input validation of command-line arguments.
    *   **Impact:** Arbitrary code execution on the developer's workstation, potentially leading to data exfiltration, system compromise, or denial of service.
    *   **Specific Recommendation:** Implement robust input validation and sanitization for all command-line arguments. Use parameterized commands or safe APIs for interacting with the operating system instead of directly constructing shell commands from user inputs.

*   **Security Implication:** **Information Disclosure through Logging**. If the CLI interface logs sensitive information, such as file paths of Swift projects, template contents, or configuration details, this information could be exposed if logs are not properly secured.
    *   **Threat:** Unauthorized access to logs, either locally or in a CI/CD environment.
    *   **Vulnerability:** Logging sensitive data without proper access controls or redaction.
    *   **Impact:** Disclosure of project structure, potentially sensitive code snippets within templates, or configuration details that could aid attackers in further exploits.
    *   **Specific Recommendation:** Review logging practices and ensure that sensitive information is not logged. If logging is necessary, implement proper access controls for log files and consider redacting sensitive data before logging.

**2.2. Swift Parser:**

*   **Security Implication:** **Parser Vulnerabilities (Denial of Service, Code Execution)**. The Swift Parser is responsible for processing potentially untrusted Swift code. Vulnerabilities in the parser, such as buffer overflows, infinite loops, or stack overflows, could be exploited by providing maliciously crafted Swift code. This could lead to denial of service (DoS) by crashing Sourcery or, in more severe cases, potentially allow for code execution if memory corruption vulnerabilities are present.
    *   **Threat:** Malicious developer, malicious Swift code in project, or attacker attempting to exploit Sourcery through crafted Swift files.
    *   **Vulnerability:** Bugs in the Swift parsing logic, especially in handling edge cases, malformed input, or deeply nested structures.
    *   **Impact:** Denial of service, resource exhaustion, or potentially arbitrary code execution on the developer's workstation.
    *   **Specific Recommendation:** Implement rigorous input validation and sanitization for Swift code input. Utilize robust parsing libraries or techniques that are resistant to common parser vulnerabilities. Consider fuzzing the Swift parser with a wide range of valid and invalid Swift code inputs to identify potential weaknesses. Regularly update the Swift parser component to incorporate security patches and improvements.

**2.3. Template Engine:**

*   **Security Implication:** **Template Injection**. The Template Engine processes templates, which can contain logic and potentially user-provided data. If the template engine is not properly secured, it could be vulnerable to template injection attacks. An attacker could craft malicious templates or manipulate input data to execute arbitrary code within the template engine's context, potentially gaining control over code generation or the developer's environment.
    *   **Threat:** Malicious developer, compromised templates, or attacker attempting to exploit template processing.
    *   **Vulnerability:** Insecure template parsing and execution, lack of proper sandboxing or input sanitization within templates.
    *   **Impact:** Arbitrary code execution during template processing, potentially leading to generation of malicious code, data exfiltration, or denial of service.
    *   **Specific Recommendation:**  Use a secure template engine that provides built-in protection against template injection. Implement strict input sanitization and output encoding within templates. Avoid allowing dynamic template loading from untrusted sources. Provide clear guidelines to developers on secure template development practices, emphasizing the risks of including user-provided data directly in templates without proper sanitization. Consider using a template engine with a strong security track record and active community support.

**2.4. Code Generator:**

*   **Security Implication:** **Code Injection in Generated Code**. While less direct, if the Code Generator does not properly handle output encoding or escaping, it could inadvertently introduce code injection vulnerabilities in the *generated* Swift code. This is more likely if the template engine produces output that is directly inserted into the generated code without proper sanitization.
    *   **Threat:**  Subtle vulnerabilities introduced in generated code that could be exploited later in the application lifecycle.
    *   **Vulnerability:** Lack of proper output encoding or escaping in the code generation process.
    *   **Impact:** Introduction of vulnerabilities (e.g., cross-site scripting if generated code is used in web contexts, or other injection flaws) in the Swift project that uses Sourcery.
    *   **Specific Recommendation:** Implement output encoding and escaping in the Code Generator to ensure that any data inserted into the generated code is properly sanitized and does not introduce injection vulnerabilities.  Specifically, consider context-aware output encoding based on where the generated code will be used.

**2.5. Configuration Manager:**

*   **Security Implication:** **Configuration Tampering**. If Sourcery's configuration files are not properly protected, they could be tampered with by a malicious actor. This could lead to Sourcery behaving unexpectedly, generating incorrect or even malicious code.
    *   **Threat:** Malicious developer or compromised developer workstation.
    *   **Vulnerability:** Lack of integrity protection for configuration files.
    *   **Impact:**  Generation of incorrect or malicious code, disruption of development workflow.
    *   **Specific Recommendation:**  While less critical for a local CLI tool, consider implementing integrity checks for configuration files (e.g., using checksums).  Clearly document the expected location and format of configuration files to prevent confusion and potential misuse.

### 3. Architecture, Components, and Data Flow Inference

Based on the diagrams and descriptions, the inferred architecture and data flow of Sourcery are as follows:

1.  **Developer Interaction:** The developer interacts with Sourcery through the **CLI Interface**, providing commands and arguments specifying the Swift project codebase, templates, and configuration.
2.  **Configuration Loading:** The **Configuration Manager** loads configuration settings from specified files or default locations, defining template paths, output directories, and other operational parameters.
3.  **Swift Code Parsing:** The **Swift Parser** reads and parses the Swift project codebase files specified by the developer. It transforms the Swift code into an Abstract Syntax Tree (AST) or an intermediate representation that is easier for the Template Engine to process.
4.  **Template Processing:** The **Template Engine** reads and parses the provided templates. It then combines the parsed Swift code information (from the AST) with the logic and directives within the templates. This process involves data binding, where information extracted from the Swift code is used to populate placeholders or variables within the templates.
5.  **Code Generation:** The **Code Generator** takes the output from the Template Engine, which is essentially a structured representation of the desired generated code. It then formats this output into valid Swift code syntax and writes it to the specified output files within the Swift project codebase.
6.  **Integration into Development Workflow:** The generated Swift code is then integrated into the developer's workflow, typically within an IDE like Xcode, and managed under version control (Git).

**Data Flow Summary:**

Developer Input (CLI Commands, Templates, Configuration) -> CLI Interface -> Configuration Manager -> Swift Parser (Swift Codebase -> AST) -> Template Engine (AST + Templates -> Template Output) -> Code Generator (Template Output -> Generated Swift Code) -> Swift Project Codebase.

**Security-Relevant Data Flows:**

*   **Untrusted Input to Swift Parser:** Swift code from the project codebase, which could potentially be crafted to exploit parser vulnerabilities.
*   **Untrusted Input to Template Engine:** Templates themselves, especially if sourced from external or untrusted locations, and data passed from the Swift Parser to the Template Engine.
*   **Output from Template Engine to Code Generator:**  The output of the template engine, if not properly sanitized, could lead to code injection in the generated code.

### 4. Specific and Tailored Security Recommendations for Sourcery

Based on the identified security implications and the architecture analysis, here are specific and tailored security recommendations for the Sourcery project:

1.  **Prioritize Input Validation Hardening for Swift Parser:**
    *   **Action:** Invest significant effort in hardening the Swift Parser component. Implement rigorous input validation for all Swift code inputs. Use established parsing techniques that minimize vulnerabilities.
    *   **Rationale:** The Swift Parser is a critical entry point for potentially malicious input. Parser vulnerabilities can have severe consequences.
    *   **Specific Steps:**
        *   Implement comprehensive input validation to reject malformed or unexpected Swift syntax.
        *   Consider using a well-vetted and actively maintained Swift parsing library if not already doing so.
        *   Perform fuzz testing on the Swift Parser with a wide range of valid and invalid Swift code samples, including edge cases and potentially malicious constructs.
        *   Regularly update the Swift Parser component to address any discovered vulnerabilities and incorporate security patches.

2.  **Implement Secure Template Processing and Mitigate Template Injection Risks:**
    *   **Action:**  Choose a template engine with strong security features and actively mitigate template injection risks.
    *   **Rationale:** Template injection is a significant threat in code generation tools. Secure template processing is crucial to prevent arbitrary code execution.
    *   **Specific Steps:**
        *   If not already using one, select a template engine known for its security and resistance to template injection attacks (e.g., consider engines with built-in sandboxing or context-aware escaping).
        *   Implement strict output encoding and escaping within templates to sanitize any data inserted into the generated code.
        *   Provide clear and comprehensive guidelines to developers on secure template development practices, emphasizing the risks of template injection and how to avoid them.
        *   Consider implementing a "safe mode" for template execution that restricts access to potentially dangerous functions or system resources.

3.  **Enhance CLI Input Validation and Command Handling:**
    *   **Action:**  Strengthen input validation for all CLI arguments and ensure secure command handling to prevent command injection.
    *   **Rationale:** The CLI interface is the primary user interaction point and a potential entry point for command injection attacks.
    *   **Specific Steps:**
        *   Implement robust input validation for all command-line arguments, including file paths, template paths, and configuration settings.
        *   Use parameterized commands or safe APIs for interacting with the operating system instead of directly constructing shell commands from user inputs.
        *   Avoid using shell interpreters to execute commands derived from user input.
        *   Sanitize or escape any user-provided input that is used in system commands.

4.  **Establish Secure Template Development Guidelines and Best Practices:**
    *   **Action:**  Create and disseminate clear guidelines and best practices for developers on how to create secure Sourcery templates.
    *   **Rationale:** Developers using Sourcery need to be aware of security risks associated with templates and how to write secure templates.
    *   **Specific Steps:**
        *   Document common template injection vulnerabilities and how to avoid them in the context of Sourcery.
        *   Provide examples of secure template coding practices, including input sanitization, output encoding, and avoiding dynamic code execution within templates.
        *   Consider providing template linters or static analysis tools that can help developers identify potential security issues in their templates.
        *   Educate developers on the importance of template security and provide training resources.

5.  **Implement Automated Security Testing in the Build Pipeline:**
    *   **Action:** Integrate automated security testing tools into the Sourcery build pipeline.
    *   **Rationale:** Automated security testing helps to proactively identify and address security vulnerabilities in Sourcery's codebase.
    *   **Specific Steps:**
        *   Implement Static Application Security Testing (SAST) tools to automatically analyze the Sourcery codebase for potential security flaws during the build process.
        *   Integrate Dependency Scanning to identify and address vulnerabilities in third-party libraries and dependencies used by Sourcery.
        *   Consider incorporating fuzz testing into the build pipeline, especially for the Swift Parser and Template Engine components.
        *   Establish a process for reviewing and addressing security vulnerabilities identified by automated testing tools.

6.  **Promote Community Security Review and Vulnerability Reporting:**
    *   **Action:** Leverage the open-source nature of Sourcery to encourage community security review and establish a clear vulnerability reporting process.
    *   **Rationale:** Community involvement can significantly enhance the security of open-source projects.
    *   **Specific Steps:**
        *   Clearly document a process for reporting security vulnerabilities in Sourcery.
        *   Encourage security researchers and the community to review the Sourcery codebase for potential security issues.
        *   Publicly acknowledge and credit security researchers who responsibly disclose vulnerabilities.
        *   Establish a timely process for addressing and patching reported vulnerabilities.

### 5. Actionable Mitigation Strategies

| Recommendation                                                     | Actionable Steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               