## Apache Flink Security Analysis

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to conduct a thorough security assessment of the Apache Flink framework, focusing on its key components, architecture, data flow, and deployment models.  The analysis aims to identify potential security vulnerabilities, assess existing security controls, and provide actionable recommendations to mitigate identified risks.  The primary goal is to enhance the overall security posture of Flink deployments and protect against threats related to data breaches, system compromise, and operational disruption.  We will specifically analyze:

*   **JobManager:**  The central coordination component.
*   **TaskManager:**  The worker nodes executing tasks.
*   **Resource Manager Interaction (specifically Kubernetes):**  How Flink interacts with resource management systems.
*   **Data Input/Output (Connectors):**  Security of data ingestion and egress.
*   **State Management:**  How Flink manages application state securely.
*   **Configuration Management:**  How configuration impacts security.
*   **Inter-component Communication:** Security of communication channels.
*   **User-Defined Functions (UDFs):** Risks associated with user-supplied code.
*   **Build Process:** Security of the build pipeline.

**Scope:**

This analysis covers Apache Flink version 1.18 (as a representative recent version) and its core components.  It focuses on the security aspects of the framework itself, including its interactions with common external systems like Kubernetes, data sources (Kafka, HDFS, etc.), data sinks, and monitoring tools.  The analysis *does not* cover the security of these external systems themselves, except where Flink's interaction with them introduces specific vulnerabilities.  It also does not cover application-specific security logic implemented *within* Flink jobs, except for the security of User-Defined Functions (UDFs).

**Methodology:**

This analysis employs a multi-faceted approach:

1.  **Design Review:**  Analyzing the provided security design review, including C4 diagrams, deployment models, and build process descriptions.
2.  **Codebase Examination (Inferred):**  Inferring security-relevant aspects of the codebase based on the design review, documentation, and common Flink usage patterns.  This is not a full code audit, but rather a targeted examination of key areas.
3.  **Documentation Review:**  Consulting the official Apache Flink documentation for security best practices, configuration options, and known vulnerabilities.
4.  **Threat Modeling:**  Identifying potential threats and attack vectors based on the architecture and data flow.  We will use a combination of STRIDE and attack trees to analyze threats.
5.  **Best Practices Analysis:**  Comparing Flink's security features and recommended configurations against industry best practices for distributed systems and data processing.
6.  **Vulnerability Research (Inferred):**  Considering known vulnerabilities in similar systems and technologies to identify potential weaknesses in Flink.

### 2. Security Implications of Key Components

This section breaks down the security implications of each key component, referencing the design review and inferring further details.

**2.1 JobManager**

*   **Role:** Central coordinator, responsible for scheduling, resource allocation, checkpointing, and recovery.  A single point of failure and a high-value target.
*   **Security Implications:**
    *   **Compromise:**  Complete control over the Flink cluster.  An attacker could deploy malicious jobs, steal data, disrupt operations, or use the cluster for other malicious purposes (e.g., cryptocurrency mining).
    *   **Denial of Service (DoS):**  Overloading the JobManager can bring down the entire cluster.
    *   **Configuration Manipulation:**  Modifying the JobManager's configuration can lead to security vulnerabilities or operational issues.
    *   **Unauthorized Access:**  Gaining access to the JobManager's web UI or RPC interface allows for unauthorized control.
*   **Inferred Architecture:**  Java process, listening on network ports for RPC communication with TaskManagers and clients.  Uses a leader election mechanism (often ZooKeeper-based) for high availability.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Impersonating a legitimate TaskManager or client.
    *   **Tampering:**  Modifying job configurations, checkpoints, or internal state.
    *   **Repudiation:**  Difficult to trace actions back to a specific user if auditing is insufficient.
    *   **Information Disclosure:**  Leaking sensitive information (e.g., credentials, data) through logs, metrics, or the web UI.
    *   **Denial of Service:**  Overwhelming the JobManager with requests or exploiting vulnerabilities to crash it.
    *   **Elevation of Privilege:**  Exploiting vulnerabilities to gain higher privileges within the JobManager or the underlying system.
*   **Mitigation Strategies:**
    *   **Network Segmentation:**  Isolate the JobManager on a separate network with strict firewall rules.  Limit access to only authorized TaskManagers and clients. Use Kubernetes Network Policies in a Kubernetes deployment.
    *   **Strong Authentication:**  Require strong authentication (Kerberos, mutual TLS) for all communication with the JobManager.  Integrate with existing identity providers (LDAP, Active Directory).
    *   **Fine-grained Authorization:**  Use Flink's ACLs to restrict access to specific resources and operations based on user roles.  Implement least privilege.
    *   **Input Validation:**  Thoroughly validate all inputs to the JobManager, including job submissions, configuration changes, and RPC requests.  Protect against injection attacks.
    *   **Secure Configuration:**  Follow Flink's security guidelines for configuring the JobManager.  Disable unnecessary features and services.  Regularly review and update the configuration.
    *   **Auditing:**  Enable detailed logging of all JobManager activities, including authentication attempts, authorization decisions, and configuration changes.  Integrate with a SIEM system for centralized monitoring and analysis.
    *   **Resource Limits:**  Configure resource limits (CPU, memory) to prevent resource exhaustion attacks.
    *   **Regular Security Updates:**  Apply security patches and updates promptly.
    *   **Intrusion Detection:**  Deploy intrusion detection systems (IDS) to monitor for suspicious activity.

**2.2 TaskManager**

*   **Role:** Worker process that executes the tasks of a Flink job.  Handles data processing and exchange.
*   **Security Implications:**
    *   **Compromise:**  Access to data being processed by the TaskManager.  An attacker could steal, modify, or delete data.  Could also be used to launch attacks against other systems.
    *   **DoS:**  Overloading a TaskManager can disrupt job execution.
    *   **Data Leakage:**  Sensitive data could be leaked through logs, temporary files, or network communication.
    *   **UDF Exploitation:**  Vulnerabilities in user-defined functions (UDFs) could be exploited to gain control of the TaskManager.
*   **Inferred Architecture:**  Java process, communicates with the JobManager via RPC.  Reads data from and writes data to external systems (data sources and sinks).  Manages local state.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Impersonating the JobManager to send malicious tasks.
    *   **Tampering:**  Modifying data in transit or at rest.
    *   **Repudiation:**  Difficult to trace data processing errors or malicious actions.
    *   **Information Disclosure:**  Leaking sensitive data through logs, metrics, or network communication.
    *   **Denial of Service:**  Overwhelming the TaskManager with data or requests.
    *   **Elevation of Privilege:**  Exploiting vulnerabilities in the TaskManager or UDFs to gain higher privileges.
*   **Mitigation Strategies:**
    *   **Network Segmentation:**  Isolate TaskManagers from untrusted networks.  Use Kubernetes Network Policies.
    *   **Authentication:**  Require authentication for communication with the JobManager.
    *   **Authorization:**  Restrict TaskManager access to only the necessary resources.
    *   **Input Validation:**  Validate all inputs to the TaskManager, including data from sources and instructions from the JobManager.
    *   **Data Encryption:**  Encrypt data in transit and at rest, especially sensitive data.  Use TLS for network communication.
    *   **UDF Sandboxing:**  Isolate UDFs to prevent them from accessing sensitive resources or interfering with the TaskManager's operation.  Consider using Java Security Manager or containerization technologies (e.g., Docker within TaskManager slots - *if supported and carefully configured*).  This is a critical area for Flink security.
    *   **Resource Limits:**  Configure resource limits (CPU, memory, disk I/O) to prevent resource exhaustion.
    *   **Secure Configuration:**  Follow Flink's security guidelines.
    *   **Auditing:**  Enable logging of TaskManager activities.
    *   **Regular Security Updates:**  Apply security patches and updates.

**2.3 Resource Manager Interaction (Kubernetes)**

*   **Role:**  Flink interacts with Kubernetes for resource allocation, container management, and service discovery.
*   **Security Implications:**
    *   **Kubernetes API Server Compromise:**  If the Kubernetes API server is compromised, the attacker gains control over the entire Flink cluster.
    *   **Misconfigured RBAC:**  Overly permissive RBAC rules can allow unauthorized access to Flink resources.
    *   **Pod Security:**  Vulnerabilities in the JobManager or TaskManager pods can be exploited.
    *   **Network Exposure:**  Exposing Flink services (e.g., the JobManager UI) to the public internet without proper authentication and authorization.
*   **Inferred Architecture:**  Flink uses the Kubernetes API to create and manage Pods for JobManagers and TaskManagers.  Relies on Kubernetes RBAC for authorization.  Uses ConfigMaps and Secrets for configuration and credential management.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Impersonating the Kubernetes API server or Flink components.
    *   **Tampering:**  Modifying Kubernetes resources (Pods, ConfigMaps, Secrets) to compromise Flink.
    *   **Repudiation:**  Difficult to track unauthorized changes to Kubernetes resources.
    *   **Information Disclosure:**  Leaking sensitive information through Kubernetes API logs or misconfigured access.
    *   **Denial of Service:**  Attacking the Kubernetes API server or deleting Flink resources.
    *   **Elevation of Privilege:**  Exploiting vulnerabilities in Kubernetes or Flink to gain higher privileges within the cluster.
*   **Mitigation Strategies:**
    *   **Secure Kubernetes Cluster:**  Follow Kubernetes security best practices.  Use a hardened Kubernetes distribution.  Regularly update Kubernetes.
    *   **Strict RBAC:**  Implement least privilege RBAC rules for Flink.  Grant only the necessary permissions to the Flink service account.  Regularly audit RBAC rules.
    *   **Pod Security Policies (or equivalent):**  Use Pod Security Policies (or their successor, Pod Security Admission) to enforce security constraints on Flink Pods.  Restrict capabilities, prevent privilege escalation, and control access to host resources.
    *   **Network Policies:**  Use Kubernetes Network Policies to restrict network access to Flink Pods.  Allow only necessary communication between JobManagers, TaskManagers, and external systems.
    *   **Secret Management:**  Use Kubernetes Secrets to store sensitive information (credentials, API keys).  Do not store secrets in ConfigMaps or environment variables.  Consider using a dedicated secrets management solution (e.g., HashiCorp Vault).
    *   **Image Security:**  Use secure base images for Flink containers.  Scan images for vulnerabilities regularly.  Use a private container registry.
    *   **Monitoring:**  Monitor Kubernetes API logs and Flink logs for suspicious activity.

**2.4 Data Input/Output (Connectors)**

*   **Role:**  Flink uses connectors to read data from and write data to external systems (Kafka, HDFS, S3, etc.).
*   **Security Implications:**
    *   **Data Source/Sink Compromise:**  If a data source or sink is compromised, the attacker can inject malicious data or steal data processed by Flink.
    *   **Authentication/Authorization Issues:**  Weak or missing authentication/authorization to data sources/sinks can lead to unauthorized access.
    *   **Data in Transit:**  Data transmitted between Flink and data sources/sinks needs to be protected.
    *   **Data at Rest:**  Data stored in data sources/sinks needs to be protected.
*   **Inferred Architecture:**  Flink connectors are typically implemented as Java libraries that interact with the external system's API.  They handle authentication, data serialization/deserialization, and data transfer.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Impersonating a legitimate data source or sink.
    *   **Tampering:**  Modifying data in transit or at rest.
    *   **Repudiation:**  Difficult to track data injection or exfiltration.
    *   **Information Disclosure:**  Leaking sensitive data during transfer or storage.
    *   **Denial of Service:**  Attacking the data source/sink to disrupt Flink's operation.
    *   **Elevation of Privilege:**  Exploiting vulnerabilities in the connector or the external system to gain higher privileges.
*   **Mitigation Strategies:**
    *   **Secure Data Sources/Sinks:**  Follow security best practices for the specific data sources/sinks used.  Use strong authentication, authorization, and encryption.
    *   **Secure Connectors:**  Use well-maintained and secure Flink connectors.  Regularly update connectors to address vulnerabilities.
    *   **Authentication:**  Use strong authentication mechanisms (e.g., Kerberos, SASL, mutual TLS) to connect to data sources/sinks.
    *   **Authorization:**  Implement fine-grained access control to data sources/sinks.
    *   **Data Encryption:**  Encrypt data in transit using TLS.  Encrypt data at rest in the data sources/sinks, if supported.
    *   **Input Validation:**  Validate data received from data sources to prevent injection attacks.
    *   **Output Sanitization:**  Sanitize data written to data sinks to prevent injection attacks against downstream systems.
    *   **Monitoring:**  Monitor data transfer rates and error rates for anomalies.

**2.5 State Management**

*   **Role:**  Flink manages application state for stateful computations.  State can be stored in memory, on disk (RocksDB), or in an external system (e.g., a distributed cache).
*   **Security Implications:**
    *   **State Corruption:**  Malicious modification of state can lead to incorrect results or application crashes.
    *   **State Leakage:**  Sensitive data stored in state could be leaked.
    *   **DoS:**  Attacks targeting state management can disrupt application operation.
*   **Inferred Architecture:**  Flink uses a checkpointing mechanism to periodically save the application state to a durable storage (e.g., HDFS, S3).  State backends (e.g., RocksDB) manage the local state on TaskManagers.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Not directly applicable, but related to tampering.
    *   **Tampering:**  Modifying state data in checkpoints or on TaskManagers.
    *   **Repudiation:**  Difficult to track unauthorized state modifications.
    *   **Information Disclosure:**  Leaking sensitive data stored in state.
    *   **Denial of Service:**  Attacking the state backend or checkpointing mechanism.
    *   **Elevation of Privilege:**  Not directly applicable.
*   **Mitigation Strategies:**
    *   **Secure Checkpoint Storage:**  Use a secure and reliable storage system for checkpoints (e.g., HDFS with Kerberos authentication and encryption).
    *   **State Encryption:**  Encrypt sensitive data stored in state.  Flink supports encryption for RocksDB state backend.
    *   **Access Control:**  Restrict access to checkpoint data.
    *   **Integrity Checks:**  Implement integrity checks to detect state corruption.  Flink's checkpointing mechanism includes checksums.
    *   **Monitoring:**  Monitor checkpointing operations for failures and anomalies.

**2.6 Configuration Management**

*   **Role:**  Flink's behavior is controlled by configuration parameters.
*   **Security Implications:**
    *   **Misconfiguration:**  Incorrect configuration can lead to security vulnerabilities or operational issues.
    *   **Credential Exposure:**  Storing credentials in plain text in configuration files is a major risk.
    *   **Insecure Defaults:**  Using insecure default settings can expose the cluster to attacks.
*   **Inferred Architecture:**  Flink uses configuration files (e.g., flink-conf.yaml) and environment variables to manage configuration.  In Kubernetes, ConfigMaps and Secrets are used.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Not directly applicable.
    *   **Tampering:**  Modifying configuration files to weaken security.
    *   **Repudiation:**  Difficult to track unauthorized configuration changes.
    *   **Information Disclosure:**  Leaking sensitive information (credentials) through configuration files.
    *   **Denial of Service:**  Misconfiguring resource limits or other parameters to cause instability.
    *   **Elevation of Privilege:**  Not directly applicable.
*   **Mitigation Strategies:**
    *   **Secure Configuration Files:**  Protect configuration files from unauthorized access.  Use file system permissions and Kubernetes RBAC.
    *   **Credential Management:**  Do not store credentials in plain text in configuration files.  Use environment variables, Kubernetes Secrets, or a dedicated secrets management solution.
    *   **Secure Defaults:**  Review and harden Flink's default configuration.  Disable unnecessary features.
    *   **Configuration Validation:**  Implement mechanisms to validate configuration changes before applying them.
    *   **Auditing:**  Log all configuration changes.
    *   **Version Control:**  Store configuration files in a version control system (e.g., Git) to track changes and facilitate rollbacks.

**2.7 Inter-component Communication**

*   **Role:**  JobManagers and TaskManagers communicate via RPC.
*   **Security Implications:**
    *   **Eavesdropping:**  Attackers could intercept communication between components.
    *   **Man-in-the-Middle (MitM) Attacks:**  Attackers could intercept and modify communication.
    *   **Impersonation:**  Attackers could impersonate a JobManager or TaskManager.
*   **Inferred Architecture:**  Flink uses Akka for RPC communication (this is a known detail of Flink). Akka can be configured to use TLS for encryption and authentication.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Impersonating a JobManager or TaskManager.
    *   **Tampering:**  Modifying messages in transit.
    *   **Repudiation:**  Difficult to prove who sent a particular message.
    *   **Information Disclosure:**  Leaking sensitive information transmitted between components.
    *   **Denial of Service:**  Flooding the RPC communication channels.
    *   **Elevation of Privilege:**  Not directly applicable.
*   **Mitigation Strategies:**
    *   **TLS Encryption:**  Enable TLS for all RPC communication.  Use strong ciphers and protocols.
    *   **Mutual TLS Authentication:**  Require mutual TLS authentication between JobManagers and TaskManagers.  This verifies the identity of both parties.
    *   **Network Segmentation:**  Isolate the communication channels between Flink components.
    *   **Monitoring:**  Monitor RPC communication for anomalies.

**2.8 User-Defined Functions (UDFs)**

*   **Role:**  Users can write custom code (UDFs) to extend Flink's functionality.
*   **Security Implications:**
    *   **Malicious Code Execution:**  UDFs could contain malicious code that compromises the TaskManager.
    *   **Resource Exhaustion:**  UDFs could consume excessive resources, leading to DoS.
    *   **Data Leakage:**  UDFs could leak sensitive data.
    *   **Vulnerabilities:**  UDFs could contain vulnerabilities that can be exploited.
*   **Inferred Architecture:**  UDFs are typically written in Java or Scala and executed within the TaskManager's JVM.
*   **Threats (STRIDE):**
    *   **Spoofing:** Not directly applicable.
    *   **Tampering:** UDFs can tamper with data.
    *   **Repudiation:** Difficult to track malicious actions within a UDF.
    *   **Information Disclosure:** UDFs can leak sensitive data.
    *   **Denial of Service:** UDFs can consume excessive resources.
    *   **Elevation of Privilege:** UDFs can exploit vulnerabilities to gain higher privileges.
*   **Mitigation Strategies:**
    *   **Code Review:**  Thoroughly review UDF code for security vulnerabilities before deploying it.
    *   **Static Analysis:**  Use static analysis tools to scan UDF code for potential issues.
    *   **Sandboxing:**  Isolate UDFs using Java Security Manager, containerization, or other techniques. This is *crucial* and often a weak point in Flink deployments.  The level of sandboxing achievable depends on the Flink version and configuration.
    *   **Resource Limits:**  Limit the resources (CPU, memory, file descriptors) that UDFs can consume.
    *   **Input Validation:**  Validate all inputs to UDFs.
    *   **Least Privilege:**  Grant UDFs only the necessary permissions.
    *   **Dependency Management:** Carefully manage UDF dependencies to avoid introducing vulnerable libraries.

**2.9 Build Process**

*   **Role:**  The build process compiles Flink from source code and creates deployable artifacts.
*   **Security Implications:**
    *   **Compromised Build System:**  If the build system is compromised, attackers could inject malicious code into Flink.
    *   **Vulnerable Dependencies:**  Using vulnerable third-party libraries can introduce security risks.
    *   **Supply Chain Attacks:**  Attackers could compromise the supply chain to deliver malicious artifacts.
*   **Inferred Architecture:**  Flink uses Maven and Gradle for build automation.  The build process includes dependency resolution, compilation, testing, packaging, and static analysis.
*   **Threats (STRIDE):**
    *   **Spoofing:**  Impersonating a legitimate developer or build server.
    *   **Tampering:**  Modifying source code, build scripts, or dependencies.
    *   **Repudiation:**  Difficult to track unauthorized changes to the build process.
    *   **Information Disclosure:**  Leaking sensitive information (e.g., API keys) used during the build process.
    *   **Denial of Service:**  Disrupting the build process.
    *   **Elevation of Privilege:**  Exploiting vulnerabilities in the build system to gain higher privileges.
*   **Mitigation Strategies:**
    *   **Secure Build Environment:**  Use a secure and isolated build environment.
    *   **Dependency Management:**  Use a dependency management tool (Maven, Gradle) to track and manage dependencies.  Use a private repository to control dependencies.
    *   **Software Composition Analysis (SCA):**  Use SCA tools to identify and manage vulnerabilities in third-party libraries.
    *   **Static Analysis:**  Use static analysis tools to scan Flink's source code for potential security issues.
    *   **Reproducible Builds:**  Ensure builds are reproducible to enhance auditability and integrity.
    *   **Signed Artifacts:**  Sign released artifacts to verify their authenticity and integrity.
    *   **Supply Chain Security:**  Implement measures to secure the build pipeline and prevent tampering with dependencies or artifacts.  This includes using trusted sources for dependencies, verifying checksums, and using code signing.
    *   **Regular Security Audits:** Conduct regular security audits of the build process and infrastructure.

### 3. Actionable Mitigation Strategies (Tailored to Flink)

The following table summarizes the key mitigation strategies, categorized and prioritized.  These are specific to Flink and build upon the general recommendations in the security design review.

| Category                     | Mitigation Strategy                                                                                                                                                                                                                                                           | Priority | Rationale                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        