## Deep Security Analysis of ExoPlayer

### 1. Objective, Scope, and Methodology

**Objective:**

This deep analysis aims to provide a thorough security evaluation of the ExoPlayer library, focusing on identifying potential security vulnerabilities and recommending actionable mitigation strategies. The analysis will delve into the key components of ExoPlayer, as inferred from the provided security design review and general media player architecture, to understand their security implications. The ultimate objective is to enhance the security posture of applications utilizing ExoPlayer by providing specific, tailored recommendations.

**Scope:**

The scope of this analysis encompasses the following:

*   **ExoPlayer Library Core Components:**  Analyzing the security implications of core modules responsible for media parsing, demuxing, decoding, rendering, streaming, and DRM handling within ExoPlayer.
*   **Integration Points:** Examining the security aspects of ExoPlayer's integration with the Android OS (Android Media APIs, Native Code) and external systems (Media Servers, DRM Providers).
*   **Data Flow Analysis:**  Tracing the flow of media data and control signals within ExoPlayer and its interactions with external entities to identify potential points of vulnerability.
*   **Build and Deployment Pipeline:**  Reviewing the security controls within the ExoPlayer build and deployment process, including CI/CD and dependency management.
*   **Identified Security Requirements:**  Specifically addressing the security requirements outlined in the design review (Input Validation, Cryptography).

The analysis will **not** cover the security of specific applications that integrate ExoPlayer, but rather focus on the library itself and its inherent security characteristics.  Application-level security concerns (like application authentication and authorization) are considered only in the context of how they interact with and impact ExoPlayer's security.

**Methodology:**

This deep analysis will employ the following methodology:

1.  **Document Review:**  Thorough review of the provided security design review document, including business posture, security posture, C4 diagrams (Context, Container, Deployment), Build process description, risk assessment, and questions/assumptions.
2.  **Architecture and Component Inference:** Based on the design review, C4 diagrams, and general knowledge of media player libraries, infer the internal architecture, key components, and data flow within ExoPlayer.
3.  **Threat Modeling:** Identify potential security threats relevant to each key component and data flow, considering common media player vulnerabilities, OWASP guidelines, and industry best practices.
4.  **Security Implication Analysis:** Analyze the security implications of each identified threat, considering the potential impact on confidentiality, integrity, and availability of applications using ExoPlayer and the Android ecosystem.
5.  **Mitigation Strategy Development:**  Develop actionable and tailored mitigation strategies for each identified threat, focusing on practical recommendations applicable to the ExoPlayer project and its development team. These strategies will be specific to ExoPlayer and avoid generic security advice.
6.  **Prioritization:**  While all identified threats are important, implicitly prioritize recommendations based on the severity of potential impact and feasibility of implementation.

### 2. Security Implications of Key Components

Based on the design review and inferred architecture, the key components of ExoPlayer and their security implications are analyzed below:

**a) ExoPlayer Library (Java/Kotlin Core):**

*   **Security Implications:** This is the central component and the primary interface for application developers. Vulnerabilities here can have widespread impact.
    *   **Input Validation Weaknesses:**  ExoPlayer processes untrusted media data.  Insufficient input validation in Java/Kotlin code handling media sources, manifests, and player configurations could lead to vulnerabilities like injection attacks (if configurations are dynamically generated based on user input), or denial of service.
    *   **Logic Flaws:**  Bugs in the core playback logic, state management, or error handling could be exploited to cause crashes, unexpected behavior, or potentially bypass security checks.
    *   **API Misuse:**  While not a vulnerability in ExoPlayer itself, insecure usage of ExoPlayer APIs by application developers (e.g., mishandling DRM parameters, insecure network configurations) can introduce vulnerabilities in applications.

**b) Android Media APIs (Java Framework):**

*   **Security Implications:** ExoPlayer relies heavily on Android Media APIs (MediaCodec, AudioTrack, MediaDrm). Security vulnerabilities in these platform APIs directly impact ExoPlayer.
    *   **Platform Vulnerabilities:**  Bugs or vulnerabilities within Android Media APIs, discovered after ExoPlayer's development, could be exploited through ExoPlayer.  ExoPlayer's security is partially dependent on the Android platform's security updates.
    *   **API Surface Complexity:** The vast API surface of Android Media APIs increases the potential for subtle vulnerabilities or unexpected interactions that could be exploited.

**c) Native Code (C/C++ Components - Decoders, Demuxers, DRM):**

*   **Security Implications:** Performance-critical media processing (decoding, demuxing) and DRM often rely on native C/C++ code for efficiency. Native code is inherently more susceptible to memory safety issues.
    *   **Memory Corruption Vulnerabilities:** Buffer overflows, heap overflows, use-after-free, and other memory corruption vulnerabilities in native decoders and demuxers are critical risks. Malicious media files could be crafted to trigger these vulnerabilities, potentially leading to arbitrary code execution on the device.
    *   **Complexity and Third-Party Libraries:** Native media processing often involves complex codebases and reliance on third-party native libraries (e.g., codec libraries).  Vulnerabilities in these dependencies or integration issues can introduce security risks.
    *   **DRM Implementation Flaws:**  Native DRM components handle sensitive cryptographic operations and key management.  Vulnerabilities in DRM implementations could lead to DRM bypass, unauthorized content access, or key compromise.

**d) Media Server (External System):**

*   **Security Implications:** ExoPlayer interacts with media servers to fetch media content. Security risks here are related to network communication and content delivery.
    *   **Insecure Communication:** If HTTPS is not enforced for all media server communication, especially for sensitive content or DRM-related requests, man-in-the-middle attacks could compromise data integrity and confidentiality.
    *   **Malicious Media Content:**  Media servers could be compromised or serve malicious media files designed to exploit vulnerabilities in ExoPlayer. ExoPlayer must be robust against malformed or malicious media.
    *   **Server-Side Vulnerabilities:** While not directly ExoPlayer's vulnerability, vulnerabilities on the media server itself could lead to content breaches or service disruption, indirectly impacting applications using ExoPlayer.

**e) DRM Provider (External System):**

*   **Security Implications:** For protected content, ExoPlayer interacts with DRM providers for license acquisition and key management.
    *   **Insecure License Acquisition:**  If the communication channel between ExoPlayer and the DRM provider is not secure (HTTPS), license requests and responses could be intercepted or tampered with.
    *   **DRM Implementation Weaknesses:**  Vulnerabilities in the DRM scheme itself or its implementation in ExoPlayer could lead to DRM bypass or unauthorized content access.
    *   **Key Management Issues:**  Improper handling or storage of DRM keys within ExoPlayer or the Android system could lead to key compromise and content piracy.

**f) Android Application (Integrating ExoPlayer):**

*   **Security Implications:** While the application itself is outside ExoPlayer's scope, the way applications integrate and configure ExoPlayer can introduce security risks.
    *   **Insecure Configuration:**  Applications might misconfigure ExoPlayer (e.g., disabling security features, using insecure network configurations) leading to vulnerabilities.
    *   **Exposure of Internal Data:**  Applications might inadvertently expose sensitive data (e.g., DRM session IDs, API keys) through logs or other means when interacting with ExoPlayer.
    *   **Input Handling at Application Level:**  Applications are responsible for handling user input and media source URLs.  Vulnerabilities in application-level input validation could be indirectly exploited through ExoPlayer if malicious URLs or data are passed to it.

### 3. Architecture, Components, and Data Flow Inference

Based on the design review and common media player architecture, we can infer the following about ExoPlayer's architecture, components, and data flow:

**Inferred Architecture:**

ExoPlayer likely adopts a modular, pipeline-based architecture.  It separates concerns into distinct components for:

*   **Media Source Handling:**  Loading media from various sources (local files, network streams, URIs).
*   **Demuxing (Container Parsing):**  Parsing media container formats (e.g., MP4, MKV, WebM, TS, MP3) to extract elementary streams (audio, video, subtitles).
*   **Decoding:** Decoding compressed audio and video streams using codecs (e.g., H.264, H.265, AAC, MP3). This likely involves both software and hardware decoders, potentially leveraging Android MediaCodec APIs.
*   **Rendering:**  Presenting decoded audio and video frames on the device's output (speakers, screen). This involves Android AudioTrack and Surface APIs.
*   **DRM Handling:**  Managing DRM workflows, including license acquisition, key management, and decryption, using Android MediaDrm APIs and potentially interacting with native DRM libraries.
*   **Streaming and Adaptive Streaming:**  Handling streaming protocols (e.g., DASH, HLS, SmoothStreaming) and adaptive bitrate streaming logic.
*   **Subtitle and Metadata Handling:**  Parsing and rendering subtitles, and extracting and processing media metadata.
*   **Network Loading:**  Handling network requests for streaming media and related resources, likely using standard Android networking APIs.

**Inferred Components (Building upon Container Diagram):**

*   **ExoPlayer Instance (Java/Kotlin):**  The main entry point and controller, managing the playback state, media sources, renderers, and overall playback pipeline.
*   **Renderers (Java/Kotlin):**  Components responsible for rendering media streams. Likely separate renderers for audio, video, and text (subtitles).
*   **Decoders (Native C/C++ and Java/Kotlin wrappers):**  Codecs for decoding audio and video. May utilize Android MediaCodec framework (Java API wrapping native decoders) and potentially include software decoders implemented in native code or Java.
*   **Demuxers (Native C/C++ and Java/Kotlin):**  Parsers for different media container formats.  Likely implemented in native code for performance, with Java/Kotlin wrappers.
*   **MediaSource (Java/Kotlin):**  Abstraction for different types of media sources (e.g., URLs, local files, DASH manifests, HLS playlists).
*   **Loaders (Java/Kotlin):**  Components responsible for loading media data from network or local storage.
*   **DrmSessionManager (Java/Kotlin):**  Manages DRM sessions, license acquisition, and key handling, interacting with Android MediaDrm APIs and potentially native DRM libraries.
*   **TrackSelector (Java/Kotlin):**  Selects appropriate audio, video, and subtitle tracks based on user preferences and device capabilities.
*   **AudioTrack (Android Media API - Java Framework):**  Android API for audio output.
*   **MediaCodec (Android Media API - Java Framework wrapping Native Code):** Android API for hardware and software media decoding.
*   **Surface (Android API - Java Framework):** Android API for video rendering surface.
*   **Network Stack (Android OS):**  Underlying Android networking components used for media streaming.

**Inferred Data Flow (Simplified):**

1.  **Application provides Media Source URL to ExoPlayer.**
2.  **ExoPlayer's MediaSource component loads the media manifest/playlist (if streaming) or media file.**
3.  **Demuxer parses the container format and extracts elementary streams (audio, video, subtitles).**
4.  **TrackSelector selects appropriate tracks based on user preferences and device capabilities.**
5.  **Decoders decode the compressed audio and video streams using appropriate codecs (potentially hardware accelerated via MediaCodec).**
6.  **Renderers receive decoded audio and video frames.**
7.  **AudioRenderer sends decoded audio to AudioTrack for playback.**
8.  **VideoRenderer renders decoded video frames to a Surface for display.**
9.  **For DRM-protected content:**
    *   **DrmSessionManager initiates license acquisition from DRM Provider.**
    *   **DRM Provider issues a license.**
    *   **DrmSessionManager obtains decryption keys from the license.**
    *   **Decoders use decryption keys to decode encrypted media samples.**
10. **Network Loader handles network requests for streaming media and related resources.**

### 4. Tailored Security Considerations for ExoPlayer

Given the analysis above, here are specific security considerations tailored to ExoPlayer:

*   **Robust Input Validation for Media Parsing:**
    *   **Focus:**  Prioritize rigorous input validation in demuxers and decoders, especially those implemented in native C/C++.
    *   **Specifics:** Validate media container formats, codec parameters, metadata fields, and stream structures against expected specifications. Implement checks for out-of-bounds access, integer overflows, format string vulnerabilities, and other common input-related flaws.
    *   **Rationale:** Media parsing is the first stage of processing untrusted data. Flaws here can have cascading effects and are prime targets for malicious media.

*   **Memory Safety in Native Code:**
    *   **Focus:**  Emphasize memory safety in all native C/C++ components, particularly decoders and demuxers.
    *   **Specifics:** Employ secure coding practices, utilize memory-safe languages where feasible (though performance constraints might limit this for core decoding), and rigorously test native code for memory leaks, buffer overflows, and use-after-free vulnerabilities. Integrate memory sanitizers (AddressSanitizer, MemorySanitizer) into the CI/CD pipeline and development process.
    *   **Rationale:** Memory corruption vulnerabilities in native code are a major security risk in media players, potentially leading to remote code execution.

*   **Secure Handling of DRM and Cryptography:**
    *   **Focus:**  Ensure correct and secure implementation of DRM functionalities and cryptographic operations.
    *   **Specifics:**  Adhere to DRM provider specifications and best practices for license acquisition, key management, and decryption. Utilize Android MediaDrm APIs correctly and securely. Regularly update DRM libraries and components.  Avoid implementing custom cryptography where possible and rely on well-vetted, platform-provided cryptographic libraries.
    *   **Rationale:** DRM is critical for protecting premium content. Flaws in DRM implementation can lead to content piracy and revenue loss.

*   **Network Security for Streaming:**
    *   **Focus:**  Enforce HTTPS for all communication with media servers and DRM providers, especially for sensitive data like licenses and credentials.
    *   **Specifics:**  Default to HTTPS for streaming protocols. Implement checks to ensure HTTPS is used and warn or fail if insecure HTTP is attempted (unless explicitly allowed by application configuration for specific use cases). Validate server certificates to prevent man-in-the-middle attacks.
    *   **Rationale:** Streaming media often involves transferring sensitive content and metadata over networks. Insecure network communication exposes data to interception and tampering.

*   **Dependency Management and Vulnerability Scanning:**
    *   **Focus:**  Maintain a secure supply chain by carefully managing dependencies, especially third-party native libraries used in decoders and demuxers.
    *   **Specifics:**  Maintain an inventory of all dependencies. Regularly scan dependencies for known vulnerabilities using dependency scanning tools (as recommended in the security review).  Prioritize updating vulnerable dependencies promptly. Consider using sandboxing or isolation techniques for third-party native libraries to limit the impact of potential vulnerabilities.
    *   **Rationale:**  Third-party libraries can introduce vulnerabilities if not properly managed and updated.

*   **Fuzzing for Media Parsing and Decoding Robustness:**
    *   **Focus:**  Proactively identify vulnerabilities in media parsing and decoding logic by using fuzzing techniques.
    *   **Specifics:**  Develop a comprehensive fuzzing strategy targeting demuxers and decoders. Generate a wide range of malformed and malicious media files and feed them to ExoPlayer's parsing and decoding components under controlled conditions (e.g., using libFuzzer or similar tools). Integrate fuzzing into the CI/CD pipeline for continuous testing.
    *   **Rationale:** Fuzzing is highly effective in discovering input validation and memory corruption vulnerabilities in media processing code.

*   **Security Audits and Penetration Testing:**
    *   **Focus:**  Conduct regular security audits and penetration testing by experienced security professionals to identify vulnerabilities that might be missed by automated tools and internal reviews.
    *   **Specifics:**  Focus audits and penetration tests on media parsing, decoding, DRM handling, and network streaming functionalities. Include both black-box and white-box testing approaches.
    *   **Rationale:** Independent security assessments provide a valuable external perspective and can uncover subtle or complex vulnerabilities.

*   **Vulnerability Disclosure and Response Process:**
    *   **Focus:**  Establish a clear and public vulnerability disclosure and response process to handle reported security issues effectively.
    *   **Specifics:**  Create a security contact point (e.g., security@exoplayer.dev). Publish a security policy outlining the vulnerability reporting process and expected response times.  Establish a process for triaging, patching, and publicly disclosing vulnerabilities in a responsible manner.
    *   **Rationale:** A well-defined vulnerability disclosure process builds trust with the security community and enables timely remediation of security issues.

### 5. Actionable and Tailored Mitigation Strategies

Based on the identified security considerations, here are actionable and tailored mitigation strategies for the ExoPlayer project:

**Actionable Mitigation Strategies:**

| Threat Category                     | Specific Threat                                      | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            