## Deep Analysis of Redis Security Considerations

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to perform a thorough security assessment of Redis, focusing on its key components, architecture, data flow, and deployment scenarios.  The analysis aims to identify potential security vulnerabilities, assess their impact, and provide actionable mitigation strategies tailored to Redis and its common usage patterns.  We will pay particular attention to the interaction between Redis and the client application, as well as the administrative interfaces.

**Scope:**

This analysis covers the following aspects of Redis:

*   **Core Redis Server:**  The main Redis process, including data storage, command processing, and networking.
*   **Client-Server Interaction:**  Communication between client applications and the Redis server, including authentication, authorization, and data transmission.
*   **Persistence Mechanisms:**  RDB and AOF persistence, including their security implications.
*   **Replication and High Availability:**  Master-replica setups, Sentinel, and Redis Cluster, focusing on security aspects of data replication and failover.
*   **Networking:**  Network configurations and their impact on Redis security.
*   **Configuration:**  `redis.conf` settings and their security implications.
*   **Lua Scripting:**  Security considerations related to the execution of Lua scripts within Redis.
*   **Build Process:** Security of the build pipeline.
*   **Deployment:** Security of the chosen deployment solution (Replication with Sentinel).

This analysis *does not* cover:

*   Operating system-level security (beyond recommendations directly related to Redis).
*   Security of external databases used in conjunction with Redis (except for their interaction with Redis).
*   Application-level security vulnerabilities in client applications (except for how they interact with Redis).

**Methodology:**

1.  **Architecture and Component Inference:**  Based on the provided security design review, GitHub repository information, and official Redis documentation, we will infer the architecture, components, and data flow of a typical Redis deployment.
2.  **Threat Modeling:**  For each identified component and interaction, we will identify potential threats, considering the business risks and security posture outlined in the design review.  We will use the STRIDE model (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) as a framework.
3.  **Vulnerability Analysis:**  We will analyze potential vulnerabilities arising from the identified threats, considering existing security controls and accepted risks.
4.  **Mitigation Strategy Recommendation:**  For each identified vulnerability, we will propose specific, actionable mitigation strategies tailored to Redis, prioritizing practical and effective solutions.
5.  **Deployment Specific Analysis:** We will analyze the chosen deployment (Replication with Sentinel) and identify security considerations specific to that configuration.
6.  **Build Process Analysis:** We will analyze the build process and identify security considerations.

### 2. Security Implications of Key Components

#### 2.1 Core Redis Server

*   **Data Storage (In-Memory):**
    *   **Threats:**
        *   **Information Disclosure:** Memory scraping attacks if the server is compromised.  Data leakage through debugging tools or core dumps.
        *   **Denial of Service:**  Memory exhaustion attacks, filling Redis with data until it crashes or becomes unresponsive.
        *   **Tampering:** If an attacker gains write access, they can modify or delete data.
    *   **Mitigation:**
        *   **Information Disclosure:**  Enable `protected-mode yes`.  Disable debugging commands (`CONFIG SET debug-command ""`) in production.  Restrict access to the server at the network level.  Use operating system-level memory protection mechanisms (e.g., ASLR, DEP).  Regularly monitor for unauthorized access.  Consider client-side encryption for highly sensitive data.
        *   **Denial of Service:**  Set `maxmemory` to a reasonable limit.  Use the `maxmemory-policy` setting (e.g., `allkeys-lru`, `volatile-lru`) to control eviction behavior.  Implement rate limiting at the network level or using a proxy.
        *   **Tampering:**  Enforce strong authentication (passwords and/or ACLs).  Restrict network access.  Regularly audit logs for unauthorized commands.

*   **Command Processing:**
    *   **Threats:**
        *   **Elevation of Privilege:**  Exploitation of vulnerabilities in command parsing or execution.  Use of dangerous commands (e.g., `FLUSHALL`, `DEBUG SEGFAULT`).
        *   **Denial of Service:**  Execution of computationally expensive commands (e.g., `KEYS *` on a large dataset).
        *   **Repudiation:** Lack of detailed logging makes it difficult to trace actions back to specific users or clients.
    *   **Mitigation:**
        *   **Elevation of Privilege:**  Use ACLs to restrict access to specific commands based on user roles.  Rename or disable dangerous commands using `rename-command`.  Keep Redis updated to the latest version to patch vulnerabilities.
        *   **Denial of Service:**  Use ACLs to restrict access to potentially expensive commands.  Monitor Redis performance and set alerts for slow queries.  Consider using a proxy to filter or rate-limit commands.
        *   **Repudiation:**  Enable detailed logging using the `loglevel` and `logfile` settings.  Configure syslog integration for centralized logging.  Regularly review logs for suspicious activity.

*   **Networking:**
    *   **Threats:**
        *   **Spoofing:**  Clients connecting from unauthorized IP addresses.
        *   **Information Disclosure:**  Unencrypted communication exposing data in transit.
        *   **Denial of Service:**  Network-based DoS attacks targeting the Redis port.
    *   **Mitigation:**
        *   **Spoofing:**  Use `bind` to restrict Redis to specific network interfaces.  Use firewall rules to allow connections only from trusted IP addresses or networks.  Implement network segmentation.
        *   **Information Disclosure:**  Enable TLS/SSL encryption for all client-server communication.  Use strong ciphers and protocols.  Configure client libraries to verify server certificates.
        *   **Denial of Service:**  Implement network-level DoS protection mechanisms (e.g., firewalls, intrusion prevention systems).  Use a load balancer to distribute traffic.

#### 2.2 Client-Server Interaction

*   **Authentication:**
    *   **Threats:**
        *   **Spoofing:**  Unauthorized clients connecting without credentials or with weak credentials.
        *   **Brute-Force Attacks:**  Repeated attempts to guess passwords.
    *   **Mitigation:**
        *   **Spoofing:**  Require authentication using the `AUTH` command or ACLs.  Use strong, randomly generated passwords.  Consider using external authentication mechanisms (e.g., LDAP, Kerberos) if supported by the client library and infrastructure.
        *   **Brute-Force Attacks:**  Implement account lockout policies (not natively supported by Redis, requires external solutions like a proxy or firewall).  Monitor for failed login attempts and trigger alerts.  Consider using rate limiting.

*   **Authorization (ACLs):**
    *   **Threats:**
        *   **Elevation of Privilege:**  Misconfigured ACLs granting excessive permissions.
        *   **Bypass:**  Exploitation of vulnerabilities in the ACL implementation.
    *   **Mitigation:**
        *   **Elevation of Privilege:**  Follow the principle of least privilege.  Carefully define ACL rules, granting only the necessary permissions to each user.  Regularly review and audit ACL configurations.
        *   **Bypass:**  Keep Redis updated to the latest version.  Monitor for security advisories related to ACLs.

*   **Data Transmission:**
    *   **Threats:**
        *   **Information Disclosure:**  Unencrypted data transmitted between the client and server.
        *   **Tampering:**  Modification of data in transit.
    *   **Mitigation:**
        *   **Information Disclosure:**  Enable TLS/SSL encryption for all client-server communication.
        *   **Tampering:**  TLS/SSL provides integrity protection.  Client-side encryption can provide additional protection.

#### 2.3 Persistence Mechanisms

*   **RDB (Redis Database Backup):**
    *   **Threats:**
        *   **Information Disclosure:**  Unauthorized access to RDB files on disk.
        *   **Tampering:**  Modification of RDB files, leading to data corruption or injection of malicious data.
    *   **Mitigation:**
        *   **Information Disclosure:**  Store RDB files in a secure directory with restricted access permissions.  Encrypt RDB files at rest (not natively supported by Redis, requires external tools or filesystem-level encryption).
        *   **Tampering:**  Use file integrity monitoring tools to detect unauthorized modifications to RDB files.  Regularly back up RDB files to a secure location.

*   **AOF (Append-Only File):**
    *   **Threats:**
        *   **Information Disclosure:**  Unauthorized access to the AOF file.
        *   **Tampering:**  Modification of the AOF file, leading to data corruption or injection of malicious commands.
        *   **Denial of Service:**  A large AOF file can slow down Redis startup and potentially lead to disk space exhaustion.
    *   **Mitigation:**
        *   **Information Disclosure:**  Store the AOF file in a secure directory with restricted access permissions.  Encrypt the AOF file at rest (not natively supported by Redis, requires external tools).
        *   **Tampering:**  Use file integrity monitoring tools.  Regularly back up the AOF file.
        *   **Denial of Service:**  Configure AOF rewriting (`auto-aof-rewrite-percentage` and `auto-aof-rewrite-min-size`) to prevent the AOF file from growing excessively large.  Monitor disk space usage.

#### 2.4 Replication and High Availability

*   **Master-Replica Replication:**
    *   **Threats:**
        *   **Information Disclosure:**  Unencrypted replication traffic between master and replicas.
        *   **Tampering:**  Compromise of a replica leading to the propagation of malicious data to other replicas.
        *   **Man-in-the-Middle (MITM):** Interception and modification of replication traffic.
    *   **Mitigation:**
        *   **Information Disclosure:**  Enable TLS/SSL encryption for replication traffic (`replica-announce-tls-port`, `tls-replication yes`).
        *   **Tampering:**  Enforce strong authentication between master and replicas.  Regularly monitor replica health and data consistency.  Implement intrusion detection systems to detect malicious activity on replicas.
        *   **MITM:** TLS/SSL encryption with certificate verification protects against MITM attacks.

*   **Sentinel:**
    *   **Threats:**
        *   **Spoofing:**  Malicious Sentinel instances joining the cluster.
        *   **Tampering:**  Compromise of a Sentinel instance leading to incorrect failover decisions.
        *   **Denial of Service:**  Attacks targeting Sentinel instances, disrupting monitoring and failover capabilities.
    *   **Mitigation:**
        *   **Spoofing:**  Require authentication for Sentinel instances (`sentinel auth-pass`).  Use TLS/SSL encryption for Sentinel communication (`sentinel announce-tls-port`, `tls-sentinel yes`).  Restrict network access to Sentinel instances.
        *   **Tampering:**  Enforce strong authentication.  Regularly monitor Sentinel logs.  Deploy Sentinel instances in a secure and redundant manner.
        *   **Denial of Service:**  Implement network-level DoS protection.  Deploy multiple Sentinel instances across different availability zones.

*   **Redis Cluster:**
    *   **Threats:**
        *   **All threats applicable to Master-Replica and Sentinel.**
        *   **Node Impersonation:** A malicious node joining the cluster and receiving/modifying data.
        *   **Data Exfiltration:** An attacker gaining access to a cluster node and exfiltrating data.
    *   **Mitigation:**
        *   **All mitigations applicable to Master-Replica and Sentinel.**
        *   **Node Impersonation:** Enable `cluster-require-full-coverage yes`. Use TLS/SSL for cluster bus communication (`cluster-announce-tls-port`, `tls-cluster yes`).  Require authentication for cluster nodes.
        *   **Data Exfiltration:**  Implement strong access controls (ACLs).  Monitor network traffic for suspicious activity.  Consider client-side encryption.

#### 2.5 Lua Scripting

*   **Threats:**
    *   **Code Injection:**  Malicious Lua scripts injected through client applications.
    *   **Denial of Service:**  Resource-intensive Lua scripts consuming excessive CPU or memory.
    *   **Information Disclosure:**  Lua scripts accessing or leaking sensitive data.
    *   **Bypass of Security Controls:** Lua scripts circumventing ACL restrictions.
    *   **Data Corruption:** Incorrectly written scripts modifying data in unintended ways.
    *   **Non-deterministic behavior:** Scripts with time-based logic or random number generation can lead to inconsistent results.
*   **Mitigation:**
    *   **Code Injection:**  Validate and sanitize all input used in Lua scripts.  Treat user-supplied scripts as untrusted.  Consider using a sandbox environment for executing Lua scripts (not natively supported by Redis, requires external solutions).
    *   **Denial of Service:**  Set limits on Lua script execution time (`lua-time-limit`).  Monitor Lua script performance.
    *   **Information Disclosure:**  Restrict access to sensitive data within Lua scripts.  Avoid storing sensitive information directly in scripts.
    *   **Bypass of Security Controls:** ACLs apply to Lua scripts.  Ensure that ACLs are properly configured to restrict the commands that Lua scripts can execute.
    *   **Data Corruption:** Thoroughly test and review Lua scripts before deploying them to production. Use version control.
    *   **Non-deterministic behavior:** Avoid using time-based logic or random number generation within Lua scripts if deterministic behavior is required. Use `redis.replicate_commands()` to ensure that non-deterministic commands are replicated correctly.

#### 2.6 Configuration (`redis.conf`)

*   **Threats:**
    *   **Misconfiguration:**  Incorrect or insecure configuration settings leading to vulnerabilities.
    *   **Default Settings:**  Using default settings without proper security hardening.
*   **Mitigation:**
    *   **Misconfiguration:**  Carefully review and understand all configuration settings.  Use a configuration management tool to automate and enforce secure configurations.  Regularly audit the `redis.conf` file.
    *   **Default Settings:**  Never use default settings in production.  Explicitly configure all security-related settings, including authentication, TLS/SSL, ACLs, and resource limits.

#### 2.7 Build Process

* **Threats:**
    * **Compromised Build Server:** An attacker gaining access to the build server and injecting malicious code into the Redis binary.
    * **Dependency Vulnerabilities:** Using outdated or vulnerable dependencies in the build process.
    * **Unsigned Releases:** Distribution of unofficial or tampered Redis binaries.
* **Mitigation:**
    * **Compromised Build Server:** Secure the build server with strong access controls, regular security updates, and intrusion detection systems. Use a dedicated, isolated build environment.
    * **Dependency Vulnerabilities:** Regularly scan dependencies for known vulnerabilities. Use a dependency management tool that supports vulnerability scanning. Update dependencies promptly when vulnerabilities are discovered.
    * **Unsigned Releases:** Always download Redis from official sources (e.g., the Redis website or GitHub releases). Verify the digital signature of the release artifact before installing.

#### 2.8 Deployment (Replication with Sentinel)

* **Threats:**
    * **Single Point of Failure:** If all Sentinel instances are located in the same data center or availability zone, a single outage could disrupt the entire system.
    * **Network Partition:** A network partition could lead to a split-brain scenario, where multiple masters are elected.
    * **Unsecured Inter-node Communication:** Communication between Redis nodes and Sentinel instances without encryption or authentication.
* **Mitigation:**
    * **Single Point of Failure:** Deploy Sentinel instances across multiple data centers or availability zones.
    * **Network Partition:** Use a sufficient number of Sentinel instances (at least three) and configure the `quorum` setting appropriately. Ensure reliable network connectivity between nodes.
    * **Unsecured Inter-node Communication:** Enable TLS/SSL encryption for all communication between Redis nodes and Sentinel instances. Require authentication for all connections.

### 3. Actionable Mitigation Strategies (Summary)

The following table summarizes the key mitigation strategies, categorized by the component they address:

| Component             | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     