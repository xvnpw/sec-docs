## Deep Security Analysis of PostgreSQL Application

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to provide a thorough evaluation of the security posture of PostgreSQL, as outlined in the provided security design review. The objective is to identify potential security vulnerabilities and risks associated with the architecture, components, and deployment of PostgreSQL, and to recommend specific, actionable mitigation strategies tailored to the PostgreSQL ecosystem. This analysis will focus on understanding the inherent security characteristics of PostgreSQL and how it aligns with the stated business and security requirements.

**Scope:**

The scope of this analysis encompasses the following key areas of PostgreSQL, as derived from the provided security design review documents (C4 Context, Container, Deployment, and Build diagrams):

*   **PostgreSQL Server:** Core database engine, including authentication, authorization, query processing, and data management.
*   **Client Libraries:** Interfaces used by applications to interact with the PostgreSQL server.
*   **Command-line Tools:** Utilities for database administration and management.
*   **Configuration Files:** Settings governing server behavior and security policies.
*   **Storage Engine:** Component responsible for physical data storage.
*   **Deployment Environment (AWS RDS for PostgreSQL):** Cloud-based managed service deployment considerations.
*   **Build Process (GitHub Actions):** Security aspects of the development and build pipeline.

This analysis will specifically address the security requirements and recommended controls outlined in the security design review, and consider the identified business risks and accepted risks. It will not cover the security of the application systems that utilize PostgreSQL, but will focus on the security of PostgreSQL itself and its immediate operational environment.

**Methodology:**

This deep security analysis will employ the following methodology:

1.  **Document Review:**  Thorough review of the provided security design review document, including business posture, security posture, C4 diagrams, risk assessment, and questions/assumptions.
2.  **Architecture and Data Flow Inference:** Based on the C4 diagrams and component descriptions, infer the architecture and data flow within PostgreSQL and its surrounding environment. This will involve understanding how data is processed, stored, and accessed by different components.
3.  **Threat Modeling:** Identify potential threats and vulnerabilities relevant to each component of PostgreSQL, considering the OWASP Top 10, database-specific threats (e.g., SQL injection, privilege escalation), and supply chain risks.
4.  **Security Control Analysis:** Evaluate the effectiveness of existing and recommended security controls in mitigating identified threats. Assess the alignment of security controls with security requirements.
5.  **Mitigation Strategy Development:**  For each identified threat and security gap, develop specific and actionable mitigation strategies tailored to PostgreSQL. These strategies will leverage PostgreSQL's built-in security features, configuration options, and best practices.
6.  **Prioritization and Actionability:**  Prioritize mitigation strategies based on risk severity and business impact. Ensure that recommendations are actionable and can be readily implemented by the development and operations teams.

### 2. Security Implications of Key Components

Based on the C4 diagrams and descriptions, we can break down the security implications of each key component:

**2.1. PostgreSQL Server:**

*   **Security Implications:**
    *   **Authentication and Authorization Bypass:** Vulnerabilities in authentication mechanisms (e.g., password-based, certificate-based) could allow unauthorized access. Weak password policies or misconfigured authentication methods (pg_hba.conf) can increase this risk.
    *   **Privilege Escalation:** Flaws in the authorization system or improper role assignments could lead to users gaining elevated privileges, allowing them to access or modify data beyond their intended permissions.
    *   **SQL Injection:**  If input validation is insufficient, attackers could inject malicious SQL code through client applications, leading to data breaches, data manipulation, or denial of service.
    *   **Denial of Service (DoS):** Resource exhaustion attacks, poorly optimized queries, or vulnerabilities in query processing could lead to server downtime and unavailability.
    *   **Data Breaches:**  Exploitation of vulnerabilities could allow attackers to directly access sensitive data stored within the database.
    *   **Data Integrity Compromise:** Malicious or accidental modifications to data due to insufficient access controls or vulnerabilities.
    *   **Unencrypted Data at Rest:** If data at rest encryption is not enabled, database files and backups are vulnerable to compromise if storage media is accessed by unauthorized parties.
    *   **Unencrypted Data in Transit:** If TLS/SSL is not enforced for client-server communication, sensitive data transmitted over the network could be intercepted.
    *   **Logging and Auditing Failures:** Insufficient or misconfigured security logging and auditing can hinder incident detection, response, and forensic analysis.

**2.2. Client Libraries:**

*   **Security Implications:**
    *   **Vulnerable Libraries:**  Exploitation of vulnerabilities in client libraries (e.g., buffer overflows, memory corruption) could compromise the application or the client system.
    *   **Insecure Connection Handling:**  Libraries might not enforce TLS/SSL by default or might be susceptible to man-in-the-middle attacks if not configured correctly.
    *   **Credential Exposure:**  Improper handling of database credentials within applications using client libraries (e.g., hardcoding credentials, insecure storage) can lead to unauthorized access.
    *   **SQL Injection Vulnerabilities (Indirect):** While libraries themselves don't directly cause SQL injection, their misuse in application code (e.g., constructing queries without parameterization) is a primary source of SQL injection vulnerabilities.

**2.3. Command-line Tools:**

*   **Security Implications:**
    *   **Administrative Access Abuse:**  Unauthorized access to command-line tools (psql, pg_dump, etc.) could allow attackers to perform administrative tasks, including data exfiltration, database manipulation, or denial of service.
    *   **Credential Exposure (Command History):**  Storing database credentials in command history or scripts used with command-line tools can lead to credential compromise.
    *   **Local Privilege Escalation:** Vulnerabilities in command-line tools could be exploited for local privilege escalation on the server.
    *   **Backup Data Exposure:** If backups created by `pg_dump` are not securely stored and accessed, they can become a source of data breaches.

**2.4. Configuration Files:**

*   **Security Implications:**
    *   **Misconfiguration:** Incorrectly configured settings in `postgresql.conf` or `pg_hba.conf` can weaken security posture, such as allowing weak authentication methods, overly permissive access rules, or disabling security features.
    *   **Unauthorized Modification:**  If file permissions on configuration files are not properly restricted, unauthorized users could modify them to weaken security or gain unauthorized access.
    *   **Credential Storage in Configuration:** While less common, storing sensitive credentials directly in configuration files is a significant security risk.

**2.5. Storage Engine:**

*   **Security Implications:**
    *   **Data at Rest Exposure:** If data at rest encryption is not implemented at the storage engine level or underlying storage system, physical access to storage media can lead to data breaches.
    *   **Data Corruption:**  Storage engine vulnerabilities or misconfigurations could lead to data corruption or loss, impacting data integrity and availability.
    *   **Performance Degradation (Security Features):**  Enabling certain security features (e.g., encryption) at the storage engine level might have performance implications that need to be considered.

**2.6. Deployment Environment (AWS RDS for PostgreSQL):**

*   **Security Implications:**
    *   **Misconfigured Security Groups:**  Overly permissive security group rules could expose the PostgreSQL instance to unauthorized network access from the internet or other AWS resources.
    *   **IAM Role Misconfiguration:**  Incorrectly configured IAM roles could grant excessive permissions to the PostgreSQL instance, potentially leading to security breaches if the instance is compromised.
    *   **Publicly Accessible Backups:**  If S3 buckets used for backups are not properly secured (e.g., public read access), backups could be exposed to unauthorized access.
    *   **Vulnerabilities in Managed Service Infrastructure:**  Although less likely, vulnerabilities in the underlying AWS RDS infrastructure could potentially impact the security of PostgreSQL instances.
    *   **Logging and Monitoring Gaps:**  Insufficient monitoring and logging within AWS CloudWatch could hinder security incident detection and response.

**2.7. Build Process (GitHub Actions):**

*   **Security Implications:**
    *   **Compromised Build Pipeline:**  If the build system (GitHub Actions) is compromised, attackers could inject malicious code into the PostgreSQL binaries or artifacts.
    *   **Vulnerable Dependencies:**  Using vulnerable dependencies in the build process can introduce security vulnerabilities into the final PostgreSQL software.
    *   **Exposure of Build Secrets:**  Improper handling of secrets (e.g., API keys, credentials) within the build pipeline could lead to their compromise.
    *   **Lack of Code Integrity Checks:**  Absence of code signing or artifact integrity checks could allow attackers to distribute tampered versions of PostgreSQL.

### 3. Architecture, Components, and Data Flow Inference

Based on the C4 diagrams and component descriptions, we can infer the following architecture and data flow:

1.  **User Interaction:** Users interact with applications or directly with command-line tools to access and manage PostgreSQL.
2.  **Application Connection:** Applications use client libraries to establish connections to the PostgreSQL Server. These connections are typically network-based.
3.  **Authentication and Authorization:** When a connection is established, the PostgreSQL Server authenticates the user based on configured methods (passwords, certificates, external authentication). Upon successful authentication, the server enforces authorization based on roles and permissions defined within the database.
4.  **Query Processing:** Client libraries send SQL queries to the PostgreSQL Server. The server parses, optimizes, and executes these queries.
5.  **Data Access and Storage:** The PostgreSQL Server interacts with the Storage Engine to read and write data to the underlying storage system. The Storage Engine manages data files, indexes, and transaction logs.
6.  **Configuration Management:** The PostgreSQL Server reads configuration settings from configuration files during startup and runtime. These files define server behavior, security policies, and operational parameters.
7.  **Administrative Tasks:** Database administrators use command-line tools to perform administrative tasks, such as database creation, user management, backups, and monitoring.
8.  **Deployment in AWS RDS (Example):** In a cloud deployment like AWS RDS, the PostgreSQL Instance runs within AWS infrastructure. AWS RDS manages aspects like patching, backups, and monitoring. Security Groups control network access, and IAM Roles manage permissions for the instance to interact with other AWS services like S3 (for backups) and CloudWatch (for monitoring).

**Data Flow (Simplified):**

`User/Application -> Client Libraries -> Network -> PostgreSQL Server -> Storage Engine -> Storage System`

**Key Security Data Flows:**

*   **Authentication Data Flow:** User credentials (passwords, certificates) flow from client to server for authentication. Secure transmission (TLS/SSL) is crucial.
*   **Authorization Data Flow:** User roles and permissions are checked by the server during query execution to control access to data and operations.
*   **Sensitive Data Flow:** Sensitive data flows between the PostgreSQL Server, Storage Engine, and Storage System. Encryption at rest and in transit is essential to protect this data.
*   **Configuration Data Flow:** Configuration files are read by the PostgreSQL Server during startup and runtime. Secure access and integrity of these files are important.
*   **Backup Data Flow:** Database backups are created by `pg_dump` or managed by AWS RDS and stored in secure locations (e.g., S3). Secure storage and access control for backups are critical.

### 4. Specific Security Recommendations for PostgreSQL Project

Based on the identified security implications and the project context (open-source RDBMS), the following specific security recommendations are tailored to PostgreSQL:

**4.1. Authentication and Authorization:**

*   **Recommendation 1: Enforce Strong Password Policies:**
    *   **Specific to PostgreSQL:** Implement password complexity requirements using the `password_required` parameter in `postgresql.conf` and encourage the use of password management tools by users.
    *   **Actionable Mitigation:** Document and promote best practices for strong password creation and management in PostgreSQL documentation and user guides. Consider developing scripts or extensions to enforce password complexity at the database level.

*   **Recommendation 2: Default to Strong Authentication Methods:**
    *   **Specific to PostgreSQL:**  In `pg_hba.conf`, prioritize stronger authentication methods like `cert`, `gssapi`, `sspi`, or `pam` over `password` or `md5` where feasible. For password-based authentication, strongly recommend `scram-sha-256`.
    *   **Actionable Mitigation:** Update default `pg_hba.conf` examples to showcase and recommend stronger authentication methods. Provide clear documentation on configuring and utilizing these methods.

*   **Recommendation 3: Implement Role-Based Access Control (RBAC) by Default:**
    *   **Specific to PostgreSQL:**  Emphasize the use of roles and granular permissions in PostgreSQL documentation and tutorials. Discourage the use of the `postgres` superuser account for routine operations.
    *   **Actionable Mitigation:**  Create templates or scripts that demonstrate best practices for setting up RBAC in PostgreSQL. Develop educational materials highlighting the principle of least privilege and its application in PostgreSQL.

*   **Recommendation 4: Implement Brute-Force Attack Protection:**
    *   **Specific to PostgreSQL:**  Explore and document methods for rate limiting connection attempts or implementing connection throttling at the operating system or firewall level, as PostgreSQL itself does not have built-in brute-force protection. Consider integration with fail2ban or similar tools.
    *   **Actionable Mitigation:**  Provide guidance and examples on configuring external tools or firewall rules to mitigate brute-force attacks against PostgreSQL authentication mechanisms.

**4.2. Input Validation and SQL Injection Prevention:**

*   **Recommendation 5: Promote Parameterized Queries and Prepared Statements:**
    *   **Specific to PostgreSQL:**  Strongly advocate for the use of parameterized queries or prepared statements in all client library documentation and examples. Emphasize this as the primary defense against SQL injection.
    *   **Actionable Mitigation:**  Enhance documentation and tutorials to prominently feature parameterized queries and prepared statements in various client library examples (libpq, JDBC, psycopg2, etc.). Consider developing linter rules or static analysis tools to detect potential SQL injection vulnerabilities in PostgreSQL extensions or contributed code.

*   **Recommendation 6: Implement Input Validation within Stored Procedures and Functions:**
    *   **Specific to PostgreSQL:**  Document best practices for input validation within PL/pgSQL stored procedures and functions. Encourage developers to validate all user-supplied inputs within database-side code.
    *   **Actionable Mitigation:**  Provide examples and guidelines on input validation techniques within PL/pgSQL, including data type validation, length checks, and regular expression matching.

**4.3. Cryptography and Data Protection:**

*   **Recommendation 7: Default to TLS/SSL Encryption for Client Connections:**
    *   **Specific to PostgreSQL:**  Recommend enabling TLS/SSL encryption by default in server configurations and client connection strings. Provide clear instructions on generating and configuring certificates for TLS/SSL.
    *   **Actionable Mitigation:**  Update default configuration examples to enable TLS/SSL. Improve documentation on TLS/SSL configuration, certificate management, and troubleshooting.

*   **Recommendation 8: Implement Data at Rest Encryption:**
    *   **Specific to PostgreSQL:**  Document and promote the use of PostgreSQL's data at rest encryption features (e.g., `pgcrypto` extension for column-level encryption, or full database encryption solutions). For cloud deployments like AWS RDS, emphasize the use of managed encryption services.
    *   **Actionable Mitigation:**  Enhance documentation on data at rest encryption options in PostgreSQL, including `pgcrypto` and full database encryption solutions. Provide guidance on key management best practices for encrypted data.

*   **Recommendation 9: Secure Key Management Practices:**
    *   **Specific to PostgreSQL:**  Provide guidance on secure key management practices for encryption keys used with `pgcrypto` or full database encryption. Recommend using dedicated key management systems or secure vault solutions for production environments.
    *   **Actionable Mitigation:**  Develop best practice guides and documentation on key management for PostgreSQL encryption, covering key generation, storage, rotation, and access control.

**4.4. Security Auditing and Logging:**

*   **Recommendation 10: Enhance Security Auditing Capabilities:**
    *   **Specific to PostgreSQL:**  Promote the use of PostgreSQL's built-in auditing features (e.g., `log_statement`, `log_connections`, `log_disconnections`, `audit-trail` extension). Document how to configure and utilize these features effectively.
    *   **Actionable Mitigation:**  Improve documentation and examples on configuring PostgreSQL's auditing features. Consider developing or promoting extensions that provide more comprehensive and granular auditing capabilities.

*   **Recommendation 11: Centralized Log Management and Monitoring:**
    *   **Specific to PostgreSQL:**  Recommend integrating PostgreSQL logs with centralized log management and monitoring systems (e.g., ELK stack, Splunk, CloudWatch Logs). Provide guidance on configuring PostgreSQL to send logs to these systems.
    *   **Actionable Mitigation:**  Develop guides and examples on integrating PostgreSQL logs with popular centralized logging and monitoring platforms. Create dashboards and alerts for common security events in PostgreSQL logs.

**4.5. Vulnerability Management and Patching:**

*   **Recommendation 12: Proactive Vulnerability Scanning and Patching:**
    *   **Specific to PostgreSQL:**  Emphasize the importance of regularly applying security patches and updates released by the PostgreSQL community. Provide clear communication channels for security advisories and release notes.
    *   **Actionable Mitigation:**  Maintain a clear and accessible security advisory page on the PostgreSQL website. Improve the process for communicating security vulnerabilities and patch releases to users. Develop automated tools or scripts to assist users in checking for and applying PostgreSQL updates.

**4.6. Supply Chain Security:**

*   **Recommendation 13: Enhance Dependency Management and Security Scanning:**
    *   **Specific to PostgreSQL:**  Implement automated dependency scanning in the build pipeline to identify and address vulnerabilities in third-party libraries used by PostgreSQL.
    *   **Actionable Mitigation:**  Integrate dependency scanning tools (e.g., Dependency-Check, Snyk) into the PostgreSQL build process (GitHub Actions). Regularly review and update dependencies to minimize supply chain risks.

*   **Recommendation 14: Secure Build Environment and Artifact Integrity:**
    *   **Specific to PostgreSQL:**  Harden the build environment (GitHub Actions) and implement measures to ensure the integrity of build artifacts. Consider code signing for official PostgreSQL releases.
    *   **Actionable Mitigation:**  Implement security best practices for GitHub Actions workflows. Explore code signing options for PostgreSQL binaries and packages to verify their authenticity and integrity.

### 5. Actionable Mitigation Strategies

The recommendations outlined above can be translated into the following actionable mitigation strategies:

| Recommendation                                          | Actionable Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            