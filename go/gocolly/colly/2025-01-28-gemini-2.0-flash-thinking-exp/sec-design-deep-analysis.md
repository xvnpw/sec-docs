## Deep Security Analysis of Colly Web Scraping Library

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to identify and evaluate potential security vulnerabilities and risks associated with the Colly web scraping library and applications built upon it. The objective is to provide actionable security recommendations and mitigation strategies tailored to Colly, enabling development teams to build more secure web scraping solutions. This analysis will focus on understanding the architecture, components, and data flow of Colly to pinpoint areas susceptible to security threats.

**Scope:**

The scope of this analysis is limited to the Colly library as described in the provided "Project Design Document: Colly Web Scraping Library" (Version 1.1). It encompasses the following:

*   **Core Colly Components:** Analysis of each component within the Colly library architecture (Collector, Request Scheduler, Request Queue, Fetcher Pool, Fetcher, Response Handler, Response Parser, Data Extractor, Storage, Middleware, Error Handler).
*   **Data Flow:** Examination of the data flow within Colly, from request initiation to data extraction and storage, identifying potential points of vulnerability.
*   **Security Considerations outlined in the Design Document:**  Deep dive into the security aspects already identified in the design document, expanding on them with specific Colly-related threats and mitigations.
*   **Inferred Architecture and Functionality:**  Analysis based on the provided documentation and codebase understanding, inferring potential security implications from the library's design and intended use.

This analysis will **not** cover:

*   Security vulnerabilities in the Go programming language itself.
*   Security of specific storage backends chosen by the user (e.g., Redis, databases) unless directly related to Colly's integration.
*   Security of the target websites being scraped.
*   Comprehensive code review of the entire Colly codebase.
*   Penetration testing or dynamic security analysis of Colly.

**Methodology:**

This analysis will employ a structured approach:

1.  **Document Review:** Thorough review of the provided "Project Design Document" to understand Colly's architecture, components, data flow, and initial security considerations.
2.  **Architecture and Data Flow Inference:** Based on the document, infer the detailed architecture and data flow, focusing on identifying trust boundaries and data processing stages.
3.  **Component-Based Security Analysis:** Analyze each key component of Colly, identifying potential security implications specific to its function and interactions with other components and external entities (User Application, Target Website).
4.  **Threat Identification:**  Utilize threat modeling principles, particularly focusing on STRIDE categories (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) where relevant, to identify potential threats in the context of web scraping and Colly's architecture.
5.  **Specific Recommendation and Mitigation Strategy Development:** For each identified threat, develop actionable and tailored security recommendations and mitigation strategies specifically applicable to Colly and its usage. These strategies will focus on configuration, coding practices, and deployment considerations for Colly-based applications.

### 2. Security Implications of Key Components

This section breaks down the security implications of each key component of the Colly library, based on the architecture and data flow described in the design document.

**2.1. Collector:**

*   **Security Implications:**
    *   **Configuration Vulnerabilities:** Misconfiguration of the `Collector` can lead to security issues. For example, overly aggressive concurrency or rate limits can lead to IP blocking or DoS of target websites. Improperly configured storage or middleware can introduce vulnerabilities.
    *   **Middleware Chain Risks:** If user-defined middleware is not carefully implemented, it can introduce vulnerabilities such as injection flaws, information disclosure, or bypass security controls. Malicious middleware could intercept and modify requests or responses in unintended ways.
    *   **Error Handling Mismanagement:** Inadequate error handling in the `Collector` or its configured error handler can lead to unexpected behavior, potential information leakage through error messages, or denial of service if errors are not gracefully managed.

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Configuration Hardening:** Provide clear documentation and examples on secure `Collector` configuration, emphasizing rate limiting, concurrency control, User-Agent management, and `robots.txt` compliance.
    *   **Middleware Security Review:**  Advise developers to thoroughly review and test any custom middleware for security vulnerabilities before deployment. Implement input validation and output sanitization within middleware.
    *   **Robust Error Handling:** Encourage developers to implement comprehensive error handling within their Colly applications, logging errors securely and avoiding the exposure of sensitive information in error messages. Use structured logging for easier analysis.

**2.2. Request Scheduler & Request Queue:**

*   **Security Implications:**
    *   **Queue Poisoning (Integrity, Availability):** If the Request Queue is not properly managed (especially if persistent storage is used), an attacker could potentially inject malicious URLs into the queue, leading to scraping of unintended targets or DoS attacks on the scraper itself.
    *   **Unintended Target Scraping (Confidentiality, Availability):**  If URL validation is insufficient before adding to the queue, the scraper might inadvertently target internal networks or sensitive systems if seed URLs or discovered links are not properly controlled.
    *   **DoS via Queue Flooding (Availability):**  In scenarios where link discovery is aggressive and URL filtering is weak, the Request Queue could be flooded with a massive number of URLs, potentially leading to memory exhaustion and DoS of the scraper.

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Strict URL Validation:** Implement robust URL validation and sanitization before adding URLs to the Request Queue. Use allowlists or denylists for target domains if possible.
    *   **Secure Queue Management:** If using persistent storage for the Request Queue, ensure proper access controls and security configurations for the storage backend to prevent unauthorized modification.
    *   **Queue Size Limits:** Implement limits on the Request Queue size to prevent queue flooding and memory exhaustion. Monitor queue size and implement alerts for unusual growth.
    *   **Rate Limiting at Queue Level:** Consider implementing rate limiting not just at the fetcher level but also at the Request Scheduler level to control the rate at which URLs are pulled from the queue.

**2.3. Fetcher Pool & Fetcher:**

*   **Security Implications:**
    *   **Server-Side Request Forgery (SSRF) (Confidentiality, Availability):** If the target URL is not properly validated by the User Application before being passed to Colly, a malicious actor could potentially control the target URL and induce the Fetcher to make requests to internal resources or unintended external systems.
    *   **TLS/SSL Vulnerabilities (Confidentiality, Integrity):**  If the underlying `net/http` client is not configured securely or if there are vulnerabilities in the Go TLS implementation, communication with HTTPS websites could be compromised, leading to man-in-the-middle attacks or data interception.
    *   **Proxy Misconfiguration (Confidentiality, Availability):**  If proxies are used for anonymity or bypassing blocking, misconfigured or compromised proxies could expose the scraper's actual IP address or route traffic through insecure channels.
    *   **Exposure of Sensitive Data in Requests (Confidentiality):** User application code might inadvertently include sensitive data (API keys, credentials) in request headers or URL parameters. If not handled carefully, this data could be logged, exposed in transit, or stored insecurely.

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Robust URL Validation in User Application:** Emphasize the importance of strict URL validation in the User Application code *before* passing URLs to Colly. Use URL parsing libraries and validation rules to prevent SSRF.
    *   **Secure TLS Configuration:** Ensure that the `net/http` client used by Colly is configured with secure TLS settings. Encourage users to use the latest Go versions with up-to-date TLS implementations. Consider using `crypto/tls` package for fine-grained TLS control if needed.
    *   **Secure Proxy Management:**  If using proxies, obtain them from reputable providers and configure them securely. Implement authentication for proxies if available. Regularly audit and rotate proxies. Avoid hardcoding proxy credentials in code; use environment variables or secure configuration management.
    *   **Sensitive Data Handling in Requests:**  Advise developers to avoid embedding sensitive data directly in URLs. Use request headers or bodies for sensitive data and ensure HTTPS is used for transmission. Implement mechanisms to redact sensitive data from logs.

**2.4. Response Handler & Response Parser:**

*   **Security Implications:**
    *   **Denial of Service via Malicious Responses (Availability):**  A malicious target website could send specially crafted responses designed to exploit vulnerabilities in the Response Parser (e.g., XML External Entity (XXE) injection if XML parsing is used, or vulnerabilities in HTML parsing libraries). This could lead to excessive resource consumption or crashes in the scraper.
    *   **Information Disclosure via Error Messages (Confidentiality):**  Verbose error messages from the Response Parser or Handler might inadvertently disclose sensitive information about the scraper's internal workings or the target website's structure.
    *   **Code Injection via Unsafe Parsing (Integrity, Availability):** In extreme cases, vulnerabilities in the parsing libraries themselves could potentially be exploited to achieve code injection if the parser processes malicious content. (Less likely with well-vetted libraries like `goquery`, but still a theoretical risk).

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Resource Limits for Parsing:** Implement resource limits (e.g., memory limits, parsing timeouts) to mitigate DoS attacks via malicious responses.
    *   **Error Message Sanitization:** Sanitize error messages generated by the Response Parser and Handler to prevent information disclosure. Log detailed errors securely for debugging but avoid exposing them to end-users or in public logs.
    *   **Dependency Updates and Vulnerability Scanning:** Keep the parsing libraries (`goquery`, `encoding/xml`, `encoding/json`) and their dependencies up-to-date to patch known security vulnerabilities. Regularly scan dependencies for vulnerabilities using vulnerability scanning tools.
    *   **Consider Content Type Validation:**  Strictly validate the `Content-Type` header of responses before parsing them. Only parse expected content types (e.g., HTML, XML, JSON) and reject unexpected or potentially malicious content types.

**2.5. Data Extractor:**

*   **Security Implications:**
    *   **Cross-Site Scripting (XSS) Vulnerabilities in User Application (Integrity, Availability):** If the extracted data is not properly sanitized and is used in web applications or displayed to users, it could introduce XSS vulnerabilities. Malicious content scraped from websites could be injected into the user application.
    *   **Injection Vulnerabilities in Downstream Systems (Integrity, Availability):** If the extracted data is used to construct queries for databases or other systems without proper sanitization, it could lead to injection vulnerabilities (e.g., SQL injection, command injection).

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Output Sanitization:**  **Crucially emphasize output sanitization.**  Developers must sanitize all scraped data before using it in any downstream systems, especially if the data is displayed in web applications or used in database queries. Use context-aware output encoding to prevent XSS.
    *   **Input Validation for Downstream Systems:**  Validate and sanitize scraped data as input to any downstream systems (databases, APIs, etc.) to prevent injection vulnerabilities. Use parameterized queries or prepared statements for database interactions.
    *   **Content Security Policy (CSP) in User Applications:** If scraped data is displayed in web applications, implement Content Security Policy (CSP) headers to mitigate the impact of potential XSS vulnerabilities.

**2.6. Storage:**

*   **Security Implications:**
    *   **Data Breach (Confidentiality, Integrity):** If storage backends (for caching or scraped data persistence) are not securely configured, scraped data could be exposed to unauthorized access, leading to data breaches.
    *   **Data Tampering (Integrity):**  Insecure storage could allow attackers to tamper with cached responses or scraped data, potentially leading to data integrity issues and incorrect information being used by the application.
    *   **Denial of Service via Storage Exhaustion (Availability):**  If storage is not properly managed, excessive caching or data storage could lead to storage exhaustion and DoS of the scraper or downstream systems.

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Secure Storage Configuration:**  Follow security best practices for configuring chosen storage backends (e.g., access controls, authentication, encryption at rest and in transit).
    *   **Access Control:** Implement strict access controls for storage backends, limiting access only to authorized components and users.
    *   **Encryption:**  Enable encryption at rest and in transit for sensitive scraped data stored in persistent storage.
    *   **Storage Quotas and Monitoring:** Implement storage quotas and monitoring to prevent storage exhaustion. Regularly review and manage cached data and scraped data storage.
    *   **Regular Security Audits:** Conduct regular security audits of storage infrastructure and configurations.

**2.7. Middleware:**

*   **Security Implications:**
    *   **Introduction of Vulnerabilities (All STRIDE categories):**  Custom middleware, if not developed securely, can introduce a wide range of vulnerabilities, including injection flaws, information disclosure, authentication bypass, and DoS.
    *   **Bypass of Security Controls (Integrity, Availability):**  Malicious or poorly designed middleware could potentially bypass built-in security controls within Colly or user application logic.
    *   **Performance Degradation (Availability):**  Inefficient middleware can degrade the performance of the scraper, potentially leading to DoS or slow scraping speeds.

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Secure Middleware Development Practices:**  Provide guidelines and best practices for developing secure middleware, emphasizing input validation, output sanitization, secure coding principles, and thorough testing.
    *   **Middleware Security Review:**  Mandate security review and testing for all custom middleware before deployment. Consider static and dynamic analysis of middleware code.
    *   **Principle of Least Privilege for Middleware:**  Design middleware to operate with the least privileges necessary. Avoid granting excessive permissions to middleware components.
    *   **Middleware Auditing and Logging:** Implement auditing and logging within middleware to track its actions and identify potential security issues or performance bottlenecks.

**2.8. Error Handler:**

*   **Security Implications:**
    *   **Information Disclosure via Error Messages (Confidentiality):**  Error handlers might inadvertently log or display sensitive information in error messages, such as internal paths, configuration details, or scraped data snippets.
    *   **DoS via Error Handling Loops (Availability):**  Poorly designed error handling logic, especially retry mechanisms, could potentially lead to infinite loops or excessive resource consumption if errors are not handled gracefully.

*   **Specific Recommendations & Mitigation Strategies:**
    *   **Secure Error Logging:**  Log errors securely, avoiding the inclusion of sensitive information in log messages. Use structured logging and redact sensitive data before logging.
    *   **Error Message Sanitization for Output:** Sanitize error messages displayed to users or external systems to prevent information disclosure.
    *   **Retry Mechanism Limits:** Implement limits on retry attempts and backoff strategies in error handlers to prevent infinite loops and resource exhaustion.
    *   **Centralized Error Handling and Monitoring:**  Use a centralized error handling mechanism and monitoring system to track errors, identify patterns, and proactively address issues.

### 3. Architecture, Components, and Data Flow Inference

Based on the provided design document, the architecture of a Colly application can be inferred as a pipeline processing model. Data flows through the following stages:

1.  **Request Generation:** User application initiates requests via the `Collector`.
2.  **Request Scheduling and Queuing:** `Request Scheduler` manages and queues requests.
3.  **Request Fetching:** `Fetcher Pool` and `Fetcher` handle HTTP requests to the `Target Website`.
4.  **Response Handling:** `Response Handler` processes HTTP responses, manages cookies, and handles redirects.
5.  **Response Parsing:** `Response Parser` parses the response body based on content type (HTML, XML, JSON).
6.  **Data Extraction:** `Data Extractor` provides APIs for users to extract data from parsed responses.
7.  **Data Processing and Storage:** User application processes and stores extracted data.
8.  **Link Discovery and Queueing:** Colly automatically discovers and queues links for further crawling (if configured).
9.  **Middleware Processing:** Middleware intercepts requests and responses at various stages.
10. **Storage Interaction:** `Storage` component handles caching and data persistence.
11. **Error Handling:** `Error Handler` manages errors throughout the process.

**Key Security Inference Points:**

*   **Trust Boundary:** The primary trust boundary is between the Colly application and the `Target Website`. Colly fetches data from external, potentially untrusted websites.
*   **Data Origin Uncertainty:** Scraped data originates from untrusted external sources and must be treated as potentially malicious until validated and sanitized.
*   **User Application Responsibility:** Security heavily relies on the User Application code to properly configure Colly, validate URLs, sanitize inputs and outputs, and handle extracted data securely. Colly provides tools, but secure usage is the developer's responsibility.
*   **Middleware as Extension Point and Risk:** Middleware provides powerful extensibility but also introduces a significant security risk if not developed and reviewed carefully.
*   **Storage as Data Repository:** Storage components become repositories for scraped data, requiring robust security measures to protect data confidentiality and integrity.

### 4. Specific Recommendations for Colly Projects

Based on the analysis, here are specific security recommendations tailored for projects using Colly:

1.  **Prioritize Input Validation:** Implement strict URL validation in your User Application code *before* adding URLs to Colly. Use URL parsing libraries to sanitize and validate URLs against allowlists or denylists of trusted domains. Prevent scraping of internal networks or unintended targets.
2.  **Mandatory Output Sanitization:**  Sanitize *all* scraped data before using it in any downstream systems, especially if displayed in web applications or used in database queries. Use context-aware output encoding to prevent XSS and parameterized queries to prevent injection vulnerabilities.
3.  **Secure Middleware Development and Review:** If using custom middleware, follow secure coding practices. Conduct thorough security reviews and testing of all middleware components. Adhere to the principle of least privilege for middleware.
4.  **Robust Error Handling and Logging (with Sanitization):** Implement comprehensive error handling in your Colly application. Log errors securely, sanitizing error messages to prevent information disclosure. Use structured logging for easier analysis. Implement retry limits and backoff strategies to prevent DoS via error loops.
5.  **Secure Storage Configuration and Management:** Securely configure storage backends used for caching and data persistence. Implement access controls, authentication, and encryption at rest and in transit. Regularly audit storage configurations and manage storage quotas.
6.  **Dependency Management and Vulnerability Scanning:** Keep Colly and all its dependencies (including parsing libraries) up-to-date. Regularly scan dependencies for known vulnerabilities and apply patches promptly.
7.  **Rate Limiting and Ethical Scraping:** Configure Colly's rate limiting and concurrency settings to be respectful of target websites and avoid triggering DoS protection mechanisms. Always respect `robots.txt` and website terms of service.
8.  **User-Agent Management and Proxy Rotation (with Caution):** Use descriptive and legitimate User-Agent strings. If using proxies for anonymity, obtain them from reputable providers and configure them securely. Rotate proxies and monitor their performance and security.
9.  **Regular Security Audits and Testing:** Conduct regular security audits of your Colly applications and infrastructure. Perform penetration testing and vulnerability scanning to identify and address potential security weaknesses.
10. **Educate Developers on Web Scraping Security:** Provide security awareness training to developers working on Colly projects, emphasizing web scraping specific security risks and best practices.

### 5. Actionable and Tailored Mitigation Strategies

Here are actionable and tailored mitigation strategies applicable to Colly for the identified threats:

| Threat Category | Specific Threat                                  | Actionable Mitigation Strategy for Colly Projects                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                