## Deep Security Analysis of Filebrowser

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to conduct a thorough security assessment of the `filebrowser/filebrowser` project, focusing on its key components, architecture, data flow, and deployment model.  The analysis aims to identify potential security vulnerabilities, assess their impact, and propose actionable mitigation strategies.  The primary goal is to provide specific, practical recommendations to enhance the security posture of a `filebrowser` deployment, going beyond generic security advice.  We will focus on the core components: authentication, authorization, file handling, input validation, and the build/deployment process.

**Scope:**

This analysis covers the following aspects of the `filebrowser/filebrowser` project:

*   **Codebase Analysis:**  Examining the Go source code (inferred from the provided design document and general knowledge of the project) to identify potential vulnerabilities in the application logic.
*   **Architectural Review:**  Analyzing the C4 diagrams and deployment model to understand the interaction between components and identify potential attack vectors.
*   **Dependency Analysis:**  Considering the security implications of using Go modules and the potential for supply chain attacks.
*   **Deployment Security:**  Evaluating the security of the recommended Docker deployment model.
*   **Configuration Review:** Assessing the security implications of various configuration options.
*   **Threat Modeling:** Identifying potential threats and attack scenarios based on the project's business risks and security posture.

This analysis *does not* cover:

*   **Formal Code Audit:**  This is not a line-by-line code audit, but rather a higher-level security review.
*   **Penetration Testing:**  This analysis does not involve active exploitation of the system.
*   **Security of External Systems:**  We assume that external systems like Authelia, external authentication providers, and the underlying operating system/file system are configured securely.  Our focus is on the `filebrowser` application itself.

**Methodology:**

1.  **Information Gathering:**  Gather information about the project from the provided design document, GitHub repository (implicitly, as we don't have direct access), and publicly available documentation.
2.  **Architecture and Data Flow Inference:**  Based on the gathered information, infer the architecture, components, and data flow of the application.
3.  **Threat Modeling:**  Identify potential threats and attack scenarios based on the project's business risks, security posture, and architecture.
4.  **Vulnerability Analysis:**  Analyze each key component for potential vulnerabilities, considering common web application security risks (OWASP Top 10) and specific threats identified during threat modeling.
5.  **Mitigation Recommendations:**  Propose actionable and tailored mitigation strategies for each identified vulnerability.
6.  **Risk Assessment:** Summarize the findings and provide an overall risk assessment.

### 2. Security Implications of Key Components

Based on the design review and common patterns in web applications, we can infer the following key components and their security implications:

**2.1 Authentication:**

*   **Component:**  Handles user login and session management. Likely implemented using Go's `net/http` package and potentially a library for JWT handling (if JWT is used).
*   **Security Implications:**
    *   **Vulnerability:** Weak password policies could allow attackers to guess or brute-force user passwords.
    *   **Vulnerability:** Improper session management (e.g., predictable session IDs, lack of proper timeouts, insufficient protection against CSRF) could lead to session hijacking.
    *   **Vulnerability:**  If using JWT, improper validation of the JWT signature or expiration time could allow attackers to forge tokens.
    *   **Vulnerability:**  Lack of protection against brute-force login attempts (e.g., no rate limiting or account lockout).
    *   **Vulnerability:**  Insecure storage of user credentials (e.g., storing passwords in plain text or using weak hashing algorithms).
    *   **Vulnerability:**  Vulnerability to phishing attacks if users are not educated about security best practices.

**2.2 Authorization:**

*   **Component:**  Enforces access control rules, determining which users can access which files and perform which operations.  Likely implemented as middleware or within the request handling logic.
*   **Security Implications:**
    *   **Vulnerability:**  Incorrectly implemented authorization logic could allow users to access files or perform actions they are not authorized to.  This is a critical vulnerability.
    *   **Vulnerability:**  Lack of granular permissions (e.g., only having "admin" and "user" roles) could lead to privilege escalation.
    *   **Vulnerability:**  Failure to properly enforce the principle of least privilege.
    *   **Vulnerability:**  Inconsistent authorization checks across different parts of the application.

**2.3 File Handling:**

*   **Component:**  Handles file operations like reading, writing, creating, deleting, moving, and renaming files.  Likely uses Go's `os` and `io` packages.
*   **Security Implications:**
    *   **Vulnerability:**  Path traversal vulnerabilities could allow attackers to access or modify files outside the designated directory.  This is a *critical* vulnerability for a file browser.
    *   **Vulnerability:**  Command injection vulnerabilities could allow attackers to execute arbitrary commands on the server by manipulating file names or paths.  This is also *critical*.
    *   **Vulnerability:**  Race conditions during file operations could lead to data corruption or unexpected behavior.
    *   **Vulnerability:**  Insufficient validation of file uploads (e.g., allowing uploads of executable files or files with malicious content) could lead to server compromise.
    *   **Vulnerability:**  Symlink attacks, where a symbolic link is manipulated to point to a sensitive file or directory.
    *   **Vulnerability:**  Insecure temporary file handling.

**2.4 Input Validation:**

*   **Component:**  Validates all user inputs, including file names, paths, search queries, and any other data submitted by the user.  Likely implemented throughout the application logic.
*   **Security Implications:**
    *   **Vulnerability:**  Insufficient input validation is the root cause of many web application vulnerabilities, including XSS, SQL injection (if a database is used), command injection, and path traversal.
    *   **Vulnerability:**  Failure to properly sanitize user input before displaying it in the web interface could lead to Cross-Site Scripting (XSS) attacks.
    *   **Vulnerability:**  Using a blacklist approach for input validation is generally ineffective, as attackers can often find ways to bypass blacklists.

**2.5 Build and Deployment:**

*   **Component:**  The process of building the application from source, creating a Docker image, and deploying it to a server.
*   **Security Implications:**
    *   **Vulnerability:**  Supply chain attacks, where compromised dependencies are introduced into the application.
    *   **Vulnerability:**  Vulnerabilities in the Docker image itself (e.g., outdated base image, insecure configuration).
    *   **Vulnerability:**  Insecure deployment practices (e.g., exposing the Docker socket to the container, running the container as root).
    *   **Vulnerability:**  Lack of code signing or verification could allow attackers to tamper with the application binary.

### 3. Inferred Architecture, Components, and Data Flow

Based on the C4 diagrams and the description, we can infer the following:

*   **Architecture:**  The application follows a typical client-server architecture, with a web browser as the client and the File Browser application (written in Go) as the server.  A reverse proxy (like Nginx or Caddy) is recommended for production deployments.
*   **Components:**
    *   **Web Interface (Frontend):**  Likely built using a JavaScript framework (e.g., React, Vue.js, or Angular) and communicates with the backend via HTTP requests.
    *   **API Endpoints (Backend):**  Go code that handles requests from the frontend, performs authentication and authorization checks, interacts with the file system, and returns responses.
    *   **Authentication Module:**  Handles user login, session management, and potentially integration with external authentication providers.
    *   **Authorization Module:**  Enforces access control rules.
    *   **File Handling Module:**  Performs file operations on the underlying file system.
    *   **Configuration Module:**  Loads and manages application configuration.
    *   **Logging Module:**  Logs events and errors.
*   **Data Flow:**
    1.  User interacts with the web interface in their browser.
    2.  The browser sends HTTP requests to the reverse proxy.
    3.  The reverse proxy forwards the requests to the File Browser application.
    4.  The File Browser application authenticates the user (if required).
    5.  The application authorizes the request based on the user's permissions.
    6.  The application performs the requested file operation (if authorized).
    7.  The application returns a response to the reverse proxy.
    8.  The reverse proxy forwards the response to the browser.
    9.  The browser renders the response and updates the web interface.

### 4. Specific Security Considerations and Recommendations

Now, let's provide specific recommendations tailored to `filebrowser`, addressing the vulnerabilities identified above:

**4.1 Authentication:**

*   **Recommendation:** Enforce strong password policies using a library like `OWASP/passpolicy`.  *Specifically*, require a minimum length (e.g., 12 characters), a mix of uppercase and lowercase letters, numbers, and symbols.  Reject common passwords.
*   **Recommendation:** Implement secure session management.  Use Go's `crypto/rand` to generate cryptographically secure random session IDs.  Set the `HttpOnly` and `Secure` flags on session cookies.  Implement session timeouts and automatic logout after a period of inactivity.  *Specifically*, configure these settings in the application's configuration file and document them clearly.
*   **Recommendation:** If using JWT, use a well-vetted JWT library (e.g., `golang-jwt/jwt`).  *Specifically*, validate the signature, expiration time (`exp`), issuer (`iss`), and audience (`aud`) claims of every JWT.  Use a strong secret key and rotate it regularly.
*   **Recommendation:** Implement rate limiting on login attempts to prevent brute-force attacks.  *Specifically*, use a library like `throttled` or implement a custom solution using a counter and time window.  Consider account lockout after a certain number of failed attempts, but be mindful of potential denial-of-service attacks.
*   **Recommendation:** Store passwords securely using a strong, adaptive hashing algorithm like Argon2id.  *Specifically*, use the `golang.org/x/crypto/argon2` package.  Never store passwords in plain text or use weak hashing algorithms like MD5 or SHA1.
*   **Recommendation:** Provide user education and documentation on creating strong passwords and avoiding phishing attacks.  *Specifically*, include a section on security best practices in the user documentation.
*   **Recommendation:** Strongly encourage (or even enforce) the use of a reverse proxy with HTTPS enabled. This protects credentials in transit.

**4.2 Authorization:**

*   **Recommendation:** Implement granular, role-based access control (RBAC).  *Specifically*, define roles with specific permissions (e.g., "viewer," "editor," "uploader," "admin").  Allow administrators to assign these roles to users and groups.  Consider using a library like `casbin` for more complex authorization scenarios.
*   **Recommendation:** Enforce the principle of least privilege.  *Specifically*, ensure that users only have access to the files and operations they absolutely need.  Avoid granting overly broad permissions.
*   **Recommendation:** Implement consistent authorization checks across all API endpoints and file operations.  *Specifically*, use a centralized authorization middleware that is applied to all relevant routes.  Avoid duplicating authorization logic in multiple places.
*   **Recommendation:** Regularly review and audit user permissions to ensure they are still appropriate.

**4.3 File Handling:**

*   **Recommendation:**  *Crucially*, implement robust path traversal prevention.  *Specifically*, use Go's `filepath.Clean` function to normalize file paths, and then *strictly* check that the resulting path is within the allowed base directory.  Do *not* rely solely on `filepath.Clean`; perform an additional check to ensure the cleaned path starts with the intended base directory.  Consider using a dedicated path traversal prevention library.
*   **Recommendation:**  *Crucially*, prevent command injection.  *Specifically*, *never* pass user-provided file names or paths directly to shell commands or system calls.  If you need to execute external commands, use Go's `os/exec` package with proper escaping and argument separation.  Avoid using functions like `os.System` or `exec.Command` with user-supplied data concatenated directly into the command string.
*   **Recommendation:**  Implement careful validation of file uploads.  *Specifically*, restrict the types of files that can be uploaded (e.g., using a whitelist of allowed extensions or MIME types).  Scan uploaded files for malware using a virus scanner (this might be done at the reverse proxy or host level).  Store uploaded files in a separate directory from the application code.
*   **Recommendation:**  Mitigate race conditions by using appropriate file locking mechanisms (e.g., `flock` or Go's `sync.Mutex`).  *Specifically*, ensure that only one process can modify a file at a time.
*   **Recommendation:**  Handle symbolic links carefully.  *Specifically*, decide whether to follow symbolic links or not.  If you choose to follow them, check that the target of the symbolic link is also within the allowed base directory.  If you choose not to follow them, handle them as regular files.
*   **Recommendation:** Use secure temporary file creation and deletion. *Specifically*, use `ioutil.TempFile` with a secure directory and ensure temporary files are deleted promptly after use.

**4.4 Input Validation:**

*   **Recommendation:**  Implement strict input validation for *all* user inputs.  *Specifically*, use a whitelist approach whenever possible, defining the allowed characters and patterns for each input field.  Use regular expressions to validate input formats.
*   **Recommendation:**  Sanitize user input before displaying it in the web interface to prevent XSS attacks.  *Specifically*, use Go's `html/template` package, which automatically escapes HTML output.  If you need to allow some HTML tags, use a well-vetted HTML sanitizer library (e.g., `bluemonday`).
*   **Recommendation:**  If using a database, use parameterized queries or prepared statements to prevent SQL injection.  *Specifically*, *never* concatenate user input directly into SQL queries.

**4.5 Build and Deployment:**

*   **Recommendation:**  Use Go modules to manage dependencies and ensure reproducible builds.  *Specifically*, regularly update dependencies using `go get -u` and check for known vulnerabilities using tools like `govulncheck`.
*   **Recommendation:**  Use a minimal base image for the Docker container (e.g., `scratch` or `alpine`).  *Specifically*, avoid including unnecessary tools or libraries in the image.
*   **Recommendation:**  Run the File Browser application as a non-root user inside the container.  *Specifically*, create a dedicated user and group in the Dockerfile and use the `USER` instruction.
*   **Recommendation:**  Do *not* expose the Docker socket to the container.
*   **Recommendation:**  Implement container image scanning in the CI/CD pipeline.  *Specifically*, use tools like Trivy, Clair, or Anchore to scan the Docker image for vulnerabilities before deploying it.
*   **Recommendation:**  Generate an SBOM during the build process.  *Specifically*, use tools like Syft or `go list -m all` to create a list of all dependencies and their versions.
*   **Recommendation:**  Sign commits using GPG keys to ensure code integrity.
*   **Recommendation:** Regularly update the base operating system of the host machine and the Docker Engine to patch security vulnerabilities.

**4.6 Reverse Proxy Configuration:**

*   **Recommendation:** Configure the reverse proxy (Nginx, Caddy, etc.) to handle HTTPS termination and enforce HTTPS connections. Obtain a valid TLS certificate (e.g., from Let's Encrypt).
*   **Recommendation:** Configure the reverse proxy to set appropriate security headers, including:
    *   `Strict-Transport-Security` (HSTS)
    *   `X-Content-Type-Options`
    *   `X-Frame-Options`
    *   `X-XSS-Protection`
    *   `Content-Security-Policy` (CSP) - *Crucially*, implement a strong CSP to mitigate XSS and other code injection attacks.  This requires careful configuration based on the application's needs.
    *   `Referrer-Policy`
*   **Recommendation:** Configure rate limiting at the reverse proxy level to protect against brute-force attacks and denial-of-service.
*   **Recommendation:** Consider using a Web Application Firewall (WAF) at the reverse proxy level to provide additional protection against common web attacks.

**4.7 Audit Logging:**

*   **Recommendation:** Implement comprehensive audit logging. *Specifically*, log all user actions, including file access, modifications, deletions, logins, logouts, and configuration changes. Include timestamps, user IDs, IP addresses, and relevant file paths in the log entries. Store logs securely and protect them from tampering. Consider using a structured logging format (e.g., JSON) for easier analysis.

**4.8 File Integrity Monitoring (FIM):**

*   **Recommendation:** While not strictly part of the Filebrowser application, consider implementing FIM on the host system to detect unauthorized changes to critical files and configurations. Tools like `AIDE`, `Tripwire`, or `Samhain` can be used for this purpose. This is particularly important for the directory being served by Filebrowser.

### 5. Risk Assessment

Based on this analysis, the following risk assessment summarizes the key findings:

| Threat                                      | Likelihood | Impact     | Risk Level | Mitigation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              