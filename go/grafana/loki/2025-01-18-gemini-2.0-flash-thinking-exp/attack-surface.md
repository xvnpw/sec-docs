# Attack Surface Analysis for grafana/loki

## Attack Surface: [Malicious Log Injection via Push API](./attack_surfaces/malicious_log_injection_via_push_api.md)

*   **Description:** An attacker sends crafted log entries to the Loki Push API with the intent to cause harm or gain unauthorized access.
    *   **How Loki Contributes:** Loki's primary function is to ingest logs via its Push API, making it a direct entry point for log data. It relies on the client application to provide valid and safe log content.
    *   **Example:** An attacker injects a log line containing a `<script>alert("XSS")</script>` payload. If these logs are displayed in Grafana without proper sanitization, the script will execute in the user's browser.
    *   **Impact:** Cross-site scripting (XSS), potential for session hijacking, information disclosure, or triggering unintended actions in downstream systems consuming the logs.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   **Input Validation and Sanitization:**  The application sending logs to Loki should sanitize log messages to remove or escape potentially harmful characters and scripts before sending.
        *   **Content Security Policy (CSP):** Implement a strong CSP in Grafana to mitigate the impact of injected scripts.
        *   **Secure Log Display Practices:** Ensure that systems displaying logs (like Grafana) properly escape or sanitize log content to prevent execution of embedded scripts.

## Attack Surface: [Denial of Service (DoS) via Log Flooding of Push API](./attack_surfaces/denial_of_service__dos__via_log_flooding_of_push_api.md)

*   **Description:** An attacker overwhelms the Loki ingestion pipeline by sending a massive volume of logs, exhausting resources.
    *   **How Loki Contributes:** Loki's Push API is designed to accept a high volume of logs. Without proper rate limiting or resource controls, it can be overwhelmed.
    *   **Example:** An attacker sends thousands of logs per second to the Loki ingestion endpoint, causing CPU and memory exhaustion on Loki servers, leading to performance degradation or service unavailability.
    *   **Impact:** Disruption of log ingestion, potential loss of log data, impact on systems relying on Loki for monitoring and alerting.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   **Rate Limiting:** Implement rate limiting on the Loki Push API to restrict the number of logs accepted from a single source or overall.
        *   **Resource Limits:** Configure resource limits (CPU, memory) for Loki components to prevent a single attack from consuming all resources.
        *   **Load Balancing:** Distribute log ingestion traffic across multiple Loki instances.
        *   **Authentication and Authorization:** Restrict access to the Push API to authorized clients.

## Attack Surface: [LogQL Injection via Query API](./attack_surfaces/logql_injection_via_query_api.md)

*   **Description:** If user-provided input is directly incorporated into LogQL queries without proper sanitization, attackers can inject malicious LogQL to access unauthorized data or cause errors.
    *   **How Loki Contributes:** Loki's Query API uses LogQL as its query language. If the application building queries doesn't sanitize input, it's vulnerable to injection.
    *   **Example:** An application allows users to filter logs based on a user-provided string. An attacker enters `"} | line_format "{{ .User.Password }}" //` which, if not properly handled, could expose sensitive data.
    *   **Impact:** Unauthorized access to sensitive log data, potential for information disclosure, and potential for causing errors or performance issues in Loki.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   **Parameterized Queries:**  If possible, use parameterized queries or prepared statements to separate user input from the LogQL query structure.
        *   **Input Sanitization and Validation:**  Thoroughly sanitize and validate any user input that is used to construct LogQL queries.
        *   **Principle of Least Privilege:** Ensure that the credentials used to query Loki have only the necessary permissions.
        *   **Query Review:** Regularly review and audit the LogQL queries generated by the application.

