## Deep Security Analysis: Artifactory User Plugins

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to comprehensively evaluate the security posture of the Artifactory User Plugins framework. The primary objective is to identify potential security vulnerabilities and risks associated with extending JFrog Artifactory functionality through user-developed plugins. This analysis will focus on understanding the architecture, components, and data flow of the plugin system to pinpoint areas of security concern and provide actionable, tailored mitigation strategies.  The ultimate goal is to ensure that the Artifactory User Plugins framework enhances functionality without compromising the security, integrity, and availability of the Artifactory instance and its managed artifacts.

**Scope:**

The scope of this analysis is limited to the Artifactory User Plugins framework as described in the provided Security Design Review document and inferred from the context of extending JFrog Artifactory using the `jfrog/artifactory-user-plugins` project.  Specifically, the analysis will cover:

*   **Architecture and Components:** Examining the Context, Container, Deployment, and Build diagrams to understand the system's architecture and key components.
*   **Data Flow:** Analyzing the interactions between plugins, Artifactory, users, and external systems to identify potential data security risks.
*   **Security Controls:** Evaluating existing and recommended security controls outlined in the design review.
*   **Security Requirements:** Assessing the security requirements for Authentication, Authorization, Input Validation, and Cryptography in the context of user plugins.
*   **Risk Assessment:** Considering the critical business processes and sensitive data involved to prioritize security concerns.

This analysis will *not* include:

*   Detailed code review of the `jfrog/artifactory-user-plugins` codebase itself (as the provided document is a design review, not a code audit).
*   Penetration testing or dynamic vulnerability scanning of a live Artifactory instance with plugins.
*   Security analysis of specific, individual user plugins.
*   Broader Artifactory security beyond the plugin framework.

**Methodology:**

This analysis will employ a risk-based approach, following these steps:

1.  **Architecture Decomposition:**  Deconstruct the provided C4 diagrams (Context, Container, Deployment, Build) to understand the system's architecture, components, and their interactions.
2.  **Threat Modeling:**  Identify potential threats and vulnerabilities associated with each component and interaction point, considering common attack vectors relevant to plugin systems and Java/JVM environments. This will involve considering the OWASP Top 10 and other relevant security frameworks.
3.  **Security Control Mapping:** Map the existing and recommended security controls from the design review to the identified threats and vulnerabilities.
4.  **Gap Analysis:** Identify gaps between the current security posture and the desired security requirements, highlighting areas needing improvement.
5.  **Risk Prioritization:**  Prioritize identified risks based on their potential impact on business priorities (Artifact Management, Software Delivery Pipeline, Custom Automation) and the sensitivity of data at risk (Artifacts, Metadata, Plugin Configurations, Audit Logs).
6.  **Mitigation Strategy Development:**  Develop specific, actionable, and tailored mitigation strategies for the prioritized risks, focusing on practical recommendations applicable to the Artifactory User Plugins framework. These strategies will align with the recommended security controls and address the specific context of Artifactory and its plugin ecosystem.

### 2. Security Implications of Key Components

Based on the provided design review, we can break down the security implications of each key component:

**C4 Context Diagram Components:**

*   **Artifactory User Plugins (P1):**
    *   **Security Implication:**  Plugins, being user-developed code, are the primary source of potential vulnerabilities. Malicious or poorly written plugins can directly compromise Artifactory's security.
    *   **Threats:** Code injection, privilege escalation, data breaches, denial of service, resource exhaustion, cross-site scripting (if plugins expose UI elements).
    *   **Data Flow:** Plugins interact with Artifactory APIs and potentially external systems, making these interfaces critical security boundaries.

*   **Artifactory Instance (S1):**
    *   **Security Implication:**  The core Artifactory instance is the target of plugin-related threats. Plugin vulnerabilities can directly impact the confidentiality, integrity, and availability of Artifactory and its artifacts.
    *   **Threats:**  Compromise of artifact storage, unauthorized access to metadata, disruption of Artifactory services, data corruption.
    *   **Data Flow:** Artifactory manages sensitive artifacts and metadata. Plugins operating within Artifactory's context have access to this data.

*   **External Systems (S2):**
    *   **Security Implication:** Plugins integrating with external systems can introduce vulnerabilities in these integrations.  Weak authentication, insecure communication, or improper data handling in plugins can expose external systems.
    *   **Threats:** Data breaches in external systems, unauthorized access to external resources, compromise of integration points, injection attacks targeting external systems.
    *   **Data Flow:** Plugins might transmit sensitive data to external systems or receive data that is then processed within Artifactory.

*   **Plugin Marketplace (Hypothetical) (S3):**
    *   **Security Implication:**  If a plugin marketplace is implemented, it becomes a critical point of trust and a potential attack vector. Compromised marketplace infrastructure or malicious plugins distributed through it can have widespread impact.
    *   **Threats:** Distribution of malicious plugins, supply chain attacks, compromised plugin updates, reputation damage.
    *   **Data Flow:**  Users download plugins from the marketplace. If compromised, this download path becomes a threat vector.

**C4 Container Diagram Components:**

*   **Plugin API (C1):**
    *   **Security Implication:** The Plugin API is the primary interface through which plugins interact with Artifactory. Vulnerabilities in the API, such as insufficient authorization checks or input validation, can be exploited by plugins.
    *   **Threats:** API abuse, unauthorized access to Artifactory functionalities, injection attacks through API parameters, privilege escalation.
    *   **Data Flow:** All plugin interactions with Artifactory core functionalities flow through this API.

*   **Plugin Execution Engine (C2):**
    *   **Security Implication:** The execution engine is responsible for running plugin code.  Lack of proper isolation or resource management in the engine can lead to security issues.
    *   **Threats:** Plugin escape from sandbox (if implemented), resource exhaustion impacting Artifactory performance, cross-plugin interference, vulnerabilities in the execution environment itself.
    *   **Data Flow:** The engine processes plugin code and manages its runtime environment, including access to resources.

*   **Plugin Storage (C3):**
    *   **Security Implication:**  Plugin storage holds plugin code and potentially plugin-generated data. Insecure storage can lead to plugin tampering, unauthorized access to plugin code, or data breaches.
    *   **Threats:** Plugin tampering, unauthorized modification of plugin configurations, data leakage from plugin storage, denial of service through storage manipulation.
    *   **Data Flow:** Plugin Execution Engine reads plugin code and configurations from storage. Plugins might also store data in this storage.

**Deployment Diagram Components:**

*   **Application Server (JVM) (N2):**
    *   **Security Implication:** Plugins run within the Artifactory JVM.  Vulnerabilities in the JVM or its configuration can be exploited by plugins.
    *   **Threats:** JVM escape, sandbox bypass, vulnerabilities in JVM libraries, denial of service through JVM resource exhaustion.
    *   **Data Flow:** The JVM is the runtime environment for both Artifactory and plugins.

*   **Plugin Filesystem (N3):**
    *   **Security Implication:**  The filesystem where plugins are stored needs to be properly secured. Insecure filesystem permissions can allow unauthorized modification or access to plugins.
    *   **Threats:** Plugin tampering, unauthorized plugin deployment, data leakage if plugin data is stored insecurely on the filesystem.
    *   **Data Flow:** Plugin Execution Engine reads plugin files from this filesystem.

**Build Diagram Components:**

*   **Build Automation (CI/CD) (BA):**
    *   **Security Implication:** A compromised build pipeline can lead to the deployment of malicious or vulnerable plugins. Lack of security checks in the build process is a significant risk.
    *   **Threats:** Supply chain attacks, injection of malicious code during build, deployment of vulnerable dependencies, unauthorized modification of plugin artifacts.
    *   **Data Flow:** The build process transforms developer code into deployable plugin artifacts.

### 3. Architecture, Components, and Data Flow Inference

Based on the diagrams and descriptions, we can infer the following architecture, components, and data flow:

**Architecture:**

The Artifactory User Plugins framework adopts a plugin-based architecture to extend Artifactory's core functionality. Plugins are developed by users and deployed to an Artifactory instance. They run within the Artifactory JVM, interacting with Artifactory's core through a defined Plugin API.  This architecture allows for customization and extension without modifying the core Artifactory codebase.

**Components:**

1.  **Artifactory Core:** The central artifact repository system providing core functionalities like artifact storage, management, and access control.
2.  **Plugin API:** A set of interfaces and libraries exposed by Artifactory, allowing plugins to interact with Artifactory's functionalities, events, and data.
3.  **Plugin Execution Engine:** A component within Artifactory responsible for loading, executing, and managing the lifecycle of plugins within the JVM environment.
4.  **Plugin Storage:** A dedicated storage area (likely a filesystem directory) within the Artifactory server where plugin files, configurations, and potentially plugin-generated data are stored.
5.  **User Plugins:**  Custom-developed code packages (likely JAR files for Java-based plugins) that implement specific functionalities by leveraging the Plugin API.
6.  **Artifactory User:** Individuals or teams who develop, deploy, and use plugins to extend Artifactory.
7.  **External Systems (Optional):** Plugins may optionally integrate with external systems through network connections or APIs.

**Data Flow:**

1.  **Plugin Deployment:** An Artifactory administrator deploys a plugin (e.g., uploads a JAR file) to the Plugin Storage, likely through the Artifactory UI or API.
2.  **Plugin Loading & Initialization:** Upon deployment or Artifactory startup, the Plugin Execution Engine loads the plugin code from Plugin Storage into the JVM. The plugin is initialized and registered with Artifactory through the Plugin API.
3.  **Event Triggering/API Invocation:**  Plugins are triggered by events within Artifactory (e.g., artifact deployment, repository creation) or explicitly invoked through the Plugin API by Artifactory or user actions.
4.  **Plugin Execution:** The Plugin Execution Engine executes the plugin code within the Artifactory JVM.
5.  **API Interaction:** During execution, plugins interact with Artifactory's core functionalities through the Plugin API to access artifacts, metadata, trigger actions, or modify Artifactory behavior.
6.  **Data Access & Processing:** Plugins can access and process data within Artifactory's context, potentially including artifact content, metadata, and configurations, subject to Artifactory's authorization controls.
7.  **External System Interaction (Optional):** Plugins may initiate network connections and interact with external systems to retrieve data, send notifications, or integrate with external workflows.
8.  **Logging & Auditing:** Plugin activities are logged and audited by Artifactory's logging mechanisms.

### 4. Specific Security Recommendations for Artifactory User Plugins

Based on the identified security implications and inferred architecture, here are specific security recommendations tailored to Artifactory User Plugins:

**Plugin Development & Build Process:**

*   **Mandatory Static Code Analysis (SAST):** Integrate SAST tools into the plugin build pipeline and enforce a minimum security quality gate before plugins can be deployed. Focus SAST rules on common web application vulnerabilities, Java-specific security issues, and API misuse. *This directly addresses Recommended Security Control: SAST/DAST.*
*   **Dependency Scanning:** Implement dependency scanning in the build process to identify and mitigate vulnerabilities in third-party libraries used by plugins. Use tools that provide vulnerability databases and automated alerts. *This is an extension of Recommended Security Control: SAST/DAST.*
*   **Plugin Signing and Verification:** Implement a robust plugin signing mechanism using digital signatures. Artifactory should verify the signature of plugins before deployment and execution to ensure authenticity and integrity.  *This directly addresses Recommended Security Control: Plugin Signing.*
    *   **Actionable Mitigation:**  Develop a plugin signing process using a dedicated key management system. Integrate signature verification into Artifactory's plugin deployment process.
*   **Secure Coding Guidelines and Training:** Provide comprehensive secure coding guidelines specifically for Artifactory plugins, covering common vulnerabilities, API security, and best practices. Offer training to plugin developers on secure development principles. *This directly addresses Recommended Security Control: Secure Coding Guidelines and Training.*
    *   **Actionable Mitigation:** Create a dedicated section in the plugin developer documentation outlining security best practices. Conduct workshops or online training sessions for plugin developers.

**Plugin Deployment & Execution:**

*   **Plugin Sandboxing and Isolation:** Implement strong sandboxing or isolation for plugin execution to limit the impact of a compromised plugin. Explore JVM-level sandboxing (SecurityManager, custom classloaders) or containerization techniques. *This directly addresses Recommended Security Control: Plugin Sandboxing.*
    *   **Actionable Mitigation:** Investigate and implement JVM SecurityManager policies tailored for plugin execution. Consider using lightweight containerization (e.g., Docker containers or similar isolation mechanisms within the JVM) for plugins if feasible and performant.
*   **Resource Quotas and Limits:** Enforce resource quotas (CPU, memory, I/O) for plugin execution to prevent resource exhaustion and denial of service attacks caused by poorly written or malicious plugins. *This is an extension of Recommended Security Control: Plugin Sandboxing.*
    *   **Actionable Mitigation:** Implement resource monitoring and control mechanisms within the Plugin Execution Engine. Allow administrators to configure resource limits per plugin or plugin type.
*   **Strict Input Validation in Plugin API:**  The Plugin API must enforce rigorous input validation for all data received from plugins. This includes validating data types, formats, ranges, and sanitizing inputs to prevent injection attacks. *This directly addresses Security Requirement: Input Validation.*
    *   **Actionable Mitigation:**  Develop a comprehensive input validation framework within the Plugin API. Use whitelisting and parameterized queries/APIs to prevent injection vulnerabilities.
*   **Enforce Artifactory's Authentication and Authorization:** Plugins must operate strictly within the authenticated user context of Artifactory and fully respect Artifactory's authorization model.  Plugins should not introduce new authentication or authorization mechanisms. *This directly addresses Security Requirements: Authentication and Authorization.*
    *   **Actionable Mitigation:**  Ensure the Plugin API design inherently enforces Artifactory's existing authentication and authorization mechanisms. Provide clear API documentation and examples emphasizing secure authorization practices.
*   **Robust Logging and Monitoring of Plugin Activities:** Implement comprehensive logging of plugin activities, including API calls, resource usage, and any errors or exceptions. Monitor these logs for suspicious behavior and security incidents. *This directly addresses Recommended Security Control: Logging and Monitoring.*
    *   **Actionable Mitigation:**  Enhance Artifactory's logging system to specifically track plugin activities. Implement real-time monitoring and alerting for anomalous plugin behavior.

**Plugin Management & Vulnerability Response:**

*   **Centralized Plugin Management Interface:** Provide a dedicated interface within Artifactory for administrators to manage deployed plugins, including viewing plugin details, enabling/disabling plugins, updating plugins, and monitoring plugin status and resource usage.
    *   **Actionable Mitigation:** Develop a user-friendly plugin management UI within Artifactory.
*   **Vulnerability Reporting and Response Process:** Establish a clear vulnerability reporting process for plugins, allowing users and security researchers to report security issues. Define a timely and efficient vulnerability response process, including plugin updates and security advisories. *This directly addresses Recommended Security Control: Vulnerability Reporting and Response.*
    *   **Actionable Mitigation:** Create a dedicated security email address or vulnerability reporting platform for plugins. Define SLAs for vulnerability assessment and remediation.
*   **Regular Security Audits and Penetration Testing:** Conduct regular security audits and penetration testing of the Artifactory User Plugins framework itself and example plugins to identify and address potential vulnerabilities proactively. *This is an extension of Recommended Security Control: SAST/DAST.*
    *   **Actionable Mitigation:**  Schedule periodic security audits and penetration tests by internal security teams or external security experts.

### 5. Actionable and Tailored Mitigation Strategies

Here are actionable and tailored mitigation strategies applicable to the identified threats, directly linked to the recommendations above:

| **Identified Threat**                                  | **Specific Recommendation**                                       | **Actionable Mitigation Strategy**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      