Okay, I am ready to perform a deep security analysis of the MLX framework based on the provided Security Design Review document.

## Deep Security Analysis of MLX Framework

### 1. Objective, Scope, and Methodology

**Objective:**

The primary objective of this deep security analysis is to identify potential security vulnerabilities within the MLX framework, focusing on its architecture, components, and data flow as described in the Security Design Review document. This analysis aims to provide actionable and tailored mitigation strategies to enhance the security posture of MLX, specifically considering its target environment of machine learning workloads on Apple silicon. The analysis will thoroughly examine key components to uncover potential weaknesses that could be exploited, leading to risks such as data breaches, denial of service, or unauthorized code execution.

**Scope:**

This analysis encompasses the following components of the MLX framework, as detailed in the Security Design Review:

*   **Python API (mlx package):**  Focus on input validation, serialization/deserialization mechanisms, and potential vulnerabilities arising from user interactions.
*   **MLX Core (C++):**  In-depth examination of the Computation Graph Manager, Tensor Operations Library, and Memory Manager, with a focus on memory safety, integer handling, and computation graph processing logic.
*   **Device Backend Abstraction and Backends (Metal, CPU, Neural Engine):**  Analysis of the abstraction layer and specific backend implementations, considering vulnerabilities in backend frameworks and potential side-channel risks related to hardware interactions.
*   **Data Flow:**  Review of the data flow between components to identify potential points of interception, manipulation, or leakage.

The analysis will primarily focus on security vulnerabilities arising from the design and implementation of MLX itself. It will also consider dependencies and interactions with underlying Apple technologies (Metal, Accelerate, Core ML) where relevant to MLX security.  Deployment scenarios, particularly local development and edge deployment, will be considered in the context of threat relevance.

**Methodology:**

This deep security analysis will employ the following methodology:

1.  **Document Review:**  Thorough review of the provided Security Design Review document to understand the architecture, components, data flow, and intended functionality of MLX.
2.  **Codebase Inference (Based on Description):**  Inferring codebase characteristics and implementation details based on the component descriptions and technology stack outlined in the design document.  This will involve making educated assumptions about potential implementation patterns and common security pitfalls in similar projects.
3.  **Threat Modeling (Component-Based):**  Applying a component-based threat modeling approach. For each component within the defined scope, we will:
    *   **Identify Assets:** Determine the valuable assets associated with each component (e.g., tensors, computation graphs, memory, hardware resources).
    *   **Identify Threats:**  Brainstorm potential threats relevant to each component, considering common vulnerability types (input validation, memory safety, injection, etc.) and the specific functionalities of MLX.
    *   **Analyze Vulnerabilities:**  Analyze potential vulnerabilities that could enable the identified threats, focusing on weaknesses in design, implementation, or configuration.
    *   **Assess Risks:**  Evaluate the potential impact and likelihood of each threat to prioritize mitigation efforts.
4.  **Mitigation Strategy Development:**  For each identified threat and vulnerability, develop specific, actionable, and tailored mitigation strategies applicable to the MLX framework and its development context. These strategies will focus on preventative measures and secure development practices.
5.  **Output Generation:**  Document the findings of the analysis, including identified threats, vulnerabilities, risk assessments, and recommended mitigation strategies in a clear and structured format.

This methodology will ensure a systematic and comprehensive security analysis tailored to the specific characteristics of the MLX framework, leading to practical and effective security recommendations.

### 2. Security Implications of Key Components and Mitigation Strategies

Based on the Security Design Review, here's a breakdown of security implications for each key component and tailored mitigation strategies:

#### 2.1. Python API (mlx package)

**Security Implications:**

*   **Threat 1: Malicious Input Data Exploitation (Input Validation Vulnerabilities)**
    *   **Vulnerability:** The Python API acts as the entry point for user-defined ML models and data. Lack of robust input validation can allow malicious users to inject crafted data (tensors, model parameters, operations) that could exploit vulnerabilities in the underlying C++ core. This could lead to crashes, unexpected behavior, or potentially code execution if unchecked data is passed to vulnerable C++ functions.
    *   **Example Scenario:** A user provides a tensor with extremely large dimensions or NaN/Inf values that are not properly handled in subsequent C++ operations, leading to a buffer overflow or numerical instability and potential crash.

    **Mitigation Strategies:**

    1.  **Strict Input Validation at API Boundary:**
        *   **Action:** Implement comprehensive input validation within the Python API for all user-provided data (tensors, shapes, data types, hyperparameters, model definitions).
        *   **Details:**
            *   **Type Checking:** Enforce expected data types for all inputs.
            *   **Range Checks:** Validate numerical ranges for tensor dimensions, hyperparameters, and other numerical inputs to prevent out-of-bounds access or unexpected behavior.
            *   **Format Validation:**  If the API accepts data in specific formats (e.g., serialized models), validate the format rigorously against expected schemas.
            *   **Sanitization:** Sanitize string inputs to prevent injection attacks if strings are used in any internal operations (though less likely in numerical ML frameworks, still good practice).
        *   **Technology:** Utilize Python's type hinting and validation libraries (e.g., `pydantic`, `marshmallow`) to enforce input constraints.

    2.  **Error Handling and Graceful Degradation:**
        *   **Action:** Implement robust error handling in the Python API to catch invalid inputs and prevent them from propagating to the C++ core.
        *   **Details:**  Return informative error messages to the user when invalid input is detected, guiding them to correct the input. Prevent crashes by gracefully handling errors instead of allowing exceptions to propagate unchecked.

*   **Threat 2: Pickle Deserialization Vulnerabilities (Model Loading)**
    *   **Vulnerability:** If MLX uses Python's `pickle` module for model serialization/deserialization (as is common in Python ML frameworks), it is inherently vulnerable to arbitrary code execution. A malicious user could craft a pickled model file that, when loaded, executes arbitrary code on the user's machine.
    *   **Example Scenario:** A user downloads a pre-trained model from an untrusted source. If MLX uses `pickle.load()` to load this model, the malicious pickle file could contain instructions to execute harmful code when loaded by MLX.

    **Mitigation Strategies:**

    1.  **Avoid `pickle` for Model Serialization:**
        *   **Action:**  Deprecate or avoid using `pickle` for model serialization and deserialization entirely.
        *   **Details:**  Adopt safer serialization formats specifically designed for machine learning models, such as `safetensors`, `HDF5`, or design a custom, secure serialization format. These formats are designed to prevent arbitrary code execution during loading.

    2.  **If `pickle` is unavoidable, Implement Strict Warnings and Security Measures:**
        *   **Action:** If `pickle` must be used for compatibility or other reasons, implement prominent warnings to users about the security risks.
        *   **Details:**
            *   **User Warnings:** Display clear warnings in documentation and during model loading if `pickle` is used, emphasizing the risks of loading models from untrusted sources.
            *   **Sandboxing (Advanced):** Explore sandboxing techniques (if feasible within the MLX architecture) to limit the potential damage if a malicious pickle file is loaded. However, this is complex and might not be fully effective against all pickle exploits.

    3.  **Promote and Support Secure Serialization Alternatives:**
        *   **Action:**  Actively promote and provide clear documentation and examples for using safer serialization formats within MLX.
        *   **Details:**  Make it easy for users to save and load models using secure formats, making them the default and recommended option.

*   **Threat 3: Dependency Vulnerabilities**
    *   **Vulnerability:** The Python API relies on external Python packages. Vulnerabilities in these dependencies (e.g., in libraries used for data loading, utilities, etc.) could be exploited to compromise MLX users.
    *   **Example Scenario:** A dependency used for image loading has a buffer overflow vulnerability. If MLX uses this library to load user-provided images, a specially crafted image could trigger the vulnerability and potentially lead to code execution.

    **Mitigation Strategies:**

    1.  **Dependency Scanning and Management:**
        *   **Action:** Implement a robust dependency management process that includes regular scanning for known vulnerabilities.
        *   **Details:**
            *   **Automated Scanning:** Integrate tools like `pip-audit`, `safety`, or GitHub's dependency scanning features into the development pipeline to automatically detect vulnerabilities in Python dependencies.
            *   **Dependency Pinning:** Pin specific versions of dependencies in `requirements.txt` or `pyproject.toml` to ensure reproducible builds and control dependency updates.
            *   **Vulnerability Monitoring:** Subscribe to security advisories for Python packages and proactively update dependencies when vulnerabilities are reported.

    2.  **Minimal Dependency Principle:**
        *   **Action:**  Minimize the number of external Python dependencies used by the `mlx` package.
        *   **Details:**  Evaluate each dependency and ensure it is truly necessary. Consider implementing functionality directly within MLX if it reduces reliance on external, potentially vulnerable, libraries.

#### 2.2. MLX Core (C++)

**Security Implications:**

*   **Threat 1: Memory Safety Vulnerabilities (Buffer Overflows, Use-After-Free)**
    *   **Vulnerability:** C++ is prone to memory safety issues. In MLX Core, vulnerabilities like buffer overflows in tensor operations, memory management errors (use-after-free, double-free), or incorrect pointer arithmetic could lead to crashes, denial of service, or potentially arbitrary code execution. These are particularly critical in performance-sensitive C++ code where manual memory management is often employed.
    *   **Example Scenario:** A tensor operation (e.g., convolution) is implemented with a buffer overflow vulnerability. When processing a specially crafted input tensor, the operation writes beyond the allocated buffer, corrupting memory and potentially leading to code execution.

    **Mitigation Strategies:**

    1.  **Memory-Safe Coding Practices:**
        *   **Action:**  Enforce strict memory-safe coding practices throughout the MLX Core C++ codebase.
        *   **Details:**
            *   **Bounds Checking:** Implement thorough bounds checking for all array and buffer accesses, especially in tensor operations and memory management routines.
            *   **Smart Pointers:** Utilize smart pointers (e.g., `std::unique_ptr`, `std::shared_ptr`) to manage memory automatically and reduce the risk of memory leaks and dangling pointers.
            *   **RAII (Resource Acquisition Is Initialization):** Apply RAII principles to ensure resources (memory, file handles, etc.) are properly managed and released automatically.
            *   **Avoid Manual Memory Management where possible:** Prefer using standard library containers and algorithms that handle memory management internally.

    2.  **Memory Sanitizers in Development and Testing:**
        *   **Action:**  Integrate memory sanitizers into the MLX Core build and testing process.
        *   **Details:**
            *   **AddressSanitizer (ASan):** Use ASan during development and continuous integration testing to detect memory safety errors like buffer overflows, use-after-free, and heap-buffer-overflows.
            *   **MemorySanitizer (MSan):** Employ MSan to detect uninitialized memory reads.
            *   **ThreadSanitizer (TSan):** Utilize TSan to detect data races and other threading-related memory errors, especially if MLX Core uses multi-threading.
        *   **Continuous Integration (CI):** Run tests with memory sanitizers enabled in CI pipelines to catch memory safety issues early in the development cycle.

    3.  **Code Reviews and Static Analysis:**
        *   **Action:**  Conduct thorough code reviews by experienced C++ developers with a focus on security and memory safety.
        *   **Details:**  Specifically review code related to tensor operations, memory management, and computation graph handling.
        *   **Static Analysis Tools:**  Employ static analysis tools (e.g., Clang Static Analyzer, Coverity) to automatically identify potential memory safety vulnerabilities and coding errors in the C++ codebase.

*   **Threat 2: Integer Overflows/Underflows**
    *   **Vulnerability:** Integer overflows or underflows in C++ code, particularly in tensor shape calculations, indexing, or memory allocation size calculations, can lead to unexpected behavior, buffer overflows, or other vulnerabilities.
    *   **Example Scenario:**  A tensor operation calculates the output tensor shape using integer arithmetic. If an overflow occurs during shape calculation, it could result in allocating a smaller buffer than needed, leading to a buffer overflow when the operation writes to the output tensor.

    **Mitigation Strategies:**

    1.  **Safe Integer Arithmetic Practices:**
        *   **Action:**  Carefully review integer arithmetic operations, especially in performance-critical sections and shape calculations.
        *   **Details:**
            *   **Overflow Checks:** Implement explicit checks for potential integer overflows and underflows, especially when dealing with tensor dimensions and sizes.
            *   **Safe Integer Libraries:** Consider using safe integer arithmetic libraries or techniques that detect and handle overflows/underflows gracefully (e.g., using larger integer types or libraries that provide overflow-safe operations).
            *   **Input Validation (Shape Limits):**  Impose reasonable limits on tensor dimensions and shapes in the Python API to reduce the likelihood of integer overflows during internal calculations.

    2.  **Assertions and Runtime Checks:**
        *   **Action:**  Use assertions and runtime checks to verify assumptions about integer ranges and prevent unexpected behavior due to overflows/underflows.
        *   **Details:**  Add assertions to check that calculated sizes and indices are within expected bounds.

*   **Threat 3: Computation Graph Exploits**
    *   **Vulnerability:** Maliciously crafted computation graphs, potentially through API manipulation or model loading, could exploit vulnerabilities in the Computation Graph Manager. This could lead to denial of service (resource exhaustion), unexpected behavior, or potentially vulnerabilities if graph processing logic is flawed.
    *   **Example Scenario:** A user constructs a computation graph with an extremely large number of nodes or highly complex dependencies, causing the Graph Manager to consume excessive memory or CPU resources, leading to a denial of service. Or, a vulnerability in graph traversal logic could be triggered by a specific graph structure.

    **Mitigation Strategies:**

    1.  **Computation Graph Validation and Sanitization:**
        *   **Action:** Implement validation and sanitization of computation graphs within the Computation Graph Manager.
        *   **Details:**
            *   **Graph Complexity Limits:** Impose limits on the size and complexity of computation graphs (e.g., maximum number of nodes, maximum depth, allowed operation types) to prevent resource exhaustion attacks.
            *   **Operation Whitelisting/Blacklisting:**  Potentially whitelist or blacklist specific operation types in computation graphs based on security considerations.
            *   **Graph Structure Validation:**  Validate the structure of the computation graph to ensure it conforms to expected patterns and does not contain malicious or unexpected constructs.

    2.  **Resource Limits and Quotas:**
        *   **Action:**  Implement resource limits and quotas within the Computation Graph Manager to prevent excessive resource consumption.
        *   **Details:**
            *   **Memory Limits:**  Limit the amount of memory that can be allocated for computation graphs and intermediate results.
            *   **Execution Time Limits:**  Potentially impose time limits on graph execution to prevent denial of service due to long-running or infinite loops in computation graphs.

    3.  **Robust Error Handling in Graph Execution:**
        *   **Action:**  Implement robust error handling in the graph execution engine to gracefully manage unexpected situations during graph processing.
        *   **Details:**  Catch exceptions and errors during graph traversal and operation execution to prevent crashes and ensure the framework remains stable even when processing potentially malformed graphs.

#### 2.3. Device Backend Abstraction & Backends (Metal/CPU/Neural Engine)

**Security Implications:**

*   **Threat 1: Backend-Specific Vulnerabilities (Indirect)**
    *   **Vulnerability:** MLX relies on underlying backend frameworks like Metal, Accelerate, and potentially Core ML. Vulnerabilities in these frameworks could indirectly affect MLX if they are exploited through MLX's usage of these APIs.
    *   **Example Scenario:** A vulnerability is discovered in Apple's Metal framework that allows for memory corruption when using a specific Metal API call. If MLX uses this vulnerable API call in its Metal backend, an attacker could potentially trigger the Metal vulnerability through MLX.

    **Mitigation Strategies:**

    1.  **Stay Updated with Backend Security Advisories:**
        *   **Action:**  Establish a process to monitor security advisories and updates for Apple's Metal, Accelerate, Core ML, and related frameworks.
        *   **Details:**  Subscribe to Apple's security mailing lists and regularly check for security updates related to these frameworks.

    2.  **Adopt Secure Backend API Usage Practices:**
        *   **Action:**  Follow secure coding best practices when using backend APIs (Metal, Accelerate, Core ML).
        *   **Details:**  Carefully review API documentation and usage guidelines to avoid known pitfalls and potential vulnerabilities. Pay attention to memory management, resource handling, and input validation requirements of backend APIs.

    3.  **Abstraction Layer Security Review:**
        *   **Action:**  Review the Device Backend Abstraction layer to ensure it properly isolates MLX Core from backend-specific details and minimizes the impact of potential backend vulnerabilities.
        *   **Details:**  Ensure the abstraction layer does not introduce new vulnerabilities or expose backend-specific vulnerabilities to the MLX Core in an unsafe way.

*   **Threat 2: Data Leakage through Side Channels (Hardware Level - Awareness)**
    *   **Vulnerability:** While MLX operates at a higher level, computations executed on hardware (GPU, CPU, Neural Engine) can be susceptible to side-channel attacks (e.g., timing attacks, power analysis). These attacks could potentially leak sensitive information if MLX is used in security-sensitive contexts.
    *   **Example Scenario:**  Timing variations in tensor operations, depending on the input data, could be measured by an attacker to infer information about the data being processed.

    **Mitigation Strategies:**

    1.  **Awareness and Documentation of Side-Channel Risks:**
        *   **Action:**  Acknowledge and document the potential for side-channel attacks in MLX documentation, especially for security-sensitive applications.
        *   **Details:**  Inform users about the inherent limitations of software-level mitigations against hardware side-channels. Advise users to consider these risks when deploying MLX in security-critical environments.

    2.  **Constant-Time Algorithms (Where Applicable and Performance-Acceptable):**
        *   **Action:**  Where feasible and without unacceptable performance degradation, consider using constant-time algorithms for security-critical operations.
        *   **Details:**  This is often challenging in machine learning due to performance requirements. However, for specific operations where side-channel resistance is paramount, explore constant-time implementations.

    3.  **Security Context Considerations:**
        *   **Action:**  Advise users to carefully consider the security context and sensitivity of data when using MLX.
        *   **Details:**  For highly sensitive data, additional security measures beyond MLX itself might be necessary at the application and system level.

*   **Threat 3: Device Driver Vulnerabilities (Indirect and Limited Control)**
    *   **Vulnerability:** Vulnerabilities in Apple's device drivers (GPU drivers, Neural Engine drivers) could potentially be exploited through MLX if it interacts directly with these drivers at a low level. However, MLX likely uses higher-level APIs (Metal, Core ML) which abstract away direct driver interaction.
    *   **Example Scenario:** A vulnerability in the GPU driver could be triggered by a specific sequence of Metal API calls made by MLX.

    **Mitigation Strategies:**

    1.  **Rely on Stable and Updated Driver Interfaces:**
        *   **Action:**  Utilize well-established and documented driver interfaces provided by Apple (Metal, Core ML).
        *   **Details:**  Avoid direct, low-level driver interactions if possible. Rely on the stability and security of Apple's official APIs.

    2.  **Stay Informed about OS and Driver Security Updates:**
        *   **Action:**  Monitor security updates for macOS, iOS, and iPadOS, which include driver updates.
        *   **Details:**  Encourage users to keep their operating systems and devices updated to receive the latest security patches for drivers and system frameworks.

### 3. General Security Considerations and Mitigation Strategies

*   **Supply Chain Security:**
    *   **Threat:** Compromise of the MLX codebase or build process could introduce malicious code or vulnerabilities.
    *   **Mitigation:**
        *   **Secure Development Practices:** Implement secure coding practices, code reviews, and version control.
        *   **Code Signing:** Sign MLX releases to ensure integrity and authenticity.
        *   **Secure Dependency Management:** Use trusted package repositories and verify dependency integrity.
        *   **Secure Build Environment:** Utilize a trusted and hardened build environment.
        *   **Distribution Channel Security:** Distribute MLX through secure and trusted channels (e.g., GitHub releases, official package managers).

*   **Access Control (Deployment Context):**
    *   **Threat:** Unauthorized access to MLX services or models in deployment scenarios.
    *   **Mitigation:**
        *   **Deployment Guidance:** Provide guidelines on secure deployment practices, including access control configurations for different deployment environments (local, edge, cloud).
        *   **Integration with Security Frameworks:** Design MLX to be easily integrated with existing security frameworks and access control mechanisms in deployment environments.

*   **Security Audits and Penetration Testing:**
    *   **Action:** Conduct regular security audits and penetration testing by independent security experts.
    *   **Details:**  Schedule periodic security assessments to identify and address potential vulnerabilities proactively.

*   **Vulnerability Disclosure Policy:**
    *   **Action:** Establish a clear vulnerability disclosure policy.
    *   **Details:**  Provide a process for security researchers and users to report vulnerabilities responsibly and securely.

*   **Secure Model Serialization and Storage:**
    *   **Action:** Investigate and implement secure model serialization and storage mechanisms.
    *   **Details:**  Explore options like model encryption, integrity checks (e.g., digital signatures), and access control for model files.

*   **Formal Security Model and Threat Modeling (Ongoing):**
    *   **Action:** Develop and maintain a formal security model and threat model for MLX.
    *   **Details:**  Continuously update the threat model as the project evolves and new features are added.

### 4. Actionable and Tailored Mitigation Strategies Summary

| Threat Category             | Specific Threat                                     | Actionable Mitigation Strategies                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 