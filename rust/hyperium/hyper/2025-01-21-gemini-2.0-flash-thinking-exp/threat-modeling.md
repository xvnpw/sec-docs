# Threat Model Analysis for hyperium/hyper

## Threat: [HTTP Request Smuggling](./threats/http_request_smuggling.md)

*   **Description:** An attacker sends a crafted HTTP request that is interpreted differently by `hyper` and an upstream server. This can allow the attacker to bypass security controls, route requests to unintended destinations, or poison caches. The attacker might manipulate Content-Length and Transfer-Encoding headers to achieve this.
    *   **Impact:**  Bypassing authentication or authorization, gaining unauthorized access to resources, cache poisoning leading to widespread attacks.
    *   **Affected Hyper Component:** `hyper::server::conn::http1` (HTTP/1.1 connection handling), `hyper::server::conn::http2` (HTTP/2 connection handling), specifically the request parsing logic.
    *   **Risk Severity:** Critical
    *   **Mitigation Strategies:**
        *   Configure `hyper` to strictly adhere to HTTP specifications regarding Content-Length and Transfer-Encoding.
        *   Disable support for ambiguous or conflicting header combinations.
        *   Use a consistent HTTP parser throughout the infrastructure.
        *   Regularly update `hyper` to benefit from bug fixes related to request parsing.

## Threat: [HTTP Header Injection](./threats/http_header_injection.md)

*   **Description:** An attacker injects malicious HTTP headers into a response generated by the application using data that is not properly sanitized. `hyper` then sends these crafted headers to the client. This can lead to various attacks like cross-site scripting (XSS) if the injected header influences the client's interpretation of the response, or session fixation if session identifiers are manipulated.
    *   **Impact:** Cross-site scripting (XSS), session fixation, cache poisoning, information disclosure.
    *   **Affected Hyper Component:** `hyper::http::response::Builder` (for constructing responses), any application code directly manipulating response headers before passing them to `hyper`.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   Strictly sanitize and validate all user-provided data before incorporating it into HTTP response headers.
        *   Use `hyper`'s API for setting headers in a way that avoids direct string manipulation where possible.
        *   Set appropriate `Content-Security-Policy` headers to mitigate XSS.

## Threat: [HTTP Response Splitting](./threats/http_response_splitting.md)

*   **Description:** An attacker injects CRLF (Carriage Return Line Feed) characters into a response header value. This allows the attacker to terminate the current HTTP response and inject a new, arbitrary response. `hyper` will then send this crafted response to the client.
    *   **Impact:** Serving malicious content, redirecting users to attacker-controlled sites, cache poisoning.
    *   **Affected Hyper Component:** `hyper::http::response::Builder`, any application code directly manipulating response headers.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   Never directly incorporate unsanitized user input into HTTP response headers.
        *   Use `hyper`'s API for setting headers, which typically prevents CRLF injection.
        *   Implement robust input validation to prevent CRLF characters from reaching header construction logic.

## Threat: [Insecure TLS Configuration](./threats/insecure_tls_configuration.md)

*   **Description:** The application configures `hyper`'s TLS (Transport Layer Security) settings in a way that uses outdated or weak protocols or cipher suites. This makes the connection vulnerable to eavesdropping or man-in-the-middle attacks.
    *   **Impact:** Confidentiality breach, data interception, man-in-the-middle attacks.
    *   **Affected Hyper Component:** `hyper::client::connect::HttpConnector` (for client-side TLS), `hyper::server::conn::Http` (when used with TLS acceptors), and the underlying TLS implementation used (e.g., `tokio-rustls`, `tokio-native-tls`).
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   Configure `hyper` to use strong and up-to-date TLS protocols (e.g., TLS 1.3).
        *   Disable support for weak or deprecated cipher suites.
        *   Regularly update the underlying TLS library.
        *   Use tools to assess the TLS configuration for vulnerabilities.

## Threat: [Improper Certificate Validation (Client-Side)](./threats/improper_certificate_validation__client-side_.md)

*   **Description:** When the application uses `hyper` as an HTTP client, it might not properly validate the server's TLS certificate. This allows an attacker to perform a man-in-the-middle attack by presenting a fraudulent certificate.
    *   **Impact:**  Connecting to malicious servers, data interception, compromised communication.
    *   **Affected Hyper Component:** `hyper::client::connect::HttpConnector`, specifically the TLS configuration and certificate verification logic.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   Ensure that certificate validation is enabled and configured correctly when creating the `hyper` client.
        *   Avoid disabling certificate validation in production environments.
        *   Consider using a custom certificate authority store if necessary.

