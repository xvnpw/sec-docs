Okay, let's perform a deep security analysis of TiKV based on the provided design review.

**1. Objective, Scope, and Methodology**

*   **Objective:** To conduct a thorough security analysis of TiKV's key components, identify potential vulnerabilities, and provide actionable mitigation strategies.  The analysis will focus on the architectural design, data flow, and existing security controls, aiming to improve TiKV's overall security posture and resilience against various threats.  We will specifically focus on the components identified in the C4 diagrams and their interactions.

*   **Scope:** This analysis covers the core components of TiKV as described in the design review, including:
    *   Storage Engine (RocksDB)
    *   Raft Consensus Module
    *   gRPC Server
    *   Transaction Module
    *   Coprocessor
    *   Interactions with Placement Driver (PD)
    *   Deployment within a Kubernetes environment.
    *   Build process security.

    This analysis *excludes* the security of client applications, TiDB itself (though its interaction with TiKV is considered), and the underlying operating system/hardware, except where TiKV's design directly interacts with them.  We also exclude external systems beyond PD, except in the context of general integration risks.

*   **Methodology:**
    1.  **Component Decomposition:** We'll analyze each component individually, considering its responsibilities, security controls, and potential attack surface.
    2.  **Data Flow Analysis:** We'll trace the flow of data through the system, identifying potential points of vulnerability.
    3.  **Threat Modeling:** We'll use the STRIDE model (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) to systematically identify potential threats to each component and data flow.
    4.  **Mitigation Strategy Recommendation:** For each identified threat, we'll propose specific, actionable mitigation strategies tailored to TiKV's architecture and implementation.
    5.  **Review of Existing Controls:** We will assess the effectiveness of the existing security controls and identify gaps.

**2. Security Implications of Key Components**

Let's break down the security implications of each component, applying the STRIDE model:

*   **2.1 Storage Engine (RocksDB)**

    *   **Responsibilities:** Persistent data storage, read/write operations.
    *   **Security Controls:** Data encryption at rest (optional), access control via TiKV's authorization.
    *   **Threats:**
        *   **Tampering:**  Direct modification of data files on disk, bypassing TiKV's controls.  If an attacker gains access to the underlying storage (e.g., the Persistent Volume in Kubernetes), they could potentially corrupt or modify data.
        *   **Information Disclosure:**  Unauthorized access to data files on disk, potentially revealing sensitive information.
        *   **Denial of Service:**  Filling the storage with garbage data, causing TiKV to become unavailable.  Exploiting RocksDB-specific vulnerabilities (e.g., resource exhaustion bugs).
    *   **Mitigation Strategies:**
        *   **Tampering:**  Implement file integrity monitoring (FIM) on the data directory.  Use volume snapshots for point-in-time recovery.  Ensure strong access controls on the Persistent Volume (Kubernetes RBAC, storage provider security).  Consider using a storage provider that supports encryption and access control at the volume level.
        *   **Information Disclosure:**  *Always* enable encryption at rest, even if the data isn't considered highly sensitive.  Use strong encryption keys and manage them securely (e.g., using a Kubernetes Secrets object or a dedicated key management service).  Restrict access to the Persistent Volume.
        *   **Denial of Service:**  Implement resource quotas in Kubernetes to limit the storage space available to TiKV pods.  Monitor RocksDB's resource usage and set appropriate limits within RocksDB's configuration.  Regularly update RocksDB to patch any known vulnerabilities.  Implement robust input validation in higher layers to prevent malicious data from being written.

*   **2.2 Raft Consensus Module**

    *   **Responsibilities:** Data replication, leader election, consistency.
    *   **Security Controls:** Secure communication (TLS), protection against malicious Raft messages (basic validation).
    *   **Threats:**
        *   **Spoofing:**  A malicious node impersonating a legitimate TiKV node to join the Raft group and disrupt consensus.
        *   **Tampering:**  Intercepting and modifying Raft messages to corrupt data or disrupt consensus.
        *   **Repudiation:**  Difficult to achieve due to the nature of Raft, but a compromised leader could potentially deny having committed certain operations.
        *   **Information Disclosure:**  Eavesdropping on Raft communication to obtain sensitive data.
        *   **Denial of Service:**  Flooding the Raft module with invalid requests, causing it to become unresponsive.  Exploiting Raft implementation vulnerabilities.
        *   **Elevation of Privilege:**  A compromised node attempting to gain leader status illegitimately.
    *   **Mitigation Strategies:**
        *   **Spoofing:**  *Require* mutual TLS (mTLS) for all Raft communication.  Ensure that certificates are properly validated and managed.  Use a strong, unique cluster ID to prevent accidental or malicious joining of incorrect clusters.
        *   **Tampering:**  mTLS provides integrity protection for Raft messages.  Implement additional message validation and sanitization within the Raft module to detect and reject malformed or malicious messages.
        *   **Repudiation:**  While Raft provides strong consistency, consider adding audit logging of Raft operations for additional non-repudiation.
        *   **Information Disclosure:**  mTLS encrypts Raft communication, protecting data in transit.
        *   **Denial of Service:**  Implement rate limiting on Raft requests.  Monitor Raft's resource usage and set appropriate limits.  Regularly update the Raft implementation to patch vulnerabilities.  Use network policies in Kubernetes to restrict communication to only legitimate TiKV and PD pods.
        *   **Elevation of Privilege:**  Ensure that the Raft implementation correctly enforces leader election rules.  Monitor for unexpected leader changes.

*   **2.3 gRPC Server**

    *   **Responsibilities:** Handling client requests, managing connections.
    *   **Security Controls:** Network security (TLS), authentication (TLS certificates), input validation (basic).
    *   **Threats:**
        *   **Spoofing:**  A malicious client impersonating a legitimate client.
        *   **Tampering:**  Modifying requests to inject malicious data or commands.
        *   **Information Disclosure:**  Eavesdropping on client-server communication.
        *   **Denial of Service:**  Flooding the server with requests, causing it to become unavailable.  Exploiting gRPC vulnerabilities.
        *   **Elevation of Privilege:**  Exploiting vulnerabilities to gain unauthorized access to data or functionality.
    *   **Mitigation Strategies:**
        *   **Spoofing:**  *Require* mTLS for all client connections.  Implement strong client authentication and authorization.
        *   **Tampering:**  Implement robust input validation and sanitization for all gRPC requests.  Use well-defined Protobuf messages and validate them against the schema.  Protect against key injection attacks (e.g., by validating key formats and lengths).
        *   **Information Disclosure:**  mTLS encrypts client-server communication.
        *   **Denial of Service:**  Implement rate limiting and connection limits on the gRPC server.  Use a load balancer (e.g., Kubernetes Service) to distribute traffic across multiple TiKV pods.  Monitor server resource usage and scale as needed.  Regularly update gRPC and its dependencies.
        *   **Elevation of Privilege:**  Implement a robust authorization model (RBAC) and enforce the principle of least privilege.  Regularly audit user permissions.  Perform security assessments (penetration testing, vulnerability scanning).

*   **2.4 Transaction Module**

    *   **Responsibilities:** Providing ACID properties, concurrency control.
    *   **Security Controls:** Authorization (via TiKV's authorization), protection against transaction-related attacks (basic).
    *   **Threats:**
        *   **Tampering:**  Manipulating transactions to violate ACID properties (e.g., causing data inconsistency).
        *   **Denial of Service:**  Creating long-running transactions that lock resources and prevent other clients from accessing data.
        *   **Elevation of Privilege:**  Exploiting vulnerabilities to bypass transaction isolation levels or gain unauthorized access to data.
    *   **Mitigation Strategies:**
        *   **Tampering:**  Thoroughly test the transaction module to ensure that it correctly implements ACID properties.  Use formal verification techniques if possible.  Implement robust error handling and recovery mechanisms.
        *   **Denial of Service:**  Implement transaction timeouts to prevent long-running transactions from blocking resources indefinitely.  Monitor transaction durations and resource usage.  Consider implementing mechanisms to detect and abort abusive transactions.
        *   **Elevation of Privilege:**  Enforce strict isolation levels between transactions.  Regularly review and update the transaction module's security mechanisms.

*   **2.5 Coprocessor**

    *   **Responsibilities:** Executing custom code on TiKV nodes.
    *   **Security Controls:** Sandboxing (limited or none mentioned), input validation (basic).
    *   **Threats:**
        *   **Tampering:**  Malicious coprocessor code modifying data directly, bypassing TiKV's controls.
        *   **Information Disclosure:**  Malicious coprocessor code accessing sensitive data.
        *   **Denial of Service:**  Malicious coprocessor code consuming excessive resources, causing TiKV to become unavailable.
        *   **Elevation of Privilege:**  Malicious coprocessor code escaping the sandbox and gaining access to the underlying system.
    *   **Mitigation Strategies:**
        *   **Tampering, Information Disclosure, Denial of Service, Elevation of Privilege:**  Implement a *strong* sandboxing mechanism for coprocessor code.  This could involve using a WebAssembly (Wasm) runtime with strict resource limits and capabilities restrictions.  Alternatively, consider using a language-agnostic approach like gVisor or a similar containerization technology to isolate coprocessor execution.  *Thoroughly* validate and sanitize all input to coprocessors.  Implement strict resource limits (CPU, memory, storage) for coprocessor execution.  Log all coprocessor activity for auditing purposes.  Provide a mechanism for administrators to disable or restrict coprocessor functionality.  *This is a high-risk area and requires significant security hardening.*

*   **2.6 Interactions with Placement Driver (PD)**

    *   **Responsibilities:** Cluster management, region placement, scheduling.
    *   **Security Controls:** Secure communication (TLS), authentication/authorization for administrative tasks.
    *   **Threats:**
        *   **Spoofing:**  A malicious node impersonating PD to disrupt cluster management.
        *   **Tampering:**  Modifying PD requests to manipulate region placement or scheduling.
        *   **Information Disclosure:**  Eavesdropping on PD communication to obtain cluster metadata.
        *   **Denial of Service:**  Flooding PD with requests, causing it to become unavailable.
        *   **Elevation of Privilege:**  Gaining unauthorized access to PD's administrative functions.
    *   **Mitigation Strategies:**
        *   **Spoofing, Tampering, Information Disclosure:**  *Require* mTLS for all communication between TiKV nodes and PD.  Implement strong authentication and authorization for PD's administrative API.  Use a secure protocol for PD communication (e.g., gRPC with TLS).
        *   **Denial of Service:**  Implement rate limiting and connection limits on PD's API.  Monitor PD's resource usage and scale as needed.  Use a load balancer to distribute traffic across multiple PD instances.
        *   **Elevation of Privilege:**  Implement a robust RBAC model for PD's administrative functions.  Enforce the principle of least privilege.  Regularly audit user permissions.

*   **2.7 Deployment within a Kubernetes Environment**

    *   **Security Controls:** Kubernetes RBAC, network policies, pod security policies, secrets management.
    *   **Threats:**
        *   **Compromise of a TiKV Pod:** An attacker gaining control of a TiKV pod could access data, disrupt service, or attempt to escalate privileges within the cluster.
        *   **Compromise of the Kubernetes Control Plane:** An attacker gaining control of the Kubernetes control plane (e.g., the API server) could compromise the entire TiKV cluster.
        *   **Network Attacks:** Attackers exploiting network vulnerabilities to intercept traffic or gain access to pods.
    *   **Mitigation Strategies:**
        *   **Pod Compromise:**  Use minimal container images (e.g., distroless).  Run TiKV pods as non-root users.  Use pod security policies (or a policy engine like OPA Gatekeeper) to enforce security best practices.  Implement regular vulnerability scanning of container images.  Use Kubernetes Secrets to manage sensitive data (e.g., encryption keys, TLS certificates).
        *   **Control Plane Compromise:**  Follow Kubernetes security best practices.  Use a managed Kubernetes service (e.g., GKE, EKS, AKS) to offload some of the security burden to the cloud provider.  Implement strong authentication and authorization for the Kubernetes API.  Regularly audit Kubernetes cluster configurations.
        *   **Network Attacks:**  Use network policies to restrict network traffic between pods.  Only allow necessary communication between TiKV pods, PD pods, and client applications.  Use a service mesh (e.g., Istio, Linkerd) to provide additional network security features (e.g., mTLS, traffic encryption, access control).

*   **2.8 Build Process Security**

    *   **Security Controls:** Code reviews, static analysis, fuzz testing, dependency management, signed commits, GitHub Actions security features.
    *   **Threats:**
        *   **Introduction of Malicious Code:** An attacker submitting malicious code that bypasses code review and is included in a build.
        *   **Compromise of Build Infrastructure:** An attacker gaining control of the build server or GitHub Actions environment to inject malicious code or tamper with build artifacts.
        *   **Dependency Vulnerabilities:** Exploiting vulnerabilities in third-party dependencies.
    *   **Mitigation Strategies:**
        *   **Malicious Code:**  Enforce mandatory code reviews with multiple reviewers.  Use static analysis tools with security rules enabled.  Implement a Software Bill of Materials (SBOM) to track all dependencies and their versions.  Use a dependency vulnerability scanner (e.g., Dependabot, Snyk).
        *   **Build Infrastructure Compromise:**  Use GitHub Actions security best practices.  Restrict access to the build environment.  Monitor build logs for suspicious activity.  Use signed commits and verify signatures before building.
        *   **Dependency Vulnerabilities:**  Regularly update dependencies to patch vulnerabilities.  Use a dependency vulnerability scanner.  Consider using a private registry for trusted dependencies.  Pin dependency versions to prevent unexpected updates.  Use tools like `cargo-vet` to audit Rust dependencies.

**3. Architecture, Components, and Data Flow (Inferences)**

The provided C4 diagrams and descriptions give a good overview.  Here are some key inferences:

*   **Data Flow:** Client requests enter through the gRPC Server, are processed by the Transaction Module (if transactional), interact with the Raft module for consensus, and ultimately read/write data to the RocksDB storage engine.  PD interacts with the Raft module for cluster management.
*   **Critical Path:** The Raft module and RocksDB are on the critical path for data consistency and availability.  Any compromise or failure in these components could have severe consequences.
*   **Security Boundary:** The primary security boundary is at the gRPC Server, where client authentication and authorization should be enforced.  However, internal communication (Raft, PD) also requires strong security.  The Kubernetes environment provides another layer of security boundaries (pods, namespaces, network policies).
*   **Single Points of Failure:** PD is a potential single point of failure, although it's typically deployed in a highly available configuration.  The Raft leader is also a critical point, but Raft handles leader election automatically.

**4. Specific Security Considerations (Tailored to TiKV)**

*   **Key Injection:** Given TiKV is a key-value store, rigorous validation of keys is crucial.  Define and enforce strict key formats (e.g., length limits, allowed characters) to prevent injection attacks that could exploit vulnerabilities in other parts of the system.
*   **Coprocessor Security:** As highlighted above, coprocessors are a high-risk area.  Strong sandboxing and resource limits are *essential*.  Consider providing different levels of coprocessor functionality with varying security restrictions.
*   **Raft Message Validation:** Implement robust validation of Raft messages to prevent malicious nodes from disrupting consensus.  This should go beyond basic TLS integrity checks and include checks for message format, content, and sender authenticity.
*   **Kubernetes Hardening:**  Follow Kubernetes security best practices *meticulously*.  Use network policies, pod security policies, RBAC, and secrets management effectively.  Regularly audit the Kubernetes cluster configuration.
*   **Monitoring and Alerting:** Implement comprehensive monitoring and alerting for all TiKV components.  Monitor resource usage, error rates, transaction durations, Raft leader changes, and security-related events.  Set up alerts for anomalous behavior.
*   **Encryption Key Management:**  Use a robust key management system for encryption at rest.  Rotate keys regularly.  Protect keys from unauthorized access.
*   **Regular Security Assessments:** Conduct penetration testing and vulnerability scanning on a regular basis.  Engage external security experts to perform independent audits.
*   **Supply Chain Security:** Implement measures to verify the integrity of dependencies and build artifacts.  Use a Software Bill of Materials (SBOM).

**5. Actionable Mitigation Strategies (Summary)**

This table summarizes the key threats and mitigation strategies, categorized by component:

| Component             | Threat                                      | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      