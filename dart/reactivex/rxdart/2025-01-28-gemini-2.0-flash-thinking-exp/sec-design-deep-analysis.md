## Deep Security Analysis of RxDart Library

**1. Objective, Scope, and Methodology**

**Objective:**

The primary objective of this deep analysis is to conduct a thorough security assessment of the RxDart library, focusing on its architecture, key components, and data flow to identify potential security vulnerabilities and risks. This analysis aims to provide actionable and RxDart-specific mitigation strategies to enhance the security posture of applications utilizing this reactive programming library.  The analysis will delve into the security implications of each core RxDart component, considering common threat vectors and vulnerabilities relevant to reactive programming paradigms.

**Scope:**

This analysis encompasses the RxDart library as described in the provided "Project Design Document: RxDart Library for Threat Modeling (Improved)". The scope includes:

*   **Core RxDart Components:** Stream, StreamController, Observable, Subject (BehaviorSubject, ReplaySubject, PublishSubject, AsyncSubject), Operators, ConnectableObservable, and Schedulers.
*   **Data Flow within RxDart Pipelines:**  Analysis of how data is processed and transformed as it moves through RxDart streams and operators.
*   **Security Considerations for Application Integration:**  Examining how RxDart's features can introduce security vulnerabilities within the context of a larger application.
*   **Threat Modeling based on STRIDE:**  Applying the STRIDE methodology to identify potential threats associated with each RxDart component.

This analysis specifically excludes:

*   **Security audit of the entire RxDart codebase:** This analysis is based on the design document and general understanding of reactive programming principles, not a line-by-line code audit of the RxDart library itself.
*   **Third-party libraries or dependencies of RxDart:** The focus is solely on RxDart's components and their inherent security implications.
*   **Specific application code using RxDart:**  While recommendations are tailored to RxDart projects, this analysis does not audit any particular application's implementation.

**Methodology:**

This deep analysis will employ the following methodology:

1.  **Document Review:**  In-depth review of the provided "Project Design Document: RxDart Library for Threat Modeling (Improved)" to understand the architecture, components, data flow, and initial security considerations.
2.  **Architecture and Data Flow Inference:** Based on the design document and general knowledge of reactive programming and RxDart, infer the detailed architecture, component interactions, and data flow within RxDart pipelines. This will involve analyzing the provided diagrams and component descriptions.
3.  **Component-Based Security Analysis:**  Break down each key RxDart component and analyze its inherent security implications. This will involve:
    *   Identifying potential vulnerabilities associated with each component based on its functionality and interactions.
    *   Considering common threat vectors relevant to reactive programming and asynchronous data streams.
    *   Leveraging the STRIDE threat model to systematically identify potential threats for each component.
4.  **Threat and Vulnerability Mapping:** Map identified threats and vulnerabilities to specific RxDart components and data flow stages.
5.  **Actionable Mitigation Strategy Formulation:**  Develop specific, actionable, and RxDart-tailored mitigation strategies for each identified threat. These strategies will be derived from the "Actionable Recommendations" section of the design document and adapted to the specific context of RxDart and reactive programming.
6.  **Tailored Recommendations:** Ensure all recommendations are specific to RxDart projects and avoid generic security advice. Recommendations will focus on how developers can securely utilize RxDart in their applications.

**2. Security Implications of Key RxDart Components**

Based on the security design review, the following are the detailed security implications of each key RxDart component:

*   **4.1. Stream (Dart Core):**
    *   **Security Implication: Unhandled Errors Leading to DoS or Logic Bypass:**  If errors within a Stream are not caught and handled appropriately, they can propagate upwards, potentially crashing the application. In a security context, this could be exploited to cause a Denial of Service (DoS) or to bypass critical error handling mechanisms, leading to unexpected and potentially insecure application states. For example, an error in a stream processing user authentication data could lead to authentication failure being ignored, granting unauthorized access.
    *   **Security Implication: Resource Leaks Causing Resource Exhaustion:** Streams tied to external resources (like network sockets or file handles) that are not properly closed can lead to resource leaks. Over time, this can exhaust system resources, resulting in application instability and potentially a DoS condition. In a security-sensitive application, resource exhaustion can be a critical vulnerability.

*   **4.2. StreamController (Dart Core):**
    *   **Security Implication: Unclosed Streams and Resource Exhaustion (DoS):**  Failure to close a `StreamController` when it's no longer needed can exacerbate resource leak issues, especially if the stream is continuously emitting events. This contributes to resource exhaustion and potential DoS attacks.
    *   **Security Implication: Uncontrolled Sink Access Leading to Data Injection/Disruption:** If the `StreamController`'s `sink` is accessible to unauthorized parts of the application or external entities, it becomes a point for malicious data injection. Attackers could inject arbitrary data or errors into the stream, disrupting application logic, injecting malicious payloads, or causing unexpected behavior.
    *   **Security Implication: Data Injection Vulnerabilities from Untrusted Input:** Directly feeding untrusted external input into a `StreamController`'s sink without validation creates a direct injection vulnerability. This is a critical security flaw as it allows attackers to directly manipulate the data stream and potentially execute arbitrary code or bypass security controls.

*   **4.3. Observable (RxDart):**
    *   **Security Implication: Operator Logic Flaws Causing Data Manipulation/Crashes:** Bugs or vulnerabilities within the logic of RxDart operators, especially custom operators, can lead to incorrect data transformations, data corruption, or application crashes. This can have severe security consequences if operators are involved in security-critical data processing or decision-making.
    *   **Security Implication: Resource Exhaustion via Buffering Operators (DoS):** Buffering operators like `buffer`, `window`, and `debounce` (with long durations) can consume excessive memory if used with unbounded input streams or misconfigured. This can lead to memory exhaustion and DoS, impacting application availability.
    *   **Security Implication: Timing-Based Vulnerabilities through Time-Sensitive Operators:** Operators dealing with time (e.g., `debounce`, `throttle`, `delay`) can introduce timing-related vulnerabilities if not carefully implemented and used. For instance, incorrect use of `debounce` in rate limiting or authentication flows could create bypass opportunities or timing attacks.
    *   **Security Implication: Information Leakage through Error Handling in Operators:** Default error handling in operator chains might inadvertently expose sensitive information in error messages or stack traces. This can lead to information disclosure if error logs or user-facing error messages are not properly sanitized.

*   **4.4. Subject (RxDart):**
    *   **Security Implication: Unintended Multicast Exposure of Sensitive Data (Information Disclosure):** Subjects multicast events to all subscribers. If a Subject is used to broadcast sensitive data and not properly scoped, unauthorized subscribers might receive this data, leading to unintended information disclosure.
    *   **Security Implication: Stateful Subject Information Disclosure (BehaviorSubject, ReplaySubject):** `BehaviorSubject` and `ReplaySubject` retain historical data. New subscribers might receive this past data, potentially exposing sensitive information that they should not have access to, especially if access control is not properly managed over time.
    *   **Security Implication: Uncontrolled Input via Subjects (Injection Attacks):** Subjects can act as entry points for external data. If untrusted input is directly fed into a Subject, it becomes a prime target for injection attacks, similar to `StreamController` sinks.
    *   **Security Implication: Race Conditions in Multicast Scenarios (Integrity/Availability):** In concurrent environments, multiple subscribers reacting to events from a Subject and modifying shared state can lead to race conditions. This can result in unpredictable application behavior, data corruption, and potential security vulnerabilities related to data integrity and application availability.

*   **4.5. Operators (RxDart):**
    *   **Security Implication: Logic Flaws in Operator Implementations (Integrity):** Incorrectly implemented operators, especially custom ones, can introduce vulnerabilities that compromise data integrity. Flawed logic can lead to data corruption, incorrect transformations, or bypasses of intended security checks.
    *   **Security Implication: Data Transformation Vulnerabilities (Integrity/Confidentiality):** Operators that transform data must be designed to avoid introducing vulnerabilities during transformation. Improper string manipulation, encoding/decoding errors, or flawed data processing logic can lead to data corruption, information leakage, or format string vulnerabilities (though less common in Dart, still a concern in specific contexts).
    *   **Security Implication: Error Handling Gaps in Operators (Availability/Information Disclosure):** Insufficient error handling within operators can lead to unhandled exceptions, application crashes (DoS), or information leakage through exposed error details. Operators should gracefully handle potential errors and use `catchError` to manage exceptions within the stream pipeline securely.
    *   **Security Implication: Side Effects in Operators and Security Implications (Confidentiality/Integrity/Availability):** Operators with side effects (e.g., logging, API calls, database updates) can introduce security risks if these side effects are not carefully controlled and secured. Logging sensitive data within an operator could lead to information leakage if logs are not properly secured. Uncontrolled API calls or database updates could be exploited for malicious purposes.

*   **4.6. ConnectableObservable (RxDart):**
    *   **Security Implication: Race Conditions in Connection Management (Availability/Integrity):** If the `connect()` call is not properly synchronized in concurrent environments, race conditions might occur, leading to unexpected event emission timing or missed events. This can impact security-sensitive operations that rely on specific event sequences, potentially leading to inconsistent application state or bypassed security checks.
    *   **Security Implication: Denial of Service through Delayed Connection (DoS):** In scenarios where connection is resource-intensive, delaying connection indefinitely could be exploited for DoS if an attacker can prevent the `connect()` call from ever happening, tying up resources without releasing them.

*   **4.7. Schedulers (RxDart):**
    *   **Security Implication: Concurrency Vulnerabilities (Integrity/Availability):** Incorrect use of concurrency with schedulers can introduce race conditions, deadlocks, or other concurrency-related vulnerabilities, especially when shared mutable state is accessed from different execution contexts. This can lead to data corruption, unpredictable application behavior, and DoS.
    *   **Security Implication: Performance Degradation and DoS (Availability):** Misusing schedulers, for example, by performing computationally intensive operations on the main thread or by overloading isolates, can lead to performance degradation and potentially contribute to DoS.
    *   **Security Implication: Security Context Switching (Confidentiality/Integrity):** When switching schedulers, be mindful of security context switching. Ensure that security-sensitive operations are performed in the appropriate security context and that context switching does not inadvertently weaken security controls or expose sensitive data to less secure contexts.

*   **4.8. Subscriber (Application Code):**
    *   **Security Implication: Input Validation and Sanitization Failures (Injection Attacks - XSS, SQLi, Command Injection etc.):** Subscribers are the point where data from streams is consumed and used in application logic. Failure to validate and sanitize all data received from streams *before* using it is a primary source of injection vulnerabilities. This is a critical security concern as it directly exposes the application to common web and application security threats.
    *   **Security Implication: Insecure Data Handling (Confidentiality, Integrity, Availability):** Subscribers handling sensitive data must implement secure data handling practices. Failure to do so can lead to data breaches, data corruption, or unauthorized access. This includes lack of encryption, insecure storage, and inadequate access control within the subscriber logic.
    *   **Security Implication: Error Handling and Information Disclosure (Confidentiality):** Subscribers must handle errors gracefully and avoid exposing sensitive information in error messages, logs, or user interfaces. Verbose error messages or stack traces can reveal internal application details to attackers.
    *   **Security Implication: Resource Management Issues in Subscribers (Availability):** Subscribers should properly manage resources acquired during stream processing (e.g., closing database connections, releasing file handles, disposing of objects) to prevent resource leaks and ensure application stability. Resource leaks in subscribers can lead to DoS.
    *   **Security Implication: Authorization and Access Control Bypass (Confidentiality/Integrity):** Subscribers should enforce authorization and access control policies to ensure that only authorized users or components can access and process sensitive data from streams. Lack of proper authorization checks in subscribers can lead to unauthorized access to sensitive data or functionality.

**3. Architecture, Components, and Data Flow Inference**

Based on the design document, RxDart's architecture is centered around extending Dart's `Stream` API with reactive programming patterns. The key components work together in a pipeline to process asynchronous data:

*   **Data Source:** Data originates from external sources like APIs, user input, sensors, or databases. These sources are often considered untrusted or semi-trusted.
*   **StreamController (Entry Point):**  `StreamController` acts as the initial entry point for external data into the RxDart reactive pipeline. It converts imperative data sources into reactive Streams.
*   **Stream (Data Channel):** The `Stream` represents the core asynchronous data channel. It carries data events, errors, and completion signals.
*   **Observable (RxDart Wrapper):** RxDart wraps Dart Streams into `Observable` objects to provide a rich set of reactive operators. This is where the power of RxDart lies, enabling declarative and composable stream transformations.
*   **Operator Chain (Transformation and Security Layer):**  Operators are the workhorses of RxDart. They are chained together to transform, filter, combine, and control the data flow within the stream. This operator chain is a critical point for implementing security measures like input validation, sanitization, and authorization checks. Security-focused operators should be applied early in the chain, *before* data reaches subscribers.
*   **Subject (Optional Multicasting):** `Subject` components are optional but powerful for multicasting data to multiple subscribers. They can also act as both sources and consumers of data, adding flexibility to the architecture. However, they introduce complexities related to state management and unintended information disclosure if not used carefully.
*   **Subscriber (Application Logic and Data Sink):** Subscribers are the consumers of the processed data. They contain the application's core logic that reacts to events from the stream. Subscribers often act as data sinks, writing processed data to databases, UI elements, external systems, or logs.  Subscribers are the final point in the RxDart pipeline and are crucial for implementing secure data handling and output sanitization.
*   **Schedulers (Concurrency Control):** Schedulers control the execution context for operators and subscribers, enabling concurrency and offloading work to background isolates. They are essential for performance but also introduce concurrency-related security considerations.

**Data Flow:** Data flows unidirectionally from the Data Source, through the `StreamController`, `Stream`, `Observable`, Operator Chain, optionally through a `Subject`, and finally to the `Subscribers` and Data Sinks.  The Operator Chain is the central processing and transformation stage, and security measures should be heavily focused within this chain and at the Subscriber level.

**4. Specific Recommendations for RxDart Projects**

Based on the analysis, here are specific recommendations for projects using RxDart to enhance security:

*   **Prioritize Input Validation and Sanitization Operators:**  Implement dedicated operators early in your RxDart pipelines specifically for input validation and sanitization. Create custom operators or utilize existing Dart libraries within `map` or `transform` operators to rigorously validate and sanitize all external data entering the stream.  Do not rely solely on validation within subscribers; enforce it proactively in the operator chain.
    *   **Example:** Create a custom operator `validateUserInput()` that checks for expected data types, formats, and ranges. Use a sanitization operator like `sanitizeHtml()` (if dealing with user-generated HTML) to prevent XSS.
*   **Implement Centralized and Secure Error Handling Operators:**  Use `catchError` operators strategically throughout your RxDart pipelines to handle errors gracefully. Create a centralized error handling mechanism, potentially within a custom operator, to log errors securely (without exposing sensitive information) and provide fallback behavior. Avoid default error propagation that might crash the application or expose stack traces to users.
    *   **Example:** Create a `secureCatchError()` operator that logs errors to a secure logging service, sanitizes error messages before potentially displaying a generic error to the user, and returns an empty Observable to prevent stream termination.
*   **Apply Resource Management Operators and Techniques:**  Proactively manage resources within RxDart pipelines to prevent resource leaks and DoS. Use operators like `throttle`, `debounce`, `sample`, and `buffer` with appropriate time windows and buffer sizes to control data flow and prevent unbounded resource consumption. Ensure `StreamController`s and subscriptions are properly closed and disposed of when no longer needed.
    *   **Example:** Use `debounceTime(Duration(milliseconds: 500))` on user input streams to prevent excessive processing of rapid keystrokes. Use `bufferCount(100, Duration(seconds: 1))` to process data in batches and limit memory usage.
*   **Secure Stateful Subjects Carefully:** Minimize the use of stateful Subjects (`BehaviorSubject`, `ReplaySubject`) for sensitive data. If stateful Subjects are necessary, carefully scope their visibility and implement strict access control to ensure only authorized components can subscribe and access their state. Document the lifecycle and state management of stateful Subjects clearly.
    *   **Example:** If using a `BehaviorSubject` to hold user session data, ensure it's scoped only to the user's session context and not globally accessible. Implement checks to verify subscriber authorization before allowing access to the Subject.
*   **Conduct Thorough Testing and Code Reviews of Custom Operators:**  If you create custom RxDart operators, especially those involved in security-sensitive data processing, invest in thorough unit and integration testing. Conduct code reviews with a security focus to identify potential logic flaws, vulnerabilities, or unintended side effects.
    *   **Example:** For a custom operator that encrypts data within a stream, write unit tests to verify correct encryption and decryption, handle edge cases, and ensure no information leakage occurs.
*   **Utilize Schedulers Securely and Mindfully of Concurrency:** When using schedulers for concurrency, be extremely cautious about shared mutable state. Minimize shared state and prefer immutable data structures. If shared mutable state is unavoidable, use appropriate synchronization mechanisms (locks, mutexes) and conduct thread-safety audits to prevent race conditions and concurrency vulnerabilities. Choose schedulers appropriate for the workload to avoid performance degradation and DoS.
    *   **Example:** When processing computationally intensive tasks in a background isolate using `ComputeScheduler`, ensure that data passed to and from the isolate is immutable or properly copied to avoid shared mutable state issues.
*   **Regularly Update RxDart and Dependencies and Perform Vulnerability Scanning:** Keep RxDart and all its dependencies up-to-date to patch known vulnerabilities. Integrate dependency vulnerability scanning tools into your CI/CD pipeline to automatically detect and alert on vulnerable dependencies. Subscribe to security advisories for RxDart and its ecosystem to stay informed about new vulnerabilities.
    *   **Example:** Use tools like `dart pub outdated` and vulnerability scanning services to regularly check for and update vulnerable dependencies.

**5. Actionable and Tailored Mitigation Strategies**

Here are actionable and tailored mitigation strategies for the identified threats, applicable to RxDart projects:

| Threat                                                                 | RxDart Component(s) | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             