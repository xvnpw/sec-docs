## Deep Security Analysis of JWT Auth Integration

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to thoroughly evaluate the security posture of a web application and API that utilizes the `tymondesigns/jwt-auth` package for authentication and authorization. The primary objective is to identify potential security vulnerabilities and weaknesses arising from the design, implementation, and deployment of this JWT-based authentication system.  Specifically, the analysis will focus on the key components involved in JWT generation, verification, and management as provided by the `jwt-auth` library, and how these components are integrated within the broader application architecture.

**Scope:**

The scope of this analysis encompasses the following:

*   **Codebase Analysis (Conceptual):**  While direct code review of the application using `jwt-auth` is not explicitly requested, the analysis will infer potential vulnerabilities based on the documented functionalities and common usage patterns of the `tymondesigns/jwt-auth` library and the provided design review documents.
*   **Architecture Review:**  Analysis of the C4 Context, Container, and Deployment diagrams to understand the system's architecture and identify potential attack surfaces and security control gaps.
*   **Security Control Review:** Evaluation of existing and recommended security controls outlined in the security design review document, specifically in the context of `jwt-auth` integration.
*   **Risk Assessment Review:** Examination of the identified business and security risks and their relevance to the JWT authentication implementation.
*   **Focus on `tymondesigns/jwt-auth`:** The core focus will be on the security implications stemming from the use of the `tymondesigns/jwt-auth` package, its configuration, and its interaction with other application components.

The analysis will **not** include:

*   **Detailed Code Audit:**  A line-by-line code review of the application or the `tymondesigns/jwt-auth` library itself.
*   **Penetration Testing:**  Active testing of the deployed application to identify vulnerabilities.
*   **Compliance Audit:**  Formal assessment against specific regulatory compliance standards (GDPR, HIPAA, PCI DSS) unless explicitly mentioned and relevant to the identified risks.

**Methodology:**

The analysis will follow these steps:

1.  **Document Review:**  Thorough review of the provided security design review document, including business posture, security posture, design diagrams (C4 Context, Container, Deployment, Build), risk assessment, and questions/assumptions.
2.  **`tymondesigns/jwt-auth` Analysis:**  Based on the documentation and common knowledge of JWT and PHP web application security, analyze the functionalities of `tymondesigns/jwt-auth` relevant to authentication and authorization. This includes JWT generation, verification, token lifecycle management, and configuration options.
3.  **Component-Based Security Analysis:**  Break down the system into components as defined in the C4 diagrams and analyze the security implications of each component in relation to the `jwt-auth` integration.
4.  **Threat Modeling (Implicit):**  Identify potential threats and vulnerabilities based on common JWT security issues, misconfigurations, and weaknesses in web application security, specifically tailored to the context of `jwt-auth`.
5.  **Mitigation Strategy Development:**  For each identified security implication and potential threat, develop specific, actionable, and tailored mitigation strategies applicable to the `jwt-auth` package and the described application architecture.
6.  **Recommendation Generation:**  Formulate clear and concise security recommendations based on the analysis, focusing on improving the security posture of the application using `jwt-auth`.

### 2. Security Implications of Key Components

Breaking down the security implications of each key component outlined in the security design review, focusing on `jwt-auth` integration:

**C4 Context Diagram Components:**

*   **User / Application:**
    *   **Security Implication:**  Users or applications are the entry points for authentication. Compromised user credentials or application API keys can lead to unauthorized access.
    *   **`jwt-auth` Relevance:**  `jwt-auth` is used to authenticate these entities. Weak password policies, insecure storage of API keys (if used), or vulnerabilities in the authentication flow can be exploited.
    *   **Specific Consideration:**  If API keys are used alongside JWT, ensure secure generation, storage, and rotation of API keys.

*   **Web Application / API:**
    *   **Security Implication:** This is the core system being protected. Vulnerabilities in the application logic, especially around authentication and authorization, can directly lead to data breaches and service disruption.
    *   **`jwt-auth` Relevance:** The application's security heavily relies on the correct and secure integration of `jwt-auth`. Misconfiguration, improper input validation, or insecure handling of JWTs within the application code can create vulnerabilities.
    *   **Specific Consideration:**  Ensure proper integration of `jwt-auth` middleware to protect routes, validate JWTs correctly, and implement robust authorization logic based on JWT claims.

*   **JWT Auth Package:**
    *   **Security Implication:** As a third-party library, vulnerabilities within `jwt-auth` itself or its dependencies can directly impact the application's security.
    *   **`jwt-auth` Relevance:**  The entire authentication and authorization mechanism depends on the security of this package. Vulnerabilities in JWT generation, verification, or token handling within `jwt-auth` are critical.
    *   **Specific Consideration:**  Regularly scan `jwt-auth` and its dependencies for vulnerabilities. Keep the package updated to the latest secure version. Understand the library's configuration options and choose secure defaults.

*   **Identity Provider (Optional):**
    *   **Security Implication:** If an external Identity Provider (IdP) is used, the security of the authentication process depends on the IdP's security posture and the secure integration between the application and the IdP.
    *   **`jwt-auth` Relevance:**  `jwt-auth` might be used to handle JWTs issued by the IdP or to generate its own JWTs after successful authentication via the IdP. Insecure integration or vulnerabilities in the IdP can compromise the application's security.
    *   **Specific Consideration:**  If using an IdP, ensure secure communication protocols (e.g., OAuth 2.0, SAML), proper validation of tokens/assertions from the IdP, and secure configuration of the IdP integration within the application.

**C4 Container Diagram Components:**

*   **Web Server:**
    *   **Security Implication:**  The web server is the first point of contact for external requests. Misconfigurations or vulnerabilities in the web server can expose the application to attacks.
    *   **`jwt-auth` Relevance:**  While not directly interacting with `jwt-auth`, the web server's HTTPS configuration is crucial for secure JWT transmission. Rate limiting and WAF at the web server level can protect authentication endpoints.
    *   **Specific Consideration:**  Enforce HTTPS, configure strong TLS settings, implement rate limiting and WAF rules to protect authentication endpoints from brute-force and DDoS attacks.

*   **Application Server:**
    *   **Security Implication:**  The application server executes the core application logic and handles authentication and authorization using `jwt-auth`. Vulnerabilities in the application code or insecure configuration of the application server can be exploited.
    *   **`jwt-auth` Relevance:**  This is where `jwt-auth` is integrated and used. Secure coding practices, proper input validation, secure session management (if applicable alongside JWT), and correct implementation of authorization logic are critical.
    *   **Specific Consideration:**  Implement robust input validation for authentication requests, securely store JWT secret keys (using environment variables or secrets management), implement proper error handling without exposing sensitive information, and ensure authorization logic correctly utilizes JWT claims.

*   **Database Server:**
    *   **Security Implication:**  The database stores sensitive data, including user credentials (hashed passwords). Compromise of the database can lead to massive data breaches.
    *   **`jwt-auth` Relevance:**  `jwt-auth` typically relies on the database to verify user credentials during authentication. Secure storage of hashed passwords and database access control are essential.
    *   **Specific Consideration:**  Use strong password hashing algorithms (e.g., bcrypt, Argon2), implement database access control with the principle of least privilege, encrypt data at rest and in transit, and regularly audit database security.

*   **JWT Auth Library:** (Already covered in Context Diagram)

*   **Configuration:**
    *   **Security Implication:**  Configuration files and environment variables often contain sensitive information, such as database credentials and JWT secret keys. Insecure storage or access to configuration data can lead to compromise.
    *   **`jwt-auth` Relevance:**  The JWT secret key is a critical configuration parameter for `jwt-auth`. If compromised, attackers can forge valid JWTs and bypass authentication.
    *   **Specific Consideration:**  Store JWT secret keys securely using environment variables or dedicated secrets management systems (e.g., HashiCorp Vault, AWS Secrets Manager). Avoid hardcoding secrets in code or configuration files. Implement strict access control to configuration files and environment variables.

**C4 Deployment Diagram Components:**

*   **Load Balancer:**
    *   **Security Implication:**  The load balancer handles SSL termination and distributes traffic. Misconfigurations can lead to security vulnerabilities.
    *   **`jwt-auth` Relevance:**  Ensuring SSL termination at the load balancer and HTTPS communication to the application servers is crucial for secure JWT transmission. DDoS protection at the load balancer level can protect authentication endpoints.
    *   **Specific Consideration:**  Properly configure SSL/TLS certificates and settings, enable DDoS protection features, and configure WAF integration if needed.

*   **Application Server Instance(s):** (Security implications are similar to the Application Server Container component, but focus on instance-level security).
    *   **Specific Consideration:**  Harden operating systems, apply security patches regularly, use security groups to restrict network access, and implement intrusion detection/prevention systems.

*   **Database Instance:** (Security implications are similar to the Database Server Container component, but focus on managed database service security).
    *   **Specific Consideration:**  Utilize managed security features provided by the cloud provider (e.g., AWS RDS security features), configure database access control, enable encryption at rest and in transit, and monitor database security logs.

*   **Internet:** (External network - security is primarily managed by external entities).

**C4 Build Diagram Components:**

*   **Code Repository (GitHub):**
    *   **Security Implication:**  The code repository stores the source code, including potentially sensitive information. Compromise of the repository can lead to code tampering and security breaches.
    *   **`jwt-auth` Relevance:**  Source code related to `jwt-auth` integration and configuration is stored here. Insecure access control or vulnerabilities in the repository itself can be exploited.
    *   **Specific Consideration:**  Implement strong access control to the repository, enable branch protection, enforce code review processes, and use security features provided by GitHub (e.g., secret scanning).

*   **CI/CD Pipeline (GitHub Actions):**
    *   **Security Implication:**  The CI/CD pipeline automates the build and deployment process. Insecure pipeline configuration or compromised pipeline secrets can lead to malicious code injection or unauthorized deployments.
    *   **`jwt-auth` Relevance:**  The build process might involve dependency installation (including `jwt-auth`), static analysis, and testing. Vulnerabilities in the pipeline can introduce vulnerabilities into the deployed application.
    *   **Specific Consideration:**  Secure pipeline configuration, use secure secret management for credentials used in the pipeline, integrate SAST and dependency scanning into the pipeline, and ensure build environment security.

*   **Build Artifacts & Artifact Repository:**
    *   **Security Implication:**  Build artifacts are the packaged application code ready for deployment. Tampering with artifacts can lead to deployment of compromised code. Insecure artifact repository access can lead to unauthorized access or modification of artifacts.
    *   **`jwt-auth` Relevance:**  The build artifact contains the application code that integrates `jwt-auth`. Integrity of the artifact is crucial.
    *   **Specific Consideration:**  Implement integrity checks (e.g., checksums) for build artifacts, secure access control to the artifact repository, and perform vulnerability scanning of dependencies included in the package.

### 3. Architecture, Components, and Data Flow Inference based on `jwt-auth`

Based on the codebase and documentation of `tymondesigns/jwt-auth`, and the design review, we can infer the following architecture, components, and data flow for authentication and authorization:

**Inferred Architecture & Components:**

1.  **Authentication Controller:**  Application code responsible for handling user login requests. This controller will:
    *   Receive user credentials (username/password) from the User/Application.
    *   Validate user credentials against the Database Server (user authentication data).
    *   Upon successful authentication, use `jwt-auth` to generate a JWT.
    *   Return the JWT to the User/Application (typically in the response body or as a cookie).

2.  **JWT Middleware:**  Application middleware (provided by `jwt-auth` or custom-built) that intercepts incoming requests to protected routes. This middleware will:
    *   Extract the JWT from the request headers (e.g., `Authorization: Bearer <JWT>`) or cookies.
    *   Use `jwt-auth` to verify the JWT's signature and validity (expiration, issuer, audience, etc.).
    *   If the JWT is valid, extract claims from the JWT and make them available to the application (e.g., user ID, roles).
    *   If the JWT is invalid or missing, reject the request (e.g., return a 401 Unauthorized error).

3.  **Authorization Logic:**  Application code within controllers or services that enforces authorization policies based on the user's roles or permissions extracted from the JWT claims. This logic will:
    *   Retrieve user roles or permissions from the JWT claims.
    *   Check if the user has the necessary roles or permissions to access the requested resource or perform the action.
    *   Allow or deny access based on the authorization policy.

4.  **Token Refresh Mechanism (Potentially Implemented):**  If long-lived JWTs are undesirable, a token refresh mechanism might be implemented. This typically involves:
    *   Issuing a short-lived JWT (access token) and a long-lived refresh token upon successful authentication.
    *   When the access token expires, the User/Application uses the refresh token to request a new access token from a dedicated refresh token endpoint.
    *   The refresh token endpoint validates the refresh token and, if valid, issues a new access token and potentially a new refresh token.

**Inferred Data Flow (Authentication):**

1.  User/Application sends login request with credentials to the Web Application/API (Authentication Controller).
2.  Authentication Controller validates credentials against the Database Server.
3.  Upon successful validation, Authentication Controller uses `jwt-auth` to generate a JWT, signing it with the JWT secret key from Configuration.
4.  JWT is returned to the User/Application.

**Inferred Data Flow (Authorization - Protected Resource Access):**

1.  User/Application sends a request to a protected resource, including the JWT in the `Authorization` header.
2.  Web Server forwards the request to the Application Server.
3.  JWT Middleware intercepts the request.
4.  JWT Middleware uses `jwt-auth` to verify the JWT's signature and validity using the JWT secret key from Configuration.
5.  If JWT is valid, JWT Middleware extracts claims and makes them available to the Application Server.
6.  Application Server (Authorization Logic) checks user roles/permissions from JWT claims against access control policies.
7.  Access is granted or denied based on authorization.
8.  Application Server processes the request and returns a response to the User/Application.

### 4. Specific Security Recommendations Tailored to `jwt-auth`

Based on the analysis and inferred architecture, here are specific security recommendations tailored to the application using `tymondesigns/jwt-auth`:

1.  **Strong JWT Secret Key Management:**
    *   **Recommendation:**  Generate a strong, cryptographically random JWT secret key. Store it securely using environment variables or a dedicated secrets management system. **Do not hardcode the secret key in the application code or configuration files.**
    *   **Rationale:**  A weak or compromised secret key allows attackers to forge valid JWTs, completely bypassing authentication. Secure storage minimizes the risk of key compromise.

2.  **Algorithm Selection and Configuration:**
    *   **Recommendation:**  Use a strong and secure JWT signing algorithm. **Prefer RS256 (RSA Signature with SHA-256) or ES256 (ECDSA using P-256 and SHA-256) over HS256 (HMAC using SHA-256) if possible.** If HS256 is used, ensure the secret key is exceptionally strong and kept secret. Configure `jwt-auth` to enforce the chosen algorithm.
    *   **Rationale:**  HS256 uses the same secret key for signing and verification, making key compromise more impactful. Asymmetric algorithms like RS256 and ES256 offer better key management and security.

3.  **JWT Expiration and Refresh Token Implementation:**
    *   **Recommendation:**  Implement short-lived JWT access tokens (e.g., 15-60 minutes) to limit the window of opportunity for compromised tokens. **Implement a robust refresh token mechanism** to allow users to obtain new access tokens without re-entering credentials frequently. Securely store refresh tokens (e.g., in a database associated with user sessions) and implement proper refresh token rotation and invalidation.
    *   **Rationale:**  Short-lived access tokens reduce the risk of token theft and reuse. Refresh tokens provide a balance between security and user experience.

4.  **JWT Claim Validation and Sanitization:**
    *   **Recommendation:**  **Thoroughly validate all JWT claims** upon verification. Verify expected claims (e.g., `iss`, `aud`, `exp`, `sub`), claim types, and claim values. **Sanitize claim values** before using them in authorization decisions or application logic to prevent potential injection attacks (though less common with JWT claims, it's a good practice).
    *   **Rationale:**  JWT verification should not only check the signature but also the integrity and validity of the claims. Malicious actors might try to manipulate claims if not properly validated.

5.  **Secure JWT Transmission and Storage:**
    *   **Recommendation:**  **Enforce HTTPS for all communication** involving JWT transmission. Store JWTs securely on the client-side. **Prefer using HTTP-only and Secure cookies** for storing JWTs in web browsers to mitigate XSS and CSRF risks. If using local storage or session storage, be aware of potential XSS vulnerabilities.
    *   **Rationale:**  HTTPS protects JWTs from interception during transmission. Secure cookie flags mitigate common client-side vulnerabilities.

6.  **Rate Limiting and Brute-Force Protection on Authentication Endpoints:**
    *   **Recommendation:**  **Implement rate limiting and throttling** on authentication endpoints (e.g., login, token refresh) to prevent brute-force attacks and denial-of-service attempts. Use web server configurations, WAF, or application-level middleware for rate limiting.
    *   **Rationale:**  Authentication endpoints are prime targets for brute-force attacks. Rate limiting makes such attacks significantly harder.

7.  **Security Logging and Monitoring for Authentication Events:**
    *   **Recommendation:**  **Implement comprehensive security logging** for authentication and authorization events, including successful logins, failed login attempts, token refresh requests, and authorization decisions. Monitor these logs for suspicious activity and security incidents.
    *   **Rationale:**  Logging and monitoring are crucial for detecting and responding to security incidents related to authentication and authorization.

8.  **Dependency Scanning and Updates for `jwt-auth` and Dependencies:**
    *   **Recommendation:**  **Integrate dependency scanning into the CI/CD pipeline** to automatically identify known vulnerabilities in `tymondesigns/jwt-auth` and its dependencies. **Regularly update `jwt-auth` and its dependencies** to the latest secure versions.
    *   **Rationale:**  Third-party libraries can contain vulnerabilities. Proactive dependency management is essential to mitigate this risk.

9.  **SAST and DAST for Application Code Integrating `jwt-auth`:**
    *   **Recommendation:**  **Implement Static Application Security Testing (SAST) and Dynamic Application Security Testing (DAST)** on the application code that integrates with `jwt-auth`. SAST can identify potential code-level vulnerabilities, while DAST can find runtime vulnerabilities in the deployed application.
    *   **Rationale:**  SAST and DAST help identify security flaws in the application code and runtime environment that might arise from improper `jwt-auth` integration or other application vulnerabilities.

10. **Regular Security Audits and Penetration Testing:**
    *   **Recommendation:**  Conduct **regular security audits and penetration testing** of the application, focusing on the authentication and authorization mechanisms implemented with `jwt-auth`.
    *   **Rationale:**  External security assessments can identify vulnerabilities that might be missed by internal teams and provide an independent validation of the security posture.

### 5. Actionable and Tailored Mitigation Strategies

Here are actionable and tailored mitigation strategies for the identified threats, applicable to `jwt-auth`:

| Threat/Vulnerability                                  | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          