## Deep Security Analysis of `mtdowling/cron-expression` PHP Library

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to thoroughly evaluate the `mtdowling/cron-expression` PHP library from a security perspective. The primary objective is to identify potential security vulnerabilities, weaknesses, and risks associated with the library's design, implementation, and usage within PHP applications. This analysis will focus on the library's core functionality of parsing and describing cron expressions, examining aspects such as input validation, error handling, and potential for misuse. The ultimate goal is to provide actionable and specific security recommendations to both the library developers and application developers who utilize this library, enhancing the overall security posture of applications relying on cron-based task scheduling.

**Scope:**

The scope of this analysis is limited to the `mtdowling/cron-expression` PHP library as described in the provided security design review document and inferred from its intended functionality. The analysis will cover:

*   **Codebase Analysis (Inferred):**  Based on the library's description and common cron expression parsing logic, we will infer potential code components and analyze their security implications.  Direct code review is not possible within this exercise, so we will focus on likely areas of concern.
*   **Input Validation Mechanisms:**  Analyzing the expected input (cron expressions) and how the library should handle valid and invalid inputs.
*   **Error Handling and Exception Management:**  Examining how the library manages errors during cron expression parsing and evaluation.
*   **Dependency Analysis (Limited):**  While the library is described as having minimal dependencies, we will consider potential risks associated with any dependencies it might have or might acquire in the future.
*   **Integration Points:**  Analyzing how the library is intended to be integrated into PHP applications and potential security implications arising from this integration.
*   **Deployment Context:** Considering the typical deployment scenarios for PHP applications using this library (web servers, CLI environments).

The analysis will **not** cover:

*   Detailed source code review of the `mtdowling/cron-expression` library (as we are working from a design review, not direct code access).
*   Security analysis of specific applications using the library.
*   Performance testing or optimization of the library.
*   Functionality beyond the core parsing and description of cron expressions.

**Methodology:**

This security analysis will employ the following methodology:

1.  **Document Review:**  Thorough review of the provided security design review document, including business posture, security posture, design diagrams (C4 Context, Container, Deployment, Build), risk assessment, and questions/assumptions.
2.  **Architecture and Data Flow Inference:** Based on the library's description and the provided diagrams, we will infer the library's internal architecture, key components, and data flow. This will involve understanding how cron expressions are processed and what outputs are generated.
3.  **Threat Modeling:** We will apply a threat modeling approach to identify potential security threats relevant to the `cron-expression` library. This will involve considering potential attack vectors, threat actors, and vulnerabilities that could be exploited. We will focus on threats specific to a parsing library, such as input manipulation, denial of service, and unexpected behavior.
4.  **Security Control Analysis:** We will evaluate the existing and recommended security controls outlined in the design review and assess their effectiveness in mitigating identified threats.
5.  **Actionable Recommendation Generation:** Based on the identified threats and vulnerabilities, we will generate specific, actionable, and tailored mitigation strategies for both the library developers (if applicable) and application developers using the library. These recommendations will be practical and directly relevant to the `cron-expression` library and its use cases.

### 2. Security Implications of Key Components

Based on the design review and the nature of a cron expression parsing library, we can infer the following key components and their security implications:

**a) Cron Expression Parsing Engine (Core Logic):**

*   **Inferred Functionality:** This component is responsible for taking a cron expression string as input and parsing it into a structured format that the library can understand and use for calculations (e.g., next run time, description).
*   **Security Implications:**
    *   **Input Validation Vulnerabilities:**  If the parsing engine does not rigorously validate the input cron expression, it could be vulnerable to various attacks. Malformed or maliciously crafted cron expressions could lead to:
        *   **Denial of Service (DoS):**  Complex or deeply nested expressions, or expressions with excessive repetition, could cause the parsing engine to consume excessive CPU or memory, leading to performance degradation or crashes.
        *   **Unexpected Behavior/Errors:** Invalid characters, incorrect syntax, or out-of-range values in the cron expression could lead to unexpected errors, exceptions, or incorrect parsing results. While not directly a security vulnerability in itself, incorrect parsing can lead to business logic flaws in applications relying on the library.
        *   **Injection Attacks (Less Likely but Possible):** While less probable in a cron expression parser compared to SQL or command injection, vulnerabilities in complex parsing logic *could* theoretically be exploited if the library were to, for example, dynamically construct and execute code based on parsed components (highly unlikely in this type of library, but worth considering in complex parsers in general).
    *   **Regular Expression Vulnerabilities (If used for parsing):** If regular expressions are used for parsing, poorly written regex can be vulnerable to Regular Expression Denial of Service (ReDoS) attacks.
    *   **Integer Overflow/Underflow:**  When handling numeric components of cron expressions (minutes, hours, days, months, years), there's a potential for integer overflow or underflow if not handled carefully, especially when calculating future or past dates. This could lead to incorrect scheduling or unexpected behavior.

**b) Cron Expression Descriptor (Human-Readable Output):**

*   **Inferred Functionality:** This component takes a parsed cron expression and generates a human-readable description of what the cron expression means (e.g., "Every minute," "At 09:00 on Monday").
*   **Security Implications:**
    *   **Information Disclosure (Minor):**  While less critical, if the descriptor component exposes overly verbose or detailed information about the cron expression's internal representation or parsing process in error messages or debug outputs, it *could* potentially leak minor information to an attacker in specific scenarios. This is a low-risk concern.

**c) Date/Time Calculation Logic (Next/Previous Run Time):**

*   **Inferred Functionality:** This component uses the parsed cron expression to calculate the next or previous execution time based on a given starting point.
*   **Security Implications:**
    *   **Incorrect Calculations:** Bugs in the date/time calculation logic could lead to tasks being scheduled at incorrect times, which is a business logic issue and could have security implications if tasks are security-sensitive (e.g., access control updates, security log processing).
    *   **Time Zone Handling Issues:** If the library or the applications using it do not handle time zones correctly, it could lead to scheduling discrepancies and potential security issues if tasks are time-sensitive across different time zones.

**d) Error Handling and Exception Management:**

*   **Inferred Functionality:**  The library needs to handle invalid cron expressions and other potential errors gracefully.
*   **Security Implications:**
    *   **Lack of Proper Error Handling:** If the library does not handle errors properly, it could:
        *   **Crash the Application:** Unhandled exceptions could lead to application crashes, causing denial of service.
        *   **Expose Sensitive Information:** Verbose error messages might reveal internal library details or system information to attackers.
        *   **Leave the Application in an Unstable State:**  Poor error handling could leave the application in an unpredictable state, potentially leading to security vulnerabilities.
    *   **Information Disclosure in Error Messages:** Error messages should be informative for debugging but should not expose sensitive details about the library's internal workings or the application environment.

### 3. Architecture, Components, and Data Flow Inference

Based on the C4 diagrams and the description of the library, we can infer the following architecture, components, and data flow:

**Architecture:**

The library follows a simple, layered architecture:

1.  **PHP Application Layer:**  This is the application code that utilizes the `cron-expression` library. It provides cron expression strings as input and uses the library's functions to parse, describe, and calculate run times.
2.  **Cron Expression Library Layer:** This is the `mtdowling/cron-expression` library itself. It contains the core logic for parsing, describing, and evaluating cron expressions.
3.  **PHP Runtime Environment Layer:** This is the PHP interpreter and the underlying operating system environment where the library and the application execute.

**Components (Within the Library Layer - Inferred):**

*   **Input Parser:**  Responsible for receiving the cron expression string and validating its basic format.
*   **Tokenization/Lexer:**  Breaks down the cron expression string into individual components (minutes, hours, days, etc.).
*   **Syntax Analyzer/Parser (Core Logic):**  Interprets the tokens and builds an internal representation of the cron expression, applying the cron syntax rules. This is the core parsing engine.
*   **Descriptor Generator:**  Generates human-readable descriptions from the internal representation.
*   **Date/Time Calculator:**  Calculates next/previous run times based on the internal representation and current time.
*   **Error Handler:**  Manages errors and exceptions during parsing and evaluation.

**Data Flow:**

1.  **Input:** A PHP application provides a cron expression string to the `cron-expression` library.
2.  **Parsing:** The library's Input Parser, Tokenizer, and Syntax Analyzer process the cron expression string.
3.  **Internal Representation:** The parsed cron expression is stored in an internal data structure.
4.  **Processing (Description/Calculation):**
    *   For description, the Descriptor Generator uses the internal representation to create a human-readable string.
    *   For run time calculation, the Date/Time Calculator uses the internal representation and the current time to calculate the next or previous run time.
5.  **Output:** The library returns the description string or the calculated date/time back to the PHP application.
6.  **Application Logic:** The PHP application uses the output from the library to schedule tasks or display cron expression information.

**Data Flow Diagram (Simplified):**

```
[PHP Application] --> Cron Expression String --> [Cron Expression Library]
[Cron Expression Library] --> Parsed Cron Expression (Internal Representation)
[Cron Expression Library] --> Description String / Calculated Date/Time --> [PHP Application]
```

### 4. Tailored and Specific Security Recommendations for `cron-expression`

Given the analysis above and focusing on the specific nature of a cron expression parsing library, here are tailored security recommendations:

**For the `mtdowling/cron-expression` Library Developers (If applicable and if contributing to the project):**

1.  **Robust Input Validation:**
    *   **Implement Strict Input Validation:**  Thoroughly validate all components of the cron expression (minutes, hours, days, months, years, commands) against expected formats, ranges, and allowed characters.
    *   **Whitelist Approach:**  Prefer a whitelist approach for allowed characters and syntax elements rather than a blacklist.
    *   **Limit Complexity:**  Consider imposing limits on the complexity of cron expressions to prevent potential DoS attacks from overly complex expressions (e.g., maximum number of ranges, steps, or wildcards).
    *   **Regular Expression Review (If Used):** If regular expressions are used for parsing, ensure they are carefully reviewed and tested to prevent ReDoS vulnerabilities. Consider alternative parsing techniques if regex complexity becomes a concern.
2.  **Graceful Error Handling and Informative Exceptions:**
    *   **Implement Comprehensive Error Handling:**  Catch and handle all potential errors during parsing and evaluation.
    *   **Throw Specific Exceptions:**  Throw specific and informative exceptions for different types of invalid cron expressions (e.g., `InvalidMinuteException`, `InvalidDayOfMonthException`). This allows application developers to handle errors gracefully and provide better user feedback.
    *   **Avoid Sensitive Information in Error Messages:** Ensure error messages are helpful for debugging but do not expose sensitive internal details or system information.
3.  **Security Testing and Static Analysis:**
    *   **Integrate Static Application Security Testing (SAST):**  Incorporate SAST tools into the development process to automatically detect potential vulnerabilities in the library's code.
    *   **Unit and Integration Tests (Including Security-Focused Tests):**  Write comprehensive unit and integration tests, including tests specifically designed to check the library's behavior with invalid and potentially malicious cron expressions.
    *   **Consider Fuzzing:**  Explore fuzzing techniques to automatically generate a wide range of inputs, including malformed cron expressions, to identify potential parsing errors or vulnerabilities.
4.  **Dependency Management (Minimize and Monitor):**
    *   **Minimize Dependencies:**  Keep external dependencies to an absolute minimum to reduce the attack surface and supply chain risks.
    *   **Dependency Scanning:** If any dependencies are used, implement dependency scanning in the build process to detect known vulnerabilities.
5.  **Documentation and Secure Usage Guidance:**
    *   **Document Input Validation Rules:** Clearly document the expected format and validation rules for cron expressions that the library accepts.
    *   **Provide Security Best Practices for Users:**  Include a section in the documentation outlining security considerations for applications using the library, emphasizing the importance of input validation *at the application level* before passing cron expressions to the library.
    *   **Example of Input Validation (in documentation):** Provide code examples demonstrating how application developers can validate cron expressions before using the library.

**For Application Developers Using `mtdowling/cron-expression`:**

1.  **Mandatory Input Validation at Application Level:**
    *   **Never Trust User Input:**  Always treat cron expressions received from users or external sources as untrusted input.
    *   **Validate Before Using the Library:**  Implement input validation *before* passing cron expressions to the `cron-expression` library. This is the most critical security control.
    *   **Validation Techniques:**
        *   **Format Validation:** Use regular expressions or custom validation logic to check the basic format of the cron expression.
        *   **Range Validation:**  Verify that numeric components (minutes, hours, etc.) are within valid ranges.
        *   **Character Whitelisting:**  Ensure the cron expression only contains allowed characters.
        *   **Complexity Limits:**  If necessary, impose limits on the length or complexity of cron expressions accepted by your application.
    *   **Example Validation (PHP):**

        ```php
        $cronExpressionInput = $_POST['cron_expression']; // Example user input

        // Basic format validation (example regex - adjust as needed)
        if (!preg_match('/^([\*,\/\-0-9]+)\s+([\*,\/\-0-9]+)\s+([\*,\/\-0-9]+)\s+([\*,\/\-0-9]+)\s+([\*,\/\-0-9]+)$/', $cronExpressionInput)) {
            // Basic format invalid
            throw new InvalidArgumentException("Invalid cron expression format.");
        }

        // Range and value validation (example - more comprehensive validation needed)
        $parts = explode(' ', $cronExpressionInput);
        if (!isValidMinute($parts[0]) || !isValidHour($parts[1]) || /* ... and so on for other parts */) {
            throw new InvalidArgumentException("Invalid cron expression values.");
        }

        try {
            $expression = Cron\CronExpression::factory($cronExpressionInput); // Use the library AFTER validation
            // ... use the cron expression
        } catch (\InvalidArgumentException $e) {
            // Handle library-level validation errors (less critical if you validate beforehand)
            throw new InvalidArgumentException("Invalid cron expression: " . $e->getMessage());
        }

        function isValidMinute($minutePart) { /* ... validation logic for minutes 0-59, *, /, -, etc. */ }
        function isValidHour($hourPart) { /* ... validation logic for hours 0-23, *, /, -, etc. */ }
        // ... similar validation functions for other cron parts
        ```

2.  **Error Handling in Application Code:**
    *   **Catch Exceptions from the Library:**  Wrap calls to `Cron\CronExpression::factory()` (or similar parsing functions) in `try-catch` blocks to handle `InvalidArgumentException` or other exceptions that the library might throw.
    *   **Provide User-Friendly Error Messages:**  If validation fails or the library throws an exception, provide user-friendly error messages to the user, guiding them to correct the cron expression. Avoid exposing technical error details to end-users in production environments.
3.  **Regularly Update the Library:**
    *   **Dependency Monitoring:**  Monitor for updates to the `mtdowling/cron-expression` library (e.g., via Composer or dependency scanning tools).
    *   **Apply Updates Promptly:**  Apply updates promptly, especially security-related updates, to benefit from bug fixes and security patches.
4.  **Secure Storage and Transmission of Cron Expressions (If Applicable):**
    *   **Sensitive Context:** If cron expressions are used in security-sensitive contexts or reveal information about critical scheduled tasks, consider encrypting them at rest and in transit if they are stored in databases or transmitted over networks.
    *   **Access Control:**  Implement appropriate access controls to protect cron expressions from unauthorized access or modification, especially if they are stored in a database or configuration files.

### 5. Actionable Mitigation Strategies Applicable to Identified Threats

| Threat                                      | Actionable Mitigation Strategy (Library Developers)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             specific to the project:

| Mitigation Strategy                                         | Target Threat                                                                 | Actionable Steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              