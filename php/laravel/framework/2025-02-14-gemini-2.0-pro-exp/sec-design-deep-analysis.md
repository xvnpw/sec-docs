## Deep Security Analysis of Laravel Framework

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to perform a thorough security assessment of the Laravel framework (version as used in a typical project, assuming current LTS or a recent stable release), focusing on its key components and their interactions.  This analysis aims to identify potential security vulnerabilities, weaknesses in design or implementation, and areas where common developer mistakes could lead to security breaches.  The ultimate goal is to provide actionable recommendations to enhance the security posture of applications built using Laravel.  We will focus on the core components and common usage patterns, inferring architecture and data flow from the provided design review and the framework's codebase/documentation.

**Scope:**

This analysis covers the following key components of the Laravel framework, as identified in the security design review:

*   **Routing and Middleware:**  How requests are handled and processed, including CSRF protection.
*   **Templating Engine (Blade):**  Output encoding and XSS prevention.
*   **Eloquent ORM:**  Database interactions and SQL injection prevention.
*   **Validation:**  Input sanitization and validation.
*   **Authentication and Authorization:**  User management, access control, and session management.
*   **Encryption and Hashing:**  Data protection mechanisms.
*   **Configuration:**  Secure configuration practices.
*   **Dependency Management (Composer):**  Supply chain risks.
*   **Error Handling and Logging:** Secure error and exception handling.
*   **Queue System:** Security of asynchronous task processing.
*   **Caching:** Security of cached data.
*   **Filesystem:** Security of file uploads and storage.

This analysis *does not* cover:

*   Specific vulnerabilities in third-party Laravel packages (beyond general dependency management).  This is a separate, ongoing concern.
*   Security of the underlying infrastructure (web server, database server, operating system).
*   Application-specific logic vulnerabilities *not* directly related to the framework's features.

**Methodology:**

1.  **Code Review and Documentation Analysis:**  We will examine the Laravel source code (available on GitHub) and official documentation to understand the implementation details of the security controls and identify potential weaknesses.  We will focus on the `Illuminate` namespace components mentioned in the design review.
2.  **Threat Modeling:**  We will identify potential threats and attack vectors based on common web application vulnerabilities and the specific features of Laravel.
3.  **Best Practice Analysis:**  We will compare Laravel's features and recommended practices against industry-standard security best practices.
4.  **Inference and Assumption Validation:**  We will make informed inferences about the architecture and data flow based on the provided design review and the framework's structure.  We will explicitly state any assumptions made.
5.  **Mitigation Strategy Development:**  For each identified vulnerability or weakness, we will propose specific, actionable mitigation strategies tailored to the Laravel framework.

### 2. Security Implications of Key Components

This section breaks down the security implications of each key component, referencing specific code locations where possible.

**2.1 Routing and Middleware (`Illuminate\Routing`, `Illuminate\Foundation\Http\Middleware`)**

*   **Architecture:** Laravel's router maps incoming HTTP requests to controller actions or closures. Middleware acts as a filtering layer, intercepting requests before and after they reach the controller.
*   **Data Flow:**  Request -> Web Server -> Laravel Router -> Middleware (chain) -> Controller -> (Middleware) -> Response.
*   **Security Implications:**
    *   **CSRF Protection (`VerifyCsrfToken`):**  Laravel's built-in CSRF protection is generally robust.  It generates a unique token for each session and validates it on every state-changing request (POST, PUT, PATCH, DELETE).
        *   **Vulnerability:** Developers might disable CSRF protection globally or for specific routes, creating a significant vulnerability.  They might also use GET requests for state-changing operations, bypassing CSRF protection.  Incorrectly configuring the `except` array in the middleware can also expose routes.
        *   **Mitigation:**  Ensure CSRF protection is enabled globally and *never* disabled unless absolutely necessary (and with a very strong justification).  Use POST/PUT/PATCH/DELETE for state-changing operations.  Regularly review the `VerifyCsrfToken` middleware configuration, especially the `except` array.  Use the `@csrf` Blade directive or `csrf_field()` helper function in forms.  Educate developers on the importance of CSRF protection.
    *   **Route Parameter Validation:**  While Laravel allows defining route parameters, it doesn't automatically validate their type or format *within the route definition itself*.
        *   **Vulnerability:**  Unvalidated route parameters can be exploited for injection attacks (e.g., passing malicious strings to database queries).
        *   **Mitigation:**  Always validate route parameters within the controller action or a dedicated Form Request using Laravel's validation system.  Use regular expressions in route definitions where possible (e.g., `/users/{id}` where `id` must be numeric: `Route::get('/users/{id}', ...)->where('id', '[0-9]+');`).
    *   **HTTP Method Spoofing:**  Although less common with modern frameworks, ensuring the correct HTTP method is used is crucial.
        *   **Vulnerability:**  A malicious actor might try to spoof the HTTP method (e.g., sending a GET request as a POST).
        *   **Mitigation:**  Use Laravel's route definitions to explicitly specify allowed HTTP methods (e.g., `Route::post(...)`, `Route::put(...)`).  Avoid using `Route::any(...)` unless absolutely necessary.
    * **Open Redirect:** If the application uses user input to construct redirect URLs.
        * **Vulnerability:** Attackers can craft malicious URLs that redirect users to phishing sites.
        * **Mitigation:** Use `Redirect::route()` or `redirect()->route()` to redirect to named routes, avoiding user input in the URL. If user input *must* be used, validate it against a whitelist of allowed URLs or domains.

**2.2 Templating Engine (Blade) (`Illuminate\View\Compilers\BladeCompiler`)**

*   **Architecture:** Blade is Laravel's templating engine, providing a convenient way to generate HTML output.  It automatically escapes output by default, using HTML entity encoding.
*   **Data Flow:**  Controller passes data to Blade -> Blade compiles the template -> Output is rendered as HTML.
*   **Security Implications:**
    *   **XSS Protection:** Blade's automatic escaping is a strong defense against XSS.  The `{{ $variable }}` syntax automatically escapes output.
        *   **Vulnerability:** Developers might use the "unescaped" output syntax (`{!! $variable !!}`), bypassing the XSS protection. This is a *major* risk.
        *   **Mitigation:**  *Strongly discourage* the use of `{!! !!}`.  If it *must* be used (e.g., for rendering trusted HTML from a database), ensure the data is thoroughly sanitized *before* being passed to the view.  Use a dedicated HTML purifier library (e.g., HTMLPurifier) to sanitize the data.  Conduct code reviews to identify and eliminate instances of `{!! !!}`.
    *   **Template Injection:** While less common than XSS, template injection is possible if user input is used to dynamically construct template names or sections.
        *   **Vulnerability:** An attacker could inject malicious Blade syntax, potentially leading to code execution.
        *   **Mitigation:**  Avoid using user input to construct template names or paths.  If dynamic template inclusion is necessary, use a whitelist of allowed templates.

**2.3 Eloquent ORM (`Illuminate\Database`)**

*   **Architecture:** Eloquent is Laravel's ORM, providing an object-oriented way to interact with databases.  It uses PDO and parameterized queries, which are a strong defense against SQL injection.
*   **Data Flow:**  Controller uses Eloquent models -> Eloquent generates SQL queries -> PDO executes the queries against the database.
*   **Security Implications:**
    *   **SQL Injection Prevention:** Eloquent's use of parameterized queries is highly effective *when used correctly*.
        *   **Vulnerability:** Developers might bypass Eloquent and use raw SQL queries (e.g., `DB::raw()`, `DB::select()`, `DB::statement()`) without proper parameterization, introducing SQL injection vulnerabilities.  They might also incorrectly use Eloquent's query builder methods, leading to similar issues (e.g., concatenating user input directly into `whereRaw()` clauses).
        *   **Mitigation:**  *Strongly encourage* the use of Eloquent's query builder methods and relationships whenever possible.  If raw SQL queries are necessary, *always* use parameterized queries (binding values).  Never concatenate user input directly into SQL queries.  Code reviews should specifically look for instances of `DB::raw()` and ensure proper parameterization.  Use a static analysis tool that can detect potential SQL injection vulnerabilities.
    *   **Mass Assignment:** Eloquent has a feature called "mass assignment," which allows setting multiple model attributes at once.
        *   **Vulnerability:**  If not properly configured, mass assignment can allow attackers to modify attributes they shouldn't have access to (e.g., setting an `is_admin` flag).
        *   **Mitigation:**  Use either `$fillable` or `$guarded` on Eloquent models to explicitly define which attributes can be mass-assigned.  `$fillable` specifies a whitelist of allowed attributes, while `$guarded` specifies a blacklist.  Prefer `$fillable` as a more secure approach (whitelist over blacklist).
    *   **Data Leakage:**  Careless use of Eloquent's `toArray()` or `toJson()` methods can expose sensitive data.
        *   **Vulnerability:**  If a model contains sensitive attributes (e.g., password hashes, API keys), these might be accidentally included in the output.
        *   **Mitigation:**  Use the `$hidden` property on Eloquent models to specify attributes that should be excluded from array/JSON representations.  Alternatively, use Eloquent resources (`Illuminate\Http\Resources\Json\JsonResource`) to explicitly define the data structure for API responses.

**2.4 Validation (`Illuminate\Validation`)**

*   **Architecture:** Laravel's validation system provides a set of rules for validating user input.  It can be used in controllers, Form Requests, or directly using the `Validator` facade.
*   **Data Flow:**  User input -> Validation rules -> (Valid/Invalid) -> Controller logic.
*   **Security Implications:**
    *   **Input Sanitization and Validation:**  Laravel's validation system is crucial for preventing various injection attacks and ensuring data integrity.
        *   **Vulnerability:**  Developers might not validate user input at all, or they might use weak or incomplete validation rules.  They might rely solely on client-side validation, which can be easily bypassed.
        *   **Mitigation:**  *Always* validate *all* user input on the server-side using Laravel's validation system.  Use Form Requests for complex validation logic.  Use a combination of validation rules to ensure data type, format, length, and other constraints.  Never rely solely on client-side validation.  Consider using strict validation rules (e.g., `numeric`, `integer`, `email`, `date_format`) to minimize the attack surface.  Regularly review validation rules to ensure they are comprehensive and up-to-date.
    *   **File Upload Validation:**  Laravel provides specific validation rules for file uploads (e.g., `file`, `image`, `mimes`, `max`).
        *   **Vulnerability:**  Improper file upload validation can lead to various attacks, including uploading malicious files (e.g., shell scripts), overwriting existing files, and denial-of-service attacks (uploading excessively large files).
        *   **Mitigation:**  Always validate file uploads using Laravel's validation rules.  Specify allowed file types (`mimes`), maximum file size (`max`), and dimensions (for images).  Store uploaded files in a secure location outside the web root, and use randomly generated filenames to prevent overwriting.  Consider using a dedicated file storage service (e.g., AWS S3) for improved security and scalability.

**2.5 Authentication and Authorization (`Illuminate\Auth`, `Illuminate\Foundation\Auth`)**

*   **Architecture:** Laravel provides built-in authentication and authorization mechanisms.  Authentication verifies user identity, while authorization controls access to resources.
*   **Data Flow:**
    *   **Authentication:**  User provides credentials -> Laravel verifies credentials against a user provider (e.g., database) -> Session is created (if successful).
    *   **Authorization:**  User requests a resource -> Laravel checks user's permissions (using guards and policies) -> Access is granted or denied.
*   **Security Implications:**
    *   **Authentication:**
        *   **Vulnerability:**  Weak password policies, insecure password reset mechanisms, and session management vulnerabilities can lead to account takeover.  Using default authentication scaffolding without customization can also introduce risks.
        *   **Mitigation:**  Enforce strong password policies (minimum length, complexity requirements).  Use Laravel's built-in password hashing (Bcrypt or Argon2).  Implement secure password reset mechanisms (using tokens, email verification).  Configure session management securely (HTTPS, HttpOnly cookies, Secure cookies, appropriate session timeout).  Consider implementing multi-factor authentication (MFA).  Customize the default authentication scaffolding to meet specific security requirements.
    *   **Authorization:**
        *   **Vulnerability:**  Incorrectly configured authorization logic (guards and policies) can lead to unauthorized access to resources.  Developers might forget to implement authorization checks altogether.
        *   **Mitigation:**  Use Laravel's authorization features (guards and policies) consistently.  Define clear roles and permissions.  Perform authorization checks on *every* request to protected resources.  Use middleware to enforce authorization checks at the route level.  Test authorization logic thoroughly.
    *   **Session Management:**
        *   **Vulnerability:** Session fixation, session hijacking, and insufficient session expiration can compromise user accounts.
        * **Mitigation:** Use HTTPS for all authenticated sessions. Set the `HttpOnly` and `Secure` flags on session cookies. Configure an appropriate session timeout. Regenerate the session ID after login (`Session::regenerate()`). Consider using a database or Redis to store sessions for improved security and scalability.

**2.6 Encryption and Hashing (`Illuminate\Encryption`, `Illuminate\Hashing`)**

*   **Architecture:** Laravel provides services for encrypting data and hashing passwords.
*   **Data Flow:**
    *   **Encryption:**  Data -> Encryption service -> Encrypted data.
    *   **Hashing:**  Password -> Hashing service -> Hashed password.
*   **Security Implications:**
    *   **Encryption:**
        *   **Vulnerability:**  Using weak encryption algorithms or insecure key management practices can compromise data confidentiality.
        *   **Mitigation:**  Use Laravel's encryption service with strong, industry-standard algorithms (e.g., AES-256-CBC).  Manage encryption keys securely, using environment variables or a dedicated key management service (e.g., AWS KMS).  Never hardcode encryption keys in the codebase.
    *   **Hashing:**
        *   **Vulnerability:**  Using weak hashing algorithms (e.g., MD5, SHA1) or not using a salt can make passwords vulnerable to cracking.
        *   **Mitigation:**  Use Laravel's built-in hashing functions (Bcrypt or Argon2) for storing passwords.  Laravel automatically handles salting.  Ensure the cost factor for Bcrypt is appropriately high (e.g., 12 or higher).

**2.7 Configuration (`config/`)**

*   **Architecture:** Laravel uses configuration files to store various settings.
*   **Security Implications:**
    *   **Vulnerability:**  Insecure configuration settings (e.g., debug mode enabled in production, exposing sensitive environment variables) can expose the application to various attacks.
    *   **Mitigation:**  *Never* enable debug mode (`APP_DEBUG=true`) in production.  Store sensitive configuration values (e.g., database credentials, API keys) in environment variables, *not* in the configuration files themselves.  Use the `.env` file for local development only, and *never* commit it to version control.  Regularly review configuration files to ensure they are secure.  Use a tool like `env-check` to verify that all required environment variables are set.

**2.8 Dependency Management (Composer)**

*   **Architecture:** Composer is used to manage Laravel's dependencies.
*   **Security Implications:**
    *   **Vulnerability:**  Third-party packages may contain vulnerabilities, introducing supply chain risks.
    *   **Mitigation:**  Regularly update dependencies using `composer update`.  Use a dependency vulnerability scanner (e.g., `composer audit`, Snyk) to identify and address known vulnerabilities.  Carefully vet third-party packages before including them in the project.  Consider using a private package repository (e.g., Packagist) to control which packages can be used.

**2.9 Error Handling and Logging (`Illuminate\Log`)**

*   **Architecture:** Laravel provides a logging system for recording errors and other events.
*   **Security Implications:**
    *   **Vulnerability:**  Exposing detailed error messages to users can reveal sensitive information about the application's internal workings.  Logging sensitive data (e.g., passwords, API keys) can create security risks.
    *   **Mitigation:**  *Never* expose detailed error messages to users in production.  Configure Laravel to display generic error pages.  Log errors to a secure location (e.g., a log file, a centralized logging service).  *Never* log sensitive data.  Use a log monitoring system to detect and respond to security-related events.

**2.10 Queue System (`Illuminate\Queue`)**

*   **Architecture:** Laravel's queue system allows deferring time-consuming tasks to be processed asynchronously.
*   **Security Implications:**
    *   **Vulnerability:** If queued jobs handle sensitive data, vulnerabilities in the queue system or in the job logic can expose this data.
    *   **Mitigation:**  Encrypt sensitive data before queuing it.  Use a secure queue driver (e.g., Redis with authentication and TLS).  Validate data within queued jobs, just as you would with any other user input.  Monitor queue activity for suspicious behavior.

**2.11 Caching (`Illuminate\Cache`)**

*   **Architecture:** Laravel provides a caching system to improve performance.
*   **Security Implications:**
    *   **Vulnerability:**  If sensitive data is cached, unauthorized access to the cache can expose this data.
    *   **Mitigation:**  Avoid caching sensitive data unless absolutely necessary.  If sensitive data *must* be cached, encrypt it before storing it in the cache.  Use a secure cache driver (e.g., Redis with authentication).  Configure appropriate cache expiration times.

**2.12 Filesystem (`Illuminate\Filesystem`)**

*   **Architecture:** Laravel provides an abstraction layer for interacting with the filesystem.
*   **Security Implications:**
    *   **Vulnerability:**  Storing files directly within the web root can make them accessible to attackers.  Improper file permissions can lead to unauthorized access or modification.
    *   **Mitigation:**  Store files outside the web root.  Use appropriate file permissions (e.g., 644 for files, 755 for directories).  Use Laravel's filesystem abstraction layer to manage files securely.  Consider using a dedicated file storage service (e.g., AWS S3) for improved security and scalability.

### 3. Actionable Mitigation Strategies (Summary)

The following table summarizes the key vulnerabilities and mitigation strategies for each component:

| Component                     | Vulnerability                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         