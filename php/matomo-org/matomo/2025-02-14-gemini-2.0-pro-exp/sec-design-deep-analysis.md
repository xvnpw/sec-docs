## Matomo Security Analysis: Deep Dive

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to conduct a thorough security assessment of the Matomo web analytics platform. This includes identifying potential vulnerabilities, assessing the effectiveness of existing security controls, and providing actionable recommendations to enhance Matomo's security posture.  The analysis will focus on key components, including the Tracking API, Reporting API, User Interface, Plugin architecture, and Database interactions, inferring architecture and data flow from the provided design review and publicly available information.

**Scope:**

This analysis covers the following aspects of Matomo:

*   **Core Matomo Application:**  The PHP codebase, including the Tracking API, Reporting API, and User Interface.
*   **Database Interactions:**  How Matomo interacts with the MySQL/MariaDB database.
*   **Plugin Architecture:**  The security implications of Matomo's plugin system.
*   **Deployment (Self-Hosted Docker):**  Security considerations specific to the Docker-based self-hosting deployment model.
*   **Build Process:**  Security controls within the build and release pipeline.
* **Data Flows:** How data moves between different components.

This analysis *does not* cover:

*   **Matomo Cloud Infrastructure:**  The security of Matomo's cloud-hosted offering is outside the scope of this analysis.
*   **Third-Party Server Infrastructure:**  The security of servers used for self-hosting (beyond the Docker configuration) is the responsibility of the user.
*   **Specific Third-Party Plugins:**  Each plugin would require its own separate security analysis.

**Methodology:**

This analysis will employ the following methodology:

1.  **Design Review Analysis:**  Thorough examination of the provided security design review document.
2.  **Codebase Inference:**  Inferring architectural details, data flows, and security mechanisms based on the design review, Matomo's documentation, and general knowledge of PHP web applications.
3.  **Threat Modeling:**  Identifying potential threats and attack vectors based on the identified components and data flows.  We will use a combination of STRIDE and attack trees.
4.  **Vulnerability Analysis:**  Assessing the likelihood and impact of potential vulnerabilities.
5.  **Mitigation Recommendations:**  Providing specific, actionable recommendations to address identified vulnerabilities and improve Matomo's security posture.

### 2. Security Implications of Key Components

Let's break down the security implications of each key component, focusing on potential threats and vulnerabilities:

**2.1 Tracking API (PHP)**

*   **Function:** Receives tracking data from websites via HTTPS requests.  Processes and stores this data in the database.
*   **Threats (STRIDE):**
    *   **Spoofing:**  An attacker could send forged tracking data, polluting the analytics data.
    *   **Tampering:**  An attacker could modify tracking data in transit, leading to inaccurate data.
    *   **Repudiation:**  Difficult to prove who sent specific tracking data (if not properly authenticated).
    *   **Information Disclosure:**  Potential leakage of sensitive information in tracking requests (e.g., custom dimensions).
    *   **Denial of Service:**  High volume of requests could overwhelm the API, making it unavailable.
    *   **Elevation of Privilege:**  Vulnerabilities in the API could allow attackers to gain unauthorized access to data or system resources.
*   **Vulnerabilities:**
    *   **SQL Injection:**  If input validation is flawed, attackers could inject malicious SQL code to access or modify data.
    *   **Cross-Site Scripting (XSS):**  Although less likely in an API, reflected XSS could be possible if error messages or responses include unescaped user input.
    *   **XML External Entity (XXE) Injection:**  If the API processes XML data, XXE vulnerabilities could allow attackers to access local files or internal systems.
    *   **Insecure Deserialization:**  If the API deserializes user-provided data, attackers could exploit vulnerabilities in the deserialization process to execute arbitrary code.
    *   **Rate Limiting Bypass:**  If rate limiting is not properly implemented, attackers could bypass it to launch DoS attacks.
    *   **Business Logic Flaws:**  Flaws in the API's logic could allow attackers to bypass security checks or manipulate data in unexpected ways.

**2.2 Reporting API (PHP)**

*   **Function:** Provides data for the user interface and other reporting tools.  Retrieves and aggregates data from the database.
*   **Threats (STRIDE):**
    *   **Spoofing:**  An attacker could impersonate a legitimate user to access data they shouldn't have.
    *   **Tampering:**  An attacker could modify API requests to retrieve or manipulate data.
    *   **Repudiation:**  Difficult to track who accessed specific data (if auditing is insufficient).
    *   **Information Disclosure:**  Potential leakage of sensitive data through API responses.
    *   **Denial of Service:**  Complex or resource-intensive API requests could be used to cause DoS.
    *   **Elevation of Privilege:**  Vulnerabilities in the API could allow attackers to gain unauthorized access to data or system resources.
*   **Vulnerabilities:**
    *   **SQL Injection:**  Similar to the Tracking API, flawed input validation could lead to SQL injection.
    *   **Broken Access Control:**  Insufficient authorization checks could allow users to access data they shouldn't have.
    *   **Insecure Direct Object References (IDOR):**  If the API uses predictable identifiers for data objects, attackers could access data by manipulating these identifiers.
    *   **Excessive Data Exposure:**  The API might return more data than necessary, potentially exposing sensitive information.
    *   **Mass Assignment:** If not handled carefully, attackers might be able to modify data fields they shouldn't have access to.

**2.3 User Interface (PHP, JavaScript)**

*   **Function:**  The web-based interface for users to interact with Matomo.  Displays reports, allows configuration, provides user management.
*   **Threats (STRIDE):**
    *   **Spoofing:**  An attacker could create a fake Matomo login page to steal user credentials (phishing).
    *   **Tampering:**  An attacker could modify the UI in the user's browser (e.g., using a malicious browser extension).
    *   **Repudiation:**  Difficult to track user actions within the UI (if auditing is insufficient).
    *   **Information Disclosure:**  Potential leakage of sensitive data through the UI (e.g., in error messages, autocomplete).
    *   **Denial of Service:**  Attacks targeting the web server could make the UI unavailable.
    *   **Elevation of Privilege:**  Vulnerabilities in the UI could allow attackers to gain administrative access.
*   **Vulnerabilities:**
    *   **Cross-Site Scripting (XSS):**  The most significant threat to the UI.  Stored XSS (injecting malicious scripts into the database) and Reflected XSS (injecting scripts through URL parameters or form inputs) are both possible.
    *   **Cross-Site Request Forgery (CSRF):**  Attackers could trick users into performing actions they didn't intend to, such as changing settings or deleting data.
    *   **Session Hijacking:**  Attackers could steal user session cookies and impersonate them.
    *   **Clickjacking:**  Attackers could trick users into clicking on hidden elements to perform unintended actions.
    *   **Open Redirect:**  If Matomo uses redirects, attackers could manipulate them to redirect users to malicious websites.
    *   **Client-Side Logic Flaws:**  Vulnerabilities in the JavaScript code could be exploited to bypass security checks or manipulate data.

**2.4 Plugins (PHP)**

*   **Function:**  Extend Matomo's functionality.  Provide additional features (e.g., custom reports, integrations).
*   **Threats (STRIDE):**  Plugins inherit all the threats of the other components (Tracking API, Reporting API, UI) depending on their functionality.  They also introduce new threats:
    *   **Spoofing:**  A malicious plugin could impersonate a legitimate plugin.
    *   **Tampering:**  A compromised plugin could be modified to include malicious code.
    *   **Repudiation:**  Difficult to track actions performed by a plugin (if auditing is insufficient).
    *   **Information Disclosure:**  A plugin could leak sensitive data.
    *   **Denial of Service:**  A poorly written plugin could consume excessive resources, causing DoS.
    *   **Elevation of Privilege:**  A plugin could exploit vulnerabilities in Matomo's core to gain higher privileges.
*   **Vulnerabilities:**
    *   **All vulnerabilities listed for other components are potentially present in plugins.**
    *   **Insecure Plugin APIs:**  If plugins expose their own APIs, these APIs could be vulnerable.
    *   **Lack of Sandboxing:**  Plugins typically run with the same privileges as the Matomo core, meaning a vulnerability in a plugin can compromise the entire installation.
    *   **Unvalidated Updates:**  If plugin updates are not properly validated, attackers could distribute malicious updates.

**2.5 Database (MySQL/MariaDB)**

*   **Function:**  Stores tracking data, configuration, and user information.
*   **Threats (STRIDE):**
    *   **Spoofing:**  An attacker could connect to the database with stolen credentials.
    *   **Tampering:**  An attacker could modify or delete data in the database.
    *   **Repudiation:**  Difficult to track database changes (if auditing is insufficient).
    *   **Information Disclosure:**  Unauthorized access to the database could expose all stored data.
    *   **Denial of Service:**  Resource exhaustion attacks could make the database unavailable.
    *   **Elevation of Privilege:**  Vulnerabilities in the database server could allow attackers to gain higher privileges.
*   **Vulnerabilities:**
    *   **SQL Injection:**  The primary threat to the database, stemming from vulnerabilities in the Tracking API or Reporting API.
    *   **Weak Database Credentials:**  Using default or easily guessable passwords.
    *   **Unpatched Database Server:**  Vulnerabilities in the MySQL/MariaDB software itself.
    *   **Insecure Database Configuration:**  Misconfigured database settings (e.g., exposed to the internet, unnecessary privileges).
    *   **Lack of Encryption at Rest:**  If the database is not encrypted, attackers who gain access to the server could read the data directly.

### 3. Inferred Architecture, Components, and Data Flow

Based on the design review and common web application patterns, we can infer the following:

**Architecture:**

*   Matomo follows a fairly standard Model-View-Controller (MVC) architecture, common for PHP applications.
*   The **Model** represents the data and interacts with the database.
*   The **View** is responsible for rendering the user interface.
*   The **Controller** handles user requests, interacts with the Model, and selects the appropriate View.
*   The Tracking API and Reporting API likely have separate controllers and models.
*   Plugins can interact with the core Matomo components through defined hooks and APIs.

**Components:**

*   **Web Server (Apache/Nginx):**  Handles incoming HTTP requests and serves static files.
*   **PHP-FPM (FastCGI Process Manager):**  Executes PHP code.
*   **Database (MySQL/MariaDB):**  Stores data.
*   **Matomo Core (PHP):**  Implements the core logic of the application.
*   **Plugins (PHP):**  Extend Matomo's functionality.
*   **JavaScript Libraries (e.g., jQuery, Vue.js):**  Used for front-end functionality.
*   **Composer (PHP Dependency Manager):**  Manages third-party PHP libraries.

**Data Flow (Tracking):**

1.  **Website Visitor:**  A user visits a website with the Matomo tracking code.
2.  **Tracking Code (JavaScript):**  The JavaScript code executes in the visitor's browser and collects data about the visit.
3.  **HTTPS Request:**  The tracking code sends an HTTPS request to the Matomo Tracking API.
4.  **Tracking API (PHP):**  The API receives the request, validates the input, and processes the data.
5.  **Database (MySQL/MariaDB):**  The API stores the tracking data in the database.

**Data Flow (Reporting):**

1.  **User:**  A user logs in to the Matomo UI.
2.  **UI (PHP, JavaScript):**  The UI makes requests to the Reporting API to retrieve data.
3.  **Reporting API (PHP):**  The API receives the request, authenticates the user, authorizes the request, and queries the database.
4.  **Database (MySQL/MariaDB):**  The database returns the requested data.
5.  **Reporting API (PHP):**  The API processes the data and returns it to the UI.
6.  **UI (PHP, JavaScript):**  The UI displays the data to the user.

### 4. Specific Security Considerations for Matomo

Based on the analysis, here are specific security considerations tailored to Matomo:

*   **Anonymization of IP Addresses:**  Matomo should *always* be configured to anonymize IP addresses by default.  This is crucial for privacy compliance (e.g., GDPR).  The level of anonymization should be configurable, and users should be clearly informed about the implications of different anonymization settings.
*   **Data Minimization:**  Matomo should only collect the data that is strictly necessary for analytics purposes.  Users should be able to configure which data points are collected and disable unnecessary tracking features.
*   **Secure Configuration Defaults:**  Matomo should ship with secure default settings.  This includes:
    *   Strong password policies.
    *   Anonymized IP addresses.
    *   Enabled CSRF protection.
    *   Recommended HTTP security headers.
    *   Disabled unnecessary features.
*   **Plugin Security:**  The Matomo Marketplace should have a rigorous review process for new plugins.  This should include:
    *   Static analysis of plugin code.
    *   Manual security reviews.
    *   Requirements for plugin developers to follow secure coding practices.
    *   A mechanism for reporting and addressing vulnerabilities in plugins.
    *   Clear communication to users about the risks of using third-party plugins.
*   **Regular Security Audits:**  Matomo should undergo regular security audits by independent security experts.  These audits should cover the core application, the plugin architecture, and the build process.
*   **Incident Response Plan:**  Matomo should have a well-defined incident response plan to handle security incidents effectively.  This plan should include procedures for:
    *   Detecting and reporting incidents.
    *   Containing and eradicating threats.
    *   Recovering from incidents.
    *   Notifying affected users.
*   **Two-Factor Authentication (2FA):**  2FA should be strongly encouraged for all Matomo users, especially administrators.
*   **Content Security Policy (CSP):**  Matomo should provide clear guidance on how to configure a strong CSP to mitigate XSS attacks.  The default Matomo installation should include a basic CSP that can be customized by users.
*   **HTTP Security Headers:**  Matomo should recommend and provide guidance on configuring various HTTP security headers, such as HSTS, X-Frame-Options, X-Content-Type-Options, and Referrer-Policy.
*   **Database Security:**
    *   Use strong, unique passwords for the database user.
    *   Restrict database access to only the necessary IP addresses.
    *   Enable database encryption at rest, if possible.
    *   Regularly back up the database.
    *   Monitor database logs for suspicious activity.
    *   Apply security updates to the database server promptly.
* **Secrets Management:** Use environment variables or a dedicated secrets management solution (e.g., HashiCorp Vault) to store sensitive information like database credentials, API keys, and other secrets. *Never* store secrets directly in the codebase or configuration files.

### 5. Actionable Mitigation Strategies

Here are specific, actionable mitigation strategies for the identified threats and vulnerabilities:

| Component          | Vulnerability                               | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 