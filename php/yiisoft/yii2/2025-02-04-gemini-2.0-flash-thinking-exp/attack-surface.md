# Attack Surface Analysis for yiisoft/yii2

## Attack Surface: [Unvalidated Request Parameters (SQL Injection, XSS, Command Injection)](./attack_surfaces/unvalidated_request_parameters__sql_injection__xss__command_injection_.md)

*   **Description:** Attackers manipulate input data (GET/POST parameters) to inject malicious code or commands into the application.
*   **Yii2 Contribution:** Yii2 provides tools for input validation and sanitization (Validation Rules, Active Record, Query Builder, HTML Helpers). However, developers' failure to properly utilize these Yii2 features, or bypassing them with raw SQL queries, directly contributes to this attack surface.
*   **Example:** A developer uses raw SQL to fetch data based on a GET parameter without validation. An attacker injects SQL code into the parameter, leading to unauthorized data access or modification.
*   **Impact:** Data breach, data modification, unauthorized access, server compromise, Cross-Site Scripting (XSS) leading to account takeover or malware distribution.
*   **Risk Severity:** **High** to **Critical**
*   **Mitigation Strategies:**
    *   **Strictly enforce Yii2 Validation Rules:** Implement comprehensive validation rules in models and controllers for all user inputs using Yii2's validation framework.
    *   **Utilize Yii2 Active Record and Query Builder:**  Primarily use Yii2's Active Record or Query Builder for database interactions. These tools inherently protect against SQL injection through parameter binding. Avoid raw SQL queries.
    *   **Implement Output Encoding with Yii2 Helpers:**  Consistently use Yii2's HTML helpers (e.g., `Html::encode()`, `Html::tag()`) in views to encode output data and prevent XSS vulnerabilities.

## Attack Surface: [Insecure File Uploads (Arbitrary File Upload, Path Traversal)](./attack_surfaces/insecure_file_uploads__arbitrary_file_upload__path_traversal_.md)

*   **Description:** Attackers upload malicious files to the server, potentially leading to code execution, information disclosure, or denial of service.
*   **Yii2 Contribution:** Yii2's `UploadedFile` class simplifies file handling, but the framework relies on developers to implement secure validation and storage practices. Insufficient validation within Yii2 controllers and insecure storage configurations directly increase this attack surface.
*   **Example:** A developer uses Yii2's `UploadedFile` to save uploaded files but only checks the file extension on the client-side. An attacker uploads a PHP script disguised as an image, which is then stored in a publicly accessible directory and executed.
*   **Impact:** Remote code execution, server compromise, website defacement, data breach, denial of service.
*   **Risk Severity:** **High** to **Critical**
*   **Mitigation Strategies:**
    *   **Server-Side File Type Validation in Yii2 Controllers:** Implement robust server-side file type validation within Yii2 controllers using MIME type checks and magic number verification, not just relying on client-side checks or file extensions.
    *   **Filename Sanitization using Yii2's features:** Sanitize filenames within Yii2 application logic to prevent path traversal vulnerabilities before saving files.
    *   **Secure File Storage Configuration outside Webroot:** Configure file storage locations outside of the webroot, leveraging Yii2's configuration options to manage file paths securely.

## Attack Surface: [Debug Mode Enabled in Production (Information Disclosure)](./attack_surfaces/debug_mode_enabled_in_production__information_disclosure_.md)

*   **Description:** Leaving debug mode enabled in a production environment exposes sensitive application information to potential attackers.
*   **Yii2 Contribution:** Yii2's debug mode, a framework feature, provides detailed error messages, the debug toolbar, and other development aids.  The framework's configuration directly controls debug mode, and failing to disable it in production is a Yii2-specific misconfiguration.
*   **Example:** With Yii2's debug mode enabled in production, an attacker triggers an error. The detailed error page, generated by Yii2's error handling, reveals application paths, configuration details, database queries, and potentially sensitive data.
*   **Impact:** Information disclosure, server configuration details revealed, potential for further exploitation based on exposed information.
*   **Risk Severity:** **High**
*   **Mitigation Strategies:**
    *   **Explicitly Disable Yii2 Debug Mode in Production Configuration:**  Ensure debug mode is explicitly disabled in Yii2's production configuration files (`config/web.php` and `config/console.php`) by setting `'debug' => false;` within the `'components' => ['log' => ...]` section.
    *   **Remove Yii2 Debug Toolbar Module in Production:**  Remove or disable the `debug` module within Yii2's module configuration in production to prevent access to the debug toolbar.
    *   **Implement Yii2 Custom Error Handling:** Utilize Yii2's error handling mechanisms to create custom error pages for production that are user-friendly and avoid revealing sensitive technical details, while still logging errors securely for debugging.

## Attack Surface: [Insecure Authentication and Session Management (Session Hijacking, Brute-Force)](./attack_surfaces/insecure_authentication_and_session_management__session_hijacking__brute-force_.md)

*   **Description:** Weaknesses in authentication mechanisms and session handling can allow attackers to impersonate users or gain unauthorized access.
*   **Yii2 Contribution:** Yii2 provides components and patterns for user authentication and session management (User component, Session component, Security component). Insecure configuration or improper implementation of these Yii2 components directly leads to vulnerabilities. Weak password hashing using outdated methods within Yii2 applications, or lack of rate limiting, are Yii2-related issues.
*   **Example:** A Yii2 application uses the Yii2 Security component but is configured to use a weak hashing algorithm. An attacker obtains password hashes and cracks them due to the weak hashing method. Or, a Yii2 application lacks rate limiting on login attempts, allowing brute-force attacks.
*   **Impact:** Unauthorized access to user accounts, data breach, account takeover, privilege escalation.
*   **Risk Severity:** **High** to **Critical**
*   **Mitigation Strategies:**
    *   **Utilize Yii2 Security Component with Strong Hashing Algorithms:** Configure the Yii2 Security component to use strong and modern password hashing algorithms like bcrypt or Argon2, as recommended by Yii2's security best practices.
    *   **Implement Rate Limiting within Yii2 Application Logic or Middleware:** Implement rate limiting on login attempts using Yii2's application structure, potentially through middleware or controller-level logic, to prevent brute-force attacks.
    *   **Secure Yii2 Session Configuration:**  Configure Yii2's Session component securely by setting `httpOnly` and `secure` flags for cookies within Yii2's session configuration in `config/web.php`.

## Attack Surface: [Exposed Configuration Files (Information Disclosure, Credential Theft)](./attack_surfaces/exposed_configuration_files__information_disclosure__credential_theft_.md)

*   **Description:** Configuration files containing sensitive information (database credentials, API keys, etc.) are unintentionally made publicly accessible.
*   **Yii2 Contribution:** Yii2's configuration structure relies on files like `config/web.php` and `config/db.php` which often contain sensitive data. Misconfiguration of the web server serving a Yii2 application, leading to direct access to these Yii2 configuration files, is a framework-specific vulnerability context.
*   **Example:** The web server hosting a Yii2 application is misconfigured to serve static files from the `config` directory. An attacker directly accesses `config/db.php` via a web request, retrieving database credentials stored within Yii2's configuration.
*   **Impact:** Information disclosure, credential theft, potential for full system compromise if database or API keys are exposed.
*   **Risk Severity:** **High** to **Critical**
*   **Mitigation Strategies:**
    *   **Secure Web Server Configuration for Yii2 Applications:** Ensure the web server is properly configured to prevent direct access to Yii2 configuration files and other sensitive directories within the Yii2 application structure.
    *   **Utilize Yii2's Environment Variable Support:** Leverage Yii2's support for environment variables to store sensitive configuration data (database credentials, API keys) outside of configuration files. Access these variables within Yii2's configuration using environment variable access methods.
    *   **Restrict Access with `.htaccess` (Apache) or equivalent in Yii2 Application Root:** Use `.htaccess` (for Apache) or equivalent web server configurations within the Yii2 application's root directory to explicitly deny access to the `config` directory and other sensitive locations.

## Attack Surface: [Gii Code Generator Enabled in Production (Remote Code Execution)](./attack_surfaces/gii_code_generator_enabled_in_production__remote_code_execution_.md)

*   **Description:** The Gii code generator, a powerful development tool, is accidentally left enabled and accessible in a production environment.
*   **Yii2 Contribution:** Gii is a core Yii2 module designed for code generation within the framework. Leaving it enabled in production is a direct Yii2-related vulnerability, as Gii is a Yii2 component.
*   **Example:** Gii is not disabled in the Yii2 production configuration. An attacker discovers the Gii URL and exploits it to generate or modify code within the Yii2 application, potentially injecting backdoors or malicious functionality, leading to remote code execution.
*   **Impact:** Remote code execution, server compromise, arbitrary file modification, website defacement, data breach.
*   **Risk Severity:** **Critical**
*   **Mitigation Strategies:**
    *   **Disable Gii Module in Yii2 Production Configuration:**  Ensure the `gii` module is explicitly disabled in Yii2's production configuration file (`config/web.php`) by removing or commenting out the `gii` module definition in the `'modules'` section.
    *   **Physically Remove Gii Module Files from Yii2 Production Deployment:**  For maximum security, completely remove the Gii module files from the Yii2 application deployment in production to eliminate any possibility of accidental exposure or misconfiguration.

