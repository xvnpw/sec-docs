## Deep Security Analysis of Facebook Android SDK

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to provide a thorough evaluation of the security posture of the Facebook Android SDK, focusing on identifying potential vulnerabilities and recommending specific, actionable mitigation strategies. The analysis will delve into the SDK's key components, build process, and deployment architecture, as outlined in the provided Security Design Review. The ultimate goal is to enhance the security of the SDK, thereby protecting both developers integrating the SDK and end-users of applications utilizing Facebook functionalities.

**Scope:**

The scope of this analysis encompasses the following key areas of the Facebook Android SDK project, as defined in the Security Design Review:

*   **Key Components:** Core SDK, Login SDK, Share SDK, and Graph API Client. We will analyze their functionalities, data flow, and inherent security implications.
*   **Deployment Architecture:**  Focus on the SDK's integration into Android applications and its interaction with the Facebook Platform and the Android Ecosystem.
*   **Build Process:** Examine the assumed CI/CD pipeline, including code commit, build, testing, security scans, and artifact distribution.
*   **Security Posture:** Review existing and recommended security controls, security requirements, and accepted risks as documented in the Security Design Review.
*   **Risk Assessment:** Analyze critical business processes and sensitive data associated with the SDK to understand the potential impact of security vulnerabilities.

This analysis will primarily focus on the security of the Facebook Android SDK itself and its immediate environment. It will not extend to a comprehensive security audit of the entire Facebook Platform or individual Android applications using the SDK, except where their interactions directly impact the SDK's security.

**Methodology:**

This deep security analysis will employ the following methodology:

1.  **Document Review and Architecture Inference:**  We will thoroughly review the provided Security Design Review document, including the C4 Context, Container, Deployment, and Build diagrams, along with their descriptions. Based on this documentation and the publicly available information about the Facebook Android SDK (from the GitHub repository and developer documentation), we will infer the SDK's architecture, component interactions, and data flow.
2.  **Threat Modeling:** For each key component and process within the SDK's ecosystem, we will perform threat modeling to identify potential security threats and vulnerabilities. This will involve considering common attack vectors relevant to mobile SDKs, OAuth 2.0 flows, API interactions, and software supply chains.
3.  **Security Requirements Mapping:** We will map the identified security requirements from the Security Design Review to the SDK's components and processes. This will help assess the coverage of security controls and identify potential gaps.
4.  **Control Effectiveness Analysis:** We will analyze the effectiveness of the existing and recommended security controls in mitigating the identified threats. This will involve considering the limitations of each control and potential bypass scenarios.
5.  **Actionable Mitigation Strategy Development:** For each identified threat and security gap, we will develop specific, actionable, and tailored mitigation strategies. These strategies will be directly applicable to the Facebook Android SDK project and will consider the SDK's architecture, functionalities, and development lifecycle.
6.  **Prioritization based on Risk:** Mitigation strategies will be prioritized based on the severity of the potential security impact and the likelihood of exploitation. We will consider the business risks outlined in the Security Design Review to guide prioritization.

This methodology will ensure a structured and comprehensive analysis, focusing on delivering practical and valuable security recommendations for the Facebook Android SDK project.

### 2. Security Implications of Key Components

#### 2.1 Core SDK

**Functionality and Data Flow:**

The Core SDK serves as the foundation for other SDK modules. It handles initialization, configuration, network communication, error handling, and provides utility functions. Data flow within the Core SDK likely involves:

*   **Configuration Data:** Reading and processing configuration parameters from the application or Facebook Platform.
*   **Network Requests:** Initiating and managing HTTPS connections to Facebook servers for various SDK functionalities.
*   **Logging and Error Reporting:** Collecting and potentially transmitting SDK logs and error information.

**Security Implications and Threats:**

*   **Configuration Vulnerabilities:**
    *   **Threat:** Insecure default configurations or vulnerabilities in configuration parsing could lead to unexpected behavior or security flaws.
    *   **Example:**  If configuration files are not properly validated, injection attacks might be possible.
    *   **Security Requirement Relevance:** Input Validation.
*   **Network Communication Security:**
    *   **Threat:**  Although HTTPS is enforced, vulnerabilities in the TLS implementation or improper certificate validation could compromise data in transit.
    *   **Example:** Man-in-the-middle attacks if certificate pinning is not implemented or bypassed.
    *   **Security Requirement Relevance:** Cryptography.
*   **Logging Sensitive Data:**
    *   **Threat:**  Accidental logging of sensitive user data (access tokens, personal information) could lead to data leaks if logs are not securely managed.
    *   **Example:**  Logging API request parameters that include access tokens.
    *   **Security Requirement Relevance:** Data Protection, Privacy.
*   **Error Handling Vulnerabilities:**
    *   **Threat:**  Verbose error messages revealing internal SDK details could aid attackers in reconnaissance. Improper error handling might lead to denial-of-service or unexpected states.
    *   **Example:**  Stack traces exposed in error messages in production builds.
    *   **Security Requirement Relevance:** Secure Coding Practices.

**Mitigation Strategies for Core SDK:**

*   **Configuration Hardening:**
    *   **Action:** Implement strict input validation and sanitization for all configuration parameters. Use secure default configurations and provide clear guidance to developers on secure configuration practices.
    *   **Rationale:** Prevents configuration-based attacks and ensures predictable SDK behavior.
*   **TLS/HTTPS Security Enhancement:**
    *   **Action:**  Implement certificate pinning to prevent MITM attacks. Regularly update TLS libraries and ensure strong cipher suites are used.
    *   **Rationale:** Strengthens network communication security beyond basic HTTPS enforcement.
*   **Secure Logging Practices:**
    *   **Action:**  Implement robust logging policies that explicitly prohibit logging sensitive user data.  Use parameterized logging to prevent injection attacks through log injection. Regularly review and sanitize log outputs.
    *   **Rationale:** Prevents accidental data leaks through logs and protects log integrity.
*   **Error Handling Improvement:**
    *   **Action:**  Implement generic error messages for production builds. Provide detailed error logs only in debug/development environments. Implement proper exception handling to prevent unexpected application states.
    *   **Rationale:** Reduces information leakage and improves application stability.

#### 2.2 Login SDK

**Functionality and Data Flow:**

The Login SDK is responsible for user authentication with Facebook. Key data flows include:

*   **Authentication Requests:** Initiating OAuth 2.0 flows to the Facebook Platform for user login.
*   **Credential Handling:** Securely managing user credentials (though ideally, the SDK should primarily handle access tokens, not raw credentials).
*   **Access Token Storage:** Securely storing and retrieving access tokens for subsequent API calls.
*   **Session Management:** Managing user sessions and handling login/logout operations.

**Security Implications and Threats:**

*   **OAuth 2.0 Implementation Vulnerabilities:**
    *   **Threat:**  Improper implementation of OAuth 2.0 flows (e.g., insecure redirect URIs, vulnerable token exchange mechanisms) could lead to authorization code interception or access token theft.
    *   **Example:**  Open redirect vulnerabilities in the OAuth flow, allowing attackers to steal authorization codes.
    *   **Security Requirement Relevance:** Authentication, Authorization.
*   **Access Token Security:**
    *   **Threat:**  Insecure storage of access tokens (e.g., in shared preferences without encryption) could lead to unauthorized access if the device is compromised.
    *   **Example:**  Malware on the device stealing access tokens from insecure storage.
    *   **Security Requirement Relevance:** Cryptography, Authentication.
*   **Session Hijacking:**
    *   **Threat:**  Vulnerabilities in session management could allow attackers to hijack user sessions and impersonate users.
    *   **Example:**  Predictable session IDs or lack of proper session invalidation.
    *   **Security Requirement Relevance:** Authentication.
*   **Permission Management Issues:**
    *   **Threat:**  Incorrectly handling or validating user permissions could lead to applications gaining excessive access to user data or functionalities.
    *   **Example:**  Bypassing permission checks or requesting unnecessary permissions.
    *   **Security Requirement Relevance:** Authorization.

**Mitigation Strategies for Login SDK:**

*   **OAuth 2.0 Hardening:**
    *   **Action:**  Strictly enforce best practices for OAuth 2.0 implementation, including using secure redirect URIs (HTTPS and exact match), implementing PKCE (Proof Key for Code Exchange) for public clients, and validating all parameters in the OAuth flow.
    *   **Rationale:** Mitigates common OAuth 2.0 vulnerabilities and ensures secure authentication flows.
*   **Secure Access Token Storage:**
    *   **Action:**  Utilize Android Keystore System for secure storage of access tokens. Encrypt tokens at rest using strong encryption algorithms. Avoid storing tokens in shared preferences or other insecure locations.
    *   **Rationale:** Protects access tokens from unauthorized access even if the device is compromised.
*   **Robust Session Management:**
    *   **Action:**  Use cryptographically strong, unpredictable session identifiers. Implement proper session invalidation upon logout and after a period of inactivity. Consider using short-lived access tokens and refresh tokens.
    *   **Rationale:** Prevents session hijacking and limits the impact of compromised tokens.
*   **Fine-grained Permission Control and Validation:**
    *   **Action:**  Implement clear and well-documented permission request mechanisms.  Validate user-granted permissions rigorously before granting access to Facebook APIs. Follow the principle of least privilege when requesting permissions. Regularly review and update required permissions.
    *   **Rationale:** Ensures applications only access necessary data and functionalities, respecting user privacy and security.

#### 2.3 Share SDK

**Functionality and Data Flow:**

The Share SDK enables users to share content from Android applications to Facebook. Data flow includes:

*   **Content Input:** Receiving content from the Android application to be shared (text, images, links, etc.).
*   **Share Dialogs:** Presenting user interfaces for composing and customizing share content.
*   **Sharing API Calls:** Interacting with Facebook's sharing APIs to publish content on the platform.

**Security Implications and Threats:**

*   **Content Injection Attacks:**
    *   **Threat:**  Improper input validation of content to be shared could allow attackers to inject malicious code or content into Facebook posts.
    *   **Example:**  Cross-site scripting (XSS) vulnerabilities if shared content is rendered in a web context without proper sanitization.
    *   **Security Requirement Relevance:** Input Validation.
*   **Data Leakage through Shared Content:**
    *   **Threat:**  Accidental sharing of sensitive data if the SDK does not properly handle or sanitize user-provided content before sharing.
    *   **Example:**  Sharing debug logs or internal application data along with user-intended content.
    *   **Security Requirement Relevance:** Data Protection, Privacy.
*   **Authorization Bypass for Sharing:**
    *   **Threat:**  Vulnerabilities in authorization checks for sharing actions could allow unauthorized sharing or sharing to unintended audiences.
    *   **Example:**  Sharing content without proper user consent or bypassing privacy settings.
    *   **Security Requirement Relevance:** Authorization.
*   **Clickjacking/UI Redressing in Share Dialogs:**
    *   **Threat:**  If share dialogs are not properly protected, attackers might be able to overlay malicious UI elements and trick users into performing unintended actions (e.g., sharing to a different audience than intended).
    *   **Example:**  Transparent iframes overlaying share buttons to redirect sharing actions.
    *   **Security Requirement Relevance:** UI Security.

**Mitigation Strategies for Share SDK:**

*   **Robust Input Validation and Sanitization for Shared Content:**
    *   **Action:**  Implement strict input validation for all content types accepted by the Share SDK. Sanitize and encode user-provided content before sending it to Facebook's sharing APIs or rendering it in any UI context. Use context-aware output encoding to prevent injection attacks.
    *   **Rationale:** Prevents content injection attacks and ensures the integrity of shared content.
*   **Data Sanitization and Privacy Checks before Sharing:**
    *   **Action:**  Implement checks to prevent accidental sharing of sensitive data.  Provide clear warnings to users if potentially sensitive data is detected in the content to be shared. Offer options to review and edit content before sharing.
    *   **Rationale:** Protects user privacy and prevents unintentional data leaks through sharing.
*   **Enforce Authorization for Sharing Actions:**
    *   **Action:**  Rigorous authorization checks should be performed before allowing any sharing action. Ensure user consent is obtained and privacy settings are respected. Validate permissions before making sharing API calls.
    *   **Rationale:** Prevents unauthorized sharing and respects user privacy preferences.
*   **Clickjacking Protection for Share Dialogs:**
    *   **Action:**  Implement frame busting techniques or Content Security Policy (CSP) headers to prevent clickjacking attacks on share dialogs. Ensure dialogs are rendered in a secure context and are not vulnerable to UI redressing.
    *   **Rationale:** Protects users from being tricked into performing unintended sharing actions.

#### 2.4 Graph API Client

**Functionality and Data Flow:**

The Graph API Client facilitates interaction with the Facebook Graph API. Data flow includes:

*   **API Request Construction:** Building and sending requests to the Facebook Graph API based on application needs.
*   **API Response Handling:** Receiving and parsing responses from the Graph API, including user data, social graph information, etc.
*   **Data Model Management:** Providing data models for representing Graph API entities and data structures.

**Security Implications and Threats:**

*   **API Request Parameter Injection:**
    *   **Threat:**  Improperly constructed API requests with unsanitized parameters could lead to injection attacks on the Facebook Graph API.
    *   **Example:**  SQL injection-like vulnerabilities if the Graph API backend is vulnerable to parameter manipulation.
    *   **Security Requirement Relevance:** Input Validation.
*   **Data Exposure through API Responses:**
    *   **Threat:**  Overly permissive API responses or improper handling of API response data could lead to unintended data exposure within the Android application.
    *   **Example:**  Accidentally exposing sensitive user data in application logs or UI elements.
    *   **Security Requirement Relevance:** Data Protection, Privacy.
*   **Rate Limiting and Abuse:**
    *   **Threat:**  Lack of proper rate limiting or vulnerabilities in rate limiting mechanisms could allow malicious applications to abuse the Graph API, leading to denial-of-service or other issues.
    *   **Example:**  Applications making excessive API requests to exhaust resources or bypass rate limits.
    *   **Security Requirement Relevance:** Availability, API Security.
*   **API Key and Access Token Management in API Requests:**
    *   **Threat:**  Insecure handling of API keys or access tokens when constructing API requests could lead to credential leakage or unauthorized access.
    *   **Example:**  Embedding API keys directly in client-side code or logging access tokens in API requests.
    *   **Security Requirement Relevance:** Authentication, Authorization, Cryptography.

**Mitigation Strategies for Graph API Client:**

*   **Secure API Request Construction:**
    *   **Action:**  Use parameterized API requests to prevent parameter injection vulnerabilities. Implement input validation and sanitization for all API request parameters. Follow secure coding practices when constructing API requests.
    *   **Rationale:** Prevents injection attacks and ensures the integrity of API requests.
*   **Secure API Response Handling and Data Minimization:**
    *   **Action:**  Process API responses securely and minimize the amount of data stored or exposed within the application.  Avoid logging sensitive data from API responses. Follow the principle of least privilege when requesting data from the Graph API.
    *   **Rationale:** Reduces the risk of data exposure and protects user privacy.
*   **Robust Rate Limiting and Abuse Prevention:**
    *   **Action:**  Implement client-side rate limiting to prevent accidental or malicious API abuse.  Work with Facebook to ensure server-side rate limiting is effective and enforced. Monitor API usage patterns for anomalies.
    *   **Rationale:** Protects the Facebook Platform and the SDK from abuse and denial-of-service attacks.
*   **Secure API Key and Access Token Management:**
    *   **Action:**  Never embed API keys directly in client-side code.  Handle access tokens securely as described in the Login SDK section.  Use HTTPS for all API communication. Avoid logging access tokens in API requests.
    *   **Rationale:** Protects API credentials and prevents unauthorized access to Facebook APIs.

### 3. Build and Deployment Security Analysis

#### 3.1 Build Process Security

**Threats and Vulnerabilities:**

*   **Compromised Dependencies:**
    *   **Threat:**  Third-party dependencies used in the SDK build process could contain vulnerabilities or malicious code, which could be incorporated into the SDK.
    *   **Example:**  A compromised library in Maven Central being used by the SDK build.
    *   **Security Posture Relevance:** Accepted risk: Risks associated with third-party dependencies. Recommended control: Enhance supply chain security measures.
*   **Build Environment Compromise:**
    *   **Threat:**  If the CI/CD system or build environment is compromised, attackers could inject malicious code into the SDK during the build process.
    *   **Example:**  An attacker gaining access to the CI/CD system and modifying the build scripts.
    *   **Security Posture Relevance:** Build Diagram - CI/CD System Security Controls.
*   **Lack of Build Artifact Integrity:**
    *   **Threat:**  If build artifacts (AAR files) are not properly signed or their integrity is not verified, developers could download and use tampered or malicious SDK versions.
    *   **Example:**  Man-in-the-middle attacks during SDK download replacing the legitimate AAR with a malicious one.
    *   **Security Posture Relevance:** Build Diagram - Artifacts Security Controls.
*   **Insufficient Security Testing in Build Pipeline:**
    *   **Threat:**  If SAST and other security scans are not comprehensive or properly configured, vulnerabilities might not be detected during the build process.
    *   **Example:**  SAST tools missing certain types of vulnerabilities or not being updated with the latest vulnerability signatures.
    *   **Security Posture Relevance:** Security Posture - Existing control: SAST. Recommended control: DAST, Fuzzing.

**Mitigation Strategies for Build Process:**

*   **Enhanced Dependency Management and Supply Chain Security:**
    *   **Action:**  Implement binary component analysis and provenance checks for all dependencies. Use dependency scanning tools to identify vulnerabilities in dependencies. Regularly update dependencies and apply security patches. Consider using a private Maven repository with stricter control over dependencies.
    *   **Rationale:** Mitigates risks associated with compromised dependencies and strengthens supply chain security.
*   **Secure CI/CD Pipeline and Build Environment:**
    *   **Action:**  Harden the CI/CD system and build environment. Implement strong access controls, secrets management, and regular security audits. Isolate build environments and use immutable infrastructure where possible.
    *   **Rationale:** Protects the build process from compromise and ensures the integrity of the SDK.
*   **Build Artifact Signing and Integrity Verification:**
    *   **Action:**  Digitally sign all SDK build artifacts (AAR files). Provide mechanisms for developers to verify the integrity and authenticity of downloaded SDK artifacts (e.g., checksums, signature verification). Distribute SDK artifacts over HTTPS.
    *   **Rationale:** Ensures developers are using legitimate and untampered SDK versions.
*   **Comprehensive Security Testing in CI/CD Pipeline:**
    *   **Action:**  Integrate DAST, fuzzing, and other security testing techniques into the CI/CD pipeline in addition to SAST. Regularly update security scanning tools and vulnerability signatures. Implement automated vulnerability reporting and tracking.
    *   **Rationale:** Improves vulnerability detection during the build process and reduces the likelihood of releasing vulnerable SDK versions.

#### 3.2 Deployment (Distribution to Developers) Security

**Threats and Vulnerabilities:**

*   **Insecure Distribution Channels:**
    *   **Threat:**  If SDK artifacts are distributed through insecure channels (e.g., HTTP), they could be intercepted and tampered with during download.
    *   **Example:**  Man-in-the-middle attacks replacing the SDK artifact during download from Maven Central.
    *   **Security Posture Relevance:** Build Diagram - Artifact Repository Security Controls.
*   **Compromised Artifact Repository:**
    *   **Threat:**  If the artifact repository (e.g., Maven Central or Facebook's internal repository) is compromised, attackers could replace legitimate SDK artifacts with malicious ones.
    *   **Example:**  An attacker gaining access to Maven Central and uploading a malicious SDK version.
    *   **Security Posture Relevance:** Build Diagram - Artifact Repository Security Controls.
*   **Lack of Developer Awareness and Guidance:**
    *   **Threat:**  If developers are not provided with clear guidance on secure SDK usage and best practices, they might introduce vulnerabilities in their applications when integrating the SDK.
    *   **Example:**  Developers misconfiguring the SDK or not properly handling user data.
    *   **Security Posture Relevance:** Accepted risk: Risks stemming from improper usage of the SDK by developers.

**Mitigation Strategies for Deployment:**

*   **Secure Distribution Channels (HTTPS):**
    *   **Action:**  Ensure SDK artifacts are distributed exclusively over HTTPS.  Encourage developers to use HTTPS for dependency resolution in their build configurations.
    *   **Rationale:** Protects SDK artifacts during download and prevents MITM attacks.
*   **Artifact Repository Security Hardening:**
    *   **Action:**  Implement strong access controls and security measures for the artifact repository. Regularly audit repository security and monitor for suspicious activity. Use multi-factor authentication for repository access.
    *   **Rationale:** Protects the artifact repository from compromise and ensures the integrity of hosted SDK artifacts.
*   **Developer Security Guidance and Best Practices:**
    *   **Action:**  Provide comprehensive security documentation and best practices for developers using the SDK. Include secure coding examples and highlight common security pitfalls. Offer security training and resources for developers.
    *   **Rationale:** Reduces the risk of developer-introduced vulnerabilities and promotes secure SDK integration.

### 4. Overall Risk Assessment and Mitigation Summary

**Critical Business Processes at Risk:**

*   **Secure Distribution of the Facebook Android SDK:** High risk. Compromise could lead to widespread distribution of malicious SDK versions, impacting numerous applications and users.
*   **Integrity and Availability of SDK Codebase and Build Artifacts:** High risk. Loss of integrity or availability would disrupt SDK development and distribution, impacting Facebook's business goals and developer trust.
*   **Confidentiality and Integrity of User Data:** High risk. SDK vulnerabilities leading to data breaches would severely damage Facebook's reputation, user trust, and result in legal and regulatory repercussions.
*   **Continuous Functionality and Reliability of Facebook Integration Features:** Medium risk. SDK vulnerabilities causing instability or functionality issues would lead to developer dissatisfaction and decreased SDK adoption.

**Sensitive Data at Risk:**

*   **User Access Tokens and Credentials:** Highest sensitivity. Compromise would grant attackers access to user accounts and data.
*   **User Profile Information and Social Graph Data:** High sensitivity. Data breaches would violate user privacy and damage Facebook's reputation.
*   **SDK Configuration and Internal Data:** Medium sensitivity. Compromise could aid attackers in reverse engineering or exploiting the SDK.

**Summary of Key Mitigation Recommendations:**

| Area                      | Threat Category                               | Specific Mitigation Strategies                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     