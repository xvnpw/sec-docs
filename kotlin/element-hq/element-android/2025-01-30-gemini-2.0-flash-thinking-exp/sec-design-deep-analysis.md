## Deep Security Analysis of Element Android Application

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to provide a comprehensive evaluation of the Element Android application's security posture based on the provided security design review. The objective is to identify potential security vulnerabilities, weaknesses, and areas for improvement within the application's architecture, components, and development lifecycle.  The analysis will focus on understanding the security implications of key components, data flow, and interactions with the Matrix ecosystem, ultimately leading to actionable and tailored mitigation strategies to enhance the security of Element Android.

**Scope:**

The scope of this analysis encompasses the Element Android application as described in the provided security design review document. This includes:

*   **Application Components:** User Interface (UI), Local Database (LocalDB), Matrix SDK, Push Notification Client (PushClient), and Crypto Library (CryptoLib).
*   **Matrix Ecosystem Interactions:** Interactions with Matrix Homeserver (HS), Identity Server (IS), and Push Notification Service (PS).
*   **Deployment Architecture:** Android application distribution through app stores and direct web download.
*   **Build Process:** CI/CD pipeline, including compilation, testing, SAST, dependency checks, and artifact management.
*   **Security Controls:** Existing, accepted, and recommended security controls as outlined in the design review.
*   **Security Requirements:** Authentication, Authorization, Input Validation, and Cryptography requirements.
*   **Critical Business Processes and Data:** Secure messaging, user account security, data privacy, application availability, and user trust, focusing on the sensitivity of user messages, credentials, profile information, encryption keys, and logs.

The analysis will **not** cover:

*   Detailed code-level vulnerability analysis (e.g., manual code review).
*   Security assessment of the Matrix protocol itself beyond its client-side implementation in Element Android.
*   Infrastructure security of Matrix Homeservers, Identity Servers, or Push Notification Services.
*   User device security beyond its interaction with the Element Android application.

**Methodology:**

This deep security analysis will be conducted using the following methodology:

1.  **Document Review:** Thoroughly review the provided security design review document, including business posture, security posture, design diagrams (C4 Context, Container, Deployment, Build), risk assessment, questions, and assumptions.
2.  **Component-Based Analysis:** Analyze each key component of Element Android (UI, LocalDB, Matrix SDK, PushClient, CryptoLib) and its interactions with the Matrix ecosystem. For each component, we will:
    *   Infer its functionality and data flow based on the design review and general knowledge of Android application architecture and Matrix protocol.
    *   Identify potential security vulnerabilities and threats relevant to the component's function and context.
    *   Evaluate existing and recommended security controls for the component.
    *   Formulate specific security considerations and tailored recommendations.
3.  **Threat Modeling (Implicit):** While not explicitly stated as a formal threat modeling exercise, the analysis will implicitly perform threat modeling by considering potential attack vectors, threat actors, and vulnerabilities based on the component analysis and the nature of a secure messaging application.
4.  **Security Requirement Mapping:** Map the identified security considerations and recommendations back to the security requirements outlined in the design review (Authentication, Authorization, Input Validation, Cryptography) to ensure comprehensive coverage.
5.  **Actionable Mitigation Strategy Development:** For each identified security consideration, develop specific, actionable, and tailored mitigation strategies applicable to Element Android. These strategies will be practical and consider the open-source nature of the project.
6.  **Output Generation:** Compile the analysis findings into a structured report, including:
    *   Objective, Scope, and Methodology.
    *   Component-wise security implications, considerations, recommendations, and mitigations.
    *   Summary of key findings and prioritized recommendations.

### 2. Security Implications of Key Components

#### 2.1 User Interface (UI)

**Security Implications:**

*   **Input Validation Vulnerabilities:** The UI is the primary entry point for user input. Failure to properly validate input can lead to various injection attacks (though less common in mobile apps, consider command injection if UI interacts with native code or external processes, and potential for XSS-like issues if rendering untrusted content within webviews or similar components).
*   **Data Leakage in UI Elements:** Sensitive data displayed in the UI (messages, usernames, etc.) could be unintentionally exposed through logging, screenshots, or accessibility services if not handled carefully.
*   **UI Redressing/Clickjacking (Less Relevant for Native Mobile):** While less of a direct threat in native Android apps compared to web applications, malicious overlays or UI manipulation could potentially trick users into performing unintended actions.
*   **Session Management Issues:** Improper handling of user sessions in the UI could lead to session fixation or hijacking vulnerabilities.
*   **Privacy Leaks through UI Design:** Poorly designed UI elements could inadvertently reveal metadata or information that users might consider private.

**Security Considerations & Recommendations:**

*   **Robust Input Validation:** Implement comprehensive input validation for all user inputs within UI components. While SQL injection is less relevant, focus on preventing command injection if the application interacts with native code or external processes. Sanitize inputs before processing and displaying them.
    *   **Recommendation:** Utilize Android's input validation mechanisms and libraries. Implement whitelisting and blacklisting input validation rules based on expected input types and formats.
*   **Secure Data Handling in UI:** Ensure sensitive data displayed in the UI is handled securely. Avoid logging sensitive data in UI components. Implement proper data masking or redaction where appropriate.
    *   **Recommendation:** Review UI code for accidental logging of sensitive information. Implement UI testing to ensure sensitive data is not inadvertently exposed in screenshots or accessibility services.
*   **Session Management Security:** Implement secure session management practices in the UI. Use secure storage mechanisms for session tokens. Implement proper session timeout and invalidation.
    *   **Recommendation:** Leverage the Matrix SDK's session management capabilities. Ensure proper handling of session tokens and implement UI logic to handle session expiration and re-authentication gracefully.
*   **Privacy-Focused UI Design:** Design UI elements to minimize the risk of unintentional privacy leaks. Clearly indicate data sharing and privacy settings to users.
    *   **Recommendation:** Conduct UI/UX reviews from a privacy perspective. Ensure clear visual cues for end-to-end encryption status and other privacy-related features.

**Actionable Mitigation Strategies:**

*   **Implement Input Validation Framework:** Integrate a consistent input validation framework across all UI components.
*   **Regular UI Code Reviews:** Conduct focused code reviews specifically for UI components, looking for input validation flaws and insecure data handling.
*   **Automated UI Security Testing:** Incorporate UI testing into the CI/CD pipeline to automatically check for basic UI security issues and data exposure.
*   **Privacy-Focused UI/UX Review:** Conduct a dedicated review of the UI/UX design with a focus on privacy implications and potential information leaks.

#### 2.2 Local Database (LocalDB)

**Security Implications:**

*   **Insecure Data Storage:** If the local database is not properly encrypted, sensitive user data (messages, keys, etc.) stored within it could be compromised if the device is lost, stolen, or rooted.
*   **Database Injection (Less Likely but Possible):** While less common in typical mobile app SQLite usage, if dynamic queries are constructed without proper sanitization, database injection vulnerabilities could theoretically be possible.
*   **Database File Access Control:** Improper file permissions on the local database file could allow other malicious applications on the device to access and steal sensitive data.
*   **Data Remnants After Deletion:**  Data might not be securely deleted from the local database, leaving remnants that could be recovered.

**Security Considerations & Recommendations:**

*   **Database Encryption at Rest:**  Encrypt the entire local database at rest to protect sensitive data from unauthorized access on the device.
    *   **Recommendation:** Utilize Android's built-in encryption features for SQLite databases, such as SQLCipher or Android Keystore backed encryption. Ensure strong encryption algorithms are used (e.g., AES-256).
*   **Secure Database Access Control:** Implement strict access control within the application to ensure only authorized components can access the local database.
    *   **Recommendation:** Follow Android's best practices for database access control. Limit database access to the Matrix SDK and necessary components.
*   **Secure Data Deletion:** Implement secure data deletion mechanisms to ensure sensitive data is completely and irrecoverably removed from the local database when users delete messages or accounts.
    *   **Recommendation:** Investigate and implement secure deletion methods for SQLite databases, potentially involving overwriting data blocks.
*   **Regular Security Audits of Database Interactions:** Periodically audit the code that interacts with the local database to ensure secure query construction and prevent potential injection vulnerabilities.
    *   **Recommendation:** Include database interaction code in regular code reviews and SAST scans.

**Actionable Mitigation Strategies:**

*   **Implement Database Encryption:** Prioritize implementing full database encryption at rest using a robust and well-vetted method.
*   **Database Access Control Review:** Review and enforce strict database access control within the application codebase.
*   **Secure Deletion Implementation:** Research and implement secure data deletion practices for the local database.
*   **Database Security Testing:** Include specific test cases in automated testing to verify database encryption and access control mechanisms.

#### 2.3 Matrix SDK

**Security Implications:**

*   **Matrix Protocol Vulnerabilities:** Vulnerabilities in the Matrix protocol itself or its client-side implementation within the SDK could be exploited to compromise communication security.
*   **Cryptographic Implementation Flaws:** Errors in the SDK's cryptographic implementations (even if using underlying crypto libraries) could weaken or break end-to-end encryption.
*   **Authentication and Authorization Bypass:** Vulnerabilities in the SDK's authentication and authorization logic could allow unauthorized access to user accounts or Matrix resources.
*   **Session Management Weaknesses:** Weaknesses in the SDK's session management could lead to session hijacking or fixation attacks.
*   **Denial of Service (DoS) Vulnerabilities:** The SDK might be susceptible to DoS attacks if it doesn't handle malformed Matrix protocol messages or excessive requests properly.
*   **Dependency Vulnerabilities:** The Matrix SDK itself relies on third-party libraries, which could contain vulnerabilities.

**Security Considerations & Recommendations:**

*   **Regular SDK Updates:** Keep the Matrix SDK updated to the latest version to benefit from security patches and bug fixes released by the Matrix SDK project.
    *   **Recommendation:** Implement a process for regularly monitoring and updating the Matrix SDK dependency.
*   **Security Audits of SDK Integration:** Conduct security audits specifically focusing on the integration of the Matrix SDK into Element Android. Ensure proper and secure usage of SDK APIs.
    *   **Recommendation:** Engage security experts with Matrix protocol knowledge to review the SDK integration.
*   **Cryptographic Implementation Review:**  While relying on crypto libraries, review the SDK's usage of these libraries to ensure correct cryptographic protocol implementation and key management.
    *   **Recommendation:**  Consult with cryptography experts to review the SDK's cryptographic aspects, especially key exchange and encryption/decryption processes.
*   **Input Validation and Output Sanitization for Matrix Protocol:** Ensure the SDK properly validates incoming Matrix protocol messages and sanitizes outgoing messages to prevent injection attacks or protocol manipulation.
    *   **Recommendation:** Review the SDK's input validation and output sanitization mechanisms. If possible, contribute to the Matrix SDK project to improve these aspects.
*   **DoS Protection:** Evaluate the SDK's resilience to DoS attacks and implement rate limiting or other mitigation strategies if necessary.
    *   **Recommendation:** Conduct DoS testing against Element Android and the Matrix SDK to assess its resilience.
*   **Dependency Scanning for SDK Dependencies:**  Ensure dependency scanning includes the Matrix SDK's dependencies to identify and mitigate vulnerabilities in third-party libraries used by the SDK.
    *   **Recommendation:** Integrate dependency scanning tools into the CI/CD pipeline that specifically analyze the Matrix SDK's dependencies.

**Actionable Mitigation Strategies:**

*   **Establish SDK Update Process:** Define a clear process for monitoring and updating the Matrix SDK dependency.
*   **SDK Integration Security Audit:** Plan and conduct a security audit focused on the Matrix SDK integration.
*   **Cryptographic Review of SDK Usage:** Engage cryptography expertise to review the SDK's cryptographic aspects.
*   **Contribute to Matrix SDK Security:** Actively participate in the Matrix SDK community and contribute to security improvements and vulnerability fixes.

#### 2.4 Push Notification Client (PushClient)

**Security Implications:**

*   **Information Leakage in Push Notifications:** Push notifications, if not carefully designed, can leak sensitive information in their payloads, potentially exposing message content or user details on the lock screen or notification history.
*   **Push Notification Spoofing/Manipulation:**  While less likely, vulnerabilities in the push notification service or client implementation could potentially allow attackers to spoof or manipulate push notifications.
*   **Unintended Data Exposure through Push Services:** Data transmitted to push notification services (like FCM) might be logged or stored by these services, raising privacy concerns.
*   **Denial of Service through Push Notifications:**  Malicious actors could potentially flood a user's device with push notifications, leading to DoS.

**Security Considerations & Recommendations:**

*   **Minimize Data in Push Notification Payloads:**  Minimize the amount of sensitive data included in push notification payloads. Ideally, push notifications should only indicate that a new message has arrived, without revealing message content.
    *   **Recommendation:**  Refactor push notification payloads to only include minimal information, such as a notification type and room ID, and fetch message content securely within the application upon user interaction.
*   **Secure Communication with Push Notification Services:** Ensure secure communication (HTTPS) between the PushClient and push notification services.
    *   **Recommendation:** Verify that all communication with push notification services is over HTTPS.
*   **Push Notification Payload Validation:** Validate push notification payloads received from push notification services to prevent potential manipulation or injection attacks.
    *   **Recommendation:** Implement server-side validation of push notification requests and client-side validation of received payloads.
*   **Rate Limiting for Push Notifications:** Implement rate limiting on push notifications to mitigate potential DoS attacks through push notification floods.
    *   **Recommendation:** Implement server-side rate limiting for sending push notifications to individual users or devices.
*   **Privacy Review of Push Notification Data Flow:** Conduct a privacy review of the entire push notification data flow, from message origination to delivery on the user device, to identify and mitigate potential privacy risks.
    *   **Recommendation:** Document the push notification data flow and conduct a privacy impact assessment to identify and address potential privacy concerns.

**Actionable Mitigation Strategies:**

*   **Redesign Push Notification Payloads:**  Refactor push notification payloads to minimize data exposure and avoid including sensitive information.
*   **Push Notification Security Review:** Conduct a dedicated security review of the push notification client and its interactions with push notification services.
*   **Implement Push Notification Rate Limiting:** Implement server-side rate limiting for push notifications.
*   **Privacy Impact Assessment for Push Notifications:** Conduct a privacy impact assessment specifically for the push notification feature.

#### 2.5 Crypto Library (CryptoLib)

**Security Implications:**

*   **Cryptographic Vulnerabilities in Libraries:** Even well-vetted crypto libraries can have undiscovered vulnerabilities or be misused, leading to weaknesses in encryption.
*   **Incorrect Cryptographic Implementation:**  Even with secure libraries, incorrect implementation of cryptographic protocols or algorithms can introduce vulnerabilities.
*   **Key Management Issues:** Insecure key generation, storage, or management practices can compromise the entire cryptographic system.
*   **Side-Channel Attacks:** Cryptographic implementations might be vulnerable to side-channel attacks (e.g., timing attacks, power analysis) if not carefully designed and implemented.
*   **Algorithm Choice and Configuration:** Using outdated or weak cryptographic algorithms or incorrect configurations can weaken security.

**Security Considerations & Recommendations:**

*   **Use Well-Vetted and Audited Crypto Libraries:**  Continue using well-vetted and audited cryptographic libraries like libolm and vodozemac.
    *   **Recommendation:**  Stick to established and actively maintained cryptographic libraries. Avoid rolling custom cryptography.
*   **Regular Crypto Library Updates:** Keep crypto libraries updated to the latest versions to benefit from security patches and bug fixes.
    *   **Recommendation:** Implement a process for regularly monitoring and updating crypto library dependencies.
*   **Cryptographic Code Review by Experts:**  Engage cryptography experts to review the code that utilizes crypto libraries, ensuring correct cryptographic protocol implementation and secure key management.
    *   **Recommendation:**  Prioritize cryptographic code reviews by specialists.
*   **Secure Key Generation, Storage, and Management:** Implement robust and secure key generation, storage, and management practices. Utilize secure storage mechanisms provided by the Android platform (e.g., Android Keystore).
    *   **Recommendation:**  Strictly adhere to best practices for key management. Leverage Android Keystore for secure key storage.
*   **Algorithm and Protocol Review:** Regularly review the cryptographic algorithms and protocols used to ensure they are still considered secure and up-to-date.
    *   **Recommendation:**  Periodically review the chosen cryptographic algorithms and protocols against current security standards and recommendations.
*   **Side-Channel Attack Mitigation:** Consider potential side-channel attack vulnerabilities and implement mitigation techniques where applicable, especially for key operations.
    *   **Recommendation:**  Consult with cryptography experts on potential side-channel attack risks and mitigation strategies relevant to the chosen crypto libraries and implementation.

**Actionable Mitigation Strategies:**

*   **Cryptographic Code Review Plan:**  Prioritize and schedule regular cryptographic code reviews by external experts.
*   **Key Management Security Audit:** Conduct a dedicated security audit of key generation, storage, and management practices.
*   **Crypto Algorithm and Protocol Review:**  Schedule periodic reviews of chosen cryptographic algorithms and protocols.
*   **Side-Channel Attack Assessment:**  Assess the application's cryptographic implementations for potential side-channel attack vulnerabilities.

### 3. Architecture, Components, and Data Flow Inference

Based on the provided diagrams and descriptions, the architecture and data flow of Element Android can be inferred as follows:

1.  **User Interaction (UI):** Users interact with the application through the User Interface (UI) to send messages, make calls, manage accounts, and configure settings. User input is validated in the UI.
2.  **Matrix SDK Core Logic:** The UI communicates with the Matrix SDK to perform Matrix protocol operations. The Matrix SDK handles:
    *   **Authentication:** User authentication against Matrix Homeserver using credentials.
    *   **Authorization:** Enforcing access control policies for Matrix resources.
    *   **Matrix Protocol Communication:** Sending and receiving encrypted messages and events over the Matrix protocol to/from the Matrix Homeserver.
    *   **End-to-End Encryption:** Utilizing the Crypto Library for encrypting outgoing messages and decrypting incoming messages. Key management is also handled within the SDK and Crypto Library.
    *   **Local Data Storage:** Interacting with the Local Database to store user data, messages, keys, and application state for offline access and persistence.
3.  **Crypto Library for Encryption:** The Matrix SDK utilizes the Crypto Library (libolm, vodozemac) to perform cryptographic operations, including:
    *   **Key Generation:** Generating cryptographic keys for end-to-end encryption.
    *   **Encryption/Decryption:** Encrypting and decrypting messages using established cryptographic algorithms.
    *   **Key Exchange:** Securely exchanging encryption keys with other users through the Matrix protocol and Identity Server.
4.  **Local Database for Persistence:** The Local Database (SQLite) stores:
    *   **User Data:** Account information, contacts, settings.
    *   **Message History:** Encrypted message history for offline access.
    *   **Encryption Keys:** Securely stored encryption keys.
    *   **Application State:** Application configuration and runtime data.
5.  **Push Notification Client for Real-time Updates:** The Push Notification Client handles push notifications:
    *   **Device Registration:** Registers the device with push notification services (e.g., FCM).
    *   **Notification Reception:** Receives push notifications from push notification services when new messages or events occur.
    *   **Notification Display:** Displays notifications to the user.
6.  **Matrix Ecosystem Interaction:** Element Android interacts with the Matrix ecosystem components:
    *   **Matrix Homeserver (HS):**  Central server for Matrix communication. Element Android communicates with the HS to send and receive messages, join rooms, manage accounts, etc. All communication is encrypted using the Matrix protocol.
    *   **Identity Server (IS):** Used for identity verification and key exchange. Element Android interacts with the IS for user verification and to facilitate secure key exchange for end-to-end encryption.
    *   **Push Notification Service (PS):** External service (e.g., FCM) used to deliver push notifications to Element Android. The Push Notification Client communicates with the PS to receive notifications.

**Data Flow Summary:**

*   **Outgoing Message:** User Input (UI) -> Matrix SDK (Encryption via CryptoLib) -> Matrix Homeserver (Encrypted Matrix Protocol) -> Recipient's Matrix Client.
*   **Incoming Message:** Matrix Homeserver (Encrypted Matrix Protocol) -> Matrix SDK (Decryption via CryptoLib) -> UI (Display to User).
*   **Push Notification:** Matrix Homeserver (Event) -> Push Notification Service -> Push Notification Client -> User Notification (UI).
*   **Data Storage:** Matrix SDK & CryptoLib -> Local Database (Encrypted Data).
*   **Key Exchange:** Matrix SDK -> Identity Server -> Matrix SDK (Secure Key Exchange).

### 4. Specific and Tailored Security Considerations and Recommendations

Based on the component analysis and architecture inference, here are specific and tailored security considerations and recommendations for Element Android:

**General Security Considerations:**

*   **Open-Source Transparency and Community Security:** Leverage the open-source nature of Element Android for security. Encourage community security contributions, bug reports, and code reviews.
    *   **Recommendation:**  Actively engage with the security community. Publicly disclose security vulnerabilities and their resolutions transparently.
*   **Focus on End-to-End Encryption Integrity:** Given the project's emphasis on secure and private communication, prioritize the integrity and robustness of end-to-end encryption.
    *   **Recommendation:**  Continuously invest in security audits and cryptographic reviews of the end-to-end encryption implementation.
*   **Mobile Platform Security Best Practices:** Adhere to Android security best practices throughout the application development lifecycle.
    *   **Recommendation:**  Regularly review and update development practices to align with the latest Android security guidelines.
*   **User Security Awareness:**  Recognize that user behavior is a critical factor in overall security. Provide security awareness guidance to users on best practices for device security and account protection.
    *   **Recommendation:**  Incorporate security tips and best practices within the application's help documentation and onboarding process.

**Specific Recommendations Tailored to Element Android:**

1.  **Formalize Security Incident Response Plan:** Develop and implement a formal security incident response plan specifically for Element Android. This plan should outline procedures for handling security vulnerabilities, data breaches, and other security incidents.
    *   **Recommendation:**  Create a documented incident response plan, including roles, responsibilities, communication protocols, and escalation procedures. Conduct regular incident response drills.

2.  **Regular Penetration Testing:** Conduct regular penetration testing by external security experts with mobile application and Matrix protocol expertise. Focus on runtime vulnerabilities and application logic flaws.
    *   **Recommendation:**  Schedule penetration tests at least annually, or more frequently if significant code changes are introduced. Scope penetration tests to cover all key components and functionalities.

3.  **Bug Bounty Program Implementation:** Implement a public bug bounty program to incentivize security researchers to find and report vulnerabilities in Element Android.
    *   **Recommendation:**  Launch a bug bounty program on a reputable platform. Define clear program scope, rules of engagement, and reward structure.

4.  **Enhanced Security Logging and Monitoring:** Enhance security logging and monitoring within Element Android to detect and respond to security incidents more effectively. Focus on logging security-relevant events without compromising user privacy.
    *   **Recommendation:**  Implement logging for authentication attempts, authorization failures, cryptographic operations, and other security-relevant events. Explore integration with security information and event management (SIEM) systems if feasible.

5.  **Dependency Management and Vulnerability Remediation Process:** Establish a robust dependency management and vulnerability remediation process. Regularly scan dependencies for vulnerabilities and prioritize timely patching or mitigation.
    *   **Recommendation:**  Integrate dependency scanning tools into the CI/CD pipeline. Establish a clear process for triaging, prioritizing, and remediating identified dependency vulnerabilities.

6.  **Multi-Factor Authentication (MFA) Implementation:** Implement multi-factor authentication (MFA) as an optional security feature for user accounts.
    *   **Recommendation:**  Prioritize the implementation of MFA. Support standard MFA methods like TOTP or push notifications. Provide clear user guidance on enabling and using MFA.

7.  **Key Rotation and Management Process:** Define and implement a clear process for managing and rotating cryptographic keys used in Element Android, especially long-term keys.
    *   **Recommendation:**  Document the key lifecycle management process, including key generation, storage, usage, rotation, and revocation. Automate key rotation where possible.

8.  **Compliance Considerations:**  Assess and address relevant compliance requirements, such as GDPR or other data privacy regulations, based on the target user base and data handling practices.
    *   **Recommendation:**  Conduct a compliance assessment to identify applicable regulations. Implement necessary controls and processes to ensure compliance.

9.  **Security Awareness Training for Developers:** Provide regular security awareness training to developers, focusing on secure coding practices, common mobile vulnerabilities, and the specific security considerations for Element Android and the Matrix protocol.
    *   **Recommendation:**  Conduct security training sessions for developers at least annually. Cover topics like OWASP Mobile Top Ten, secure coding guidelines, and Matrix protocol security.

### 5. Actionable and Tailored Mitigation Strategies

| **Identified Threat/Vulnerability Area** | **Specific Mitigation Strategy**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             