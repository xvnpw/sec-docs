## Deep Security Analysis of kernelsu

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to thoroughly evaluate the security posture of kernelsu, a modern root solution for Android, based on its design and intended functionality. The primary objective is to identify potential security vulnerabilities and risks associated with kernelsu's architecture, components, and deployment, and to provide actionable, project-specific recommendations and mitigation strategies to enhance its security.  A key focus will be on analyzing the security implications of the kernel module, userspace tools, and installation process, which are core to kernelsu's operation.

**Scope:**

This analysis encompasses the following aspects of kernelsu, as described in the provided Security Design Review and inferred from typical rooting solution architectures:

* **Kernelsu Components:** Kernel Module, Userspace Tools, and Installation Scripts.
* **Design Architecture:** C4 Context and Container diagrams, focusing on component interactions and data flow.
* **Deployment Model:** Single Device Deployment, considering the build and distribution processes.
* **Security Posture:** Existing and recommended security controls, accepted risks, and security requirements outlined in the review.
* **Build Process:** Security considerations within the build pipeline, including security checks and artifact signing.
* **Risk Assessment:** Critical business processes and sensitive data related to kernelsu and its impact on device security.

This analysis will **not** cover:

* In-depth code review of the kernelsu codebase. This analysis is based on the design review and general understanding of rooting solutions.
* Penetration testing or dynamic analysis of kernelsu.
* Security analysis of the Android kernel or underlying hardware beyond their interaction with kernelsu.
* Comparison with other rooting solutions in detail, except where relevant to highlight specific security considerations.

**Methodology:**

This analysis will employ the following methodology:

1. **Document Review:**  Thorough review of the provided Security Design Review document, including business and security posture, design diagrams, deployment architecture, build process, risk assessment, questions, and assumptions.
2. **Architecture Inference:** Based on the design diagrams and descriptions, infer the detailed architecture, components, and data flow of kernelsu. This will involve understanding how the kernel module and userspace tools interact to achieve root access.
3. **Component-Based Security Analysis:** Break down kernelsu into its key components (Kernel Module, Userspace Tools, Installation Scripts) and analyze the security implications of each component, considering potential threats and vulnerabilities specific to their function and interaction with the Android system.
4. **Threat Modeling (Implicit):**  While not explicitly stated as a formal threat model, the analysis will implicitly consider potential threat actors (malicious apps, attackers exploiting vulnerabilities) and attack scenarios (privilege escalation, data compromise, device instability) relevant to a rooting solution.
5. **Tailored Recommendation and Mitigation Strategy Generation:** Based on the identified security implications and threats, generate actionable and tailored security recommendations and mitigation strategies specifically for kernelsu. These will be practical and relevant to the project's goals and open-source nature.
6. **Alignment with Security Design Review:** Ensure that the recommendations and mitigations align with and expand upon the recommended security controls outlined in the Security Design Review.

### 2. Security Implications of Key Components

Based on the design review and typical rooting solution architectures, the key components of kernelsu and their security implications are analyzed below:

**2.1. Kernel Module:**

* **Functionality:** The kernel module is the core of kernelsu, responsible for providing root access. It likely achieves this by modifying kernel-level permission checks, potentially hooking system calls related to privilege checks (e.g., `capable()`, `cred_has_capability()`), or implementing a custom access control mechanism. It needs to interact directly with the Android kernel to elevate privileges for specific processes.
* **Security Implications:**
    * **Kernel Vulnerabilities:** Any vulnerability in the kernel module itself (e.g., buffer overflows, race conditions, logic errors) could lead to **kernel-level exploits**. This is the most critical security risk as it can compromise the entire device. A compromised kernel module could be leveraged for arbitrary code execution in kernel space, bypassing all security mechanisms.
    * **Privilege Escalation Vulnerabilities:** If the kernel module's privilege escalation mechanism is flawed, it could be exploited by malicious apps to gain root access without proper authorization. This could bypass intended access controls and lead to unauthorized system modifications and data access.
    * **Stability Issues:** Bugs in the kernel module can lead to kernel panics, system crashes, and device instability (bricking). While not directly a security vulnerability in the traditional sense, instability can be exploited for denial-of-service or create conditions for other vulnerabilities to be exploited.
    * **Interaction with Kernel Security Features (SELinux, etc.):**  The kernel module must interact carefully with existing kernel security features like SELinux. Improper integration or bypass of SELinux could weaken the overall security posture of the device, potentially allowing malicious apps to escape sandboxing.
    * **Backdoor Potential:** A malicious or poorly designed kernel module could inadvertently or intentionally act as a backdoor, allowing remote access or control of the device. This is a significant risk if the development process is not secure or if the code is not thoroughly reviewed.

**2.2. Userspace Tools:**

* **Functionality:** Userspace tools are responsible for installing, configuring, and managing kernelsu. They likely include command-line utilities for interacting with the kernel module, managing root access requests, and potentially updating kernelsu components. They act as the interface between the user and the kernel module.
* **Security Implications:**
    * **Input Validation Vulnerabilities:** Userspace tools that accept user input (e.g., commands, configuration parameters) are susceptible to input validation vulnerabilities like command injection, path traversal, and buffer overflows. Exploiting these vulnerabilities could allow attackers to execute arbitrary commands with the privileges of the userspace tools, potentially leading to privilege escalation or system compromise.
    * **Privilege Escalation (Indirect):** While userspace tools should ideally run with minimal privileges, vulnerabilities in them could be chained with kernel module weaknesses to achieve full root access. For example, a vulnerability in a userspace tool could be used to manipulate the kernel module's configuration or trigger a vulnerability in the module itself.
    * **Insecure Communication with Kernel Module:** If userspace tools communicate with the kernel module through an insecure channel (e.g., unprotected file descriptors, predictable IPC mechanisms), this communication could be intercepted or manipulated by malicious apps. This could allow unauthorized control over kernelsu's functionality or the kernel module itself.
    * **Insecure Storage of Configuration Data:** If userspace tools store sensitive configuration data (e.g., access control lists, cryptographic keys) insecurely (e.g., in world-readable files, without encryption), this data could be compromised by malicious apps or attackers with physical access to the device.
    * **TOCTOU (Time-of-Check-Time-of-Use) Vulnerabilities:** In scenarios where userspace tools interact with the file system or other system resources, TOCTOU vulnerabilities could arise. An attacker could potentially modify a resource between the time the userspace tool checks its state and the time it uses it, leading to unexpected or malicious behavior.

**2.3. Installation Scripts:**

* **Functionality:** Installation scripts automate the process of installing kernelsu. This typically involves patching the boot image (e.g., `boot.img`) to include the kernel module and userspace tools, and potentially modifying system partitions. They are crucial for setting up kernelsu on the device.
* **Security Implications:**
    * **Boot Image Corruption:** Errors or vulnerabilities in the installation scripts could lead to corruption of the boot image, potentially rendering the device unbootable (bricked). While primarily a stability issue, it can be exploited for denial-of-service.
    * **Insecure Boot Image Patching:** If the boot image patching process is not secure (e.g., lacks integrity checks, uses insecure tools), it could be vulnerable to tampering. An attacker could potentially inject malicious code into the boot image during the patching process, leading to persistent malware installation at the kernel level.
    * **Insecure Distribution of Installation Scripts:** If the installation scripts are distributed through insecure channels (e.g., unencrypted HTTP, untrusted sources), they could be intercepted and modified by attackers. This could lead to users installing compromised versions of kernelsu containing malware.
    * **Lack of Rollback Mechanisms:** If the installation process lacks robust rollback mechanisms, users may be unable to recover from failed or problematic installations, potentially leading to device instability or data loss.
    * **Privilege Escalation during Installation:** Installation scripts often require elevated privileges (e.g., `adb root`, bootloader unlocking). Vulnerabilities in these scripts could be exploited to gain unauthorized root access during the installation process itself, even before kernelsu is fully functional.

### 3. Architecture, Components, and Data Flow Inference

Based on the design review and the nature of rooting solutions, we can infer the following architecture, components, and data flow for kernelsu:

**3.1. Architecture:**

Kernelsu adopts a modular architecture with two primary components:

* **Kernel Module (Core):**  This is the central component, loaded into the Android kernel at boot. It's responsible for the core root functionality:
    * **Privilege Escalation Engine:** Implements the logic to grant root privileges to authorized processes. This might involve hooking kernel functions, modifying permission checks, or using a custom access control mechanism.
    * **Access Control Policy Enforcement:** Defines and enforces policies for granting root access. This could be based on process UID/GID, application signatures, or user-defined rules.
    * **Communication Interface:** Provides a secure interface (e.g., ioctl, procfs, sysfs) for userspace tools to interact with the kernel module and manage root access.

* **Userspace Tools (Management & Interface):** These tools run in Android userspace and provide the user interface for managing kernelsu:
    * **`ksu` Command-Line Tool:**  A primary command-line utility for users to request root access, manage modules (if any), and configure kernelsu.
    * **Installation/Uninstallation Scripts:** Scripts to automate the installation and removal of kernelsu components, including boot image patching and file system modifications.
    * **Configuration Management:** Tools to manage kernelsu's configuration, such as access control policies, module settings, and update preferences.
    * **Communication Client:**  Clients that communicate with the kernel module through the defined interface to request root access and manage kernelsu.

**3.2. Data Flow (Simplified Root Access Request):**

1. **User Application Requests Root:** An application running in userspace requires root privileges.
2. **Application Invokes `ksu` or Kernelsu API:** The application might use a library or directly invoke the `ksu` command-line tool to request root access.
3. **Userspace Tool Communicates with Kernel Module:** The `ksu` tool or library communicates with the kernelsu kernel module through a defined interface (e.g., ioctl). This communication likely includes the requesting process's UID/PID and potentially other identifying information.
4. **Kernel Module Enforces Access Control Policy:** The kernel module receives the request and checks it against its configured access control policy. This policy determines whether to grant root access based on factors like the requesting process, user configuration, etc.
5. **Kernel Module Grants/Denies Root Access:** Based on the policy, the kernel module either grants root privileges to the requesting process (e.g., by modifying its credentials or capabilities) or denies the request.
6. **Application Operates with Root Privileges (if granted):** If root access is granted, the application can now perform actions requiring elevated privileges.

**3.3. Component Interaction Diagram (Simplified):**

```mermaid
flowchart LR
    subgraph "Android Userspace"
        A[User Application]
        B[ksu Userspace Tool]
    end
    subgraph "Android Kernel"
        C[kernelsu Kernel Module]
        D[Android Kernel Core]
    end
    A --> B{Request Root Access}
    B --> C{Communicate via Interface (ioctl, etc.)}
    C --> D{Enforce Access Control Policy, Grant/Deny Root}
    C --> B{Response (Grant/Deny)}
    B --> A{Response to Application}
    style C fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#f9f,stroke:#333,stroke-width:2px
```

### 4. Specific Security Recommendations for kernelsu

Based on the identified security implications and the project's context, here are specific and actionable security recommendations for kernelsu:

**4.1. Kernel Module Security Hardening:**

* **Recommendation 1: Implement Robust Input Validation in Kernel Module:**  Thoroughly validate all inputs received by the kernel module from userspace tools and the kernel itself. This includes validating data types, sizes, ranges, and formats to prevent buffer overflows, integer overflows, and other input-related vulnerabilities. **Mitigation Strategy:** Use safe coding practices in kernel module development, leverage kernel's input validation APIs where available, and perform rigorous testing with fuzzing tools specifically targeting the kernel module's interfaces.
* **Recommendation 2: Apply Least Privilege Principle within Kernel Module:** Design the kernel module to operate with the minimum necessary privileges within the kernel. Avoid unnecessary kernel API usage and minimize the module's footprint in the kernel space. **Mitigation Strategy:**  Carefully review the kernel module's code to identify and eliminate any unnecessary privileges or functionalities. Implement fine-grained access control within the module itself to limit its capabilities.
* **Recommendation 3: Conduct Kernel Module Specific Static Analysis:** Utilize static analysis tools specifically designed for kernel module code to identify potential vulnerabilities like memory leaks, race conditions, and null pointer dereferences. **Mitigation Strategy:** Integrate kernel-specific SAST tools into the build pipeline and regularly analyze the kernel module code for identified issues. Address all high and medium severity findings.
* **Recommendation 4: Implement Kernel Module Code Review by Security Experts:**  Engage security experts with kernel development experience to conduct thorough code reviews of the kernel module. Focus on identifying potential vulnerabilities, design flaws, and areas for security improvement. **Mitigation Strategy:**  Prioritize security-focused code reviews for the kernel module, especially for critical sections like privilege escalation and access control logic.

**4.2. Userspace Tools Security:**

* **Recommendation 5: Implement Strict Input Validation in Userspace Tools:**  Apply rigorous input validation to all user inputs and data received by userspace tools. Sanitize and validate all command-line arguments, configuration file entries, and data received from the kernel module. **Mitigation Strategy:** Use input validation libraries and frameworks, implement whitelisting and blacklisting for inputs, and perform fuzzing and penetration testing on userspace tools to identify input validation vulnerabilities.
* **Recommendation 6: Secure Communication Channel between Userspace Tools and Kernel Module:**  Establish a secure and authenticated communication channel between userspace tools and the kernel module. Avoid relying on insecure IPC mechanisms. **Mitigation Strategy:** Explore using secure kernel interfaces like netlink sockets with appropriate access controls or dedicated secure ioctl interfaces with authentication mechanisms. Encrypt communication if sensitive data is exchanged.
* **Recommendation 7: Minimize Privileges of Userspace Tools:**  Design userspace tools to run with the lowest possible privileges. Avoid running them as root unless absolutely necessary. Implement privilege separation where possible, dividing functionalities into separate tools with minimal privileges. **Mitigation Strategy:**  Refactor userspace tools to minimize root privileges. Utilize capabilities or other privilege management mechanisms to grant only necessary permissions.
* **Recommendation 8: Secure Storage of Configuration Data:**  If userspace tools store sensitive configuration data, ensure it is stored securely. Use encryption for sensitive data at rest and implement proper access controls to prevent unauthorized access. **Mitigation Strategy:**  Encrypt configuration files using strong encryption algorithms. Store encryption keys securely and implement access controls to limit access to configuration data.

**4.3. Installation Script Security:**

* **Recommendation 9: Implement Integrity Checks for Installation Scripts and Artifacts:**  Digitally sign installation scripts and all release artifacts (kernel module, userspace tools). Verify signatures before execution and installation to ensure integrity and prevent tampering. **Mitigation Strategy:**  Use strong cryptographic signatures (e.g., GPG) for all release artifacts. Provide users with clear instructions on how to verify signatures before installation.
* **Recommendation 10: Secure Boot Image Patching Process:**  Ensure the boot image patching process is secure and robust. Implement checksums and integrity checks for the patched boot image to detect corruption or tampering. **Mitigation Strategy:**  Use well-vetted and secure boot image patching tools. Implement checksum verification at each stage of the patching process. Consider using verified boot mechanisms if feasible.
* **Recommendation 11: Implement Rollback Mechanism for Installation:**  Develop a robust rollback mechanism for the installation process. In case of installation failure or errors, provide users with a clear and easy way to revert to the previous state and recover their device. **Mitigation Strategy:**  Create backups of critical partitions before installation. Implement scripts to restore backups in case of installation failure. Provide clear documentation on the rollback process.
* **Recommendation 12: Distribute Installation Scripts and Artifacts Securely:**  Distribute installation scripts and release artifacts through secure channels (HTTPS). Host them on trusted platforms and provide checksums and signature verification to ensure authenticity. **Mitigation Strategy:**  Use HTTPS for all downloads. Host releases on reputable platforms like GitHub Releases. Clearly communicate checksums and signature verification instructions to users.

**4.4. General Security Practices:**

* **Recommendation 13: Establish a Formal Vulnerability Disclosure and Response Process:**  Create a clear and publicly documented process for users and security researchers to report vulnerabilities. Establish a dedicated security team or point of contact to handle vulnerability reports, triage them, and develop and release security updates promptly. **Mitigation Strategy:**  Publish a security policy with contact information and vulnerability reporting guidelines. Use a vulnerability tracking system to manage reported issues. Prioritize and expedite security updates.
* **Recommendation 14: Conduct Regular Security Audits and Penetration Testing:**  Engage external security experts to conduct regular security audits and penetration testing of kernelsu. Focus on identifying vulnerabilities in all components, including the kernel module, userspace tools, and installation process. **Mitigation Strategy:**  Schedule regular security audits and penetration tests. Address all identified vulnerabilities based on severity and impact.
* **Recommendation 15: Enhance Automated Security Testing:**  Expand automated security testing beyond SAST and DAST. Integrate fuzzing, dependency vulnerability scanning, and runtime security monitoring into the development and CI/CD pipeline. **Mitigation Strategy:**  Incorporate fuzzing tools to test input validation and robustness. Use dependency scanning tools to identify vulnerable dependencies. Implement runtime security monitoring to detect anomalies and potential attacks.
* **Recommendation 16: Provide Comprehensive Security Documentation and User Warnings:**  Create clear and comprehensive documentation detailing the security risks associated with rooting and using kernelsu. Provide users with best practices for mitigating these risks and using root access responsibly. Include prominent warnings about the inherent security risks of rooting. **Mitigation Strategy:**  Develop detailed security documentation covering risks, mitigations, and responsible root usage. Display clear warnings during installation and in user documentation.
* **Recommendation 17: Implement Secure Build Pipeline:**  Harden the build pipeline to prevent supply chain attacks. Secure the build environment, implement access controls, and ensure the integrity of build tools and dependencies. **Mitigation Strategy:**  Use secure build environments. Implement access controls to the build system. Regularly audit build dependencies and tools for vulnerabilities.

### 5. Tailored Mitigation Strategies Applicable to Identified Threats

Here are tailored mitigation strategies applicable to specific threats identified in the analysis:

| Threat                                      | Applicable Mitigation Strategies (Tailored to kernelsu)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              