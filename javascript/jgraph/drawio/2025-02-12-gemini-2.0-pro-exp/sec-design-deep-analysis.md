Okay, let's perform a deep security analysis of draw.io based on the provided design review.

**1. Objective, Scope, and Methodology**

*   **Objective:**  The primary objective is to conduct a thorough security analysis of the draw.io application, focusing on its key components, data flows, and interactions with external services.  This analysis aims to identify potential vulnerabilities, assess their impact, and propose specific, actionable mitigation strategies.  We will pay particular attention to the client-side nature of much of draw.io's functionality and the implications of its integrations.  The analysis will cover aspects of confidentiality, integrity, and availability.

*   **Scope:** The scope includes the following:
    *   The core draw.io web application (as described in the C4 diagrams).
    *   The desktop application (Electron-based) to the extent that it shares code and functionality with the web version.
    *   The documented integrations with third-party services (Google Drive, OneDrive, GitHub, Dropbox, Confluence, Jira).
    *   The build process and deployment model (as described).
    *   The identified existing and recommended security controls.

    The scope *excludes* the security infrastructure of the third-party services themselves (e.g., Google's internal security). We assume these services are reasonably secure and focus on draw.io's *interaction* with them.  We also exclude a deep dive into the specific cryptographic implementations *within* those services.

*   **Methodology:**
    1.  **Architecture Review:** Analyze the C4 diagrams and deployment diagrams to understand the system's structure, components, and data flows.
    2.  **Threat Modeling:**  Based on the architecture and identified business risks, we will identify potential threats using a combination of STRIDE (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) and attack trees.
    3.  **Codebase Inference:**  Since we don't have direct access to the full codebase, we will infer security-relevant aspects from the provided information, the GitHub repository's structure, public documentation, and known characteristics of similar applications.
    4.  **Vulnerability Analysis:**  Identify potential vulnerabilities based on the threat model and architectural review.
    5.  **Mitigation Recommendations:**  Propose specific, actionable mitigation strategies for each identified vulnerability, tailored to draw.io's architecture and technology stack.

**2. Security Implications of Key Components**

Let's break down the security implications of each key component, focusing on potential threats and vulnerabilities:

*   **Web UI (Browser-based):**
    *   **Threats:** XSS (Cross-Site Scripting), CSRF (Cross-Site Request Forgery), UI Redressing (Clickjacking), Open Redirects, malicious extensions.
    *   **Vulnerabilities:**
        *   Insufficiently strict CSP:  A misconfigured CSP could allow attackers to inject malicious scripts.  draw.io's CSP needs to be carefully crafted to allow necessary functionality (e.g., loading scripts from CDNs, connecting to integrated services) while blocking potentially harmful actions.
        *   Lack of `HttpOnly` and `Secure` flags on cookies (if any are used):  This could allow attackers to steal cookies via XSS.
        *   Vulnerable JavaScript libraries:  Outdated or vulnerable third-party libraries used in the UI could be exploited.
        *   Insufficient validation of URLs before opening them in new tabs/windows.
    *   **Mitigation:**
        *   **Strict CSP:**  Regularly review and update the CSP to ensure it's as restrictive as possible while maintaining functionality.  Use a CSP evaluator tool.  Specifically, ensure that `script-src`, `connect-src`, `img-src`, `style-src`, and `frame-src` are tightly controlled.
        *   **Cookie Security:**  If cookies are used, ensure they are set with the `HttpOnly` and `Secure` flags.  Consider using the `SameSite` attribute to mitigate CSRF.
        *   **Dependency Management:**  Continuously monitor and update JavaScript libraries.  Use tools like `npm audit` or `yarn audit` to identify known vulnerabilities.  Consider using a Software Composition Analysis (SCA) tool as part of the CI/CD pipeline.
        *   **URL Validation:** Before opening any user-provided URL, validate it against a strict allowlist of known safe domains (e.g., the domains of integrated services).  Avoid using `target="_blank"` without `rel="noopener noreferrer"` to prevent tabnabbing attacks.

*   **Diagram Editor (JavaScript Library):**
    *   **Threats:**  XSS, DOM-based XSS, Prototype Pollution, Denial of Service (resource exhaustion), Malicious Diagram Data.
    *   **Vulnerabilities:**
        *   Improper handling of user-supplied data within the diagram:  If diagram data (e.g., text, attributes, embedded objects) is not properly sanitized before being rendered in the DOM, it could lead to XSS attacks.  This is *critical* for draw.io.
        *   Vulnerable parsing of diagram file formats (e.g., XML, SVG):  Exploitable vulnerabilities in the parsing logic could allow attackers to inject malicious code or cause a denial of service.
        *   Prototype Pollution vulnerabilities in JavaScript libraries used for diagram manipulation.
        *   Excessive memory allocation or CPU usage triggered by maliciously crafted diagrams.
    *   **Mitigation:**
        *   **Input Sanitization:**  Implement *rigorous* input sanitization for *all* data that is part of a diagram.  This includes text content, attributes, URLs, and any embedded objects.  Use a well-vetted sanitization library (e.g., DOMPurify) and configure it to be as restrictive as possible.  Sanitize *before* the data is used to construct the DOM.
        *   **Secure Parsing:**  Use secure XML and SVG parsers.  Avoid custom parsing logic where possible.  If custom parsing is necessary, thoroughly test it for vulnerabilities, including fuzzing.  Consider using a parser that is specifically designed for security (e.g., a parser with built-in defenses against XML External Entity (XXE) attacks).
        *   **Prototype Pollution Protection:**  Use libraries that are known to be resistant to prototype pollution.  Consider using techniques like object freezing or defensive copying to prevent modification of built-in prototypes.
        *   **Resource Limits:**  Implement limits on the size and complexity of diagrams that can be loaded and rendered.  This can help prevent denial-of-service attacks that attempt to exhaust memory or CPU resources.  Monitor memory usage and CPU utilization during diagram rendering.
        *   **Sandboxing:** The existing sandboxing (mentioned in the security review) is crucial.  Ensure that the sandbox is properly configured and enforced.  Consider using a Web Worker to isolate the diagram rendering process from the main browser thread. This can limit the impact of any exploits.

*   **File Handler (JavaScript Component):**
    *   **Threats:**  Path Traversal, Malicious File Upload, Data Leakage.
    *   **Vulnerabilities:**
        *   Improper validation of file names and paths:  If file names or paths are not properly validated, an attacker might be able to read or write files outside of the intended directory (path traversal).  This is less of a concern in the browser context but *very* relevant for the Electron desktop application.
        *   Loading malicious files disguised as diagrams:  An attacker could upload a file that is not a valid diagram but contains malicious code that exploits a vulnerability in the file handling logic.
        *   Data leakage during file operations:  Sensitive data (e.g., API keys, tokens) could be accidentally exposed during file operations.
    *   **Mitigation:**
        *   **Path Validation (Electron):**  In the Electron desktop application, *strictly* validate file paths before using them in any file system operations.  Use a whitelist approach, allowing only specific file extensions and directories.  Avoid using user-supplied data directly in file paths.  Use the `path` module's functions (e.g., `path.normalize`, `path.resolve`) to ensure paths are safe.
        *   **File Type Validation:**  Validate the *content* of uploaded files, not just the file extension.  Use a library that can identify the file type based on its magic bytes or other content-based analysis.  Do not rely solely on the file extension.
        *   **Secure Data Handling:**  Avoid storing sensitive data (e.g., API keys, tokens) directly in diagram files.  If sensitive data must be stored, encrypt it using a strong encryption algorithm.

*   **Service Integrations (JavaScript Component):**
    *   **Threats:**  OAuth 2.0 Flow Hijacking, Token Leakage, Man-in-the-Middle (MitM) Attacks, CSRF.
    *   **Vulnerabilities:**
        *   Improper implementation of OAuth 2.0 flows:  Vulnerabilities in the OAuth 2.0 implementation could allow attackers to intercept authorization codes or access tokens.
        *   Exposure of API keys or tokens:  If API keys or tokens are hardcoded in the client-side code or exposed in network requests, they could be stolen by attackers.
        *   Lack of HTTPS or improper certificate validation:  This could allow MitM attacks.
        *   CSRF vulnerabilities in the integration endpoints.
    *   **Mitigation:**
        *   **Secure OAuth 2.0 Implementation:**  Follow the OAuth 2.0 best practices *strictly*.  Use a well-vetted OAuth 2.0 library.  Validate the `state` parameter to prevent CSRF attacks.  Use the PKCE (Proof Key for Code Exchange) extension for added security.  Ensure that the redirect URI is properly validated and matches the registered redirect URI.
        *   **Token Management:**  *Never* hardcode API keys or tokens in the client-side code.  Store them securely.  For the web application, this means relying on the backend (if any) or the integrated service's token management.  For the Electron application, use a secure storage mechanism (e.g., the operating system's keychain or a secure storage library).
        *   **HTTPS and Certificate Validation:**  Use HTTPS for *all* communication with external services.  Ensure that the client properly validates the server's certificate.  Do not disable certificate validation.
        *   **CSRF Protection:**  Implement CSRF protection for any endpoints that handle sensitive operations (e.g., saving a diagram to a cloud storage service).  Use standard CSRF protection techniques (e.g., synchronizer tokens).

* **Electron Desktop Application:**
    * **Threats:** All threats applicable to the web application, plus: Local File System Access, Node.js Integration Vulnerabilities, Unsigned Code Execution.
    * **Vulnerabilities:**
        * **Node.js Integration:** If `nodeIntegration` is enabled in Electron, it grants the renderer process access to Node.js APIs, significantly increasing the attack surface.  Malicious code injected via XSS could then execute arbitrary code on the user's system.
        * **Context Isolation:** If `contextIsolation` is not enabled, the renderer process and the main process share the same context, making it easier for exploits to escalate privileges.
        * **Unsigned Code:** If the application is not properly signed, users might be tricked into running a modified, malicious version.
        * **Insecure `webPreferences`:** Misconfigured `webPreferences` can expose the application to various attacks.
    * **Mitigation:**
        * **Disable `nodeIntegration`:**  Set `nodeIntegration: false` in the `webPreferences` of the `BrowserWindow`. This is the *most important* security measure for Electron applications.
        * **Enable `contextIsolation`:** Set `contextIsolation: true` in the `webPreferences`. This isolates the renderer process from the main process, limiting the impact of exploits.
        * **Use `preload` scripts:** Use `preload` scripts to expose only the necessary Node.js APIs to the renderer process in a controlled manner.  Communicate between the renderer and main processes using IPC (Inter-Process Communication).
        * **Code Signing:**  Digitally sign the Electron application to ensure its authenticity and integrity.
        * **Secure `webPreferences`:**  Review and configure the `webPreferences` carefully.  Disable features that are not needed (e.g., `webviewTag`, `experimentalFeatures`).  Set `sandbox: true` to further restrict the renderer process.
        * **Content Security Policy:** Use a strict CSP within the Electron application, just like in the web version.

**3. Inferred Architecture, Components, and Data Flow**

Based on the provided information, we can infer the following:

*   **Client-Side Focus:**  draw.io heavily relies on client-side JavaScript for its core functionality.  This means that most of the diagram rendering, editing, and file handling happens within the user's browser.
*   **Stateless Backend (Likely):**  The web application likely has a minimal backend, primarily serving static files (HTML, CSS, JavaScript).  The backend might also handle some API requests related to service integrations, but it likely does not store or process diagram data directly.
*   **Data Flow:**
    1.  The user interacts with the Web UI.
    2.  The Web UI sends events to the Diagram Editor.
    3.  The Diagram Editor renders the diagram and handles user input.
    4.  The File Handler manages saving and loading diagrams.
    5.  For cloud storage, the File Handler interacts with the Service Integrations component.
    6.  The Service Integrations component communicates with external services (e.g., Google Drive) using OAuth 2.0.
    7.  Diagram data is stored either locally (in the browser or on the user's file system) or in the user's cloud storage account.

**4. Specific Security Considerations and Recommendations**

Here are specific security considerations and recommendations, tailored to draw.io:

*   **XSS is the Primary Threat:**  Given the client-side nature of draw.io and the extensive use of user-supplied data in diagrams, XSS is the most significant threat.  The mitigation strategies outlined above (strict CSP, rigorous input sanitization, secure parsing, etc.) are *crucial*.

*   **Diagram Data Sanitization is Paramount:**  The most critical area for input sanitization is the handling of diagram data.  *Every* piece of data that comes from the user or a loaded diagram file must be treated as potentially malicious and sanitized before being used to construct the DOM.  This includes:
    *   Text content within shapes.
    *   Shape attributes (e.g., colors, styles, IDs).
    *   URLs embedded in diagrams.
    *   Embedded objects (e.g., images, iframes).
    *   Custom XML or SVG data.

*   **Electron Security is Critical:**  If the Electron desktop application is widely used, it requires *special attention*.  The recommendations above (disabling `nodeIntegration`, enabling `contextIsolation`, using `preload` scripts, code signing) are *essential* to prevent remote code execution vulnerabilities.

*   **OAuth 2.0 Implementation Must Be Flawless:**  The security of the integrations with cloud storage services depends entirely on the correct implementation of OAuth 2.0.  Any mistakes in the OAuth 2.0 flow could allow attackers to steal user data or gain access to their accounts.

*   **Regular Security Audits and Penetration Testing:**  Given the complexity of draw.io and the potential for vulnerabilities, regular security audits and penetration testing are *highly recommended*.  These should be performed by experienced security professionals.

*   **Vulnerability Disclosure Program (VDP):**  A VDP is essential for encouraging responsible reporting of security vulnerabilities.  This should be clearly advertised and easy to use.

*   **Dependency Management:**  A robust dependency management process is crucial.  This includes:
    *   Using tools like `npm audit` or `yarn audit` to identify known vulnerabilities in dependencies.
    *   Regularly updating dependencies to the latest versions.
    *   Using a Software Composition Analysis (SCA) tool as part of the CI/CD pipeline.
    *   Considering the use of dependency pinning to prevent unexpected changes in dependencies.

*   **Logging and Monitoring:** Implement logging to track security-relevant events, such as:
    *   Failed login attempts (to integrated services).
    *   Errors related to OAuth 2.0 flows.
    *   CSP violations.
    *   Exceptions during diagram parsing.
    *   File access events (in the Electron application).
    Monitor these logs for suspicious activity.

* **Addressing Assumptions:**
    * **Cloud Provider Security:** While we assume the cloud provider is secure, verify that the specific services used (e.g., load balancers, web servers, CDN) are configured securely. Use the cloud provider's security best practices and tools.
    * **CI/CD Pipeline Security:** Ensure the CI/CD pipeline itself is secure. Limit access to the pipeline, use strong authentication, and regularly review the pipeline configuration.
    * **Developer Training:** Confirm that developers are trained in secure coding practices, particularly regarding XSS prevention and secure handling of user input.
    * **Regular Updates:** Establish a clear process for applying security updates to the application and its dependencies. Automate this process as much as possible.

**5. Actionable Mitigation Strategies (Summary)**

This table summarizes the key vulnerabilities and actionable mitigation strategies:

| Vulnerability Category          | Specific Vulnerability                                                                                                                               | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   