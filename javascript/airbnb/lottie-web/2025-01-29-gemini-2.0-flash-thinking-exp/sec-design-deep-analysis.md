## Deep Security Analysis of Lottie-web Library

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to thoroughly evaluate the security posture of the Lottie-web library, a Javascript library for rendering After Effects animations on the web. The primary objective is to identify potential security vulnerabilities and risks associated with the library's architecture, components, and data flow, focusing on client-side security implications. This analysis will provide actionable and tailored security recommendations and mitigation strategies to enhance the security of the Lottie-web library and its integration into web applications.

**Scope:**

The scope of this analysis encompasses the following key areas based on the provided Security Design Review document:

*   **Lottie-web Library Components:**  Analysis of the Animation Parser, Lottie Renderer, and Animation API containers within the Lottie-web library.
*   **Animation JSON Files:** Examination of the security risks associated with processing and rendering animation JSON files, including potential input validation vulnerabilities.
*   **Deployment Architecture:** Review of the client-side deployment model, including the role of CDNs in delivering the library and animation files.
*   **Build Process:** Assessment of the security of the GitHub Actions-based build process, focusing on supply chain risks and opportunities for automated security controls.
*   **Data Flow:** Analysis of the data flow from animation designers to web applications, identifying potential points of vulnerability.
*   **Identified Security Requirements and Controls:**  Evaluation of the effectiveness of existing and recommended security controls, particularly input validation.

The analysis will **not** cover:

*   Security of the After Effects and Bodymovin/Lottie plugin ecosystem used to create animation files.
*   Detailed code-level vulnerability analysis (penetration testing or in-depth code review). This analysis is based on the design review documentation and inferred architecture.
*   Security of specific web applications that integrate Lottie-web, beyond their interaction with the library itself.
*   Performance optimization aspects, except where they directly relate to security (e.g., resource exhaustion DoS).

**Methodology:**

This analysis will employ the following methodology:

1.  **Architecture Deconstruction:** Based on the provided C4 Context, Container, Deployment, and Build diagrams, we will deconstruct the architecture of the Lottie-web ecosystem, identifying key components, data flows, and interactions.
2.  **Threat Modeling:** For each key component and data flow, we will perform threat modeling to identify potential security vulnerabilities and risks. This will be guided by common client-side web security threats, supply chain risks, and the specific context of animation rendering. We will consider threats like XSS, DoS, and malicious input processing.
3.  **Risk Assessment:** We will assess the likelihood and impact of the identified threats based on the project's business and security posture, accepted risks, and the nature of the Lottie-web library.
4.  **Security Control Analysis:** We will analyze the existing and recommended security controls outlined in the Security Design Review, evaluating their effectiveness and identifying gaps.
5.  **Recommendation and Mitigation Strategy Development:** Based on the threat modeling and risk assessment, we will develop specific, actionable, and tailored security recommendations and mitigation strategies for the Lottie-web project. These recommendations will be practical and directly applicable to the library and its development lifecycle.

### 2. Security Implications of Key Components

Based on the provided documentation and diagrams, we can break down the security implications of each key component:

**2.1. Web Application:**

*   **Security Implications:**
    *   **XSS Vulnerabilities:** If the web application does not properly implement Content Security Policy (CSP) or sanitize inputs and outputs in other parts of the application, vulnerabilities could be exploited through maliciously crafted animation files. While Lottie-web itself should prevent XSS, vulnerabilities in the surrounding application can still be triggered.
    *   **Dependency Management:** The web application depends on Lottie-web. If the application uses an outdated or vulnerable version of Lottie-web, it inherits those vulnerabilities.
    *   **Misconfiguration:** Incorrect implementation of Lottie-web API or improper handling of animation files within the web application can lead to unexpected behavior or security issues.
*   **Specific Security Considerations for Lottie-web Context:**
    *   **CSP Implementation:** Web applications must implement a strict CSP that restricts script sources and other potentially dangerous directives to mitigate XSS risks, even if Lottie-web is secure.
    *   **Animation File Origin:** Applications should carefully consider the origin of animation JSON files. Fetching animations from untrusted sources increases the risk of malicious files.
    *   **API Misuse:** Developers need clear guidance on the secure usage of the Lottie-web API to avoid introducing vulnerabilities through incorrect integration.

**2.2. Lottie-web Library:**

*   **2.2.1. Animation Parser:**
    *   **Security Implications:**
        *   **Input Validation Vulnerabilities:** The parser is the entry point for animation data. Lack of robust input validation on the JSON structure and data can lead to various vulnerabilities:
            *   **Cross-Site Scripting (XSS):** Processing malicious JSON that injects or manipulates DOM elements in unintended ways.
            *   **Denial of Service (DoS):**  Processing excessively large or complex JSON files that consume excessive resources (CPU, memory), leading to browser crashes or performance degradation.
            *   **Prototype Pollution:**  If the parser improperly handles JSON properties, it could potentially lead to prototype pollution vulnerabilities, affecting the application's behavior.
            *   **Arbitrary Code Execution (Less likely in browser context, but consider edge cases):** In extremely rare scenarios, parser vulnerabilities could theoretically be exploited to execute code, although highly improbable in a modern browser sandbox.
        *   **JSON Parsing Vulnerabilities:**  Underlying JSON parsing libraries (if used directly and not browser's native JSON) might have vulnerabilities.
    *   **Specific Security Considerations for Lottie-web Context:**
        *   **Schema Validation:** Implement strict JSON schema validation to ensure animation files conform to the expected structure and data types.
        *   **Data Sanitization and Range Checks:** Sanitize and validate animation data values (e.g., colors, sizes, paths) to prevent unexpected behavior or exploits.
        *   **Resource Limits:** Implement limits on the complexity and size of animation files to prevent DoS attacks.
        *   **Error Handling:** Implement robust error handling to gracefully handle invalid or malicious JSON files without crashing or exposing sensitive information.

*   **2.2.2. Lottie Renderer:**
    *   **Security Implications:**
        *   **Rendering Engine Vulnerabilities:**  Bugs in the rendering logic could potentially be exploited, although less likely to be direct security vulnerabilities and more likely to cause rendering errors or crashes.
        *   **Resource Exhaustion:** Rendering overly complex animations could lead to resource exhaustion and DoS on the client-side.
        *   **Browser API Exploits:**  While less likely, vulnerabilities in the browser's Canvas, SVG, or HTML APIs used for rendering could be indirectly triggered by specific animation structures.
    *   **Specific Security Considerations for Lottie-web Context:**
        *   **Secure Coding Practices:** Employ secure coding practices in the rendering logic to minimize potential vulnerabilities.
        *   **Resource Management:** Optimize rendering performance and implement resource management to prevent DoS due to complex animations.
        *   **Browser Compatibility Testing:** Thoroughly test rendering across different browsers and devices to identify and mitigate browser-specific rendering issues that could have security implications.

*   **2.2.3. Animation API:**
    *   **Security Implications:**
        *   **API Misuse:**  Developers might misuse the API in ways that introduce security vulnerabilities in their applications.
        *   **Lack of Security Features:** If the API lacks necessary security features or guidance, it could make it harder for developers to use the library securely.
    *   **Specific Security Considerations for Lottie-web Context:**
        *   **Secure API Design:** Design the API to minimize the risk of misuse and unintended side effects.
        *   **Clear Documentation and Security Guidelines:** Provide comprehensive documentation and security guidelines for developers on how to use the API securely, including best practices for handling animation files and integrating Lottie-web into their applications.

**2.3. Animation JSON Files:**

*   **Security Implications:**
    *   **Malicious Content Injection:** Animation JSON files can be crafted to contain malicious content that, when processed by Lottie-web, could lead to client-side vulnerabilities (primarily XSS). This could involve manipulating animation properties to inject scripts or redirect users to malicious URLs.
    *   **Data Integrity Risks:** If animation files are tampered with in transit or at rest, they could be modified to contain malicious content or disrupt application functionality.
    *   **DoS Attacks:**  Maliciously crafted animation files can be designed to be excessively complex, leading to DoS when rendered.
*   **Specific Security Considerations for Lottie-web Context:**
    *   **Source Validation:**  Applications should validate the source and integrity of animation JSON files.
    *   **Content Integrity Checks:** Implement content integrity checks (e.g., checksums, SRI) to ensure animation files are not tampered with during delivery.
    *   **Secure Storage and Delivery:** Store and deliver animation files securely, preferably over HTTPS and from trusted sources (like CDNs with access controls).

**2.4. Content Delivery Network (CDN):**

*   **Security Implications:**
    *   **CDN Compromise:** If the CDN is compromised, malicious actors could replace legitimate Lottie-web library files or animation JSON files with malicious versions, leading to widespread attacks on applications using Lottie-web.
    *   **Data Breaches (Less likely for animation files, but consider CDN security posture):**  While animation files are generally not sensitive, a CDN breach could expose other assets or data hosted on the CDN.
    *   **Availability Risks:** CDN outages can impact the availability of animations and applications relying on Lottie-web.
*   **Specific Security Considerations for Lottie-web Context:**
    *   **CDN Security Hardening:** Ensure the CDN provider implements robust security measures, including access controls, intrusion detection, and regular security audits.
    *   **HTTPS Enforcement:**  Enforce HTTPS for all CDN traffic to protect data in transit.
    *   **Subresource Integrity (SRI):**  Implement SRI for Lottie-web library files loaded from the CDN to ensure integrity and prevent tampering.

**2.5. Animation Designers:**

*   **Security Implications:**
    *   **Unintentional Introduction of Vulnerabilities:** Designers, if not security-aware, might unintentionally create animations that contain elements that could be exploited (e.g., embedding external links or scripts).
    *   **Compromised Designer Accounts/Machines:** If designer accounts or machines are compromised, malicious actors could inject malicious content into animation files at the source.
*   **Specific Security Considerations for Lottie-web Context:**
    *   **Security Awareness Training:** Provide security awareness training for animation designers on secure animation design practices.
    *   **Animation Review Process:** Implement a review process for animation files to identify and mitigate potential security risks before deployment.
    *   **Secure Design Tools and Workflows:** Encourage designers to use secure design tools and workflows to minimize the risk of introducing vulnerabilities.

**2.6. Build Process (GitHub Actions):**

*   **Security Implications:**
    *   **Compromised Build Pipeline:** If the GitHub Actions workflows or build environment are compromised, malicious actors could inject malicious code into the Lottie-web library during the build process, leading to supply chain attacks.
    *   **Dependency Vulnerabilities:**  Vulnerabilities in third-party dependencies used during the build process or included in the library itself can introduce security risks.
    *   **Lack of Security Scanning:**  Without automated security scanning in the build process, vulnerabilities might not be detected before release.
*   **Specific Security Considerations for Lottie-web Context:**
    *   **Secure Workflow Configuration:**  Securely configure GitHub Actions workflows, following best practices for secrets management and workflow permissions.
    *   **Dependency Scanning:** Implement automated dependency scanning in the build process to identify and address known vulnerabilities in dependencies.
    *   **Static Application Security Testing (SAST):** Integrate SAST tools into the build process to identify potential code-level vulnerabilities in the Lottie-web library.
    *   **Supply Chain Security Hardening:**  Harden the build environment and implement measures to protect against supply chain attacks, such as verifying the integrity of build tools and dependencies.

### 3. Specific Recommendations

Based on the identified security implications, here are specific and actionable recommendations tailored to the Lottie-web project:

1.  **Enhance Input Validation in Animation Parser:**
    *   **Recommendation:** Implement robust JSON schema validation within the Animation Parser to strictly enforce the expected structure and data types of animation JSON files. Use a well-defined schema and validate against it before parsing animation data.
    *   **Specific Action:** Integrate a JSON schema validation library into the Animation Parser and define a comprehensive schema for Lottie animation JSON format.

2.  **Implement Data Sanitization and Range Checks:**
    *   **Recommendation:**  Within the Animation Parser, sanitize and validate animation data values. Implement range checks for numerical values (sizes, durations, etc.) and sanitize string values to prevent injection attacks.
    *   **Specific Action:**  Develop validation functions for different data types within the animation data model. For example, validate color codes, path strings, and numerical ranges.

3.  **Resource Limits for Animation Complexity:**
    *   **Recommendation:** Implement mechanisms to limit the complexity and size of animations processed by Lottie-web to prevent DoS attacks. This could involve limits on the number of layers, shapes, keyframes, or overall file size.
    *   **Specific Action:**  Introduce configuration options or internal limits within the Animation Parser and Renderer to control resource consumption based on animation complexity. Document these limits for developers.

4.  **Automated Security Scanning in Build Process:**
    *   **Recommendation:** Integrate automated security scanning into the GitHub Actions build process. Implement both Static Application Security Testing (SAST) and Dependency Scanning.
    *   **Specific Action:**
        *   Add a SAST step to the GitHub Actions workflow using a suitable SAST tool for Javascript (e.g., ESLint with security plugins, SonarQube).
        *   Integrate a dependency scanning tool (e.g., npm audit, Snyk, or similar) into the workflow to check for vulnerabilities in npm dependencies.
        *   Fail the build if security scans detect high-severity vulnerabilities.

5.  **Establish Security Vulnerability Reporting and Handling Process:**
    *   **Recommendation:**  Establish a clear process for reporting and handling security vulnerabilities. Create a security policy and provide contact information for security researchers and users to report vulnerabilities.
    *   **Specific Action:**
        *   Create a `SECURITY.md` file in the GitHub repository outlining the vulnerability reporting process and contact information (e.g., security email address).
        *   Define an internal process for triaging, patching, and releasing security fixes.

6.  **Provide Security Guidelines for Developers and Designers:**
    *   **Recommendation:**  Develop and publish security guidelines and best practices for developers using Lottie-web and for animation designers creating animation files.
    *   **Specific Action:**
        *   Create a dedicated "Security" section in the Lottie-web documentation.
        *   Include guidelines on:
            *   Securely integrating Lottie-web into web applications (CSP, input validation at application level).
            *   Best practices for creating secure animation files (avoiding external links, scripts, etc.).
            *   Recommendations for validating the origin and integrity of animation files.

7.  **Regular Dependency Updates and Monitoring:**
    *   **Recommendation:**  Establish a process for regularly updating dependencies of the Lottie-web library and monitoring for newly disclosed vulnerabilities.
    *   **Specific Action:**
        *   Use dependency management tools (e.g., Dependabot) to automate dependency updates and vulnerability alerts.
        *   Schedule regular reviews of dependencies and update them proactively.

8.  **Implement Subresource Integrity (SRI) for CDN Delivery:**
    *   **Recommendation:**  Encourage or provide instructions for users to implement Subresource Integrity (SRI) when loading Lottie-web library files from CDNs.
    *   **Specific Action:**
        *   Include instructions on how to use SRI in the Lottie-web documentation, especially for CDN usage.
        *   Consider generating SRI hashes as part of the build/release process and making them easily accessible.

### 4. Tailored Mitigation Strategies

Here are tailored mitigation strategies applicable to the identified threats, focusing on Lottie-web:

| Threat                                      | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ### Tailored Mitigation Strategies Table:

| Threat Category                  | Specific Threat                                  | Tailored Mitigation Strategy for Lottie-web                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   