## Gatsby Security Analysis: Deep Dive

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to conduct a thorough security assessment of a Gatsby-based application, focusing on the key components and their interactions as outlined in the provided security design review.  This analysis aims to identify potential vulnerabilities, assess their impact, and provide specific, actionable mitigation strategies tailored to the Gatsby framework and its ecosystem.  We will pay particular attention to the interaction between Gatsby, its plugins, data sources (CMS, APIs, databases), and the deployment environment.

**Scope:**

This analysis covers the following areas:

*   **Gatsby Core:**  The core functionalities of the Gatsby framework itself.
*   **Gatsby Plugins:**  The security implications of using both official and third-party plugins.
*   **Data Sourcing:**  Security considerations related to fetching data from various sources (CMS, APIs, databases).
*   **GraphQL Layer:**  Security aspects of Gatsby's GraphQL implementation.
*   **Build Process:**  Security controls within the CI/CD pipeline.
*   **Deployment Environment:**  Security of the chosen hosting solution (AWS S3 + CloudFront, as specified).
*   **Client-Side Security:**  Vulnerabilities that could be exploited in the user's browser.

**Methodology:**

1.  **Architecture and Component Inference:**  Based on the provided C4 diagrams, documentation, and typical Gatsby usage patterns, we will infer the application's architecture, components, and data flow.
2.  **Threat Modeling:**  For each component and interaction, we will identify potential threats using a combination of STRIDE (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) and known attack vectors relevant to web applications and static site generators.
3.  **Vulnerability Analysis:**  We will analyze the identified threats to determine potential vulnerabilities specific to Gatsby and its ecosystem.
4.  **Impact Assessment:**  We will assess the potential impact of each vulnerability on the confidentiality, integrity, and availability of the application and its data.
5.  **Mitigation Recommendations:**  We will provide specific, actionable, and Gatsby-tailored mitigation strategies to address the identified vulnerabilities.  These recommendations will consider the existing security controls and accepted risks.

### 2. Security Implications of Key Components

**2.1 Gatsby Core:**

*   **Architecture:** Gatsby core acts as the orchestrator, fetching data, transforming it, and generating static assets.  It relies heavily on Node.js and its package ecosystem.
*   **Threats:**
    *   **Dependency Vulnerabilities (T, I):**  Vulnerabilities in core Node.js modules or Gatsby's own dependencies could lead to code execution, data breaches, or denial of service.
    *   **Configuration Errors (I, D):**  Incorrect configuration of Gatsby itself (e.g., exposing sensitive environment variables) could lead to information disclosure.
    *   **Denial of Service (DoS) (A):**  Extremely large or complex builds could exhaust server resources during the build process, making the build pipeline unavailable.
*   **Mitigation:**
    *   **Regularly update Gatsby and its dependencies:** Use `npm outdated` and `npm update` (or yarn equivalents) to keep all packages up-to-date.  Automate this process within the CI/CD pipeline.
    *   **Implement SBOM:** Maintain a Software Bill of Materials (SBOM) to track all dependencies and their versions.  Use tools like `cyclonedx-bom` or `syft` to generate and manage the SBOM.
    *   **Secure Configuration Management:**  Store sensitive configuration values (API keys, secrets) securely using environment variables and a secrets management solution (e.g., AWS Secrets Manager, HashiCorp Vault, or GitHub Actions secrets).  *Never* hardcode secrets in the codebase.
    *   **Build Timeouts:** Implement build timeouts in the CI/CD pipeline to prevent excessively long builds from consuming resources.
    *   **Rate Limiting (Build Process):** If the build process is triggered frequently, consider implementing rate limiting to prevent abuse.

**2.2 Gatsby Plugins:**

*   **Architecture:** Plugins extend Gatsby's functionality, providing data sourcing, transformations, and other features.  They are essentially Node.js packages.
*   **Threats:**
    *   **Supply Chain Attacks (T, I, D):**  Malicious or compromised plugins could inject malicious code, steal data, or disrupt the website. This is a *significant* risk due to the accepted risk of relying on third-party plugins.
    *   **Vulnerable Plugin Code (T, I, D):**  Plugins may contain their own vulnerabilities (e.g., XSS, SQL injection, insecure data handling) that could be exploited.
    *   **Overly Permissive Plugins (I, D):**  Plugins might request more data than they need, increasing the risk of data exposure if compromised.
    *   **Unmaintained Plugins (T, I, D, A):** Plugins that are no longer maintained are more likely to contain unpatched vulnerabilities.
*   **Mitigation:**
    *   **Plugin Vetting:**  Carefully vet all plugins before using them.  Prioritize official plugins and those from reputable sources.  Examine the plugin's code, community activity, and security track record.  Check for recent updates and maintenance.
    *   **Dependency Scanning (Plugins):**  Use tools like `npm audit`, `yarn audit`, or Snyk to scan plugin dependencies for known vulnerabilities.  Integrate this into the CI/CD pipeline.
    *   **Principle of Least Privilege (Plugins):**  Configure plugins with the minimum necessary permissions.  Avoid granting plugins access to data or resources they don't require.
    *   **Regular Plugin Audits:**  Periodically review the plugins used in the project and remove any that are no longer needed or have become unmaintained.
    *   **Sandboxing (Advanced):**  Explore techniques for sandboxing plugin execution to limit their potential impact if compromised. This is complex but can significantly enhance security.  This might involve running plugin code in separate processes or using containerization.

**2.3 Data Sourcing:**

*   **Architecture:** Gatsby fetches data from various sources (CMS, APIs, databases) using source plugins.
*   **Threats:**
    *   **Injection Attacks (T, I):**  If data from external sources is not properly validated and sanitized, it could lead to injection vulnerabilities (e.g., SQL injection, NoSQL injection, command injection) within the data sourcing process or when the data is used later.
    *   **Data Exposure (I, D):**  Misconfigured API keys or credentials could expose sensitive data from the data sources.
    *   **Man-in-the-Middle (MitM) Attacks (I, D):**  If communication with data sources is not secured, attackers could intercept or modify data in transit.
    *   **Data Source Compromise (T, I, D, A):**  If the CMS, API, or database itself is compromised, the attacker could gain access to all data sourced by Gatsby.
*   **Mitigation:**
    *   **Secure API Key Management:**  Store API keys and credentials securely using environment variables and a secrets management solution.  *Never* hardcode them in the codebase or commit them to version control.
    *   **HTTPS Enforcement:**  Use HTTPS for *all* communication with data sources.  Ensure that TLS certificates are valid and trusted.
    *   **Input Validation and Sanitization:**  Validate and sanitize *all* data received from external sources, regardless of the source.  Use a robust validation library and follow OWASP guidelines for preventing injection vulnerabilities.  This is *critical* for data that will be used in GraphQL queries or rendered as HTML.
    *   **Data Source Security:**  Ensure that the CMS, APIs, and databases used by Gatsby are themselves secure.  Follow security best practices for each data source.
    *   **Rate Limiting (Data Sources):** Implement rate limiting on API requests to prevent abuse and potential denial-of-service attacks against the data sources.
    *   **Principle of Least Privilege (Data Sources):** Configure data source access with the minimum necessary permissions. Gatsby should only have read access to the data it needs.

**2.4 GraphQL Layer:**

*   **Architecture:** Gatsby uses GraphQL to manage and query data internally.
*   **Threats:**
    *   **Query Complexity Attacks (DoS) (A):**  Attackers could craft complex or deeply nested GraphQL queries that consume excessive server resources, leading to denial of service.
    *   **Introspection Attacks (I, D):**  If introspection is enabled in production, attackers could discover the entire GraphQL schema, including potentially sensitive fields and relationships.
    *   **Over-fetching (I):** While GraphQL helps prevent over-fetching, poorly designed queries could still retrieve more data than necessary.
    *   **Injection Attacks (T, I):** If user-supplied input is used to construct GraphQL queries without proper sanitization, it could lead to injection vulnerabilities.
*   **Mitigation:**
    *   **Query Cost Analysis and Limiting:**  Implement query cost analysis to limit the complexity and depth of GraphQL queries.  Use libraries like `graphql-cost-analysis` or `graphql-validation-complexity` to enforce these limits.
    *   **Disable Introspection in Production:**  Disable GraphQL introspection in the production environment to prevent attackers from discovering the schema.
    *   **Input Validation (GraphQL):**  Validate and sanitize all user-supplied input used in GraphQL queries.  Use GraphQL's built-in type system and validation features, and consider adding custom validation logic where needed.
    *   **Authorization (GraphQL):** Implement authorization checks within GraphQL resolvers to ensure that users can only access data they are authorized to see.
    *   **Rate Limiting (GraphQL):** Implement rate limiting on GraphQL queries to prevent abuse.

**2.5 Build Process (GitHub Actions):**

*   **Architecture:** The build process uses GitHub Actions to automate the steps of fetching data, building the site, and deploying it.
*   **Threats:**
    *   **Compromised CI/CD Pipeline (T, I, D, A):**  If an attacker gains access to the GitHub Actions workflow or the underlying infrastructure, they could inject malicious code, steal secrets, or disrupt the build process.
    *   **Dependency Vulnerabilities (Build) (T, I):**  Vulnerabilities in build tools or dependencies could be exploited during the build process.
    *   **Secret Exposure (Build) (I, D):**  If secrets are not handled securely within the CI/CD pipeline, they could be exposed to attackers.
*   **Mitigation:**
    *   **Secure GitHub Actions Configuration:**  Follow security best practices for configuring GitHub Actions workflows.  Use specific commit SHAs for actions, avoid using third-party actions from untrusted sources, and regularly review workflow configurations.
    *   **Least Privilege (Build):**  Run the build process with the minimum necessary permissions.  Avoid granting the workflow unnecessary access to resources.
    *   **Secret Management (Build):**  Use GitHub Actions secrets to securely store API keys, credentials, and other sensitive information.  Do not hardcode secrets in the workflow configuration.
    *   **Dependency Scanning (Build):**  Integrate dependency scanning tools (e.g., `npm audit`, `yarn audit`, Snyk) into the GitHub Actions workflow to automatically check for vulnerabilities in build dependencies.
    *   **Code Scanning (Build):** Integrate static analysis tools (e.g., SonarQube, ESLint with security plugins) into the workflow to scan the codebase for potential security issues.
    *   **Artifact Signing (Optional):** For increased security, consider signing build artifacts to ensure their integrity.

**2.6 Deployment Environment (AWS S3 + CloudFront):**

*   **Architecture:** The static site is hosted on AWS S3 and served through CloudFront.
*   **Threats:**
    *   **Misconfigured S3 Bucket (I, D):**  If the S3 bucket is publicly accessible, attackers could access or modify the website's files.
    *   **Lack of HTTPS (I, D):**  If HTTPS is not enforced, attackers could intercept or modify traffic between users and the website (MitM attack).
    *   **DDoS Attacks (A):**  Distributed denial-of-service attacks could overwhelm the website, making it unavailable to users.
    *   **Lack of WAF (T, I, D):** Without a Web Application Firewall (WAF), the website is more vulnerable to common web attacks (e.g., XSS, SQL injection).
*   **Mitigation:**
    *   **Restrict S3 Bucket Access:**  Configure the S3 bucket policy to allow access *only* from CloudFront using an Origin Access Identity (OAI).  Disable public access to the bucket.
    *   **Enable Server-Side Encryption (S3):**  Enable server-side encryption on the S3 bucket to protect data at rest.
    *   **Enforce HTTPS (CloudFront):**  Configure CloudFront to redirect all HTTP requests to HTTPS.  Use a strong TLS configuration.
    *   **Enable CloudFront Logging:** Enable access logging for the CloudFront distribution to monitor traffic and identify potential security issues.
    *   **AWS WAF Integration:**  Integrate AWS WAF with CloudFront to protect against common web attacks.  Configure WAF rules to block malicious requests based on OWASP Top 10 vulnerabilities and other relevant threats.
    *   **DDoS Protection:** Utilize AWS Shield (Standard or Advanced) for DDoS protection. CloudFront itself provides some level of DDoS mitigation, but AWS Shield offers more comprehensive protection.
    *   **Origin Shield (Optional):** Consider using CloudFront Origin Shield for an additional caching layer to improve cache hit ratio and reduce load on the origin (S3 bucket).

**2.7 Client-Side Security:**

*   **Architecture:** The user's browser renders the static HTML, CSS, and JavaScript generated by Gatsby.
*   **Threats:**
    *   **Cross-Site Scripting (XSS) (T, I):**  If user-supplied input is not properly sanitized before being displayed on the website, attackers could inject malicious JavaScript code that executes in the user's browser.
    *   **Cross-Site Request Forgery (CSRF) (T):**  While less common for static sites, CSRF attacks are possible if the site interacts with external APIs that require authentication.
    *   **Clickjacking (T):**  Attackers could trick users into clicking on something different from what they think they are clicking on.
    *   **Data Exfiltration (I, D):**  Malicious JavaScript code (e.g., from a compromised third-party library) could steal sensitive data from the user's browser.
*   **Mitigation:**
    *   **Content Security Policy (CSP):**  Implement a strict CSP to control the resources that the browser is allowed to load.  This is a *crucial* defense against XSS and data exfiltration. Use the `gatsby-plugin-csp` to configure CSP headers.
    *   **Input Validation and Sanitization (Client-Side):**  Validate and sanitize all user-supplied input on the client-side *before* sending it to any server or displaying it on the page.  Use a robust sanitization library like DOMPurify.  Remember that client-side validation is *not* a substitute for server-side validation.
    *   **Subresource Integrity (SRI):**  Use SRI to ensure that the browser only loads JavaScript and CSS files with the expected content.  This helps protect against compromised CDNs or third-party libraries.  Gatsby does not have built-in SRI support, but it can be implemented manually or with custom scripts.
    *   **HTTP Headers:**  Use security-related HTTP headers like `X-Content-Type-Options`, `X-Frame-Options`, and `Referrer-Policy` to enhance browser security.  The `gatsby-plugin-netlify` can help manage these headers.
    *   **CSRF Protection (if applicable):** If the site interacts with external APIs that require authentication, implement CSRF protection mechanisms (e.g., CSRF tokens) on the API side.
    *   **Avoid Inline Scripts:** Minimize the use of inline scripts and event handlers.  Favor external scripts with SRI.

### 3. Actionable Mitigation Strategies (Summary)

The following table summarizes the key mitigation strategies, categorized by the component they address:

| Component          | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   