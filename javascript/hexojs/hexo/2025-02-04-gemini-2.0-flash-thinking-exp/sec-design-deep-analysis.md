## Deep Security Analysis of Hexo Static Site Generator

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to thoroughly evaluate the security posture of the Hexo static site generator, based on the provided security design review and architectural diagrams. The primary objective is to identify potential security vulnerabilities and risks within the core Hexo framework and its ecosystem. This analysis will focus on the design and implementation of Hexo, aiming to provide actionable and tailored mitigation strategies to enhance its security and protect users from potential threats.

**Scope:**

The scope of this analysis encompasses the following aspects of Hexo, as depicted in the provided documentation:

*   **Core Hexo Framework:**  Analysis of the Hexo CLI, Core, Theme Engine, Plugin Engine, and Generator components within the Node.js environment on the user's local machine.
*   **Data Flow:** Examination of the flow of data from configuration files, content files, external repositories (themes, plugins, npm registry), through the Hexo generation process, to the final static website files.
*   **Build and Deployment Processes:** Review of the automated build process using GitHub Actions and deployment to CDN-based platforms.
*   **Identified Security Controls:** Assessment of existing and recommended security controls outlined in the security design review.
*   **Assumptions and Questions:** Consideration of the stated assumptions and questions to contextualize the analysis.

The analysis explicitly excludes:

*   Security of user-installed themes and plugins (accepted risk).
*   Server security of the deployment platform (accepted risk).
*   Security of user's local development environment beyond interactions with Hexo.
*   Administrative interfaces for managing Hexo configurations or plugins (out of scope for core framework).

**Methodology:**

This analysis will employ a risk-based approach, utilizing the following methodology:

1.  **Document Review:**  In-depth review of the provided security design review, C4 Context, Container, Deployment, and Build diagrams to understand Hexo's architecture, business and security posture, and existing/recommended security controls.
2.  **Component-Based Analysis:**  Break down Hexo into its key components (as identified in the Container diagram) and analyze the security implications of each component, considering its responsibilities, data inputs, and outputs.
3.  **Threat Modeling (Implicit):**  Infer potential threats based on common web application vulnerabilities and the specific functionalities of each Hexo component. Focus will be on vulnerabilities relevant to static site generators, such as Cross-Site Scripting (XSS), injection flaws, dependency vulnerabilities, and insecure configurations.
4.  **Mitigation Strategy Development:**  For each identified security implication, develop specific, actionable, and tailored mitigation strategies applicable to Hexo. These strategies will consider the Hexo architecture, development practices, and user workflows.
5.  **Prioritization:**  Implicit prioritization of recommendations based on the potential impact and likelihood of identified risks, focusing on the most critical areas for improvement within the core Hexo framework.

### 2. Security Implications of Key Components

Based on the C4 Container diagram and security review, the key components and their security implications are analyzed below:

**A. Hexo CLI:**

*   **Functionality:**  Command-line interface for user interaction, parsing commands and invoking Hexo core functionalities.
*   **Security Implications:**
    *   **Command Injection:** If Hexo CLI improperly handles user-provided command arguments or options, it could be vulnerable to command injection attacks. An attacker could potentially execute arbitrary commands on the user's local machine by crafting malicious input.
    *   **Path Traversal:** If the CLI handles file paths based on user input without proper validation, path traversal vulnerabilities could arise, allowing access to unintended files or directories.
*   **Mitigation Strategies:**
    *   **Input Validation:** Thoroughly validate and sanitize all user inputs to the CLI, including command arguments and options. Use secure parsing techniques to prevent injection attacks.
    *   **Principle of Least Privilege:** Ensure the CLI operates with the minimum necessary privileges. Avoid running CLI commands with elevated permissions unless absolutely required.

**B. Hexo Core:**

*   **Functionality:** Orchestrates the static site generation process, manages configuration, loads themes and plugins, invokes generators, and handles events.
*   **Security Implications:**
    *   **Configuration Parsing Vulnerabilities:** If the core improperly parses configuration files (YAML), vulnerabilities like YAML injection or denial-of-service through maliciously crafted YAML could occur.
    *   **Dependency Vulnerabilities:** Hexo Core relies on numerous dependencies. Vulnerabilities in these dependencies can directly impact Hexo's security.
    *   **Logic Flaws:**  Bugs in the core logic could lead to unexpected behavior, potentially creating security loopholes or vulnerabilities exploitable by malicious themes or plugins.
*   **Mitigation Strategies:**
    *   **Secure Configuration Parsing:** Utilize secure YAML parsing libraries and implement robust input validation for configuration data.
    *   **Dependency Management & Updates:**  Maintain strict dependency management using `package-lock.json`. Implement automated dependency vulnerability scanning as recommended (SAST/DAST). Regularly update dependencies to patch known vulnerabilities.
    *   **Secure Coding Practices:** Adhere to secure coding practices throughout the core development. Conduct regular code reviews, including security-focused reviews, to identify and address potential logic flaws and vulnerabilities.

**C. Theme Engine:**

*   **Functionality:** Renders templates using themes to generate HTML structure and styling.
*   **Security Implications:**
    *   **Cross-Site Scripting (XSS):**  The primary security risk in theme engines is XSS. If themes do not properly sanitize user-provided content (blog posts, comments, etc.) before rendering it in HTML templates, attackers can inject malicious scripts that execute in users' browsers. This is highlighted as a user responsibility in the security review, but the core can influence this.
    *   **Template Injection:**  Although less likely in typical templating engines used for static site generators, improper template handling could potentially lead to template injection vulnerabilities if user input is directly incorporated into template code without proper escaping.
*   **Mitigation Strategies:**
    *   **Security Guidelines for Theme Developers:**  Provide comprehensive security guidelines and best practices for theme developers, specifically emphasizing the importance of output encoding and sanitization of user-provided content within templates to prevent XSS.
    *   **Default Security Features in Theme Engine (Consideration):** Explore options to incorporate default security features into the theme engine itself, such as automatic output encoding for common template variables. This could act as a safety net, even though theme developers remain primarily responsible.
    *   **Theme Auditing Tools (Consideration):**  Potentially develop or recommend tools that can help theme developers and users audit themes for common security vulnerabilities, particularly XSS risks.

**D. Plugin Engine:**

*   **Functionality:** Manages and executes plugins to extend Hexo functionality.
*   **Security Implications:**
    *   **Plugin Vulnerabilities:** Plugins, being third-party code, can introduce vulnerabilities into Hexo. Malicious or poorly coded plugins can compromise the security of the generated website and potentially the user's local environment. This is also highlighted as a user responsibility.
    *   **Plugin Isolation Limitations:** While Node.js provides some level of process isolation, plugins within the same Node.js process can still potentially interfere with each other or the core Hexo framework if not carefully designed.
*   **Mitigation Strategies:**
    *   **Security Guidelines for Plugin Developers:**  Similar to themes, provide clear security guidelines for plugin developers, emphasizing secure coding practices, input validation, and output encoding.
    *   **Plugin API Security Review:**  Carefully review the Plugin API to ensure it minimizes the potential for plugins to introduce security vulnerabilities or bypass core security mechanisms.
    *   **Plugin Sandboxing (Consideration - Advanced):**  Investigate more robust plugin sandboxing techniques within the Node.js environment to further isolate plugins and limit their potential impact in case of vulnerabilities. This is a complex area and might have performance implications.
    *   **Plugin Vetting/Verification (Community-Driven):**  Explore community-driven initiatives to vet and verify plugins for security and quality, potentially creating a curated list of recommended and safer plugins.

**E. Generator:**

*   **Functionality:** Processes content files (Markdown, YAML, etc.) and generates static website files (HTML, CSS, JavaScript).
*   **Security Implications:**
    *   **Input Validation Vulnerabilities (Content Parsing):**  Improper parsing of content files (Markdown, YAML frontmatter) could lead to vulnerabilities. For example, vulnerabilities in Markdown parsers could be exploited to inject malicious HTML or scripts.
    *   **Cross-Site Scripting (XSS) through Content:** If content parsing or rendering processes do not properly handle and sanitize user-provided content within Markdown or other formats, XSS vulnerabilities can be introduced into the generated static website.
*   **Mitigation Strategies:**
    *   **Secure Content Parsing Libraries:** Utilize well-vetted and actively maintained libraries for parsing Markdown, YAML, and other content formats. Regularly update these libraries to address known vulnerabilities.
    *   **Input Sanitization during Content Processing:** Implement input sanitization during content processing, especially when converting Markdown or other formats to HTML. Ensure that potentially harmful HTML tags or scripts are properly escaped or removed.
    *   **Content Security Policy (CSP) Headers (Recommendation for Generated Sites):**  While not directly a Hexo core responsibility, recommend and potentially provide tools or guidance for users to easily implement Content Security Policy (CSP) headers in their generated websites. CSP can significantly mitigate the impact of XSS vulnerabilities, even if they exist in themes or plugins.

**F. Configuration Files & G. Content Files:**

*   **Functionality:** Store Hexo configuration settings and blog post content respectively.
*   **Security Implications:**
    *   **Information Disclosure (Configuration Files):** While less critical for core Hexo as it's client-side, misconfigured file permissions on the user's local machine could potentially expose configuration files containing sensitive information (though unlikely in typical Hexo setups).
    *   **Integrity Issues (Content Files):**  Tampering with content files could lead to website defacement or content manipulation, although this is primarily a local user environment security concern.
*   **Mitigation Strategies:**
    *   **File System Permissions Guidance:** Provide guidance to users on setting appropriate file system permissions for configuration and content files in their local development environment.
    *   **Configuration File Security Best Practices:**  Advise users against storing sensitive secrets directly in configuration files. If secrets are necessary, recommend using environment variables or secure secret management techniques (though this is less relevant for core Hexo).

### 3. Architecture, Components, and Data Flow Inference

The analysis is primarily based on the provided C4 diagrams and security review.  The architecture is clearly modular, with a core framework orchestrating themes and plugins to generate static sites from user content and configuration.

**Data Flow (Simplified Security Perspective):**

1.  **User Input:** User provides content (Markdown, YAML), configuration (YAML), and CLI commands.
2.  **Hexo CLI & Core (Input Processing):** CLI parses commands, Core reads configuration and content files. Input validation is crucial at this stage to prevent injection attacks and ensure data integrity.
3.  **Theme & Plugin Engines (Content Rendering & Extension):** Core utilizes theme and plugin engines to process content and extend functionality. XSS prevention in themes and plugin security are paramount.
4.  **Generator (Static File Output):** Generator produces static HTML, CSS, and JavaScript files. Secure content processing and output encoding are essential to avoid introducing vulnerabilities in the generated files.
5.  **Static Website Files (Deployment):** Generated files are deployed to a hosting platform. Security of these files at rest and in transit (HTTPS) is important, although deployment security is largely user responsibility.

**Inferences based on Codebase (Hypothetical - as codebase not directly provided for review):**

*   **Node.js Ecosystem:** Hexo leverages the Node.js ecosystem, inheriting its strengths and weaknesses. Dependency management and Node.js security best practices are crucial.
*   **Event-Driven Architecture:**  The description of Hexo Core handling events suggests an event-driven architecture, which can be complex and requires careful security considerations in event handling and propagation.
*   **Plugin Extensibility:** The plugin architecture is a key feature, but also a significant security surface. The level of isolation and security controls within the plugin system is critical.

### 4. Specific and Tailored Security Recommendations for Hexo

Based on the analysis, here are specific and tailored security recommendations for the Hexo project:

1.  **Formalize and Enhance Security Guidelines for Theme and Plugin Developers:**
    *   Create dedicated, comprehensive security guidelines specifically for theme and plugin developers.
    *   Include detailed instructions and code examples on how to prevent XSS vulnerabilities (output encoding, sanitization).
    *   Provide guidance on secure coding practices, input validation, and dependency management for plugins.
    *   Make these guidelines easily accessible in the Hexo documentation and developer resources.

2.  **Implement Automated Security Scanning in CI/CD Pipeline (SAST/DAST):**
    *   As recommended in the security review, implement automated Static Application Security Testing (SAST) and Dynamic Application Security Testing (DAST) tools in the CI/CD pipeline for the core Hexo framework.
    *   SAST should focus on identifying potential code-level vulnerabilities in Hexo Core, CLI, and Engines.
    *   DAST could be used to test generated static sites for common web vulnerabilities (though limited applicability for static sites).
    *   Integrate vulnerability reporting and alerting into the development workflow.

3.  **Establish a Clear Vulnerability Reporting and Response Process:**
    *   As recommended, establish a clear and publicly documented process for reporting security vulnerabilities in Hexo and its ecosystem.
    *   Define roles and responsibilities for handling security reports.
    *   Establish a timeline for vulnerability assessment, patching, and public disclosure.
    *   Consider using GitHub Security Advisories for managing and disclosing vulnerabilities.

4.  **Enhance Input Validation Across Core Components:**
    *   Conduct a thorough review of input validation throughout Hexo Core, CLI, and the Generator.
    *   Strengthen input validation for configuration files (YAML), content files (Markdown, YAML frontmatter), and CLI arguments.
    *   Use secure parsing libraries and implement robust validation logic to prevent injection attacks and other input-related vulnerabilities.

5.  **Dependency Security Hardening:**
    *   Beyond regular updates, explore further dependency security hardening measures.
    *   Implement dependency vulnerability scanning as part of the build process (e.g., `npm audit` in CI).
    *   Consider using tools like `npm shrinkwrap` or `pnpm` for more deterministic and secure dependency management.
    *   Regularly review and audit dependencies for unnecessary or potentially risky packages.

6.  **Promote Content Security Policy (CSP) Best Practices in Documentation:**
    *   While CSP is a deployment-level control, Hexo documentation should strongly recommend and provide guidance on implementing CSP headers for generated websites.
    *   Offer examples and best practices for configuring CSP to mitigate XSS risks effectively.
    *   Potentially explore creating a Hexo plugin or helper function to simplify CSP header generation.

7.  **Security Focused Code Reviews:**
    *   Incorporate security-focused code reviews as a standard practice for all code changes in Hexo Core.
    *   Train developers on common web security vulnerabilities and secure coding practices relevant to static site generators.
    *   Utilize security checklists during code reviews to ensure security aspects are systematically considered.

8.  **Consideration for Subresource Integrity (SRI):**
    *   While static sites are less prone to runtime manipulation, consider recommending or implementing Subresource Integrity (SRI) for external resources (e.g., CDNs for themes, plugins, or assets) in generated HTML.
    *   SRI can help ensure that external resources are not tampered with, adding a layer of defense against supply chain attacks.

### 5. Actionable and Tailored Mitigation Strategies

| **Identified Threat**          | **Component**      | **Actionable Mitigation Strategy**                                                                                                                                                                                                                                                           | **Tailored to Hexo**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        