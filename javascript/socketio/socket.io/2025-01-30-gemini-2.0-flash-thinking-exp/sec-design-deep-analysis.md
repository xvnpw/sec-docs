## Deep Analysis of Security Considerations for Socket.IO Application

### 1. Objective, Scope, and Methodology

**Objective:**

This deep analysis aims to provide a thorough security evaluation of the socket.io project and its typical deployment architecture, as outlined in the provided Security Design Review. The primary objective is to identify potential security vulnerabilities and risks associated with using socket.io for real-time applications. This analysis will focus on understanding the architecture, components, and data flow of a socket.io based system to pinpoint specific security weaknesses and recommend tailored mitigation strategies. The ultimate goal is to equip the development team with actionable insights to build more secure real-time applications using socket.io.

**Scope:**

The scope of this analysis encompasses the following:

* **Components:** Client Application, Socket.IO Server Application (Node.js), Socket.IO Adapter (Redis), Backend Service, Load Balancer, Kubernetes Cluster, CI/CD Pipeline, and related infrastructure as described in the C4 diagrams and Security Design Review.
* **Security Domains:** Authentication, Authorization, Input Validation, Cryptography, Availability, Confidentiality, Integrity, and aspects of Supply Chain Security related to socket.io and its dependencies.
* **Lifecycle Phases:** Design, Build, Deployment, and Operation of a socket.io based application.
* **Focus:** Security considerations specific to socket.io library and its ecosystem, rather than generic web application security principles (although these will be considered in context).

**Methodology:**

This analysis will employ the following methodology:

1. **Document Review:**  In-depth review of the provided Security Design Review document, including business posture, security posture, C4 diagrams (Context, Container, Deployment, Build), risk assessment, questions, and assumptions.
2. **Architecture and Data Flow Analysis:**  Based on the C4 diagrams and descriptions, infer the architecture, components, and data flow of a typical socket.io application. Understand how data is transmitted, processed, and stored across different components.
3. **Threat Modeling:** Identify potential security threats and vulnerabilities relevant to each component and data flow, considering common attack vectors for real-time applications and web technologies. This will be informed by the OWASP Top Ten, socket.io specific vulnerabilities, and general security best practices.
4. **Security Control Evaluation:** Assess the existing and recommended security controls outlined in the Security Design Review. Evaluate their effectiveness and identify gaps.
5. **Mitigation Strategy Development:** For each identified threat, develop specific, actionable, and tailored mitigation strategies applicable to socket.io and its ecosystem. These strategies will be practical and directly address the identified vulnerabilities.
6. **Recommendation Prioritization:** Prioritize mitigation strategies based on risk level (likelihood and impact) and feasibility of implementation.

### 2. Security Implications of Key Components

Based on the provided Security Design Review and C4 diagrams, we can break down the security implications of each key component:

**2.1. Client Application:**

* **Security Implications:**
    * **Cross-Site Scripting (XSS):**  If the client application dynamically renders data received via socket.io without proper sanitization, it is vulnerable to XSS attacks. Malicious messages from the server or other clients could inject scripts into the user's browser.
    * **Insecure Client-Side Storage:** If the client application stores sensitive data (e.g., authentication tokens, user data) in local storage or cookies without proper encryption and protection, it could be compromised.
    * **Client-Side Input Validation Bypass:** While client-side input validation can improve user experience, it is not a security control. Attackers can bypass client-side validation and send malicious data directly to the Socket.IO Server.
    * **Man-in-the-Middle (MitM) Attacks (if WSS is not used):** If the connection between the client and Socket.IO Server is not encrypted using WSS, sensitive data transmitted over the connection could be intercepted by attackers.

**2.2. Socket.IO Server Application (Node.js):**

* **Security Implications:**
    * **Input Validation Vulnerabilities (Critical):** The Socket.IO Server is the primary entry point for client data. Insufficient input validation on messages, events, and connection parameters can lead to various injection attacks (e.g., command injection, NoSQL injection if interacting with a database directly, denial of service).
    * **Authentication and Authorization Flaws:** Weak or missing authentication and authorization mechanisms can allow unauthorized clients to connect, send messages, and access sensitive data or functionalities.
    * **Denial of Service (DoS):**  Socket.IO servers can be vulnerable to DoS attacks if not properly protected. Attackers could flood the server with connection requests, messages, or specific events to exhaust resources and make the application unavailable.
    * **Event Handling Vulnerabilities:**  Improperly designed event handlers in the Socket.IO Server application could be exploited. For example, if an event handler processes data without validation or performs insecure operations based on client-provided data.
    * **Dependency Vulnerabilities:**  As a Node.js application, the Socket.IO Server relies on numerous npm packages. Vulnerabilities in these dependencies can be exploited to compromise the server.
    * **Code Injection:** If the Socket.IO Server dynamically executes code based on client input (which is generally bad practice but possible in Node.js), it could be vulnerable to code injection attacks.
    * **Namespace Security:** Socket.IO namespaces provide a way to segment communication. Misconfiguration or vulnerabilities in namespace handling could lead to unauthorized access to specific namespaces or cross-namespace attacks.
    * **Session Hijacking/Fixation:** If session management is not implemented securely, attackers could potentially hijack or fixate sessions to impersonate legitimate users.

**2.3. Socket.IO Adapter (e.g., Redis):**

* **Security Implications:**
    * **Redis Security Vulnerabilities:** If Redis is used as an adapter, vulnerabilities in Redis itself or its configuration can be exploited. This includes unauthorized access to Redis data, data breaches, and DoS attacks against Redis.
    * **Data Persistence Security:** If messages are persisted in the adapter (e.g., Redis), the security of this data store becomes critical. Access control, encryption at rest, and secure backup practices are necessary.
    * **Communication Security between Socket.IO Server and Adapter:** If communication between the Socket.IO Server and the adapter is not secured (e.g., using TLS for Redis), it could be vulnerable to eavesdropping or MitM attacks within the internal network.
    * **Injection Attacks against Adapter (if applicable):** Depending on how the adapter is used and if the Socket.IO Server constructs queries based on client input, there might be a risk of injection attacks against the adapter (e.g., NoSQL injection in MongoDB).

**2.4. Backend Service:**

* **Security Implications:**
    * **Standard Backend Vulnerabilities:** The Backend Service is subject to standard backend security risks like SQL injection, API vulnerabilities, authentication/authorization flaws, etc. These are not directly related to socket.io but are relevant in the overall application security context.
    * **Authorization Issues in Socket.IO Server Interaction:**  The Socket.IO Server interacts with the Backend Service. If the Socket.IO Server does not properly authenticate and authorize its requests to the Backend Service, it could lead to unauthorized data access or actions.
    * **Data Exposure through Socket.IO:**  The Backend Service might expose sensitive data through the Socket.IO Server to the Client Application. Care must be taken to ensure that only authorized data is transmitted and that data is properly secured in transit and at rest.

**2.5. Deployment (Kubernetes, Cloud):**

* **Security Implications:**
    * **Kubernetes Security Misconfigurations:**  Insecure Kubernetes configurations (e.g., weak RBAC, exposed API server, insecure network policies) can compromise the entire deployment, including the Socket.IO Server.
    * **Container Security Vulnerabilities:** Vulnerabilities in the container images used for Socket.IO Server Pods can be exploited. This includes outdated base images, vulnerable packages within the container, and insecure container configurations.
    * **Network Security Issues:**  Improperly configured network policies or firewall rules in the cloud environment or Kubernetes cluster can expose the Socket.IO Server and related components to unauthorized access.
    * **Load Balancer Misconfigurations:**  Insecure Load Balancer configurations (e.g., weak TLS settings, exposed management interface) can create vulnerabilities.
    * **Secrets Management:**  Improper handling of secrets (e.g., API keys, database credentials) within the Kubernetes environment or Socket.IO Server configuration can lead to credential compromise.

**2.6. Build (CI/CD):**

* **Security Implications:**
    * **Compromised Dependencies (Supply Chain Attack):**  If the npm registry or any dependency source is compromised, malicious code could be injected into the Socket.IO Server application during the build process.
    * **Insecure CI/CD Pipeline:**  Vulnerabilities in the CI/CD pipeline itself (e.g., insecure GitHub Actions workflows, exposed secrets) can be exploited to inject malicious code or compromise the build process.
    * **Lack of Security Scanning in CI/CD:**  If SAST, DAST, and dependency scanning are not integrated into the CI/CD pipeline, vulnerabilities may not be detected before deployment.
    * **Unauthorized Access to Build Artifacts:**  If build artifacts are not securely stored and accessed, they could be tampered with or replaced with malicious versions.

### 3. Architecture, Components, and Data Flow Inference

Based on the provided diagrams and descriptions, we can infer the following architecture, components, and data flow:

1. **Client Connection:** Clients initiate connections to the Socket.IO Server via WebSocket or HTTP long-polling, typically over WSS/HTTPS for secure communication. The Load Balancer distributes these connections across multiple Socket.IO Server Pods in a Kubernetes cluster.
2. **Event-Based Communication:** Communication is primarily event-based. Clients and the server emit and listen for events. Data is exchanged as payloads within these events.
3. **Message Routing:** The Socket.IO Server Application is responsible for routing messages and events between connected clients and potentially the Backend Service.
4. **Adapter for Scaling and Persistence (Optional):** For scalability and message persistence in clustered deployments, a Socket.IO Adapter (like Redis) is used. Server Pods communicate with the Adapter to share messages and maintain state across instances.
5. **Backend Service Interaction:** The Socket.IO Server may interact with the Backend Service to fetch data, update data, or trigger events based on backend events. This interaction is likely over HTTP/HTTPS.
6. **Data Flow Path:**
    * **Client to Server:** Client Application -> Internet -> Load Balancer -> Socket.IO Server Pod -> (Socket.IO Adapter)
    * **Server to Client:** Socket.IO Server Pod -> Load Balancer -> Internet -> Client Application
    * **Server to Backend:** Socket.IO Server Pod -> Backend Service
    * **Server to Adapter (if used):** Socket.IO Server Pod <-> Socket.IO Adapter

**Key Security Flow Points:**

* **Client Input to Server:** All data received from clients via socket.io events is untrusted input and must be validated on the Socket.IO Server.
* **Server Output to Client:** Data sent from the server to clients should be carefully constructed to prevent XSS vulnerabilities in the client application.
* **Server Interaction with Adapter:** Communication with the Adapter should be secure, and access to the Adapter data store should be controlled.
* **Server Interaction with Backend:** Authentication and authorization are crucial for interactions between the Socket.IO Server and the Backend Service.

### 4. Specific Security Recommendations for Socket.IO Project

Based on the analysis, here are specific security recommendations tailored to the socket.io project and its typical deployment:

**4.1. Socket.IO Server Application (Node.js):**

* **Recommendation 1: Implement Robust Input Validation on Server-Side Event Handlers.**
    * **Specific Action:**  For every socket.io event handler that processes client data, implement strict input validation. Use libraries like `joi`, `express-validator`, or custom validation functions to sanitize and validate all incoming data types, formats, and lengths.  **Specifically, validate event names and event payloads.**
    * **Rationale:** Prevents injection attacks (command injection, NoSQL injection), DoS, and data corruption.
* **Recommendation 2: Enforce Strong Authentication and Authorization for Socket.IO Connections and Events.**
    * **Specific Action:** Implement an authentication mechanism to verify client identity upon connection. Consider using JWT or session-based authentication. For authorization, implement role-based access control (RBAC) or attribute-based access control (ABAC) to restrict access to specific namespaces, events, and functionalities based on user roles or permissions. **Leverage Socket.IO middleware to enforce authentication and authorization before event handlers are executed.**
    * **Rationale:** Prevents unauthorized access, data breaches, and malicious actions by unauthenticated or unauthorized users.
* **Recommendation 3: Implement Rate Limiting and DoS Protection at the Socket.IO Server Level.**
    * **Specific Action:** Use middleware or libraries like `express-rate-limit` (if using Express.js with socket.io) or custom logic to limit the number of connection requests, events, and messages from a single client or IP address within a specific time window. **Configure Socket.IO server options like `maxHttpBufferSize` and `pingTimeout` to mitigate DoS attacks.**
    * **Rationale:** Protects against DoS attacks and resource exhaustion, ensuring application availability.
* **Recommendation 4: Secure Socket.IO Namespaces and Rooms.**
    * **Specific Action:**  Use namespaces to logically separate different parts of the application and apply specific security policies to each namespace. Implement authorization checks when clients attempt to join rooms or access namespaces. **Document best practices for namespace and room security in socket.io documentation.**
    * **Rationale:** Prevents unauthorized access to sensitive functionalities or data within specific namespaces or rooms.
* **Recommendation 5: Regularly Update Socket.IO and its Dependencies and Implement Dependency Scanning.**
    * **Specific Action:**  Establish a process for regularly updating socket.io and all its npm dependencies. Integrate automated dependency scanning tools (like `npm audit`, `Snyk`, or `OWASP Dependency-Check`) into the CI/CD pipeline to detect and alert on known vulnerabilities. **Prioritize patching vulnerabilities in socket.io and its direct dependencies.**
    * **Rationale:** Mitigates risks associated with known vulnerabilities in socket.io and its ecosystem.
* **Recommendation 6: Securely Configure Socket.IO Server Options.**
    * **Specific Action:** Review and securely configure Socket.IO server options. Disable unnecessary features, set appropriate timeouts (`pingTimeout`, `pingInterval`), limit message sizes (`maxHttpBufferSize`), and ensure secure transport protocols (WSS). **Provide a security configuration checklist or best practices guide for socket.io server setup in the documentation.**
    * **Rationale:** Reduces the attack surface and hardens the Socket.IO Server against potential vulnerabilities.
* **Recommendation 7: Implement Server-Side Output Encoding to Prevent Client-Side XSS.**
    * **Specific Action:** When sending data from the server to clients that will be rendered in the client application, implement server-side output encoding (e.g., HTML escaping, URL encoding) to prevent XSS vulnerabilities. **Provide guidance and examples in the documentation on how to securely send data to clients to avoid XSS.**
    * **Rationale:** Mitigates XSS risks in client applications by ensuring that data received from the server cannot be interpreted as executable code.

**4.2. Socket.IO Adapter (e.g., Redis):**

* **Recommendation 8: Securely Configure and Harden the Socket.IO Adapter (Redis).**
    * **Specific Action:** Follow security best practices for the chosen adapter technology (e.g., Redis). Enable authentication, restrict network access, disable unnecessary commands, and regularly update the adapter software. **Provide specific security configuration guidelines for popular Socket.IO adapters like Redis and MongoDB in the documentation.**
    * **Rationale:** Protects the adapter from unauthorized access, data breaches, and DoS attacks.
* **Recommendation 9: Secure Communication between Socket.IO Server and Adapter.**
    * **Specific Action:** If the adapter supports encrypted communication (e.g., TLS for Redis), enable it to secure the communication channel between the Socket.IO Server and the adapter. **Recommend and document the use of secure communication protocols for adapters in clustered deployments.**
    * **Rationale:** Prevents eavesdropping and MitM attacks on the internal network.

**4.3. Deployment Environment (Kubernetes, Cloud):**

* **Recommendation 10: Implement Kubernetes Security Best Practices.**
    * **Specific Action:**  Follow Kubernetes security best practices, including RBAC, network policies, pod security policies, secrets management, and regular security audits of the Kubernetes cluster. **Provide guidance on secure deployment of socket.io in Kubernetes environments in the documentation.**
    * **Rationale:** Secures the underlying infrastructure and reduces the risk of cluster-level compromises.
* **Recommendation 11: Secure Container Images for Socket.IO Server Pods.**
    * **Specific Action:** Use minimal container images, regularly scan container images for vulnerabilities, and apply security patches. Implement container security best practices. **Recommend using minimal base images and security scanning tools for container images in the deployment documentation.**
    * **Rationale:** Reduces the attack surface and mitigates risks associated with container vulnerabilities.
* **Recommendation 12: Secure Load Balancer Configuration.**
    * **Specific Action:**  Properly configure the Load Balancer, including strong TLS settings, DDoS protection, rate limiting, and access control to the management interface. **Document recommended Load Balancer configurations for socket.io deployments.**
    * **Rationale:** Protects against DDoS attacks, ensures secure TLS termination, and controls access to the Load Balancer.

**4.4. Build Process (CI/CD):**

* **Recommendation 13: Integrate Security Scanning into the CI/CD Pipeline.**
    * **Specific Action:** Integrate SAST, DAST, and dependency scanning tools into the CI/CD pipeline to automatically detect vulnerabilities in the code and dependencies during the build process. **Provide examples of integrating security scanning tools into CI/CD pipelines in the documentation.**
    * **Rationale:** Enables early detection and remediation of security vulnerabilities before deployment.
* **Recommendation 14: Secure the CI/CD Pipeline Itself.**
    * **Specific Action:** Secure the CI/CD pipeline configuration, use secure build environments, protect secrets used in the pipeline, and implement access control to the pipeline. **Document best practices for securing the CI/CD pipeline used for socket.io development and deployment.**
    * **Rationale:** Prevents supply chain attacks and ensures the integrity of the build and release process.

### 5. Actionable Mitigation Strategies Applicable to Identified Threats

Here are actionable mitigation strategies applicable to the identified threats, tailored to socket.io:

| Threat                                      | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              