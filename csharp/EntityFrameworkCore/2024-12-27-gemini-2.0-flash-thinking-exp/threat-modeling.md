## High and Critical Threats Directly Involving Entity Framework Core

| Threat | Description (Attacker Action & Method) | Impact | Affected Component | Risk Severity | Mitigation Strategies |
|---|---|---|---|---|---|
| **SQL Injection via LINQ** | An attacker manipulates user input that is directly or indirectly used within a LINQ query. This could involve crafting input that, when processed by **EF Core's query translation**, results in malicious SQL being executed against the database. |  * **Data Breach:** Access to sensitive data. * **Data Manipulation:** Modifying or deleting data. * **Privilege Escalation:** Performing actions beyond authorized permissions. | **Query Compilation & Execution (LINQ Provider)** - Specifically the translation of LINQ expressions to SQL within **EF Core**. | **Critical** | * **Always use parameterized queries:** Ensure user input is never directly concatenated into LINQ queries. **EF Core handles parameterization automatically for most LINQ scenarios.** * **Input Validation:** Validate and sanitize user input before using it in any part of the application logic that might influence queries processed by **EF Core**. * **Principle of Least Privilege:** Ensure the database user used by the application (configured within **EF Core's DbContext**) has only the necessary permissions. |
| **SQL Injection via Raw SQL Execution** | An attacker injects malicious SQL code into strings that are passed to **EF Core's** `FromSqlRaw`, `ExecuteSqlRaw`, or similar methods. This bypasses **EF Core's** LINQ translation and directly executes the attacker's SQL. | * **Data Breach:** Access to sensitive data. * **Data Manipulation:** Modifying or deleting data. * **Privilege Escalation:** Performing actions beyond authorized permissions. * **Denial of Service:** Executing resource-intensive queries. | **Raw SQL Execution Methods (`FromSqlRaw`, `ExecuteSqlRaw`, etc.)** within **EF Core**. | **Critical** | * **Always use parameterized queries with raw SQL:** Utilize the overloads of `FromSqlRaw` and `ExecuteSqlRaw` that accept parameters provided by **EF Core**. * **Strict Input Validation:** Thoroughly validate and sanitize any input used in raw SQL queries executed through **EF Core**. Avoid constructing SQL strings dynamically from user input if possible. |
| **Mass Assignment Vulnerability (Over-Posting)** | An attacker crafts malicious HTTP requests to include values for entity properties that should not be directly modifiable. When **EF Core** binds the request data to an entity, these unintended properties are updated in the database. | * **Data Manipulation:** Modifying critical or sensitive data managed by **EF Core**. * **Privilege Escalation:** Setting properties that grant higher privileges within the application's data model. * **Bypassing Business Logic:** Circumventing intended application rules enforced through **EF Core** entities. | **Change Tracking & Model Binding** - Specifically when **EF Core** materializes entities from external data (e.g., HTTP requests). | **High** | * **Use Data Transfer Objects (DTOs):** Create separate classes to represent the data being transferred between the client and the application. Map only the necessary properties to the **EF Core** entity. * **Explicit Property Mapping:** Use the `[Bind]` attribute or Fluent API configurations within **EF Core** to explicitly define which properties can be bound during model binding. * **Manual Property Updates:** Instead of directly updating the entire entity managed by **EF Core**, selectively update only the allowed properties after authorization checks. |
| **Migration Vulnerabilities (Schema Manipulation)** | An attacker gains unauthorized access to the migration process of **EF Core** or manipulates migration files before they are applied to the database. This could lead to unintended schema changes or data manipulation managed by **EF Core**. | * **Data Corruption:** Altering data structures in unexpected ways managed by **EF Core**. * **Data Loss:** Dropping tables or columns containing important data tracked by **EF Core**. * **Denial of Service:** Making the database unusable for applications relying on **EF Core**. | **Migrations Infrastructure** within **EF Core**. | **High** | * **Secure Migration Management:** Treat **EF Core** migrations as code and manage them in version control. * **Code Review Migrations:** Thoroughly review all generated **EF Core** migration scripts before applying them to production. * **Testing Migrations:** Test **EF Core** migrations in a non-production environment before deploying them. * **Restrict Migration Access:** Limit who can create and apply **EF Core** migrations in production environments. |