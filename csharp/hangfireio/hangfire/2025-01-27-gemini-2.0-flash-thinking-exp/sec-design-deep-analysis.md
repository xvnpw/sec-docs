Okay, I'm ready to provide a deep security analysis of Hangfire based on the provided Security Design Review document.

## Deep Security Analysis of Hangfire Background Job Processing System

### 1. Objective, Scope, and Methodology

**Objective:**

The primary objective of this deep security analysis is to thoroughly evaluate the security posture of Hangfire, an open-source background job processing system for .NET applications, based on its architecture, components, and data flow as described in the provided Security Design Review document. This analysis aims to identify potential security vulnerabilities and threats specific to Hangfire deployments and provide actionable, tailored mitigation strategies to enhance the overall security of systems utilizing Hangfire.  The focus will be on understanding the inherent security risks within Hangfire's design and operation, rather than general web application security principles.

**Scope:**

This analysis will cover the following components of Hangfire, as outlined in the Security Design Review document:

*   **Client Application (Web Application / Service):** Security considerations related to job enqueueing and interaction with Hangfire client libraries.
*   **Job Storage (e.g., SQL Server, Redis):** Security implications of persistent job storage, including data at rest and in transit.
*   **Hangfire Server(s):** Security aspects of job processing, server management, and execution environment.
*   **Hangfire Dashboard:** Security vulnerabilities and risks associated with the web-based monitoring and management interface.
*   **Data Flow:** Security analysis of data exchange between components, focusing on confidentiality, integrity, and availability.
*   **Configuration:** Security considerations related to Hangfire configuration and sensitive data management.
*   **Communication:** Security of communication channels between Hangfire components.

The analysis will **not** cover:

*   Security of the underlying operating systems or hosting environments in detail, except where directly relevant to Hangfire's security.
*   Specific security vulnerabilities in the .NET framework or other third-party libraries used by Hangfire, unless they are directly exploited within the context of Hangfire's functionality.
*   Security of the application logic within the background jobs themselves, beyond considerations of input validation and secure coding practices within the Hangfire context.
*   Performance testing or scalability analysis.
*   Detailed code review of the Hangfire codebase itself. This analysis is based on the design document and publicly available information.

**Methodology:**

This deep security analysis will employ the following methodology:

1.  **Document Review:**  Thorough review of the provided "Project Design Document: Hangfire Background Job Processing System" to understand the architecture, components, data flow, and initial security considerations.
2.  **Component-Based Threat Analysis:**  Break down Hangfire into its key components (as defined in the scope) and analyze the potential security threats and vulnerabilities associated with each component based on its functionality and interactions. This will involve considering common attack vectors and security weaknesses relevant to each component type (e.g., web application vulnerabilities for the Dashboard, database security for Job Storage, etc.).
3.  **Data Flow Analysis:** Analyze the data flow between components to identify potential points of vulnerability during data transmission and processing. This includes considering data serialization, storage, and retrieval processes.
4.  **Threat Modeling (Implicit):** While not a formal threat modeling exercise with diagrams and workshops, this analysis will implicitly perform threat modeling by identifying assets (job data, server health, dashboard access), threats (unauthorized access, data breaches, DoS), and vulnerabilities (weak authentication, injection flaws) within the Hangfire system.
5.  **Mitigation Strategy Development:** For each identified threat, develop specific, actionable, and tailored mitigation strategies applicable to Hangfire deployments. These strategies will be based on security best practices and tailored to the .NET ecosystem and Hangfire's specific features and configurations.
6.  **Tailored Recommendations:** Ensure all recommendations are specific to Hangfire and avoid generic security advice. Recommendations will be practical and directly applicable to improving the security of Hangfire implementations.

### 2. Security Implications of Key Hangfire Components

Based on the Security Design Review, we will now analyze the security implications of each key component:

#### 2.1. Client Application (Web Application / Service)

**Functionality & Data Flow:** The Client Application is responsible for enqueuing jobs into the Hangfire system. It interacts with the Hangfire Client Library to serialize job details and store them in the Job Storage.

**Security Implications:**

*   **Job Enqueueing as an Attack Vector:**  If the Client Application doesn't properly validate or sanitize data used as job arguments, it can become an entry point for injecting malicious payloads. An attacker might manipulate input fields in the web application to enqueue jobs with crafted arguments designed to exploit vulnerabilities during job execution.
    *   **Example:** Imagine a job that processes user-provided file paths. If the Client Application doesn't validate the file path, an attacker could enqueue a job with a path like `../../../../etc/passwd`, potentially leading to unauthorized file access on the Hangfire Server.
*   **Exposure of Internal Logic:**  The way the Client Application enqueues jobs can inadvertently reveal internal application logic or sensitive data if job names or arguments are overly descriptive or contain sensitive information that shouldn't be exposed.
*   **Denial of Service (DoS) through Job Flooding:** A compromised or malicious Client Application could be used to flood the Hangfire system with a massive number of jobs, potentially overwhelming the Job Storage and Hangfire Servers, leading to a DoS condition.
*   **Serialization/Deserialization Issues:** While less directly a Client Application issue, the choice of serializer (JSON by default) and how the Client Application handles serialization can have security implications. Vulnerabilities in the serialization process itself could be exploited, although this is less likely with standard JSON libraries.

**Specific Security Recommendations for Client Application:**

*   **Input Validation and Sanitization for Job Arguments:** **Actionable Mitigation:** Implement strict input validation and sanitization on all data that is passed as arguments to Hangfire jobs *within the Client Application itself, before enqueuing the job*.  Use allow-lists and appropriate encoding to prevent injection attacks.  Treat all external input as untrusted.
*   **Principle of Least Information Disclosure in Job Details:** **Actionable Mitigation:** Avoid including overly sensitive or revealing information in job names or arguments.  If sensitive data is necessary for job processing, consider passing identifiers or references to data stored securely elsewhere rather than the data itself.
*   **Rate Limiting and Input Validation on Job Enqueueing Endpoints:** **Actionable Mitigation:** If job enqueueing is exposed through an API endpoint (e.g., in a web service), implement rate limiting to prevent job flooding attacks.  Apply robust input validation to these endpoints to reject malformed or suspicious job requests.
*   **Secure Configuration of Hangfire Client:** **Actionable Mitigation:** Ensure the Hangfire Client Library is configured securely. While less critical than server configuration, review any client-side configuration options for potential security implications.

#### 2.2. Job Storage (e.g., SQL Server, Redis)

**Functionality & Data Flow:** Job Storage is the persistent repository for all Hangfire data, including job details, queues, server state, and dashboard data. All other components interact with it.

**Security Implications:**

*   **Data Breach and Confidentiality:** The Job Storage holds potentially sensitive data related to background jobs, including job arguments, results, and execution history. Unauthorized access to the Job Storage could lead to a significant data breach.
*   **Data Integrity and Manipulation:**  If an attacker gains write access to the Job Storage, they could manipulate job data, alter job states, or inject malicious jobs directly into the queues, bypassing the Client Application's intended workflow. This could lead to data corruption, unauthorized actions, or system compromise.
*   **Availability and Denial of Service:**  Attacks targeting the Job Storage, such as DoS attacks against the database server or data corruption, could disrupt the entire Hangfire system and prevent job processing.
*   **SQL Injection (for SQL-based storage):** If Hangfire's interaction with SQL-based Job Storage is not properly parameterized, SQL injection vulnerabilities could arise, allowing attackers to execute arbitrary SQL commands, potentially gaining full control over the database.
*   **Storage-Specific Vulnerabilities:** The chosen storage technology (SQL Server, Redis, etc.) may have its own inherent vulnerabilities that could be exploited if not properly secured and patched.

**Specific Security Recommendations for Job Storage:**

*   **Strong Authentication and Authorization for Storage Access:** **Actionable Mitigation:** Implement robust authentication and authorization mechanisms provided by the chosen Job Storage technology. Use strong passwords or key-based authentication for database users or Redis connections.  Apply the principle of least privilege, granting only necessary permissions to Hangfire Server and Dashboard accounts.
*   **Network Segmentation and Firewalling:** **Actionable Mitigation:** Isolate the Job Storage within a secure network segment, restricting network access to only authorized Hangfire components (Servers and Dashboard). Implement firewall rules to limit inbound and outbound traffic to the Job Storage.
*   **Data Encryption at Rest:** **Actionable Mitigation:** Enable data encryption at rest for the Job Storage using features provided by the storage technology (e.g., Transparent Data Encryption (TDE) in SQL Server, Redis encryption). This protects sensitive job data even if the storage media is compromised.
*   **Data Encryption in Transit:** **Actionable Mitigation:** Enforce encrypted communication (TLS/SSL) between Hangfire Servers, Dashboard, and the Job Storage. Configure database connections and Redis clients to use encrypted connections.
*   **Regular Security Audits and Vulnerability Scanning of Storage:** **Actionable Mitigation:** Regularly audit the configuration of the Job Storage and perform vulnerability scans to identify and remediate any security weaknesses in the storage technology itself.
*   **Input Validation and Parameterized Queries (for SQL Storage):** **Actionable Mitigation:** If using SQL-based storage, ensure that Hangfire and any custom extensions use parameterized queries or an ORM framework to prevent SQL injection vulnerabilities.  Verify that Hangfire's database access code is secure against SQL injection.
*   **Regular Backups and Disaster Recovery:** **Actionable Mitigation:** Implement regular backups of the Job Storage to ensure data availability and recoverability in case of data loss or security incidents. Test the backup and recovery process regularly.

#### 2.3. Hangfire Server(s)

**Functionality & Data Flow:** Hangfire Servers are responsible for fetching jobs from the Job Storage, processing them, and updating job statuses. They are the workhorses of the system.

**Security Implications:**

*   **Job Execution Vulnerabilities (Code Injection, Deserialization):**  Hangfire Servers execute the actual job logic. If job arguments are not properly validated or sanitized, or if deserialization vulnerabilities exist, attackers could potentially inject malicious code that gets executed by the Hangfire Server with the server's privileges. This is a critical risk.
*   **Dependency Vulnerabilities:** Hangfire Servers rely on various libraries and dependencies. Vulnerabilities in these dependencies could be exploited if not properly managed and patched.
*   **Resource Exhaustion and DoS:** Maliciously crafted jobs could be designed to consume excessive resources (CPU, memory, disk space) on the Hangfire Server, leading to resource exhaustion and denial of service for legitimate jobs.
*   **Privilege Escalation:** If Hangfire Servers are running with overly broad privileges, a successful exploit within a job execution context could lead to privilege escalation and further system compromise.
*   **Information Disclosure through Job Processing:** Errors or logging during job processing might inadvertently expose sensitive information if not handled carefully.

**Specific Security Recommendations for Hangfire Server(s):**

*   **Secure Job Implementation Practices:** **Actionable Mitigation:**  **This is paramount.**  Developers must follow secure coding practices when implementing Hangfire jobs. This includes:
    *   **Strict Input Validation and Sanitization within Job Logic:**  Re-validate and sanitize all job arguments *within the job execution code* even if validation was performed in the Client Application. Assume all data from the Job Storage is potentially untrusted.
    *   **Secure Deserialization:** If deserialization of complex objects is necessary within jobs, use secure deserialization libraries and techniques. Avoid deserializing untrusted data directly without proper validation and type handling. Consider using simpler data formats if possible.
    *   **Principle of Least Privilege within Job Logic:**  Jobs should only perform actions that are strictly necessary for their intended purpose. Avoid granting jobs excessive permissions or access to resources they don't need.
*   **Dependency Management and Vulnerability Scanning for Hangfire Servers:** **Actionable Mitigation:** Implement a robust dependency management process for Hangfire Servers. Regularly scan server dependencies for known vulnerabilities and apply security patches promptly. Use tools to automate dependency vulnerability scanning.
*   **Resource Limits and Quotas for Job Processing:** **Actionable Mitigation:** Configure resource limits (CPU, memory, execution time) for Hangfire Server processes or worker threads to prevent resource exhaustion by malicious or poorly written jobs.  Operating system-level resource limits (e.g., cgroups, resource quotas) can be used.
*   **Principle of Least Privilege for Hangfire Server Processes:** **Actionable Mitigation:** Run Hangfire Server processes with the minimum necessary privileges required for job processing. Avoid running servers as highly privileged users (e.g., `SYSTEM` or `root`). Create dedicated service accounts with restricted permissions for Hangfire Servers.
*   **Secure Logging and Error Handling in Job Implementations:** **Actionable Mitigation:** Implement secure logging practices within job implementations. Avoid logging sensitive data in plain text.  Handle errors gracefully and prevent error messages from revealing sensitive information.
*   **Code Reviews and Security Testing of Job Implementations:** **Actionable Mitigation:** Conduct regular code reviews and security testing (including static and dynamic analysis) of job implementations to identify and address potential vulnerabilities before deployment.
*   **Consider Containerization and Isolation:** **Actionable Mitigation:** Deploy Hangfire Servers in containers (e.g., Docker) to provide process isolation and limit the impact of potential security breaches within a server instance. Container security best practices should be followed.

#### 2.4. Hangfire Dashboard

**Functionality & Data Flow:** The Hangfire Dashboard provides a web-based UI for monitoring and managing jobs and servers. It retrieves data from the Job Storage.

**Security Implications:**

*   **Unauthorized Access to Dashboard (Information Disclosure, Administrative Actions):** If the Dashboard is not properly secured, unauthorized users could gain access, potentially viewing sensitive job data, server status, and configuration information. They could also perform administrative actions like retrying or deleting jobs, leading to data manipulation or disruption of background processing.
*   **Cross-Site Scripting (XSS):** The Dashboard is a web application and is susceptible to XSS vulnerabilities if user inputs or data retrieved from the Job Storage are not properly sanitized and encoded before being displayed in the UI. Attackers could inject malicious scripts to steal user credentials, redirect users, or perform actions on behalf of authenticated users.
*   **Cross-Site Request Forgery (CSRF):** If CSRF protection is not implemented, attackers could potentially forge requests on behalf of authenticated Dashboard users to perform unintended actions, such as deleting jobs or modifying server settings.
*   **Clickjacking:**  Attackers could potentially embed the Hangfire Dashboard within a malicious website using iframes and trick users into performing unintended actions by overlaying hidden elements.
*   **Information Disclosure through Dashboard Features:**  Certain Dashboard features, if not properly secured, could inadvertently expose sensitive system information or configuration details to unauthorized users.
*   **Authentication and Authorization Bypass:** Vulnerabilities in the Dashboard's authentication and authorization mechanisms could allow attackers to bypass security controls and gain unauthorized access.

**Specific Security Recommendations for Hangfire Dashboard:**

*   **Robust Authentication and Authorization for Dashboard Access:** **Actionable Mitigation:** Implement strong authentication mechanisms for Dashboard access. Options include:
    *   **Forms Authentication:** Use ASP.NET Forms Authentication with strong password policies and account lockout mechanisms.
    *   **Windows Authentication:** Integrate with Active Directory or Windows domain authentication for centralized user management.
    *   **OAuth 2.0/OpenID Connect:** Integrate with an identity provider using OAuth 2.0 or OpenID Connect for federated authentication.
    *   **API Key Authentication:** For programmatic access, consider API key authentication, but ensure secure key management.
    *   **Implement Role-Based Access Control (RBAC):** Define roles and permissions to restrict access to sensitive Dashboard features based on user roles. For example, differentiate between read-only monitoring users and administrative users who can manage jobs.
*   **Input Sanitization and Output Encoding for XSS Prevention:** **Actionable Mitigation:** Implement robust input sanitization and output encoding throughout the Dashboard application to prevent XSS vulnerabilities. Use framework features to automatically encode output and sanitize user inputs. Regularly test for XSS vulnerabilities.
*   **CSRF Protection:** **Actionable Mitigation:** Enable CSRF protection mechanisms provided by ASP.NET (e.g., anti-forgery tokens) for all Dashboard forms and actions that modify data or perform administrative tasks.
*   **Clickjacking Protection:** **Actionable Mitigation:** Implement clickjacking protection mechanisms:
    *   **`X-Frame-Options` HTTP Header:** Set the `X-Frame-Options` header to `DENY` or `SAMEORIGIN` to prevent the Dashboard from being embedded in iframes on other domains.
    *   **Content Security Policy (CSP) `frame-ancestors` directive:** Use CSP with the `frame-ancestors` directive to control which domains can embed the Dashboard in frames.
*   **HTTPS Enforcement:** **Actionable Mitigation:** Enforce HTTPS for all Dashboard communication to protect user credentials and sensitive data in transit. Configure the web server to redirect HTTP requests to HTTPS.
*   **Regular Security Updates and Patching for Dashboard Dependencies:** **Actionable Mitigation:** Keep the Dashboard application and its dependencies (ASP.NET framework, libraries, etc.) up-to-date with the latest security patches. Regularly scan for vulnerabilities in Dashboard dependencies.
*   **Security Headers:** **Actionable Mitigation:** Implement security-related HTTP headers to enhance browser-side security:
    *   **`Content-Security-Policy` (CSP):** Define a strict CSP to control the sources of content that the browser is allowed to load, mitigating XSS and other injection attacks.
    *   **`Strict-Transport-Security` (HSTS):** Enforce HTTPS and prevent downgrade attacks.
    *   **`X-Content-Type-Options: nosniff`:** Prevent MIME-sniffing vulnerabilities.
    *   **`Referrer-Policy`:** Control referrer information sent in HTTP requests.
*   **Rate Limiting and Brute-Force Protection for Login Attempts:** **Actionable Mitigation:** Implement rate limiting and brute-force protection mechanisms for Dashboard login attempts to prevent password guessing attacks.
*   **Regular Security Audits and Penetration Testing of the Dashboard:** **Actionable Mitigation:** Conduct regular security audits and penetration testing of the Hangfire Dashboard to identify and remediate any security vulnerabilities.

#### 2.5. Communication Security

**Functionality & Data Flow:** Communication occurs between Client Application and Job Storage (enqueueing), Hangfire Servers and Job Storage (fetching/processing/status updates), and Hangfire Dashboard and Job Storage (data retrieval).

**Security Implications:**

*   **Man-in-the-Middle (MITM) Attacks:** If communication channels are not encrypted, attackers could intercept network traffic between Hangfire components to eavesdrop on sensitive data (job details, server status, potentially credentials) or manipulate communication.

**Specific Security Recommendations for Communication Security:**

*   **TLS/SSL Encryption for All Communication Channels:** **Actionable Mitigation:** Enforce TLS/SSL encryption for *all* communication channels between Hangfire components:
    *   **Client Application to Job Storage:** Ensure the connection string used by the Hangfire Client Library to connect to the Job Storage is configured to use encryption (e.g., `Encrypt=True` in SQL Server connection strings, TLS enabled for Redis connections).
    *   **Hangfire Servers to Job Storage:** Similarly, ensure Hangfire Servers use encrypted connections to the Job Storage.
    *   **Hangfire Dashboard to Job Storage:**  The Dashboard's connection to the Job Storage must also be encrypted.
    *   **Dashboard User to Dashboard Web Server:** Enforce HTTPS for all Dashboard web traffic.
*   **Mutual Authentication (Optional, for High-Security Environments):** **Actionable Mitigation:** For highly sensitive environments, consider implementing mutual authentication (client certificate authentication) to verify the identity of both communicating parties (e.g., Hangfire Servers and Job Storage). This adds an extra layer of security beyond just encryption.

#### 2.6. Configuration Security

**Functionality & Data Flow:** Hangfire relies on configuration settings for database connections, server options, dashboard settings, etc.

**Security Implications:**

*   **Exposure of Sensitive Configuration Data (Credentials, API Keys):** Configuration files or environment variables may contain sensitive information like database credentials, API keys, or other secrets. If these are not properly secured, they could be exposed to unauthorized users or attackers.
*   **Misconfiguration Leading to Security Weaknesses:** Incorrect or insecure configuration settings can introduce vulnerabilities. For example, weak authentication settings for the Dashboard, insecure storage configurations, or overly permissive server settings.

**Specific Security Recommendations for Configuration Security:**

*   **Secure Configuration Storage:** **Actionable Mitigation:** Store sensitive configuration data securely:
    *   **Avoid Hardcoding Secrets:** Never hardcode sensitive information directly in code or configuration files.
    *   **Encrypted Configuration Files:** Encrypt sensitive sections of configuration files if possible.
    *   **Secrets Management Systems:** Utilize dedicated secrets management systems like Azure Key Vault, HashiCorp Vault, AWS Secrets Manager, or similar to store and manage sensitive configuration data. Retrieve secrets at runtime instead of storing them directly in configuration files.
    *   **Environment Variables with Restricted Access:** Use environment variables to store configuration, but ensure that access to the environment where these variables are set is restricted to authorized personnel and processes.
*   **Principle of Least Privilege for Configuration Access:** **Actionable Mitigation:** Restrict access to configuration files and secrets management systems to only authorized administrators and processes that require access to configuration data.
*   **Regular Configuration Reviews and Security Audits:** **Actionable Mitigation:** Regularly review Hangfire configurations to ensure they are secure and follow security best practices. Conduct security audits of configuration settings to identify and remediate any misconfigurations.
*   **Configuration Validation and Error Handling:** **Actionable Mitigation:** Implement configuration validation to ensure that Hangfire is configured with secure and valid settings. Handle configuration errors gracefully and prevent error messages from revealing sensitive configuration details.

### 3. Actionable and Tailored Mitigation Strategies Summary

The following table summarizes the actionable and tailored mitigation strategies for Hangfire, categorized by component and threat:

| Component          | Threat                                         | Actionable Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   