## Deep Analysis of EF Core Security Considerations

### 1. Objective, Scope, and Methodology

**Objective:** To conduct a thorough security analysis of Entity Framework Core (EF Core), focusing on its key components, identifying potential vulnerabilities, and providing actionable mitigation strategies.  The analysis aims to understand how EF Core interacts with the database, how data flows through the system, and where security risks might arise, both from inherent design choices and potential developer misuse.  The objective includes providing specific, actionable recommendations tailored to EF Core, rather than generic security advice.

**Scope:** This analysis covers EF Core's core components, including:

*   **DbContext:** The primary interaction point for applications.
*   **EF Core Runtime:**  The core logic for query translation, change tracking, and connection management.
*   **Database Providers:**  The adapters for specific database systems (e.g., SQL Server, PostgreSQL, MySQL, SQLite).
*   **LINQ to Entities:** The query language used to interact with the database.
*   **Change Tracking:**  The mechanism for tracking changes to entities.
*   **Migrations:**  The system for managing database schema changes.
*   **Caching:** How EF Core handles caching (first and second-level).

The analysis *excludes* the security of specific database systems themselves (e.g., SQL Server security), focusing instead on how EF Core interacts with them.  It also excludes general application security best practices (e.g., input validation at the application level) except where they directly relate to EF Core usage.

**Methodology:**

1.  **Architecture and Component Inference:**  Based on the provided C4 diagrams, codebase documentation (https://github.com/dotnet/efcore), and established knowledge of EF Core, we will infer the architecture, data flow, and interactions between components.
2.  **Threat Modeling:**  For each component and interaction, we will identify potential threats using a combination of STRIDE (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege) and other relevant threat modeling techniques.
3.  **Vulnerability Analysis:**  We will analyze potential vulnerabilities arising from the identified threats, considering both inherent design aspects and potential misuse by developers.
4.  **Mitigation Strategy Recommendation:**  For each identified vulnerability, we will propose specific, actionable mitigation strategies tailored to EF Core and its usage.  These strategies will consider existing security controls and accepted risks.
5.  **Prioritization:**  We will prioritize vulnerabilities and mitigation strategies based on their potential impact and likelihood.

### 2. Security Implications of Key Components

This section breaks down the security implications of each key component, identifies potential threats and vulnerabilities, and proposes mitigation strategies.

#### 2.1 DbContext

*   **Function:** Represents a session with the database.  Manages entity tracking and provides access to database operations.  It's the primary entry point for developers.

*   **Threats:**
    *   **Information Disclosure:**  Leaking connection strings or sensitive configuration data.
    *   **Elevation of Privilege:**  Using a DbContext with excessive database permissions.
    *   **Denial of Service:**  Holding database connections open for too long, exhausting connection pools.
    *   **Tampering:** Modifying the DbContext configuration at runtime to point to a malicious database.

*   **Vulnerabilities:**
    *   **Hardcoded Connection Strings:**  Storing connection strings directly in the code, making them vulnerable to exposure.
    *   **Overly Permissive Database User:**  Using a database user with more permissions than necessary.
    *   **Connection Pool Exhaustion:**  Not properly disposing of DbContext instances, leading to connection leaks.
    *   **Insecure Deserialization:** If the DbContext configuration is loaded from an untrusted source, insecure deserialization vulnerabilities could be exploited.

*   **Mitigation Strategies:**
    *   **Secure Configuration Management:**  Use secure configuration providers (e.g., Azure Key Vault, AWS Secrets Manager, environment variables) to store connection strings and other sensitive data.  *Never* hardcode them.
    *   **Least Privilege Principle:**  Create database users with the minimum necessary permissions for the application's operations.  Use different users for different tasks if necessary (e.g., read-only vs. read-write).
    *   **Proper DbContext Disposal:**  Ensure that DbContext instances are properly disposed of after use, typically by using a `using` statement.  This releases the database connection back to the pool.
    *   **Connection Resiliency:** Implement connection resiliency to handle transient database connection failures.  EF Core provides built-in mechanisms for this.
    *   **Validate Configuration Source:** If loading DbContext configuration from a file or external source, validate the source and contents to prevent tampering.  Use digital signatures or checksums if necessary.
    *   **Limit DbContext Lifetime:** Avoid long-lived DbContext instances.  Create and dispose of them for each unit of work.

#### 2.2 EF Core Runtime

*   **Function:**  The core engine of EF Core.  Handles query translation, change tracking, connection management, and materialization of results.

*   **Threats:**
    *   **SQL Injection:**  Although EF Core uses parameterized queries, vulnerabilities could exist in the query translation process.
    *   **Denial of Service:**  Complex or inefficient queries could overload the database server.
    *   **Information Disclosure:**  Errors or exceptions could reveal sensitive information about the database schema or data.
    *   **Tampering:**  Malicious code could potentially interfere with the runtime's internal state.

*   **Vulnerabilities:**
    *   **Bugs in Query Translation:**  Errors in the LINQ to SQL translation logic could lead to unexpected SQL queries, potentially including vulnerabilities.
    *   **Inefficient Query Generation:**  Poorly written LINQ queries could result in inefficient SQL, impacting performance and potentially causing denial of service.
    *   **Sensitive Data in Exceptions:**  Exception messages might contain sensitive data if not handled carefully.
    *   **Reflection-Based Attacks:**  If the application uses reflection to interact with EF Core's internals, it could be vulnerable to attacks that manipulate the runtime's behavior.

*   **Mitigation Strategies:**
    *   **Stay Up-to-Date:**  Regularly update to the latest version of EF Core to benefit from security patches and bug fixes.
    *   **Query Optimization:**  Carefully review and optimize LINQ queries to ensure they generate efficient SQL.  Use profiling tools to identify performance bottlenecks.
    *   **Custom Exception Handling:**  Implement custom exception handling to prevent sensitive information from being exposed in error messages.  Log detailed error information securely.
    *   **Avoid Unnecessary Reflection:**  Minimize the use of reflection to interact with EF Core's internals.  If reflection is necessary, carefully validate inputs and sanitize data.
    *   **Code Reviews:**  Thoroughly review code that interacts with EF Core, paying close attention to LINQ queries and any custom logic.
    *   **SAST/DAST:** Utilize SAST and DAST tools to identify potential vulnerabilities in the EF Core runtime and the application's interaction with it.

#### 2.3 Database Providers

*   **Function:**  Translate EF Core commands into database-specific commands and manage communication with the database.

*   **Threats:**
    *   **Provider-Specific Vulnerabilities:**  Each database provider has its own implementation and may have unique vulnerabilities.
    *   **SQL Injection (Provider-Specific):**  Bugs in the provider's command generation could lead to SQL injection vulnerabilities, even if EF Core's core is secure.
    *   **Denial of Service:**  Provider-specific issues could lead to denial of service attacks.
    *   **Information Disclosure:**  Provider-specific error messages or logging could reveal sensitive information.

*   **Vulnerabilities:**
    *   **Known Vulnerabilities in Specific Providers:**  Some providers may have known vulnerabilities that need to be patched.
    *   **Incorrect Parameterization (Provider-Specific):**  Errors in how the provider handles parameters could lead to SQL injection.
    *   **Insecure Default Configurations:**  Some providers may have insecure default configurations that need to be adjusted.

*   **Mitigation Strategies:**
    *   **Use Well-Maintained Providers:**  Choose database providers that are actively maintained and have a good security track record.
    *   **Stay Up-to-Date:**  Regularly update the database provider to the latest version to benefit from security patches.
    *   **Provider-Specific Security Guidance:**  Consult the security documentation for the specific database provider being used.
    *   **Monitor for Provider Vulnerabilities:**  Stay informed about any reported vulnerabilities in the chosen database provider.
    *   **Test with Different Providers:**  If supporting multiple database providers, test the application thoroughly with each provider to identify any provider-specific issues.
    *   **Review Provider Source Code (if available):** For open-source providers, consider reviewing the source code for potential security issues.

#### 2.4 LINQ to Entities

*   **Function:**  The query language used to interact with the database through EF Core.

*   **Threats:**
    *   **SQL Injection (Indirect):**  While LINQ to Entities generally protects against SQL injection, complex or dynamically generated queries could introduce vulnerabilities.
    *   **Denial of Service:**  Inefficient or overly complex LINQ queries can lead to performance issues and denial of service.
    *   **Information Disclosure:**  Careless use of LINQ queries could inadvertently expose sensitive data.

*   **Vulnerabilities:**
    *   **Dynamic LINQ Queries:**  Constructing LINQ queries dynamically using string concatenation or user-supplied input can lead to SQL injection vulnerabilities.
    *   **Inefficient Queries:**  Poorly written LINQ queries can result in inefficient SQL, impacting performance.
    *   **Unintended Data Exposure:**  Queries that project more data than necessary could expose sensitive information.

*   **Mitigation Strategies:**
    *   **Avoid Dynamic LINQ with String Concatenation:**  *Never* construct LINQ queries using string concatenation with user-supplied input.  Use parameterized queries or expression trees instead.
    *   **Use Parameterized Queries:**  EF Core's LINQ provider automatically parameterizes queries, but be cautious when using `FromSqlRaw` or `ExecuteSqlRaw`.
    *   **Query Optimization:**  Review and optimize LINQ queries to ensure they generate efficient SQL.  Use profiling tools to identify performance bottlenecks.
    *   **Project Only Necessary Data:**  In the `Select` clause of LINQ queries, project only the data that is actually needed by the application.
    *   **Use `AsNoTracking()` When Appropriate:**  For read-only scenarios, use `AsNoTracking()` to improve performance and reduce memory usage. This also reduces the attack surface related to change tracking.
    *   **Validate User Input:** Even though EF Core handles parameterization, validate user input *before* it's used in LINQ queries to prevent other types of attacks (e.g., XSS, logic errors).

#### 2.5 Change Tracking

*   **Function:**  Tracks changes to entities loaded from the database, allowing EF Core to generate appropriate update statements.

*   **Threats:**
    *   **Tampering:**  Malicious code could potentially modify the change tracker's internal state, leading to incorrect updates.
    *   **Denial of Service:**  Tracking a large number of entities could consume significant memory, potentially leading to denial of service.
    *   **Information Disclosure:**  The change tracker could potentially expose information about previous entity states.

*   **Vulnerabilities:**
    *   **Unexpected Updates:**  Bugs in the change tracking mechanism could lead to unintended data modifications.
    *   **Memory Exhaustion:**  Tracking too many entities without proper management can lead to memory exhaustion.
    *   **Sensitive Data in Snapshots:**  The change tracker's snapshots of entity data could contain sensitive information.

*   **Mitigation Strategies:**
    *   **Limit Tracked Entities:**  Only track entities that need to be modified.  Use `AsNoTracking()` for read-only scenarios.
    *   **Clear the Change Tracker:**  Call `ChangeTracker.Clear()` to explicitly clear the change tracker when it's no longer needed.
    *   **Use Separate DbContexts:**  Use separate DbContext instances for read-only and read-write operations to minimize the number of tracked entities.
    *   **Avoid Modifying Tracked Entities Directly:**  Modify entities through the DbContext's methods (e.g., `Update`, `Remove`) to ensure that changes are tracked correctly.
    *   **Understand Change Tracking Behavior:**  Thoroughly understand how EF Core's change tracking works to avoid unexpected behavior.

#### 2.6 Migrations

*   **Function:**  Manages database schema changes, allowing developers to evolve the database schema alongside the application code.

*   **Threats:**
    *   **Tampering:**  Malicious code or unauthorized access could modify migration scripts, leading to database corruption or data loss.
    *   **Elevation of Privilege:**  Migration scripts could be used to grant excessive database permissions.
    *   **Information Disclosure:**  Migration scripts could inadvertently expose sensitive information about the database schema.

*   **Vulnerabilities:**
    *   **Insecure Migration Scripts:**  Migration scripts that contain hardcoded credentials or execute arbitrary SQL commands are vulnerable.
    *   **Unauthorized Access to Migration Scripts:**  If migration scripts are stored in an insecure location, they could be modified by unauthorized users.
    *   **Lack of Version Control:**  Not using version control for migration scripts makes it difficult to track changes and revert to previous versions.

*   **Mitigation Strategies:**
    *   **Secure Migration Script Storage:**  Store migration scripts in a secure location, such as a version-controlled repository with access controls.
    *   **Code Reviews:**  Thoroughly review migration scripts for security issues, such as hardcoded credentials or arbitrary SQL commands.
    *   **Least Privilege Principle:**  Ensure that the database user used to run migrations has only the necessary permissions to modify the schema.
    *   **Version Control:**  Use version control (e.g., Git) to track changes to migration scripts and allow for easy rollback.
    *   **Automated Migration Application:**  Use a secure and automated process to apply migrations to production databases.
    *   **Avoid `migrationBuilder.Sql()` with Untrusted Input:** Do not use raw SQL in migrations with input from untrusted sources.
    *   **Test Migrations Thoroughly:**  Test migrations in a non-production environment before applying them to production.  Include both upgrade and downgrade scenarios.

#### 2.7 Caching

* **Function:** EF Core supports first-level (identity map within a DbContext) and second-level caching (shared across DbContexts).

* **Threats:**
    * **Information Disclosure:** Stale or inconsistent data in the cache could lead to incorrect information being displayed to users.
    * **Denial of Service:** A large cache could consume significant memory, potentially leading to denial of service.
    * **Cache Poisoning:** Malicious actors could potentially manipulate the cache to inject incorrect data.

* **Vulnerabilities:**
    * **Stale Data:** If the cache is not properly invalidated, it could return stale data.
    * **Inconsistent Data:** If multiple applications or processes are using the same cache, data inconsistencies could occur.
    * **Memory Exhaustion:** A large, unmanaged cache could consume excessive memory.
    * **Insecure Cache Storage:** If the cache is stored in an insecure location, it could be vulnerable to tampering.

* **Mitigation Strategies:**
    * **Understand Caching Behavior:** Thoroughly understand how EF Core's caching mechanisms work, including first-level and second-level caching.
    * **Use Caching Appropriately:** Only cache data that is relatively static and frequently accessed.
    * **Implement Cache Invalidation:** Implement proper cache invalidation strategies to ensure that the cache is updated when data changes.
    * **Limit Cache Size:** Configure the cache to limit its size and prevent memory exhaustion.
    * **Secure Cache Storage:** If using a second-level cache, ensure that it is stored in a secure location with appropriate access controls.
    * **Consider Cache Poisoning:** If using a shared cache, implement measures to prevent cache poisoning attacks. This might involve validating data before adding it to the cache or using cryptographic signatures.
    * **Use `AsNoTracking()` to Bypass First-Level Cache:** For scenarios where you always need the latest data, use `AsNoTracking()` to bypass the first-level cache.

### 3. Prioritized Vulnerabilities and Mitigation Strategies

The following table summarizes the most critical vulnerabilities and their corresponding mitigation strategies, prioritized by potential impact and likelihood:

| Vulnerability                                     | Component(s)          | Impact | Likelihood | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     