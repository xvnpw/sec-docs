Okay, I understand the request. Let's create a deep analysis of security considerations for FluentValidation based on the provided design document.

## Deep Analysis of Security Considerations for FluentValidation Library

### 1. Objective, Scope, and Methodology

**Objective:**

The primary objective of this deep analysis is to conduct a thorough security review of the FluentValidation library, focusing on its architecture, key components, and data flow as outlined in the provided Project Design Document. This analysis aims to identify potential security vulnerabilities, misconfigurations, and usage patterns that could introduce security risks in applications utilizing FluentValidation.  Specifically, we will analyze how FluentValidation contributes to application security and where potential weaknesses might arise in its implementation and integration.

**Scope:**

This analysis is scoped to the FluentValidation library itself and its integration within .NET applications.  The scope includes:

*   **Core Components:** `AbstractValidator<T>`, Validation Rules (`IValidationRule` and built-in validators), `ValidationContext<T>`, and `ValidationResult`.
*   **Data Flow:**  The validation process from input data to the application logic consuming the `ValidationResult`.
*   **Extensions and Integrations:**  ASP.NET Core integration, ASP.NET MVC integration, and Dependency Injection support as described in the design document.
*   **Security Considerations:**  Threats and vulnerabilities related to input validation, data integrity, information leakage, performance, and custom validation logic within the context of FluentValidation.

This analysis explicitly excludes:

*   Security vulnerabilities in the underlying .NET framework or other libraries used by applications alongside FluentValidation.
*   Detailed code review of the FluentValidation library's source code (we are working from the design document).
*   Specific application-level security vulnerabilities that are not directly related to the use or misuse of FluentValidation.

**Methodology:**

The methodology for this deep analysis will involve:

1.  **Design Document Review:**  In-depth review of the provided Project Design Document to understand the architecture, components, data flow, and intended security benefits of FluentValidation.
2.  **Component-Based Security Analysis:**  Breaking down FluentValidation into its key components (as listed in the Scope) and analyzing the security implications of each component. This will involve identifying potential threats and vulnerabilities associated with each component's functionality and interactions.
3.  **Data Flow Analysis:**  Analyzing the data flow during the validation process to identify points where security vulnerabilities could be introduced or exploited.
4.  **Threat Modeling (Implicit):**  While not a formal threat modeling exercise, we will implicitly consider common threat categories (Injection, DoS, Information Disclosure, etc.) and how they relate to FluentValidation's functionality and usage.
5.  **Mitigation Strategy Development:**  For each identified security consideration, we will develop specific, actionable, and tailored mitigation strategies applicable to applications using FluentValidation. These strategies will be practical and directly address the identified threats.
6.  **Tailored Recommendations:**  Ensuring that all security considerations and mitigation strategies are tailored to FluentValidation and its typical use cases, avoiding generic security advice.

### 2. Security Implications of Key Components

Let's break down the security implications of each key component of FluentValidation:

**3.1. AbstractValidator<T>**

*   **Security Implication:**  The `AbstractValidator<T>` is the foundation for defining validation logic. Misconfiguration or insufficient validation rules defined within concrete validators derived from `AbstractValidator<T>` can lead to significant security vulnerabilities. If validators are not comprehensive, malicious or malformed input might bypass validation and reach application logic, potentially leading to injection attacks, data corruption, or unexpected behavior.
*   **Specific Security Consideration:**  **Incomplete or Insufficient Validation Rules.** If developers fail to define rules for all relevant input properties or use weak validation rules (e.g., only checking for `NotEmpty()` but not validating format or range), vulnerabilities can arise.
*   **Specific Security Consideration:** **Over-reliance on Client-Side Validation.**  Developers might mistakenly rely solely on client-side validation provided by frameworks and neglect server-side validation using FluentValidation. Client-side validation can be easily bypassed, making server-side validation crucial for security.

**3.2. Validation Rules (IValidationRule and Built-in Validators)**

*   **Security Implication:** The security effectiveness of FluentValidation heavily relies on the correct and secure usage of validation rules.  Incorrectly chosen or configured built-in validators, or poorly implemented custom validators, can introduce vulnerabilities.
*   **Specific Security Consideration:** **Regular Expression Vulnerabilities (ReDoS).**  Using regular expressions in validators like `Matches` or `EmailAddress` can be powerful but also risky.  Complex or poorly written regular expressions can be susceptible to Regular Expression Denial of Service (ReDoS) attacks. An attacker could provide input that causes the regex engine to consume excessive resources, leading to DoS.
    *   **Example:** A poorly crafted regex for email validation could be exploited.
*   **Specific Security Consideration:** **Information Leakage in Error Messages.**  Default error messages provided by built-in validators or custom messages might inadvertently reveal sensitive information about the application's internal workings, data structure, or business logic to potential attackers.
    *   **Example:** An error message like "User ID must be an integer, and must correspond to an existing user in the database" reveals information about the data type and database structure.
*   **Specific Security Consideration:** **Bypass through Encoding or Character Manipulation.**  If validators are not carefully designed, attackers might attempt to bypass them using different character encodings or by manipulating input strings in ways that are not anticipated by the validation rules.
    *   **Example:**  Bypassing XSS prevention by using HTML encoded characters if the validator only checks for basic script tags.
*   **Specific Security Consideration:** **Logic Errors in Custom Validators (`Custom`, `Must`).**  Custom validators offer flexibility but also introduce the risk of developers introducing logic errors that could lead to security vulnerabilities. If custom validation logic is not thoroughly reviewed and tested, it might contain flaws that allow invalid input to pass validation.

**3.3. ValidationContext<T>**

*   **Security Implication:** While `ValidationContext<T>` itself is not directly a source of vulnerabilities, its features can be misused or overlooked, indirectly impacting security.
*   **Specific Security Consideration:** **Over-reliance on Context Data for Security Decisions.**  If security-critical decisions are based solely on data passed through `RootContextData` without proper validation of that context data itself, it could be manipulated by an attacker.  Context data should be treated as potentially untrusted input if it originates from external sources or can be influenced by users.
*   **Specific Security Consideration:** **Complex Conditional Validation Logic leading to Errors.**  Using `RuleSet` and conditional validation extensively can increase the complexity of validation logic.  This complexity can make it harder to reason about the overall validation process and might lead to unintended bypasses or vulnerabilities if the logic is not carefully designed and tested.

**3.4. ValidationResult**

*   **Security Implication:** The `ValidationResult` object is primarily for conveying validation outcomes. However, how the application handles and presents `ValidationResult` can have security implications.
*   **Specific Security Consideration:** **Verbose Error Responses in Production.**  Returning detailed `ValidationResult.Errors` directly to the client in production environments, especially in APIs, can expose sensitive information. Error messages might reveal internal system details, data structures, or business rules that attackers could use to gain insights into the application and plan attacks.
    *   **Example:**  API responses returning full validation error details including property names and technical error messages in production.
*   **Specific Security Consideration:** **Insufficient Logging of Validation Failures.**  Not properly logging validation failures can hinder security monitoring and incident response.  Validation failures can be indicators of malicious activity or attempted attacks. Insufficient logging makes it harder to detect and respond to such events.

**3.5. Extensions and Integrations (ASP.NET Core, ASP.NET MVC, DI)**

*   **Security Implication:**  While the extensions themselves are designed to enhance integration, misconfigurations or vulnerabilities in the integration points can create security risks.
*   **Specific Security Consideration:** **Misconfiguration of ASP.NET Core Integration.**  Incorrectly configuring `FluentValidation.AspNetCore` in ASP.NET Core, such as failing to register validators correctly or misconfiguring model validation filters, might lead to validation not being applied as intended, leaving endpoints vulnerable.
*   **Specific Security Consideration:** **Dependency Injection Vulnerabilities (Indirect).**  If the application's dependency injection setup itself has vulnerabilities (e.g., insecure container configuration, allowing injection of malicious components), and validators are injected, this could indirectly impact security. However, this is less about FluentValidation itself and more about the overall DI setup.
*   **Specific Security Consideration:** **Version Mismatches and Compatibility Issues.** Using outdated versions of FluentValidation or its extensions, or incompatible versions with the target framework (.NET, ASP.NET Core), might expose known vulnerabilities that have been fixed in later versions.

### 3. Architecture, Components, and Data Flow Inference

Based on the design document, the architecture is in-process and lightweight. Data flows from input to a Validator Instance, then through Validation Rules and the Validation Engine, finally resulting in a `ValidationResult` consumed by the application logic.

**Inferred Security-Relevant Aspects from Architecture and Data Flow:**

*   **In-Process Nature:**  FluentValidation operates within the application process. This means that any vulnerabilities in validation logic directly impact the application's security context. There's no isolation or separate security boundary.
*   **Dependency on Validator Definitions:** Security is entirely dependent on how well validators are defined.  FluentValidation itself doesn't enforce security; it provides a framework for *developers* to implement secure validation.
*   **Data Flow Transparency:** The data flow is relatively straightforward, making it easier to analyze and understand where validation occurs and how data is processed. This transparency aids in security reviews and threat modeling.
*   **Integration Points:**  The integration points with frameworks like ASP.NET Core are critical. Secure configuration and usage of these integrations are essential to ensure validation is correctly applied at the application's entry points (e.g., API endpoints, web forms).

### 4. Specific and Tailored Security Considerations

Here are specific security considerations tailored to FluentValidation projects:

1.  **Comprehensive Validation Rule Coverage:** Ensure validators are defined for *all* user-controlled input fields and properties that are security-sensitive. Don't rely on default values or implicit assumptions about input data.
    *   **Specific to FluentValidation:**  Utilize `RuleFor` for every relevant property and apply appropriate validators. Regularly review validator classes to ensure complete coverage as the application evolves.
2.  **Secure Regular Expression Usage:**  When using `Matches` or `EmailAddress`, carefully craft and test regular expressions to avoid ReDoS vulnerabilities. Use online regex analyzers and testing tools to assess regex complexity and potential performance issues. Consider simpler validation methods if regex complexity becomes a concern.
    *   **Specific to FluentValidation:**  Be mindful of regex complexity within `Matches` validators. Test regex performance with potentially malicious inputs.
3.  **Minimize Information Leakage in Error Messages:**  Customize error messages to be user-friendly and informative for legitimate users but avoid revealing sensitive technical details or internal application information.  Consider different error message strategies for development and production environments.
    *   **Specific to FluentValidation:**  Use `WithMessage()` to override default error messages and provide generic, safe messages for production. Log detailed error information server-side for debugging.
4.  **Thorough Testing of Custom Validators:**  Custom validators (`Custom`, `Must`) should be rigorously unit-tested, especially for edge cases and potential error conditions. Security-relevant custom validation logic should undergo security code review.
    *   **Specific to FluentValidation:**  Utilize `FluentValidation.Testing` for unit testing validators, including custom validators. Write tests that specifically target potential security flaws in custom logic.
5.  **Input Sanitization (Consider Pre-Validation):** While FluentValidation is for *validation*, in some scenarios, you might need to sanitize input *before* validation to prevent certain types of attacks (e.g., HTML sanitization to prevent XSS).  FluentValidation itself doesn't sanitize.  Consider using separate sanitization libraries or custom sanitization logic *before* passing data to FluentValidation.
    *   **Specific to FluentValidation:**  Recognize that FluentValidation is primarily for validation, not sanitization. If sanitization is needed, implement it as a separate step before validation.
6.  **Performance Considerations for Validation Logic:**  Complex validation rules, especially those involving external calls or heavy computations within custom validators, can impact application performance and potentially lead to DoS if attackers can trigger expensive validation processes repeatedly. Monitor validation performance and optimize where necessary.
    *   **Specific to FluentValidation:**  Profile validator execution time, especially for complex validators. Consider caching results of expensive validation checks if appropriate.
7.  **Secure Configuration of ASP.NET Core Integration:**  Carefully configure `FluentValidation.AspNetCore` in ASP.NET Core applications. Ensure validators are correctly registered with DI and that model validation is enabled for relevant endpoints. Review ASP.NET Core startup code and controller configurations related to validation.
    *   **Specific to FluentValidation:**  Double-check validator registration in `Startup.cs` or `Program.cs`. Verify that `AddFluentValidationAutoValidation()` and `AddValidatorsFromAssembly()` are correctly used. Test validation at API endpoints.
8.  **Keep FluentValidation and Extensions Up-to-Date:** Regularly update FluentValidation and its extension packages to the latest versions to benefit from security patches and bug fixes. Monitor security advisories related to FluentValidation and its dependencies.
    *   **Specific to FluentValidation:**  Include FluentValidation and its extensions in your dependency update process. Regularly check for updates on NuGet and the FluentValidation GitHub repository.

### 5. Actionable and Tailored Mitigation Strategies

Here are actionable and tailored mitigation strategies for the identified threats:

| Threat Category                     | Threat Description                                                                 | Actionable Mitigation Strategies Tailored to FluentValidation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 1. **Insufficient Validation Coverage** | Validators not defined for all security-sensitive inputs.                                | **Action:** **Validation Rule Checklist:** Create a checklist of all user inputs and data points that require validation. Systematically review validators against this checklist to ensure comprehensive coverage. Use code analysis tools to identify controllers or endpoints without associated validators. **Regular Validator Review:** Schedule periodic reviews of validator definitions, especially after application updates or feature additions, to maintain coverage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 2. **ReDoS Vulnerabilities in Regex**       | Complex or poorly written regex in validators leading to DoS.                       | **Action:** **Regex Complexity Analysis:** Use static analysis tools or online regex analyzers to assess the complexity of regular expressions used in validators.  **Regex Performance Testing:**  Write unit tests that specifically target regex validators with long, crafted input strings to measure performance and identify potential ReDoS issues. **Simplify Regex:**  Favor simpler, less complex regular expressions where possible. If complex regex is necessary, ensure thorough testing and consider alternative validation methods if performance is a concern.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               