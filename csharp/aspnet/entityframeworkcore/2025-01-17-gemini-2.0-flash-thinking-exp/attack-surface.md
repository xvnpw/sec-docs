# Attack Surface Analysis for aspnet/entityframeworkcore

## Attack Surface: [SQL Injection via Raw SQL Queries](./attack_surfaces/sql_injection_via_raw_sql_queries.md)

*   **Attack Surface:** SQL Injection via Raw SQL Queries
    *   **Description:** Attackers inject malicious SQL code into raw SQL queries executed by the application.
    *   **EntityFrameworkCore Contribution:** EF Core provides methods like `context.Database.ExecuteSqlRaw()` and `context.Database.ExecuteSqlInterpolated()` which, if used with unsanitized user input, directly embed it into the SQL query.
    *   **Example:**
        ```csharp
        string userInput = GetUserInput(); // Potentially malicious input
        var query = $"SELECT * FROM Users WHERE Username = '{userInput}'";
        context.Database.ExecuteSqlRaw(query);
        ```
        An attacker could input `' OR '1'='1` to bypass the `WHERE` clause.
    *   **Impact:** Full database compromise, data exfiltration, data manipulation, denial of service.
    *   **Risk Severity:** Critical
    *   **Mitigation Strategies:**
        *   **Always use parameterized queries:** Utilize parameters for user-provided values in `ExecuteSqlRaw()` or `ExecuteSqlInterpolated()`.
        *   **Avoid string concatenation for query building:**  Don't build SQL queries by directly concatenating strings with user input.

## Attack Surface: [SQL Injection via LINQ to Entities with Dynamic Predicates](./attack_surfaces/sql_injection_via_linq_to_entities_with_dynamic_predicates.md)

*   **Attack Surface:** SQL Injection via LINQ to Entities with Dynamic Predicates
    *   **Description:** Attackers manipulate input used to dynamically construct LINQ queries, leading to the execution of unintended SQL.
    *   **EntityFrameworkCore Contribution:**  Dynamically building LINQ expressions based on user input without proper sanitization can result in vulnerable SQL queries being generated by EF Core.
    *   **Example:**
        ```csharp
        string sortColumn = GetUserInput("sortColumn"); // Potentially malicious input
        var query = context.Users.OrderBy(sortColumn); // Vulnerable if sortColumn is not validated
        ```
        An attacker could input a malicious string that gets interpreted as SQL.
    *   **Impact:** Data exfiltration, unauthorized data access, potential data manipulation.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   **Use strongly-typed and predefined options:**  Instead of directly using user input, map it to a predefined set of allowed values or properties.
        *   **Utilize libraries for safe dynamic LINQ:** Consider using libraries that provide safe ways to build dynamic LINQ expressions, ensuring proper escaping and validation.
        *   **Validate and sanitize input:**  Thoroughly validate and sanitize any user input used to influence query construction.

## Attack Surface: [Insecure Data Filtering and Authorization](./attack_surfaces/insecure_data_filtering_and_authorization.md)

*   **Attack Surface:** Insecure Data Filtering and Authorization
    *   **Description:**  Relying solely on EF Core's filtering without proper authorization checks can lead to users accessing data they shouldn't.
    *   **EntityFrameworkCore Contribution:** While EF Core provides filtering capabilities, it doesn't inherently enforce authorization rules. Developers need to implement these.
    *   **Example:**
        ```csharp
        // Assuming a multi-tenant application
        int tenantId = GetUserTenantId();
        var orders = context.Orders.Where(o => o.TenantId == tenantId).ToList();
        ```
        If `GetUserTenantId()` is compromised or manipulated, users could access other tenants' data.
    *   **Impact:** Unauthorized data access, data breaches.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   **Implement robust authorization logic:**  Enforce authorization checks at the application layer, independent of EF Core's filtering.
        *   **Use row-level security in the database:** Leverage database features to restrict data access based on user roles or attributes.
        *   **Validate user context:** Ensure the user's identity and permissions are correctly established and validated before data access.

## Attack Surface: [Mass Assignment Vulnerabilities](./attack_surfaces/mass_assignment_vulnerabilities.md)

*   **Attack Surface:** Mass Assignment Vulnerabilities
    *   **Description:** Attackers can modify unintended entity properties by manipulating input data during model binding.
    *   **EntityFrameworkCore Contribution:**  If user input is directly bound to entity properties without careful control, attackers can potentially modify sensitive fields.
    *   **Example:**
        ```csharp
        public class User {
            public int Id { get; set; }
            public string Username { get; set; }
            public string PasswordHash { get; set; } // Sensitive property
            public bool IsAdmin { get; set; }       // Sensitive property
        }

        // In a controller action:
        public IActionResult UpdateUser(User user) { // User object is bound from request
            // ... save changes
        }
        ```
        An attacker could potentially set `IsAdmin` to `true` if the binding isn't restricted.
    *   **Impact:** Privilege escalation, data manipulation, unauthorized access.
    *   **Risk Severity:** High
    *   **Mitigation Strategies:**
        *   **Use Data Transfer Objects (DTOs) or View Models:** Define specific classes for data transfer and binding, containing only the properties that should be updatable.
        *   **Use the `[Bind]` attribute or Fluent API:** Explicitly specify which properties can be bound from user input.
        *   **Utilize `[BindNever]` attribute:** Prevent specific properties from being bound.

## Attack Surface: [Malicious Interceptors](./attack_surfaces/malicious_interceptors.md)

*   **Attack Surface:** Malicious Interceptors
    *   **Description:** Attackers inject malicious code through custom EF Core interceptors.
    *   **EntityFrameworkCore Contribution:** EF Core allows developers to register interceptors that can modify database commands. If a malicious interceptor is introduced, it can compromise security.
    *   **Example:** An attacker injects an interceptor that logs all executed SQL queries, including those with sensitive data, to an external location.
    *   **Impact:** Data exfiltration, unauthorized data modification, potential remote code execution on the database server.
    *   **Risk Severity:** Critical
    *   **Mitigation Strategies:**
        *   **Carefully control the registration of interceptors:** Ensure only trusted code is used for interceptor implementation.
        *   **Implement code reviews for interceptor logic:** Thoroughly review the code of any custom interceptors.
        *   **Restrict access to configuration where interceptors are registered.**

