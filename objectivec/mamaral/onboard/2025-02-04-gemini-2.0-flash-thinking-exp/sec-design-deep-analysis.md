## Deep Security Analysis of Onboard Application

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep security analysis is to thoroughly evaluate the security posture of the 'onboard' application, based on the provided security design review and inferred architecture from the codebase documentation. This analysis aims to identify potential security vulnerabilities within the key components of the application and recommend specific, actionable mitigation strategies to enhance its overall security. The focus is on providing practical security advice tailored to the 'onboard' project's specific context and business goals.

**Scope:**

This analysis encompasses the following key components and aspects of the 'onboard' application, as outlined in the security design review and C4 diagrams:

* **Components:** Web Application (Web UI), API Service, Onboarding Database, Email Service, Product Database, Load Balancer, Web Server Instance, API Server Instance, Database Instance, Virtual Private Cloud (VPC), Build Process (CI/CD Pipeline).
* **Security Domains:** Authentication, Authorization, Input Validation, Cryptography, Data Security, Infrastructure Security, Build Process Security, Logging and Monitoring.
* **Threat Modeling:** Identification of potential threats and vulnerabilities relevant to each component and security domain.
* **Mitigation Strategies:** Recommendation of specific, actionable, and tailored mitigation strategies for identified threats.

This analysis is based on the information provided in the security design review document and assumptions derived from standard web application architectures and cloud deployment practices.  It does not involve a live code review or penetration testing of the actual `onboard` codebase.

**Methodology:**

The methodology employed for this deep security analysis involves the following steps:

1. **Document Review:**  Thorough review of the provided security design review document, including business posture, security posture, C4 diagrams (Context, Container, Deployment, Build), risk assessment, questions, and assumptions.
2. **Architecture Inference:**  Inferring the application architecture, component interactions, and data flow based on the C4 diagrams and descriptions.
3. **Component-Based Threat Analysis:**  Breaking down the application into its key components and analyzing potential security threats and vulnerabilities specific to each component. This will consider common web application vulnerabilities (OWASP Top 10) and cloud security best practices.
4. **Security Requirement Mapping:**  Mapping the identified security requirements from the design review (Authentication, Authorization, Input Validation, Cryptography) to the relevant components and analyzing their implementation and potential weaknesses.
5. **Tailored Mitigation Strategy Development:**  Developing specific, actionable, and tailored mitigation strategies for each identified threat, considering the 'onboard' application's context, business priorities, and assumed deployment environment (AWS).
6. **Actionable Recommendations:**  Formulating recommendations in a clear and actionable manner, prioritizing them based on risk and business impact.

### 2. Security Implications of Key Components and Mitigation Strategies

Here's a breakdown of security implications for each key component and tailored mitigation strategies:

**2.1. Web Application (Web UI)**

* **Security Implications:**
    * **Cross-Site Scripting (XSS):**  Vulnerable to XSS attacks if user inputs are not properly sanitized before being displayed in the UI. Attackers could inject malicious scripts to steal user sessions, redirect users, or deface the application.
    * **Client-Side Input Validation Bypass:**  Relying solely on client-side validation is insecure. Attackers can easily bypass client-side checks and submit malicious data directly to the API.
    * **Insecure Session Management:**  Weak session management (e.g., predictable session IDs, long session timeouts without inactivity checks) can lead to session hijacking and unauthorized access.
    * **Clickjacking:**  If not properly protected, the Web UI could be vulnerable to clickjacking attacks, where attackers trick users into clicking hidden elements on the page.
    * **Content Security Policy (CSP) Misconfiguration:**  Improperly configured CSP can fail to prevent XSS attacks or introduce new vulnerabilities.
    * **Dependency Vulnerabilities:**  Using vulnerable JavaScript libraries or frameworks can expose the application to known exploits.

* **Tailored Mitigation Strategies:**
    * **Server-Side Output Encoding:**  **Recommendation:** Implement robust server-side output encoding (e.g., using templating engines with auto-escaping or dedicated sanitization libraries) for all user-generated content displayed in the Web UI. **Action:** Integrate a server-side templating engine or sanitization library into the backend API to process data before sending it to the Web UI.
    * **Strict Content Security Policy (CSP):** **Recommendation:** Implement a strict CSP to control the resources the browser is allowed to load, significantly reducing the risk of XSS. **Action:** Configure the web server to send CSP headers that restrict script sources, object sources, and other potentially dangerous resources. Regularly review and refine the CSP as the application evolves.
    * **HTTP Security Headers:** **Recommendation:** Implement security-related HTTP headers like `X-Frame-Options` (to prevent clickjacking), `X-Content-Type-Options: nosniff` (to prevent MIME-sniffing attacks), and `Strict-Transport-Security (HSTS)` (to enforce HTTPS). **Action:** Configure the web server or load balancer to automatically add these security headers to all responses.
    * **Regular Dependency Scanning:** **Recommendation:** Integrate dependency scanning tools into the CI/CD pipeline to automatically identify and alert on vulnerabilities in client-side JavaScript libraries and frameworks. **Action:** Use tools like `npm audit`, `yarn audit`, or dedicated dependency scanning services to scan `package.json` and `yarn.lock` files during the build process.
    * **Subresource Integrity (SRI):** **Recommendation:** Use SRI for all externally hosted JavaScript libraries to ensure that the browser only executes scripts that haven't been tampered with. **Action:** When including CDNs for JavaScript libraries, always use the SRI attribute with the correct hash of the expected file.

**2.2. API Service**

* **Security Implications:**
    * **Injection Attacks (SQL Injection, NoSQL Injection, Command Injection):**  Vulnerable if user inputs are not properly validated and sanitized before being used in database queries, system commands, or other backend operations.
    * **Broken Authentication and Authorization:**  Weak authentication mechanisms, insecure session management, or flawed authorization logic can lead to unauthorized access to API endpoints and data.
    * **API Rate Limiting and Abuse:**  Lack of rate limiting can allow attackers to perform brute-force attacks, denial-of-service attacks, or abuse API resources.
    * **Insecure API Design (e.g., Mass Assignment, Verb Tampering):**  Poorly designed APIs can expose vulnerabilities like mass assignment (allowing users to modify unintended fields) or verb tampering (abusing HTTP verbs for unauthorized actions).
    * **Exposure of Sensitive Data:**  API endpoints might inadvertently expose sensitive user data in responses if not carefully designed and implemented.
    * **Dependency Vulnerabilities:**  Vulnerable dependencies in the backend framework and libraries can introduce known security flaws.
    * **Logging and Monitoring Deficiencies:**  Insufficient logging and monitoring can hinder incident detection, security audits, and forensic investigations.

* **Tailored Mitigation Strategies:**
    * **Robust Server-Side Input Validation and Sanitization:** **Recommendation:** Implement comprehensive server-side input validation and sanitization for all API endpoints. Validate data type, format, length, and range. Sanitize inputs before using them in database queries or other operations. **Action:** Use input validation libraries and frameworks appropriate for the chosen backend language. Implement parameterized queries or ORM features to prevent SQL injection.
    * **Strong Authentication and Authorization Mechanisms:** **Recommendation:** Implement robust authentication (e.g., JWT, OAuth 2.0) and authorization (Role-Based Access Control - RBAC) for all API endpoints. Enforce the principle of least privilege. **Action:** Choose a suitable authentication and authorization framework for the backend language. Implement RBAC to control access to different API endpoints based on user roles (New User, Admin User).
    * **API Rate Limiting and Throttling:** **Recommendation:** Implement API rate limiting and throttling to prevent abuse and denial-of-service attacks. **Action:** Use middleware or API gateway features to limit the number of requests from a single IP address or user within a specific time window.
    * **Secure API Design Principles:** **Recommendation:** Follow secure API design principles, including:
        * **Principle of Least Privilege:** Only expose necessary data in API responses.
        * **Input Validation and Output Encoding:** As mentioned above.
        * **Proper Error Handling:** Avoid exposing sensitive information in error messages.
        * **Version Control:** Implement API versioning to manage changes and maintain backward compatibility.
    * **Dependency Scanning and Management:** **Recommendation:** Integrate dependency scanning tools into the CI/CD pipeline to identify and manage vulnerabilities in backend dependencies. **Action:** Use tools like `Snyk`, `OWASP Dependency-Check`, or language-specific dependency vulnerability scanners (e.g., `pip audit` for Python, `mvn dependency:check` for Java).
    * **Comprehensive Logging and Monitoring:** **Recommendation:** Implement comprehensive logging and monitoring for all API requests, errors, and security-relevant events. Log authentication attempts, authorization failures, input validation errors, and any suspicious activity. **Action:** Use a centralized logging system (e.g., ELK stack, Splunk) to collect and analyze logs. Set up alerts for critical security events.

**2.3. Onboarding Database**

* **Security Implications:**
    * **SQL Injection (if using SQL database):**  Vulnerable if the API Service does not properly sanitize inputs before constructing database queries.
    * **Data Breach and Unauthorized Access:**  Weak database access controls, insecure configurations, or vulnerabilities in the database software can lead to unauthorized access and data breaches.
    * **Data Loss and Integrity Issues:**  Lack of proper backups, data corruption, or accidental deletion can lead to data loss and integrity issues.
    * **Insufficient Data Encryption at Rest:**  If sensitive onboarding data is not encrypted at rest, it could be exposed in case of physical theft or unauthorized access to the database server.
    * **Database Vulnerabilities:**  Unpatched database software can contain known vulnerabilities that attackers can exploit.

* **Tailored Mitigation Strategies:**
    * **Database Access Control and Authentication:** **Recommendation:** Implement strong database access controls and authentication mechanisms. Restrict database access to only the API Service and authorized administrative users. Use strong passwords and consider key-based authentication where applicable. **Action:** Configure database user accounts with minimal necessary privileges. Use network firewalls and security groups to restrict network access to the database server.
    * **Data Encryption at Rest:** **Recommendation:** Encrypt sensitive data at rest in the database. Use database-level encryption features or disk encryption for the underlying storage. **Action:** Enable database encryption features provided by the chosen database system (e.g., Transparent Data Encryption in PostgreSQL, MySQL).
    * **Regular Database Backups and Disaster Recovery:** **Recommendation:** Implement regular database backups and a disaster recovery plan to ensure data availability and recoverability in case of data loss or system failures. **Action:** Configure automated database backups and test the recovery process regularly. Store backups in a secure and separate location.
    * **Database Vulnerability Scanning and Patching:** **Recommendation:** Regularly scan the database for vulnerabilities and apply security patches promptly. **Action:** Use database vulnerability scanning tools to identify potential weaknesses. Subscribe to security advisories for the chosen database system and apply patches as soon as they are released.
    * **Database Activity Monitoring and Auditing:** **Recommendation:** Implement database activity monitoring and auditing to track database access and modifications. Log all administrative actions and security-relevant events. **Action:** Enable database auditing features to log user activity, data access, and schema changes. Review audit logs regularly for suspicious activity.

**2.4. Email Service**

* **Security Implications:**
    * **Email Spoofing and Phishing:**  If not properly configured, emails sent by the onboarding application could be spoofed by attackers for phishing attacks.
    * **Compromised Email Service Account:**  If the Email Service account is compromised, attackers could send malicious emails on behalf of the application.
    * **Data Exposure in Email Content:**  Sensitive user data might be inadvertently exposed in email content if not carefully handled.
    * **Lack of Encryption in Transit (SMTP):**  If SMTP is used without TLS encryption, email content could be intercepted in transit.

* **Tailored Mitigation Strategies:**
    * **Implement Email Authentication (SPF, DKIM, DMARC):** **Recommendation:** Configure SPF, DKIM, and DMARC records for the domain used to send emails. This helps prevent email spoofing and improves email deliverability. **Action:** Configure DNS records for SPF, DKIM, and DMARC according to the Email Service provider's instructions.
    * **Secure API Communication with Email Service:** **Recommendation:** Use secure API communication (HTTPS) with the Email Service. Use API keys or other authentication mechanisms provided by the Email Service. **Action:** Ensure that the API Service communicates with the Email Service over HTTPS. Securely store and manage API keys.
    * **Encrypt Sensitive Data in Email Content:** **Recommendation:** Avoid sending highly sensitive data in emails. If necessary, encrypt sensitive data within emails or provide secure links to access sensitive information. **Action:** Review email content to ensure no unnecessary sensitive data is included. Consider using secure links for users to access sensitive information within the application instead of sending it directly in emails.
    * **Use TLS Encryption for SMTP (if applicable):** **Recommendation:** If using SMTP to send emails, ensure that TLS encryption is enabled to protect email content in transit. **Action:** Configure the SMTP client in the API Service to use TLS encryption.

**2.5. Product Database**

* **Security Implications:**
    * **Data Breach and Unauthorized Access:** Similar to the Onboarding Database, the Product Database is a critical asset and vulnerable to unauthorized access and data breaches.
    * **Data Integrity Issues:**  Unauthorized modifications or data corruption in the Product Database can have significant business impact.
    * **Performance Impact from Onboarding Application:**  If the Onboarding Application's queries to the Product Database are not optimized, they could negatively impact the performance of the main product.

* **Tailored Mitigation Strategies:**
    * **Strict Access Control and Network Segmentation:** **Recommendation:** Implement strict access control to the Product Database. The Onboarding Application's API Service should only have access to the minimal necessary data and operations within the Product Database. Use network segmentation to isolate the Product Database from the Onboarding Application network. **Action:** Configure database user accounts for the Onboarding API Service with limited privileges. Use network firewalls and security groups to restrict network access between the Onboarding Application and the Product Database.
    * **Secure API for Product Database Interaction:** **Recommendation:** If possible, interact with the Product Database through a well-defined and secure API provided by the product itself, rather than directly accessing the database. **Action:** Explore if the product offers a secure API for accessing user data or onboarding-related information. Using a dedicated API can provide an abstraction layer and enforce security policies.
    * **Regular Security Audits and Monitoring:** **Recommendation:** Include the Product Database in regular security audits and monitoring activities. Monitor database access patterns and performance to detect anomalies and potential security incidents. **Action:** Extend existing security monitoring and auditing practices for the Product Database to include interactions from the Onboarding Application.

**2.6. AWS Infrastructure Components (Load Balancer, EC2 Instances, RDS, VPC)**

* **Security Implications:**
    * **Misconfigured Security Groups and NACLs:**  Overly permissive security group or NACL rules can expose instances and services to unauthorized access from the internet or other parts of the network.
    * **Unpatched Instances and Services:**  Running outdated operating systems, web servers, or database software on EC2 instances or RDS can expose known vulnerabilities.
    * **Insecure Instance Configurations:**  Default configurations or insecure hardening of EC2 instances can leave them vulnerable to attacks.
    * **Data Exposure in Transit within AWS:**  Data transmitted between components within AWS (e.g., between Web Server and API Server, API Server and Database) should be encrypted in transit.
    * **IAM Role Misconfiguration:**  Incorrectly configured IAM roles for EC2 instances or other AWS services can grant excessive permissions, leading to privilege escalation vulnerabilities.
    * **Lack of Monitoring and Logging of Infrastructure Events:**  Insufficient logging and monitoring of infrastructure events can hinder security incident detection and response.

* **Tailored Mitigation Strategies:**
    * **Principle of Least Privilege for Security Groups and NACLs:** **Recommendation:** Configure security groups and NACLs with the principle of least privilege. Only allow necessary inbound and outbound traffic for each component. **Action:** Review and refine security group and NACL rules to ensure they are as restrictive as possible while still allowing necessary communication.
    * **Automated Patch Management and Vulnerability Scanning:** **Recommendation:** Implement automated patch management for EC2 instances and ensure that RDS instances are kept up-to-date with security patches managed by AWS. Regularly scan EC2 instances for vulnerabilities. **Action:** Use AWS Systems Manager Patch Manager or similar tools for automated patching. Integrate vulnerability scanning tools (e.g., AWS Inspector, third-party scanners) into the deployment process.
    * **Instance Hardening and Secure Baselines:** **Recommendation:** Harden EC2 instances based on security best practices. Use secure baselines and configuration management tools to ensure consistent and secure configurations. **Action:** Implement CIS benchmarks or other security hardening guides for the chosen operating system. Use configuration management tools (e.g., Ansible, Chef, Puppet) to automate instance hardening.
    * **Encryption in Transit within AWS:** **Recommendation:** Ensure that all communication between components within AWS (e.g., between EC2 instances, between EC2 and RDS) is encrypted in transit using TLS/HTTPS. **Action:** Configure applications to use HTTPS for all internal communication. For database connections, use TLS encryption provided by RDS.
    * **Principle of Least Privilege for IAM Roles:** **Recommendation:** Configure IAM roles for EC2 instances and other AWS services with the principle of least privilege. Grant only the minimum necessary permissions required for each component to function. **Action:** Review and refine IAM roles to ensure they adhere to the principle of least privilege. Use AWS IAM Access Analyzer to identify overly permissive roles.
    * **Comprehensive Cloud Logging and Monitoring (CloudTrail, CloudWatch):** **Recommendation:** Enable and configure comprehensive cloud logging and monitoring using AWS CloudTrail and CloudWatch. Monitor infrastructure events, API calls, and resource utilization for security anomalies and performance issues. **Action:** Enable CloudTrail to log API activity. Configure CloudWatch alarms for critical security events and performance metrics. Integrate cloud logs with a centralized logging and SIEM system.

**2.7. Build Process (CI/CD Pipeline)**

* **Security Implications:**
    * **Compromised Code Repository:**  If the code repository is compromised, attackers could inject malicious code into the application.
    * **Insecure CI/CD Pipeline:**  Vulnerabilities in the CI/CD pipeline itself (e.g., insecure credentials, lack of access control) can be exploited to compromise the build process and inject malicious code.
    * **Dependency Vulnerabilities Introduced During Build:**  Vulnerable dependencies can be introduced during the build process if dependency scanning is not performed.
    * **Lack of SAST and Security Testing in Pipeline:**  If SAST and other security testing are not integrated into the CI/CD pipeline, vulnerabilities may not be detected before deployment.
    * **Insecure Build Artifacts (Docker Images):**  Docker images built with vulnerabilities or insecure configurations can propagate security flaws to the deployed environment.

* **Tailored Mitigation Strategies:**
    * **Code Repository Security:** **Recommendation:** Implement strong access control for the code repository. Enforce branch protection rules, code reviews, and multi-factor authentication for developers. **Action:** Use GitHub's branch protection features to require code reviews before merging to main branches. Enforce MFA for all developers with write access to the repository.
    * **Secure CI/CD Pipeline Configuration:** **Recommendation:** Securely configure the CI/CD pipeline. Use secure credential management for API keys and secrets. Implement access control to the pipeline configuration and execution. **Action:** Use GitHub Actions Secrets for storing sensitive credentials. Restrict access to CI/CD pipeline configuration and workflows to authorized personnel.
    * **Dependency Scanning in CI/CD Pipeline:** **Recommendation:** Integrate dependency scanning tools into the CI/CD pipeline to automatically identify and fail builds if vulnerable dependencies are detected. **Action:** Add dependency scanning steps (e.g., using `npm audit`, `yarn audit`, `Snyk`, `OWASP Dependency-Check`) to the CI/CD pipeline workflow.
    * **SAST Scanning in CI/CD Pipeline:** **Recommendation:** Integrate SAST scanning tools into the CI/CD pipeline to automatically scan code for vulnerabilities before deployment. **Action:** Integrate SAST tools (e.g., SonarQube, Checkmarx, Veracode) into the CI/CD pipeline workflow. Configure SAST tools to fail builds if critical vulnerabilities are found.
    * **Docker Image Scanning and Hardening:** **Recommendation:** Scan Docker images for vulnerabilities before pushing them to the registry. Harden Docker images by following security best practices (e.g., minimal base images, non-root user, remove unnecessary tools). **Action:** Integrate Docker image scanning tools (e.g., Snyk, Clair, Trivy) into the CI/CD pipeline. Use minimal base images for Docker images. Run containers as non-root users.
    * **Immutable Infrastructure and Build Artifacts:** **Recommendation:** Treat Docker images as immutable artifacts. Ensure that the build process is reproducible and consistent. **Action:** Build Docker images from a clean and consistent environment. Avoid making changes to running containers.

### 3. Actionable and Tailored Mitigation Strategies Summary

The following table summarizes the actionable and tailored mitigation strategies, categorized by component and security domain:

| Component          | Security Domain        | Mitigation Strategy                                                                                | Actionable Step                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   