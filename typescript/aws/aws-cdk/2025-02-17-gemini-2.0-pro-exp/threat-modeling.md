# Threat Model Analysis for aws/aws-cdk

## Threat: [Overly Permissive IAM Role Creation via `iam.Role` (CDK Facilitated)](./threats/overly_permissive_iam_role_creation_via__iam_role___cdk_facilitated_.md)

*   **Description:** The CDK's ease of use in defining IAM roles (`iam.Role` construct) can lead developers to inadvertently create roles with excessive permissions.  An attacker, either an insider with CDK code access or through a compromised resource using the role, leverages these overly broad permissions. The CDK's abstraction, while simplifying development, can obscure the underlying complexity of IAM policies.
*   **Impact:** If a resource using this overly permissive role is compromised, the attacker gains extensive access to the AWS account, potentially leading to data exfiltration, resource manipulation, or complete account takeover. The CDK's role is in making it *too easy* to create broad policies.
*   **Affected AWS CDK Component:** `aws-cdk-lib/aws-iam` module, specifically the `iam.Role` construct and related policy-granting methods (e.g., `addToPolicy`, `grant`, `grantRead`, `grantWrite`).
*   **Risk Severity:** Critical
*   **Mitigation Strategies:**
    *   **Least Privilege (CDK-Specific):**  Prioritize CDK methods that enforce granularity (e.g., `grantRead` on specific resources) over broader grants.
    *   **CDK Aspects:** Implement custom CDK Aspects to *enforce* organizational policies directly within the CDK code, preventing the creation of overly permissive roles.
    *   **Code Review (CDK Focus):**  Reviews must specifically examine the *generated* IAM policies from the CDK code, not just the CDK code itself.
    *   **IAM Access Analyzer (with CDK):** Integrate IAM Access Analyzer into the CI/CD pipeline to analyze policies *generated by the CDK*.
    *   **cdk-nag (CDK-Specific Rules):** Utilize `cdk-nag` with rules specifically targeting overly permissive IAM roles created via CDK.

## Threat: [Hardcoding Secrets in `lambda.Function` Environment Variables (CDK Facilitated)](./threats/hardcoding_secrets_in__lambda_function__environment_variables__cdk_facilitated_.md)

*   **Description:** The CDK's `lambda.Function` construct provides an `environment` property, making it tempting for developers to hardcode secrets directly into the CDK code.  This is a CDK-specific issue because the construct *provides a mechanism* that can be misused.
*   **Impact:** If the CDK code repository is compromised (public or private), the attacker gains access to the hardcoded secrets, allowing them to access the associated resources (databases, APIs, etc.).
*   **Affected AWS CDK Component:** `aws-cdk-lib/aws-lambda` module, specifically the `lambda.Function` construct and its `environment` property.
*   **Risk Severity:** Critical
*   **Mitigation Strategies:**
    *   **Secrets Manager/Parameter Store (CDK Integration):**  *Always* use CDK's integration with Secrets Manager (`secretsmanager.Secret.fromSecretAttributes`) or Parameter Store (`ssm.StringParameter.valueForStringParameter`) to retrieve secrets dynamically.  This is the CDK-recommended approach.
    *   **CDK Context:** Use CDK context variables to pass secrets securely *without* hardcoding them in the CDK code itself.
    *   **Pre-commit Hooks (CDK Context):**  Hooks should specifically check for secrets within the CDK code, including within the `environment` property of Lambda functions.

## Threat: [Unintentional Public S3 Bucket via `s3.Bucket` (CDK Default Behavior)](./threats/unintentional_public_s3_bucket_via__s3_bucket___cdk_default_behavior_.md)

*   **Description:**  The `s3.Bucket` construct, *if not explicitly configured*, can create publicly accessible buckets.  This is a CDK-specific threat because the *default behavior* (or lack of explicit defaults) can lead to insecure configurations. An attacker discovers and exploits the public bucket.
*   **Impact:** Data leakage, data modification, or deletion from the publicly accessible S3 bucket.
*   **Affected AWS CDK Component:** `aws-cdk-lib/aws-s3` module, specifically the `s3.Bucket` construct and its `publicReadAccess` and `blockPublicAccess` properties.
*   **Risk Severity:** High
*   **Mitigation Strategies:**
    *   **Explicit Configuration (CDK Best Practice):** *Always* explicitly set `publicReadAccess: false` and `blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL` within the CDK code. This should be a mandatory practice.
    *   **CDK Aspects (Enforcement):** Create a CDK Aspect that *forces* all `s3.Bucket` instances to have Block Public Access enabled, preventing accidental misconfiguration.
    *   **AWS Config Rules (Remediation):** While not directly CDK, Config rules should be used to *detect and remediate* any publicly accessible buckets, even if the CDK code is incorrect.

## Threat: [Insufficient Validation of User-Provided Input to Custom Resources (CDK-Enabled Vulnerability)](./threats/insufficient_validation_of_user-provided_input_to_custom_resources__cdk-enabled_vulnerability_.md)

* **Description:** The CDK allows the creation of custom resources (`core.CustomResource`), which often use Lambda functions as providers. If the developer fails to properly validate user-provided input to these custom resources *within the CDK code*, an attacker can inject malicious data. This is a CDK-specific threat because the CDK *provides the mechanism* for creating custom resources, and the developer's responsibility within that mechanism is crucial.
    * **Impact:** The impact depends on the custom resource's functionality, but could include code injection, privilege escalation, or data corruption within the AWS environment.
    * **Affected AWS CDK Component:** `aws-cdk-lib/core` module (specifically `core.CustomResource`) and `aws-cdk-lib/aws-lambda` (if used as a provider).
    * **Risk Severity:** High
    * **Mitigation Strategies:**
        * **Input Validation (Within CDK-Defined Lambda):** Implement rigorous input validation *within the Lambda function code* that is part of the CDK-defined custom resource.
        * **Least Privilege (CDK-Defined IAM Role):** Ensure the custom resource's Lambda function, defined within the CDK, has only the *absolutely necessary* permissions.
        * **Code Review (CDK Focus):** Thoroughly review the *entire* custom resource definition, including the Lambda function code and its interaction with the CDK-provided inputs.

## Threat: [CDK Bootstrap Account Compromise (CDK-Specific Process)](./threats/cdk_bootstrap_account_compromise__cdk-specific_process_.md)

*   **Description:** The `cdk bootstrap` command creates resources (S3 bucket, IAM role) in the AWS account. If the credentials used for this *CDK-specific process* are compromised, an attacker gains access to these resources. This is a direct threat related to the CDK's setup process.
*   **Impact:** The attacker can access the CDK deployment artifacts stored in the S3 bucket, potentially modifying them to inject malicious code into *future* CDK deployments. This is a supply-chain attack facilitated by the CDK.
*   **Affected AWS CDK Component:** The CDK Toolkit (`cdk bootstrap` command) and the resources it creates (S3 bucket, IAM role).
*   **Risk Severity:** High
*   **Mitigation Strategies:**
    *   **Least Privilege (CDK Bootstrap Role):** Use a dedicated IAM role with *minimal* permissions specifically for the `cdk bootstrap` process.
    *   **Credential Rotation (Bootstrap Credentials):** Regularly rotate the AWS credentials used for bootstrapping the CDK environment.
    *   **CloudTrail Monitoring (CDK Activity):** Monitor CloudTrail logs for any suspicious activity related to the bootstrap resources *and* the `cdk` commands themselves.
    *   **Separate Accounts (Blast Radius Reduction):** Use separate AWS accounts for development, staging, and production, limiting the impact of a compromised bootstrap process.

