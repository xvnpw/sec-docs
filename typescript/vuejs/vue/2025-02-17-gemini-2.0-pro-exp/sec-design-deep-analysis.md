## Deep Security Analysis of Vue.js

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep analysis is to conduct a thorough security assessment of the Vue.js framework (version 3, as that's the current stable version), focusing on its key components, architecture, and data flow.  The analysis aims to identify potential security vulnerabilities, assess their impact, and provide actionable mitigation strategies tailored to Vue.js development.  This goes beyond general web security advice and delves into Vue.js-specific concerns.  The analysis will also consider the security controls already in place, as described in the provided Security Design Review.

**Scope:**

This analysis covers the following:

*   **Core Vue.js Library:**  The core functionalities of the Vue.js framework, including reactivity, templating, component system, directives, and built-in features.
*   **Vue Router:** The official routing library for Vue.js.
*   **Vuex:** The official state management library for Vue.js.
*   **Common Third-Party Libraries:**  While not directly part of Vue.js, the analysis will briefly touch upon the security implications of commonly used libraries like Axios (for HTTP requests).
*   **Build and Deployment Process:**  The security considerations related to building and deploying Vue.js applications, focusing on the chosen static hosting with Netlify scenario.
*   **Data Flow:**  How data flows within a Vue.js application and between the application, backend APIs, and third-party services.
* **C4 Diagrams:** Security controls and responsibilities of each component.

**Methodology:**

1.  **Architecture and Component Analysis:**  Infer the architecture, components, and data flow based on the provided C4 diagrams, the Vue.js documentation (https://vuejs.org/), and the official GitHub repository (https://github.com/vuejs/vue).
2.  **Threat Modeling:**  Identify potential threats based on the architecture, components, and data flow.  This will leverage common attack vectors like XSS, CSRF, injection attacks, and supply chain vulnerabilities.
3.  **Vulnerability Analysis:**  Analyze the identified threats to determine potential vulnerabilities within the Vue.js framework and its ecosystem.
4.  **Mitigation Strategy Recommendation:**  Provide specific, actionable, and Vue.js-tailored mitigation strategies for each identified vulnerability.
5.  **Review of Existing Controls:**  Evaluate the effectiveness of the existing security controls mentioned in the Security Design Review.
6.  **Documentation Review:** Analyze Vue.js official documentation for security recommendations and best practices.

### 2. Security Implications of Key Components

This section breaks down the security implications of key Vue.js components, inferred from the codebase structure, documentation, and C4 diagrams.

**2.1 Core Vue.js Library**

*   **Reactivity System:**
    *   **Threat:**  While Vue's reactivity system is generally secure, improper handling of reactive data derived from user input could lead to vulnerabilities.  For example, if a computed property directly uses unsanitized user input in its calculation, and that computed property is then used in the template, it could create an XSS vulnerability.
    *   **Mitigation:**  Always sanitize user input *before* it becomes part of the reactive data.  Use a dedicated sanitization library (like DOMPurify) rather than relying on built-in Vue.js features for sanitization.  Avoid using reactive data directly in `v-html`.
    *   **Example:**
        ```vue
        <template>
          <div v-html="computedDangerousHTML"></div>
        </template>
        <script>
        import DOMPurify from 'dompurify';

        export default {
          data() {
            return {
              userInput: '' // Potentially dangerous user input
            };
          },
          computed: {
            computedDangerousHTML() {
              // UNSAFE: Directly using userInput in v-html
              // return this.userInput;

              // SAFE: Sanitize userInput before using it
              return DOMPurify.sanitize(this.userInput);
            }
          }
        };
        </script>
        ```

*   **Templating (v-html, v-text, {{}}):**
    *   **Threat:**  `v-html` is inherently dangerous if used with untrusted data, as it directly injects raw HTML into the DOM, bypassing Vue's built-in escaping mechanisms.  This is the most common source of XSS vulnerabilities in Vue.js applications.  Even `{{ }}` and `v-text` can be vulnerable if the data they display is later manipulated by malicious JavaScript.
    *   **Mitigation:**
        *   **Avoid `v-html` whenever possible.**  Use `v-text` or `{{ }}` for displaying text content.
        *   If `v-html` *must* be used, *always* sanitize the input using a robust HTML sanitizer like DOMPurify.  *Never* trust user-provided data, even if it appears to be safe.
        *   Be aware of "DOM XSS" where even `v-text` or `{{ }}` can be vulnerable if the displayed content is later manipulated by malicious JavaScript that modifies the DOM.  Avoid manipulating DOM elements containing user-provided data after they have been rendered.
    *   **Example (v-html):**
        ```vue
        <template>
          <!-- DANGEROUS:  Directly renders userInput as HTML -->
          <div v-html="userInput"></div>

          <!-- SAFE:  Sanitizes userInput before rendering -->
          <div v-html="sanitizedUserInput"></div>
        </template>
        <script>
        import DOMPurify from 'dompurify';

        export default {
          data() {
            return {
              userInput: '<img src=x onerror=alert(1)>' // Example XSS payload
            };
          },
          computed: {
            sanitizedUserInput() {
              return DOMPurify.sanitize(this.userInput);
            }
          }
        };
        </script>
        ```
    *   **Example (DOM XSS):**
        ```vue
        <template>
          <div id="myDiv">{{ userInput }}</div>
        </template>
        <script>
        export default {
          data() {
            return {
              userInput: 'Initial Value'
            };
          },
          mounted() {
            // DANGEROUS:  Manipulating the DOM element's innerHTML
            // after it has been rendered with user input.
            document.getElementById('myDiv').innerHTML = '<img src=x onerror=alert(1)>';
          }
        };
        </script>
        ```

*   **Directives (v-bind, v-on, custom directives):**
    *   **Threat:**  Improperly implemented custom directives could introduce vulnerabilities.  For example, a custom directive that modifies the DOM based on unsanitized user input could lead to XSS.  `v-bind` used with attributes like `href` or `src` can be vulnerable if the bound value is derived from untrusted input.
    *   **Mitigation:**
        *   When creating custom directives, carefully validate and sanitize any user input used within the directive's logic.
        *   Avoid using user input directly in attributes like `href`, `src`, or `style` without proper sanitization or URL encoding.  Use computed properties to sanitize the values before binding them.
        *   For `v-on`, ensure event handlers do not execute arbitrary code based on user input.
    *   **Example (v-bind):**
        ```vue
        <template>
          <!-- DANGEROUS:  Directly binding user input to href -->
          <a :href="userInput">Click Me</a>

          <!-- SAFE:  Using a computed property to sanitize the URL -->
          <a :href="safeUrl">Click Me</a>
        </template>
        <script>
        export default {
          data() {
            return {
              userInput: 'javascript:alert(1)' // Example XSS payload
            };
          },
          computed: {
            safeUrl() {
              // Basic URL validation (replace with a more robust solution)
              if (this.userInput.startsWith('http://') || this.userInput.startsWith('https://')) {
                return this.userInput;
              } else {
                return '#'; // Or a safe default URL
              }
            }
          }
        };
        </script>
        ```

*   **Component System (Props and Events):**
    *   **Threat:**  While Vue's component system promotes encapsulation, vulnerabilities can arise if components accept and render unsanitized data as props or if event handlers execute arbitrary code based on emitted event data.
    *   **Mitigation:**
        *   Treat props as potentially untrusted data, especially if they come from parent components that handle user input.  Sanitize props within the child component before rendering them.
        *   Validate the data received in event handlers.  Avoid executing arbitrary code based on event payloads.
        *   Use Vue's prop validation features to enforce type checking and basic validation rules.

*   **Provide/Inject:**
    * **Threat:** Similar to props, data passed through `provide` and `inject` should be treated as potentially untrusted, especially in large applications with complex component hierarchies.
    * **Mitigation:** Sanitize data before providing it, and validate/sanitize it again after injecting it.  Consider using a more structured approach like Vuex for managing application-wide state.

**2.2 Vue Router**

*   **Route Parameters and Query Strings:**
    *   **Threat:**  Unvalidated route parameters and query strings can be used for XSS attacks or to manipulate application logic.  For example, if a route parameter is directly rendered in the template without sanitization, it could lead to XSS.
    *   **Mitigation:**
        *   Always sanitize route parameters and query strings before using them in the template or in component logic.
        *   Use Vue Router's built-in navigation guards (e.g., `beforeEach`, `beforeResolve`) to validate route parameters and redirect to an error page if they are invalid.
        *   Avoid using route parameters to directly control sensitive operations without proper authorization checks.
    *   **Example:**
        ```vue
        // routes.js
        const routes = [
          {
            path: '/user/:id',
            component: UserProfile,
            beforeEnter: (to, from, next) => {
              // Basic validation of the 'id' parameter
              if (!/^\d+$/.test(to.params.id)) {
                next('/error'); // Redirect to an error page
              } else {
                next();
              }
            }
          }
        ];

        // UserProfile.vue
        <template>
          <div>User ID: {{ sanitizedUserId }}</div>
        </template>
        <script>
        import DOMPurify from 'dompurify';

        export default {
          computed: {
            sanitizedUserId() {
              return DOMPurify.sanitize(this.$route.params.id);
            }
          }
        };
        </script>
        ```

*   **Navigation Guards:**
    *   **Threat:**  Improperly implemented navigation guards could lead to bypasses of security checks.  For example, a guard that only checks for the presence of a token without validating its authenticity could be bypassed.
    *   **Mitigation:**
        *   Ensure navigation guards perform thorough validation of authentication and authorization tokens.
        *   Use a centralized authentication service to manage authentication and authorization logic.
        *   Avoid relying solely on client-side checks for security.  Always enforce security on the server-side.

**2.3 Vuex Store**

*   **State Management:**
    *   **Threat:**  Storing sensitive data (e.g., API keys, user tokens) directly in the Vuex store can be risky, as the store's state is accessible from anywhere in the application.  If an attacker gains access to the client-side code (e.g., through XSS), they could potentially retrieve this sensitive data.
    *   **Mitigation:**
        *   Avoid storing sensitive data directly in the Vuex store.
        *   If you must store sensitive data, consider using a more secure storage mechanism, such as browser cookies with the `HttpOnly` and `Secure` flags, or a dedicated client-side storage library with encryption capabilities.  However, remember that client-side storage is *never* completely secure.
        *   For API keys and tokens, consider using environment variables during the build process and injecting them into the application as constants.  This is still not perfectly secure, but it's better than storing them directly in the Vuex store.
        *   Use mutations to modify the state in a predictable and controlled manner.  Avoid directly mutating the state outside of mutations.

*   **Mutations and Actions:**
    *   **Threat:**  Mutations and actions that handle user input should be carefully validated to prevent vulnerabilities.
    *   **Mitigation:**  Sanitize user input *before* committing it to the Vuex store via mutations.

**2.4 Third-Party Libraries (e.g., Axios)**

*   **Threat:**  Vulnerabilities in third-party libraries can be exploited to compromise the application.  Axios, while generally secure, could have vulnerabilities or be misconfigured.
*   **Mitigation:**
    *   Regularly update all third-party libraries to their latest versions to patch known vulnerabilities.
    *   Use a dependency management tool (like `npm audit` or Snyk) to scan for vulnerabilities in dependencies.
    *   When using Axios, ensure you are using HTTPS for all API requests.
    *   Validate and sanitize data received from API responses before using it in the application.
    *   Configure Axios with appropriate timeouts and error handling to prevent denial-of-service attacks or information leakage.
    *   Avoid sending sensitive data in URL parameters. Use request bodies instead.

**2.5 Build and Deployment (Netlify)**

*   **Threat:**  The build process itself can be a target for attacks.  Compromised build tools or dependencies could inject malicious code into the final application.  The deployment environment (Netlify) could also be misconfigured or have vulnerabilities.
*   **Mitigation:**
    *   **Dependency Management:** Use `package-lock.json` or `yarn.lock` to ensure consistent and reproducible builds.  This helps prevent "dependency confusion" attacks.
    *   **Vulnerability Scanning:** Regularly run `npm audit` or use a dedicated vulnerability scanning tool (like Snyk) to identify and address vulnerabilities in dependencies.
    *   **Secure Build Environment:** Netlify provides a secure build environment, but it's important to follow their security best practices.
    *   **Netlify Configuration:**
        *   **HTTPS:** Ensure HTTPS is enabled and enforced for your site. Netlify provides automatic HTTPS provisioning.
        *   **Access Control:** Limit access to your Netlify account and configure appropriate permissions.
        *   **Headers:** Configure appropriate security headers, such as:
            *   **Content Security Policy (CSP):**  A crucial header to mitigate XSS attacks.  Vue.js is designed to be CSP-compatible, but you need to configure it correctly.  A strict CSP is highly recommended.
            *   **HTTP Strict Transport Security (HSTS):**  Enforces HTTPS connections.
            *   **X-Frame-Options:**  Protects against clickjacking attacks.
            *   **X-Content-Type-Options:**  Prevents MIME-sniffing vulnerabilities.
            *   **Referrer-Policy:**  Controls how much referrer information is sent with requests.
            *   **Permissions-Policy:** Controls which browser features your site can use.
        *   **Deploy Previews:** Use deploy previews to test changes in a staging environment before deploying to production.
        *   **Build Hooks:** Be cautious with build hooks, as they could be exploited if compromised.
        * **Environment Variables:** Use Netlify's environment variable feature to securely store sensitive configuration values (e.g., API keys). *Never* store secrets directly in your code repository.

**2.6 Data Flow**

*   **Threat:**  Data flowing between the client (Vue.js application), backend APIs, and third-party services can be intercepted or manipulated.
*   **Mitigation:**
    *   **HTTPS:**  Always use HTTPS for all communication between the client and the server.
    *   **Input Validation:**  Validate and sanitize all data received from the server before using it in the application.
    *   **Output Encoding:**  Encode data before displaying it in the UI to prevent XSS attacks.
    *   **CORS:**  Configure Cross-Origin Resource Sharing (CORS) properly on your backend API to restrict which origins can access your API.
    *   **CSRF Protection:**  Implement CSRF protection for any state-changing API requests.  This typically involves using a CSRF token that is validated on the server-side.  Axios can be configured to automatically include CSRF tokens in requests.

### 3. Review of Existing Security Controls

The Security Design Review outlines several existing security controls:

*   **Regular code reviews:**  Effective, but relies on the expertise and diligence of reviewers.  Should be supplemented with automated tools.
*   **Security audits:**  Valuable, but should be conducted regularly and by reputable third-party security researchers.
*   **Vulnerability disclosure program:**  Essential for responsible disclosure of vulnerabilities.  Should be clearly documented and easy to find.
*   **Dependency management:**  Good practice, but requires ongoing monitoring and updates.
*   **Content Security Policy (CSP) compatibility:**  Excellent, but requires proper configuration by developers.  Vue.js's documentation should provide clear guidance on CSP.
*   **Automated testing:**  Helps prevent regressions, but may not catch all security vulnerabilities.  Should include security-focused tests.

The "Accepted Risks" are also important to consider:

*   **Reliance on community contributions:**  Mitigated by code reviews and testing, but still a risk.
*   **XSS vulnerabilities in user-provided templates:**  A fundamental risk that must be addressed by developers through sanitization.  Vue.js should provide clear warnings and guidance on this.

### 4. Mitigation Strategies and Recommendations

This section summarizes the recommended mitigation strategies, categorized for clarity:

**4.1. General Recommendations:**

*   **Stay Updated:**  Keep Vue.js, Vue Router, Vuex, and all third-party libraries updated to their latest versions.
*   **Security Training:**  Provide security training to all developers working with Vue.js.  This training should cover common web vulnerabilities (OWASP Top 10) and Vue.js-specific security best practices.
*   **Security Champions:**  Establish a security champions program to promote security awareness and best practices within the development team.
*   **Regular Security Audits:** Conduct regular security audits by external security experts.
*   **Penetration Testing:** Perform regular penetration testing to simulate real-world attacks.

**4.2. Vue.js-Specific Recommendations:**

*   **Input Sanitization:**  *Always* sanitize user input before using it in templates, component logic, or Vuex mutations.  Use a dedicated sanitization library like DOMPurify.
*   **Avoid `v-html`:**  Minimize the use of `v-html`.  If you must use it, *always* sanitize the input with DOMPurify.
*   **Secure Route Handling:**  Validate route parameters and query strings using navigation guards and sanitization.
*   **Secure State Management:**  Avoid storing sensitive data directly in the Vuex store.  Use secure storage mechanisms or environment variables.
*   **CSP:**  Implement a strict Content Security Policy (CSP) to mitigate XSS attacks.  Use the `unsafe-inline` directive sparingly, and only if absolutely necessary.  Consider using a CSP nonce or hash for inline scripts.
*   **CSRF Protection:** Implement CSRF protection for all state-changing API requests.
*   **Secure Build Process:**  Use dependency locking, vulnerability scanning, and secure build environments.
*   **Netlify Security:** Configure Netlify with appropriate security headers, access control, and environment variables.

**4.3. Addressing the Questions:**

*   **Compliance Requirements:**  The framework itself doesn't directly handle compliance, but applications built with it *must* adhere to relevant regulations (GDPR, CCPA, etc.).  Developers are responsible for implementing appropriate data privacy and security measures.
*   **Vulnerability Reporting Process:**  Vue.js has a documented vulnerability disclosure program (https://vuejs.org/about/security.html). This should be followed.
*   **Security Policies for Contributors:**  The contribution guidelines (https://github.com/vuejs/core/blob/main/.github/contributing.md) mention code reviews, but could be expanded to include more explicit security guidelines.
*   **Support for Older Versions:**  Vue.js has a defined release schedule and support policy.  Older versions may receive security patches, but it's best to use the latest stable version.
*   **Future Security Features:**  The Vue.js team is continuously working on improving the framework, including security.  Stay informed about new releases and security updates.

**4.4. Addressing the Assumptions:**

The assumptions are generally reasonable, but it's important to verify them:

*   **Vue.js Team Prioritizes Security:**  This is supported by the existence of a vulnerability disclosure program and regular security updates.
*   **Community Involvement:**  The active Vue.js community is a valuable asset for identifying and reporting security issues.
*   **Developer Responsibility:**  This is crucial.  Developers *must* understand and implement security best practices in their applications.
*   **Framework Doesn't Handle Sensitive Data Directly:**  Generally true, but developers can choose to store sensitive data in the Vuex store, which is a risk.
*   **Deployment Model:**  Static hosting is common, but other deployment models (SSR, serverless) have their own security considerations.
*   **Build Process:**  Standard Node.js tooling is generally used, but developers should be aware of potential supply chain vulnerabilities.
*   **Git-Based Workflow:**  This is standard practice, but requires secure configuration of the Git repository and build server.

### 5. C4 Diagrams Security Controls and Responsibilities

This section revisits the C4 diagrams and highlights the security controls and responsibilities for each component, incorporating the findings of this analysis.

**5.1 C4 Context Diagram - Revisited**

| Component               | Security Controls                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               