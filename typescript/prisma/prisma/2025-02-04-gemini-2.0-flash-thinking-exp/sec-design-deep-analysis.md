## Deep Analysis of Prisma Security Considerations

### 1. Objective, Scope, and Methodology

**Objective:**

This deep analysis aims to provide a comprehensive security evaluation of the Prisma toolkit, focusing on its architecture, components, and interactions with applications and databases. The objective is to identify potential security vulnerabilities and risks associated with using Prisma, and to recommend specific, actionable mitigation strategies tailored to the Prisma ecosystem. This analysis will delve into the security implications of Prisma Client, Prisma Migrate, Prisma Studio, and Prisma CLI, considering their roles in the development lifecycle and runtime environment.

**Scope:**

The scope of this analysis encompasses the following key components of the Prisma toolkit as described in the provided Security Design Review:

*   **Prisma Client:**  Focus on query generation, input validation, database connection handling, and type safety aspects.
*   **Prisma Migrate:**  Focus on schema migration management, migration script security, and access control for migration execution.
*   **Prisma Studio:** Focus on GUI security, authentication, authorization within the Studio, and data exposure risks.
*   **Prisma CLI:** Focus on command execution security, credential handling, and orchestration of other Prisma tools.
*   **Deployment Architecture:** Cloud-based containerized deployment using Kubernetes and managed database services as described.
*   **Build Process:** CI/CD pipeline integration and security considerations during the build phase.

The analysis will consider the security posture outlined in the review, including existing and recommended security controls, and security requirements related to authentication, authorization, input validation, and cryptography.

**Methodology:**

This analysis will employ the following methodology:

1.  **Document Review:** Thoroughly review the provided Security Design Review document, including business and security posture, C4 diagrams (Context, Container, Deployment, Build), risk assessment, questions, and assumptions.
2.  **Architecture Inference:** Based on the C4 diagrams and component descriptions, infer the architecture, data flow, and interactions between Prisma components, applications, and databases.
3.  **Threat Modeling:** For each key component and interaction point, identify potential security threats and vulnerabilities, considering common attack vectors relevant to ORMs, database tools, and web applications.
4.  **Security Control Mapping:** Map the existing and recommended security controls from the design review to the identified threats and components.
5.  **Gap Analysis:** Identify gaps between the existing security controls and the potential threats, and areas where further security measures are needed.
6.  **Mitigation Strategy Formulation:** Develop specific, actionable, and Prisma-tailored mitigation strategies for each identified threat and gap, focusing on practical recommendations for developers and operations teams using Prisma.
7.  **Prioritization:**  Prioritize mitigation strategies based on the severity of the potential risks and the feasibility of implementation.

This methodology will ensure a structured and comprehensive analysis, leading to practical and valuable security recommendations for Prisma users.

### 2. Security Implications of Key Components

Based on the Security Design Review and inferred architecture, the following are the security implications for each key component of the Prisma toolkit:

**2.1 Prisma Client:**

*   **Security Implication 1: SQL Injection Vulnerabilities:**
    *   **Threat:** Despite Prisma's ORM nature, vulnerabilities could arise if input sanitization or query parameterization is insufficient, leading to SQL injection attacks. This is especially relevant if developers use raw queries or bypass Prisma's query builder in certain scenarios.
    *   **Specific Risk:** Malicious actors could manipulate application inputs to inject arbitrary SQL code, potentially leading to data breaches, data modification, or denial of service.
    *   **Architecture Context:** Prisma Client is the primary interface between the Application Code and the Database Server. Input validation and secure query generation within Prisma Client are critical.

*   **Security Implication 2: Database Credential Exposure and Management:**
    *   **Threat:**  Prisma Client requires database credentials to connect to the Database Server. Mismanagement or exposure of these credentials in application code, configuration files, or logs could lead to unauthorized database access.
    *   **Specific Risk:** Attackers gaining access to database credentials could bypass application-level security and directly access or manipulate the database.
    *   **Architecture Context:** Prisma Client handles database connections. Secure storage and retrieval of database credentials within the application environment are crucial.

*   **Security Implication 3: ORM Misconfiguration and Logic Bugs:**
    *   **Threat:** Incorrectly configured Prisma Client or logic errors in application code using Prisma Client could lead to unintended data access, modification, or deletion. This might not be a direct vulnerability in Prisma itself but a consequence of its usage.
    *   **Specific Risk:** Data integrity issues, unauthorized data access due to flawed application logic interacting with the database through Prisma Client.
    *   **Architecture Context:** The application developer is responsible for correctly using Prisma Client. Misunderstandings or errors in implementation can introduce security flaws.

*   **Security Implication 4: Dependency Vulnerabilities in Prisma Client Library:**
    *   **Threat:** Prisma Client library relies on dependencies. Vulnerabilities in these dependencies could be exploited if not properly managed and updated.
    *   **Specific Risk:** Compromise of Prisma Client functionality or the application using it due to vulnerabilities in underlying libraries.
    *   **Architecture Context:** Prisma Client is a library integrated into the Application Pod. Regular dependency scanning and updates are essential.

**2.2 Prisma Migrate:**

*   **Security Implication 1: Malicious Migration Scripts:**
    *   **Threat:** If not properly controlled, malicious actors (insiders or compromised developer accounts) could introduce harmful migration scripts that alter the database schema in a way that compromises security or data integrity.
    *   **Specific Risk:** Data corruption, unauthorized data access, denial of service through schema manipulation.
    *   **Architecture Context:** Prisma Migrate directly interacts with the Database Server to modify the schema. Strict access control and review processes for migration scripts are necessary.

*   **Security Implication 2: Unauthorized Migration Execution:**
    *   **Threat:** If access to execute Prisma Migrate commands is not restricted, unauthorized individuals could apply migrations, potentially disrupting services or introducing malicious changes.
    *   **Specific Risk:** Unintended or malicious database schema changes leading to application instability or security breaches.
    *   **Architecture Context:** Prisma CLI and Migrate are typically used in development and deployment environments. Access control to these tools is vital.

*   **Security Implication 3: Database Credential Exposure in Migration Process:**
    *   **Threat:** Prisma Migrate requires database credentials to apply migrations. If these credentials are exposed during the migration process (e.g., in logs, scripts, or configuration files), they could be compromised.
    *   **Specific Risk:** Unauthorized database access using exposed credentials.
    *   **Architecture Context:** Prisma Migrate connects to the Database Server. Secure credential management during migration execution is essential.

**2.3 Prisma Studio:**

*   **Security Implication 1: Unauthorized Access to Prisma Studio:**
    *   **Threat:** If Prisma Studio is accessible without proper authentication and authorization, unauthorized users could gain access to sensitive database data and potentially modify it.
    *   **Specific Risk:** Data breaches, data manipulation, and unauthorized access to database management functionalities.
    *   **Architecture Context:** Prisma Studio is a GUI application that connects to the Database Server. Secure authentication and access control are paramount.

*   **Security Implication 2: Data Exposure through Prisma Studio Interface:**
    *   **Threat:** Even with authentication, insufficient authorization controls within Prisma Studio could allow users to access or modify data beyond their intended permissions.
    *   **Specific Risk:** Data breaches, data manipulation, and privilege escalation within the database management interface.
    *   **Architecture Context:** Prisma Studio provides a direct interface to database data. Granular authorization controls within Studio are needed.

*   **Security Implication 3: Vulnerabilities in Prisma Studio Application:**
    *   **Threat:** Prisma Studio, being a GUI application, could contain vulnerabilities that could be exploited by attackers.
    *   **Specific Risk:** Compromise of the Prisma Studio application itself, potentially leading to unauthorized database access or other malicious actions.
    *   **Architecture Context:** Prisma Studio is a separate application interacting with the Database Server. Regular security updates and vulnerability scanning are important.

**2.4 Prisma CLI:**

*   **Security Implication 1: Unauthorized Command Execution:**
    *   **Threat:** If access to Prisma CLI commands is not controlled, unauthorized users could execute commands, including those related to migrations or database management, leading to security breaches or service disruption.
    *   **Specific Risk:** Unintended or malicious database operations, schema changes, or access to sensitive information.
    *   **Architecture Context:** Prisma CLI is the central command-line interface for Prisma tools. Access control to CLI commands is crucial.

*   **Security Implication 2: Credential Handling by Prisma CLI:**
    *   **Threat:** Prisma CLI might handle database credentials or other sensitive information. Insecure handling of these credentials (e.g., storing in plain text, logging) could lead to exposure.
    *   **Specific Risk:** Unauthorized database access or compromise of other sensitive information.
    *   **Architecture Context:** Prisma CLI orchestrates various Prisma operations. Secure credential management within the CLI is essential.

### 3. Architecture, Components, and Data Flow Inference

Based on the provided diagrams and descriptions, the architecture, components, and data flow can be inferred as follows:

1.  **Application Developer** uses **Prisma CLI** to interact with **Prisma Migrate** and **Prisma Studio** for schema management and data exploration. They also use **Prisma Client** library in their **Application Code**.
2.  **Prisma CLI** acts as a central command-line interface, orchestrating **Prisma Migrate** and **Prisma Studio**.
3.  **Prisma Migrate** connects directly to the **Database Server** to apply schema migrations based on the Prisma schema and migration scripts.
4.  **Prisma Studio** connects directly to the **Database Server** to provide a GUI for data visualization and management.
5.  **Prisma Client** is integrated as a library within the **Application Code**. The **Application Code** uses **Prisma Client** to construct and execute database queries.
6.  **Prisma Client** connects to the **Database Server** to execute queries on behalf of the **Application Code**.
7.  All connections to the **Database Server** (from Prisma Client, Migrate, and Studio) are expected to be secured using TLS/SSL.
8.  Database credentials are required for Prisma Client, Migrate, and Studio to connect to the **Database Server**. These credentials need to be securely managed and provided to these components.
9.  In a cloud deployment, the **Application Pod** (containing **Application Code** and **Prisma Client**) and **Prisma CLI** (used during build/deploy) interact with a **Managed Database Service**.

**Data Flow Summary:**

*   **Schema Definition:** Application Developer defines the database schema using Prisma Schema Language.
*   **Migration Generation:** Prisma Migrate, via Prisma CLI, generates migration scripts based on schema changes.
*   **Migration Application:** Prisma Migrate, via Prisma CLI, applies migration scripts to the Database Server, modifying the database schema.
*   **Query Building:** Application Code uses Prisma Client to build type-safe database queries.
*   **Query Execution:** Prisma Client executes the generated queries against the Database Server, retrieving or modifying data.
*   **Data Exploration & Management:** Prisma Studio provides a GUI to browse, edit, and manage data directly in the Database Server.

### 4. Specific and Tailored Security Recommendations for Prisma Projects

Based on the identified security implications, here are specific and tailored security recommendations for projects using Prisma:

**4.1 Prisma Client Security Recommendations:**

*   **Recommendation 1: Implement Parameterized Queries Exclusively:**
    *   **Specific Action:** Enforce the use of Prisma Client's parameterized query features and strictly avoid raw SQL queries or string interpolation for user inputs.
    *   **Rationale:** Directly mitigates SQL injection risks by ensuring user inputs are treated as data, not executable code.
    *   **Tailored to Prisma:** Prisma Client is designed for parameterized queries; leveraging this feature is the most effective defense against SQL injection.

*   **Recommendation 2: Securely Manage Database Credentials:**
    *   **Specific Action:** Utilize environment variables or dedicated secret management solutions (e.g., HashiCorp Vault, AWS Secrets Manager, Kubernetes Secrets) to store and retrieve database credentials. Avoid hardcoding credentials in application code or configuration files.
    *   **Rationale:** Reduces the risk of credential exposure in source code or configuration, limiting the impact of potential breaches.
    *   **Tailored to Prisma:** Prisma configurations often rely on environment variables for database connection strings; extend this practice to all credential management.

*   **Recommendation 3: Implement Application-Level Authorization:**
    *   **Specific Action:**  Do not rely solely on database-level authorization. Implement robust application-level authorization logic within the Application Code using Prisma Client to control access to specific data and operations based on user roles and permissions.
    *   **Rationale:** Provides granular access control beyond database-level permissions, aligning with business logic and user roles.
    *   **Tailored to Prisma:** Prisma Client facilitates complex queries and data manipulation; application-level authorization is crucial to control how these capabilities are used.

*   **Recommendation 4: Regularly Update Prisma Client and Dependencies:**
    *   **Specific Action:**  Implement a process for regularly updating Prisma Client library and its dependencies to the latest versions to patch known vulnerabilities. Utilize dependency scanning tools in the CI/CD pipeline.
    *   **Rationale:** Addresses dependency vulnerabilities and ensures access to the latest security fixes and improvements in Prisma Client.
    *   **Tailored to Prisma:** Prisma is actively developed; staying updated is essential for security and performance.

**4.2 Prisma Migrate Security Recommendations:**

*   **Recommendation 5: Restrict Access to Migration Execution:**
    *   **Specific Action:** Limit access to execute Prisma Migrate commands (e.g., `prisma migrate deploy`, `prisma migrate dev`) to authorized personnel and environments (e.g., CI/CD pipelines, designated development/staging environments). Implement access control mechanisms (e.g., RBAC in Kubernetes, restricted SSH access to servers).
    *   **Rationale:** Prevents unauthorized or accidental database schema changes, reducing the risk of malicious migrations or service disruption.
    *   **Tailored to Prisma:** Prisma Migrate is a powerful tool for schema changes; controlling its access is critical for database integrity and security.

*   **Recommendation 6: Implement Migration Script Review Process:**
    *   **Specific Action:**  Establish a code review process for all Prisma migration scripts before they are applied to production or critical environments. Use version control for migration scripts and track changes.
    *   **Rationale:** Detects potentially malicious or erroneous migration scripts before they impact the database, ensuring schema integrity and preventing unintended consequences.
    *   **Tailored to Prisma:** Prisma Migrate generates migration scripts; reviewing these scripts is a crucial security step.

*   **Recommendation 7: Securely Store and Manage Migration History:**
    *   **Specific Action:** Ensure the migration history table (`_prisma_migrations`) is protected and backed up along with the rest of the database. Do not manually modify the migration history table.
    *   **Rationale:** Protects the integrity of the migration history, which is essential for rollback and auditing purposes. Prevents tampering with migration records.
    *   **Tailored to Prisma:** Prisma Migrate relies on the migration history table for tracking schema changes; its integrity is vital for migration management.

**4.3 Prisma Studio Security Recommendations:**

*   **Recommendation 8: Implement Strong Authentication for Prisma Studio:**
    *   **Specific Action:**  Configure authentication for Prisma Studio access. If possible, integrate with existing authentication systems (e.g., SSO, OAuth). At a minimum, use strong, unique passwords and consider multi-factor authentication.
    *   **Rationale:** Prevents unauthorized access to Prisma Studio and the underlying database data.
    *   **Tailored to Prisma:** Prisma Studio provides direct access to database data; strong authentication is non-negotiable.

*   **Recommendation 9: Implement Authorization Controls within Prisma Studio (if feasible):**
    *   **Specific Action:** Explore if Prisma Studio offers any built-in authorization controls to limit data access or actions based on user roles. If not, restrict access to Prisma Studio to only necessary personnel and consider network segmentation to limit exposure.
    *   **Rationale:** Minimizes the risk of data breaches or unauthorized data manipulation within the Prisma Studio interface.
    *   **Tailored to Prisma:** Prisma Studio's primary function is data access and management; authorization within the tool is highly desirable.

*   **Recommendation 10: Deploy Prisma Studio in Secure Environments:**
    *   **Specific Action:**  Deploy Prisma Studio in non-production environments or behind a VPN/firewall to restrict access from public networks. Avoid exposing Prisma Studio directly to the internet.
    *   **Rationale:** Reduces the attack surface and limits the potential for unauthorized access to Prisma Studio from external networks.
    *   **Tailored to Prisma:** Prisma Studio is primarily a development/admin tool and should not be publicly accessible.

**4.4 Prisma CLI Security Recommendations:**

*   **Recommendation 11: Restrict Access to Prisma CLI in Production Environments:**
    *   **Specific Action:**  Do not install or expose Prisma CLI in production runtime environments unless absolutely necessary for specific operational tasks. Limit its use to development, staging, and build environments.
    *   **Rationale:** Reduces the attack surface in production and prevents potential misuse of Prisma CLI commands in a live environment.
    *   **Tailored to Prisma:** Prisma CLI is primarily a development and deployment tool; its presence in production should be minimized.

*   **Recommendation 12: Securely Manage Credentials Used by Prisma CLI:**
    *   **Specific Action:**  When using Prisma CLI commands that require database credentials (e.g., `prisma migrate deploy`), ensure credentials are provided securely, preferably through environment variables or secure secret injection mechanisms. Avoid hardcoding credentials in scripts or command-line arguments.
    *   **Rationale:** Prevents credential exposure during CLI operations and reduces the risk of unauthorized database access.
    *   **Tailored to Prisma:** Prisma CLI interacts with the database; secure credential handling is essential for its operations.

### 5. Actionable and Tailored Mitigation Strategies

The following table summarizes the actionable and tailored mitigation strategies for the identified threats, linking them back to the specific security implications and recommendations:

| Threat                                       | Security Implication                                  | Recommendation                                              | Actionable Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      