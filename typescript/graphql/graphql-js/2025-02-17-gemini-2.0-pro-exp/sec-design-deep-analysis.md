## Deep Security Analysis of GraphQL-JS

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep security analysis is to conduct a thorough examination of the `graphql-js` library (https://github.com/graphql/graphql-js) to identify potential security vulnerabilities, weaknesses, and areas for improvement.  This analysis focuses on the core components of `graphql-js` responsible for query parsing, validation, and execution, and how these components interact with application-level code (resolvers).  The goal is to provide actionable recommendations to mitigate identified risks and enhance the overall security posture of applications built using `graphql-js`.

**Scope:**

This analysis focuses on the core `graphql-js` library itself, *not* on the security of applications built *using* the library.  However, we will analyze how `graphql-js` *enables* or *potentially hinders* secure application development.  We will examine:

*   **Query Parsing and Lexing:**  How `graphql-js` handles potentially malicious or malformed input.
*   **Validation:**  The built-in validation rules and their effectiveness against common GraphQL attacks.
*   **Execution:**  How the execution engine handles resolvers, field resolution, and error handling.
*   **Schema Definition:**  How schema design choices can impact security.
*   **Introspection:**  Security implications of the introspection system.
*   **Dependencies:**  The security posture of `graphql-js`'s direct dependencies (though a full SCA is out of scope).

**Methodology:**

1.  **Code Review:**  Manual inspection of the `graphql-js` source code on GitHub, focusing on areas identified in the scope.
2.  **Documentation Review:**  Analysis of the official GraphQL specification and `graphql-js` documentation.
3.  **Threat Modeling:**  Identification of potential threats based on the library's architecture and functionality, using the provided C4 diagrams and security design review as a starting point.
4.  **Vulnerability Analysis:**  Inferring potential vulnerabilities based on code review, threat modeling, and known GraphQL attack vectors.
5.  **Mitigation Recommendation:**  Providing specific, actionable recommendations to address identified vulnerabilities and weaknesses.

### 2. Security Implications of Key Components

This section breaks down the security implications of the key components outlined in the scope.

**2.1 Query Parsing and Lexing (`src/language/*`)**

*   **Functionality:**  The lexer and parser convert the raw GraphQL query string into an Abstract Syntax Tree (AST).
*   **Threats:**
    *   **Denial of Service (DoS) via Malformed Queries:**  Crafting extremely long or deeply nested queries, or queries with many aliases, can consume excessive server resources (CPU, memory), leading to DoS.  This is a classic resource exhaustion attack.
    *   **Information Disclosure via Error Messages:**  Verbose error messages during parsing could reveal information about the schema or internal implementation details.
*   **`graphql-js` Mechanisms:**
    *   `graphql-js` uses a recursive descent parser.  While generally efficient, recursive descent parsers can be vulnerable to stack overflow errors if not carefully implemented.
    *   The lexer and parser include checks for syntax errors and invalid characters.
    *   Error messages are generated, but their verbosity can be controlled.
*   **Inferred Vulnerabilities:**
    *   Potential for stack overflow with extremely deeply nested queries, although `graphql-js` likely has mitigations (we'd need to examine the recursion depth limits).
    *   Potential for resource exhaustion with excessively large or complex queries.
    *   The default error messages might be too verbose in a production environment.
*   **Mitigation Strategies:**
    *   **Maximum Query Depth:**  Implement a maximum query depth limit *at the application level* (e.g., using a middleware or a custom validation rule).  `graphql-js` doesn't enforce this directly, but provides the tools to do so.
    *   **Maximum Query Complexity:**  Implement a maximum query complexity limit, often based on the number of fields or aliases.  Again, this is an *application-level* concern, using `graphql-js`'s visitor API.
    *   **Query Cost Analysis:**  Implement a cost analysis system to estimate the resource consumption of a query *before* execution.  This is a more sophisticated approach than simple depth/complexity limiting.
    *   **Error Handling:**  Customize error handling to return generic error messages to clients in production, while providing detailed errors during development.  Use `formatError` in `graphql-js`.
    *   **Input Sanitization:** While GraphQL's strong typing helps, consider additional input sanitization in resolvers, especially for arguments that accept free-form text.

**2.2 Validation (`src/validation/*`)**

*   **Functionality:**  The validation phase checks the AST against the schema and the GraphQL specification rules.
*   **Threats:**
    *   **Bypassing Validation:**  If validation rules are incomplete or incorrectly implemented, malicious queries could bypass checks and access unauthorized data or trigger unexpected behavior.
    *   **DoS via Validation:**  Crafting queries that trigger computationally expensive validation rules could lead to DoS.
*   **`graphql-js` Mechanisms:**
    *   `graphql-js` implements a comprehensive set of validation rules based on the GraphQL specification.  These rules cover type checking, field existence, argument validity, and more.
    *   The `validate` function performs the validation.
*   **Inferred Vulnerabilities:**
    *   While `graphql-js`'s validation is robust, it's crucial to ensure that *all* relevant validation rules are enabled.  Custom validation rules might be needed for application-specific logic.
    *   There's a theoretical possibility of DoS if a specific validation rule is computationally expensive and can be triggered repeatedly by a malicious query.  This is less likely than parsing-related DoS.
*   **Mitigation Strategies:**
    *   **Review Enabled Validation Rules:**  Ensure that all standard validation rules are enabled.
    *   **Custom Validation Rules:**  Implement custom validation rules *at the application level* to enforce business-specific constraints and security policies.  Use the `specifiedRules` array and the visitor API to add custom rules.
    *   **Regularly Update `graphql-js`:**  Stay up-to-date with the latest version of `graphql-js` to benefit from bug fixes and security improvements, including potential improvements to validation rules.

**2.3 Execution (`src/execution/*`)**

*   **Functionality:**  The execution engine traverses the validated AST, calls resolvers to fetch data, and constructs the response.
*   **Threats:**
    *   **N+1 Problem (Performance/DoS):**  Poorly written resolvers can lead to the "N+1 problem," where fetching data for a list of items results in a separate database query for *each* item.  This can severely impact performance and potentially lead to DoS.
    *   **Data Leakage:**  If resolvers don't properly handle authorization, they could leak sensitive data to unauthorized users.
    *   **Insecure Direct Object Reference (IDOR):**  If resolvers directly use user-provided IDs to access resources without proper authorization checks, attackers could access data belonging to other users.
    *   **Uncaught Exceptions:**  Uncaught exceptions in resolvers could lead to unexpected behavior or information disclosure.
*   **`graphql-js` Mechanisms:**
    *   `graphql-js` provides the `execute` function to run the query.
    *   Resolvers are provided by the application, not by `graphql-js` itself.  This is a *critical* point: **resolver security is entirely the application's responsibility.**
    *   `graphql-js` handles errors that occur during execution, but the level of detail in the error message is configurable.
*   **Inferred Vulnerabilities:**
    *   The N+1 problem is a significant risk, and `graphql-js` *does not* automatically prevent it.  This is a common performance and potential DoS vulnerability.
    *   Data leakage and IDOR are entirely dependent on the implementation of resolvers.  `graphql-js` provides no built-in protection against these.
*   **Mitigation Strategies:**
    *   **DataLoader:**  Use the `DataLoader` pattern (provided as a separate library, but often used with `graphql-js`) to batch and cache data fetching, mitigating the N+1 problem.  This is *essential* for performance and security.
    *   **Authorization in Resolvers:**  Implement *thorough* authorization checks within *every* resolver that accesses sensitive data.  Check user roles, permissions, and ownership of resources.  *Never* trust user-provided IDs without validation.
    *   **Input Validation in Resolvers:**  Validate *all* inputs to resolvers, even if they have passed GraphQL's type validation.  Use libraries like `validator.js` for common validation tasks.
    *   **Error Handling in Resolvers:**  Implement robust error handling in resolvers.  Catch all exceptions and return appropriate error messages.  Avoid exposing internal implementation details.
    *   **Rate Limiting:** Implement rate limiting *at the application level* (e.g., using middleware) to prevent abuse and DoS attacks.  This can be applied to specific fields or resolvers.
    * **Field-Level Authorization:** Implement fine-grained authorization at the field level, potentially using directives or middleware to control access to specific fields based on user roles or attributes.

**2.4 Schema Definition (`src/type/*`)**

*   **Functionality:**  The schema defines the types, fields, and relationships available in the GraphQL API.
*   **Threats:**
    *   **Overly Permissive Schema:**  Exposing too much data or functionality through the schema can increase the attack surface.
    *   **Poorly Defined Types:**  Using vague or imprecise types can make it harder to validate input and prevent errors.
*   **`graphql-js` Mechanisms:**
    *   `graphql-js` provides a robust system for defining schemas using the GraphQL schema definition language (SDL) or programmatically.
*   **Inferred Vulnerabilities:**
    *   The schema design itself is a major factor in security.  A poorly designed schema can create vulnerabilities, even if the `graphql-js` library itself is secure.
*   **Mitigation Strategies:**
    *   **Principle of Least Privilege:**  Expose only the data and functionality that is *absolutely necessary* for the application.  Avoid exposing internal fields or implementation details.
    *   **Use Specific Types:**  Use the most specific types possible (e.g., `Int`, `String`, `Boolean`, custom scalars) to improve validation and prevent errors.
    *   **Consider Field-Level Permissions:** Think about which fields should be accessible to which users or roles *during schema design*.
    *   **Avoid Over-Fetching:** Design the schema to allow clients to request only the data they need, reducing the risk of exposing unnecessary information.

**2.5 Introspection (`src/utilities/introspectionQuery.js`)**

*   **Functionality:**  Introspection allows clients to query the schema itself, discovering available types, fields, and arguments.
*   **Threats:**
    *   **Information Disclosure:**  Introspection can reveal information about the schema that could be useful to attackers.
    *   **DoS via Introspection:**  Complex introspection queries could potentially consume excessive resources.
*   **`graphql-js` Mechanisms:**
    *   `graphql-js` implements the standard GraphQL introspection system.
*   **Inferred Vulnerabilities:**
    *   Introspection is a powerful tool, but it can also be a security risk if not properly controlled.
*   **Mitigation Strategies:**
    *   **Disable Introspection in Production:**  The most common and effective mitigation is to *disable* introspection in production environments.  This prevents attackers from easily discovering the schema structure.  This is done at the *application level*, not within `graphql-js` itself.
    *   **Limit Introspection Depth:**  If introspection must be enabled, consider limiting the depth of introspection queries to prevent resource exhaustion.
    *   **Rate Limit Introspection:**  Apply rate limiting specifically to introspection queries.

**2.6 Dependencies**

*   **Threats:**  Vulnerabilities in dependencies can be exploited to compromise the application.
*   **`graphql-js` Mechanisms:** `graphql-js` has a relatively small number of direct dependencies.
*   **Inferred Vulnerabilities:**  Regularly checking for and updating dependencies is crucial.
*   **Mitigation Strategies:**
    *   **SCA (Software Composition Analysis):** Use SCA tools (e.g., Snyk, Dependabot, npm audit) to identify and manage vulnerabilities in dependencies.  This is a *build-time* and *ongoing* process.
    *   **Regular Updates:**  Keep `graphql-js` and its dependencies up-to-date.

### 3. Actionable Mitigation Strategies (Summary and Prioritization)

The following table summarizes the key mitigation strategies, categorized by priority and the component they address:

| Priority | Component          | Mitigation Strategy                                                                                                                                                                                                                                                           | Implementation Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 
                                                                 