## Deep Security Analysis of VCR Library

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to comprehensively evaluate the security posture of the VCR library, a Ruby gem designed for recording and replaying HTTP interactions to facilitate robust and efficient testing. The analysis will focus on identifying potential security vulnerabilities, risks associated with its design and usage, and recommend actionable mitigation strategies tailored to the VCR project.  A key objective is to analyze how VCR handles sensitive data within recorded cassettes and to propose enhancements to minimize the risk of accidental data exposure.

**Scope:**

The scope of this analysis encompasses the following aspects of the VCR library, based on the provided Security Design Review and inferred architecture:

*   **Key Components:** Request Interceptor, Cassette Manager, Configuration Manager, HTTP Client Wrapper, and Cassette Storage.
*   **Data Flow:**  Analysis of how HTTP requests and responses are intercepted, recorded, stored, and replayed. Special attention will be given to the handling of sensitive data throughout this flow.
*   **Deployment Scenarios:** Local Development Environment, Continuous Integration (CI) Environment, and Shared Test Environment, focusing on the security implications in each context.
*   **Build Process:** Examination of the build pipeline for security vulnerabilities and opportunities for improvement.
*   **Identified Business and Security Risks:**  Analysis of the risks outlined in the Security Design Review and expansion upon them based on the component analysis.
*   **Existing and Recommended Security Controls:** Evaluation of the effectiveness of current controls and detailed recommendations for enhancing security.

**Methodology:**

This analysis will employ a combination of methods:

*   **Security Design Review Analysis:**  Leveraging the provided Security Design Review document as a starting point to understand the business and security context, existing controls, and identified risks.
*   **Codebase Inference (Documentation-Driven):**  While direct codebase review is not explicitly requested, the analysis will infer architectural details, component functionalities, and data flow based on the provided C4 diagrams, element descriptions, and general understanding of how a library like VCR operates. This will be supplemented by publicly available VCR documentation to understand its features and configuration options.
*   **Threat Modeling (Component-Based):**  For each key component, potential threats and vulnerabilities will be identified, considering the component's responsibilities and interactions with other components and the environment.
*   **Risk-Based Approach:**  Prioritizing security recommendations based on the severity of potential risks and their impact on the business goals and security posture outlined in the review.
*   **Actionable Recommendations:**  Focusing on providing specific, practical, and tailored mitigation strategies that can be implemented by the VCR development team and users.

### 2. Security Implications of Key Components

Based on the C4 Container diagram and component descriptions, the security implications of each key component are analyzed below:

**2.1. Request Interceptor:**

*   **Functionality:** Intercepts HTTP requests made by the application under test. Determines whether to record or replay based on cassette availability and VCR configuration.
*   **Security Implications:**
    *   **Bypass of Application Security Logic (Potential):** If not implemented carefully, the Request Interceptor could potentially bypass certain security checks or logic within the application under test itself. For example, if the application relies on specific request headers for security, VCR's interception and replay mechanism must ensure these are handled consistently and securely.
    *   **Vulnerability Introduction (Low):**  While less likely, vulnerabilities in the request interception logic itself could be introduced. This component interacts closely with the underlying HTTP client and needs to handle request and response objects securely to avoid issues like injection vulnerabilities or data corruption during interception.
    *   **Configuration Misuse:** Incorrect configuration of the interceptor (e.g., overly broad request matching rules) could lead to unintended recording or replaying of requests, potentially including sensitive interactions that should not be persisted in cassettes.

**2.2. Cassette Manager:**

*   **Functionality:** Manages cassette files, including loading, saving, searching, configuration, and sanitization.
*   **Security Implications:**
    *   **Sensitive Data Exposure (High):** This is the most critical component from a security perspective. The Cassette Manager is responsible for handling cassette files, which can contain sensitive data recorded from HTTP interactions.  Insufficient or ineffective sanitization within this component directly leads to the risk of data leaks if cassettes are not properly secured.
    *   **Sanitization Vulnerabilities:**  If sanitization logic is flawed or incomplete, it may fail to remove all sensitive data, leaving residual information in cassettes. Vulnerabilities in sanitization logic itself could also be exploited if attackers can manipulate sanitization rules.
    *   **Insecure File Handling:**  Vulnerabilities related to file system operations (e.g., path traversal, insecure file permissions) within the Cassette Manager could allow unauthorized access to or modification of cassette files.
    *   **Configuration-Driven Security Weakness:**  Sanitization rules and cassette storage locations are often configuration-driven. Insecure default configurations or lack of clear guidance on secure configuration can lead to users inadvertently creating insecure setups.

**2.3. Configuration Manager:**

*   **Functionality:** Manages VCR's configuration, including recording mode, cassette directory, and request matching rules.
*   **Security Implications:**
    *   **Insecure Defaults:**  Insecure default configurations (e.g., overly permissive recording modes, default cassette storage locations in publicly accessible directories) can increase the risk of sensitive data exposure.
    *   **Lack of Security-Focused Configuration Options:**  If the Configuration Manager does not provide sufficient options for security hardening (e.g., enforcing sanitization, secure cassette storage paths, warnings about sensitive data), users may not be able to easily configure VCR securely.
    *   **Configuration Injection (Low):**  While less likely in typical usage, vulnerabilities in how configuration is loaded and parsed could potentially lead to configuration injection attacks if an attacker can influence the configuration source.

**2.4. HTTP Client Wrapper:**

*   **Functionality:** Wraps the underlying HTTP client library (e.g., Net::HTTP). Used to make actual HTTP requests during recording.
*   **Security Implications:**
    *   **Dependency Vulnerabilities (Medium):**  The security of the HTTP Client Wrapper is heavily reliant on the security of the underlying HTTP client library.  Vulnerabilities in the HTTP client library (e.g., in parsing HTTP responses, handling TLS) can be indirectly exposed through VCR if the wrapper doesn't properly isolate or mitigate these issues.
    *   **Outdated Dependencies:**  If VCR depends on an outdated version of the HTTP client library with known vulnerabilities, it inherits those risks.  Maintaining up-to-date dependencies is crucial.
    *   **Incorrect Usage of HTTP Client (Low):**  While less likely, incorrect usage of the HTTP client library within the wrapper could potentially introduce vulnerabilities, such as mishandling of TLS certificates or insecure request construction.

**2.5. Cassette Storage:**

*   **Functionality:** File system directory where cassette files are stored.
*   **Security Implications:**
    *   **Unauthorized Access (High):** If cassette storage is not properly secured at the file system level, unauthorized users or processes could gain access to cassette files, potentially exposing sensitive data contained within. This is especially critical in shared environments (CI, shared test environments).
    *   **Insecure Storage Location:**  Storing cassettes in publicly accessible directories (e.g., web server document roots, shared network drives without proper access controls) significantly increases the risk of data leaks.
    *   **Lack of Encryption at Rest (Medium):**  Cassette files are typically stored in plain text formats (YAML, JSON).  Lack of encryption at rest means that if the storage is compromised, the data within the cassettes is readily accessible.

### 3. Architecture, Components, and Data Flow Inference

Based on the provided diagrams and descriptions, the inferred architecture, components, and data flow are as follows:

**Architecture:** VCR adopts a modular architecture with clear separation of concerns. It acts as a middleware layer between the application under test and external HTTP services during testing.

**Components (as detailed in Container Diagram):**

*   **Request Interceptor:** The entry point for HTTP requests. It uses hooks or monkey-patching techniques to intercept requests made by the application's HTTP client.
*   **Cassette Manager:** The core component responsible for cassette lifecycle management. It handles loading, saving, and searching cassettes. It also applies sanitization rules defined in the configuration.
*   **Configuration Manager:**  Centralized component for managing VCR's settings. It provides configuration options to other components, influencing recording behavior, cassette storage, and sanitization.
*   **HTTP Client Wrapper:**  Provides an abstraction over the underlying HTTP client. Used for making actual HTTP requests when recording new interactions. This likely allows VCR to support different HTTP client libraries.
*   **Cassette Storage:**  Represents the file system where cassettes are persisted.  The format is typically YAML or JSON.

**Data Flow (Simplified):**

1.  **Application Under Test Makes HTTP Request:** The application code, during test execution, attempts to make an HTTP request to an external service.
2.  **Request Interception:** The Request Interceptor intercepts this request before it reaches the actual HTTP client.
3.  **Cassette Lookup:** The Request Interceptor consults the Cassette Manager to check if a matching cassette exists for this request based on configured matching rules.
4.  **Replay (Cassette Found):** If a cassette is found and VCR is in replay mode, the Cassette Manager retrieves the recorded response from the cassette. The Request Interceptor returns this recorded response to the application, effectively mocking the external service.
5.  **Record (Cassette Not Found or Record Mode):** If no cassette is found or VCR is in record mode, the Request Interceptor uses the HTTP Client Wrapper to make the actual HTTP request to the external service.
6.  **Response Recording:** The HTTP Client Wrapper receives the response from the external service. The Request Interceptor, via the Cassette Manager, records both the request and the response into a new cassette file in Cassette Storage. Sanitization rules are applied by the Cassette Manager before saving sensitive data to the cassette.
7.  **Response Return:** The Request Interceptor returns the actual response (from the external service or replayed from cassette) to the application under test.

**Sensitive Data Flow:** Sensitive data can enter the data flow in HTTP requests (e.g., in headers, body, query parameters) and responses (e.g., in headers, body). The Cassette Manager and its sanitization logic are critical points in this flow for preventing sensitive data from being persisted in cassettes.

### 4. Specific Security Recommendations for VCR

Based on the analysis, here are specific and actionable security recommendations tailored to the VCR project:

**4.1. Enhance Cassette Sanitization Capabilities (High Priority):**

*   **Recommendation:**  Develop and promote robust, built-in sanitization features within VCR. This should go beyond basic string replacement and include:
    *   **Regular Expression Based Sanitization:** Allow users to define regular expressions to identify and redact sensitive patterns in headers, bodies, and URLs.
    *   **Header-Specific Sanitization:** Provide pre-defined sanitization rules for common sensitive headers like `Authorization`, `Cookie`, `X-API-Key`, etc.
    *   **Body-Specific Sanitization (Content-Aware):**  For common content types (JSON, XML), offer options to sanitize specific fields or nodes based on paths or keys.
    *   **Callback/Custom Sanitization Functions:** Allow users to define custom Ruby functions to implement more complex or application-specific sanitization logic.
*   **Actionable Steps:**
    *   Prioritize development of more advanced sanitization features in upcoming releases.
    *   Provide clear and comprehensive documentation on how to use sanitization effectively, with examples for common sensitive data types.
    *   Consider creating a library of pre-built sanitization rules for common sensitive data patterns that users can easily incorporate.

**4.2. Improve Default Security Posture (Medium Priority):**

*   **Recommendation:**  Review and enhance default configurations to promote secure usage out-of-the-box.
    *   **Default Sanitization Enabled (Opt-Out):** Consider enabling a basic level of sanitization by default (e.g., for common authorization headers) and make it opt-out rather than opt-in.
    *   **Warnings for Potential Sensitive Data:**  Implement warnings or logging when VCR detects potentially sensitive headers or body content during recording, prompting users to configure sanitization.
    *   **Secure Default Cassette Storage Location:**  While user-configurable, recommend or default to storing cassettes in a project-specific directory within the version control system, rather than potentially more exposed locations.
*   **Actionable Steps:**
    *   Conduct a review of current default configurations from a security perspective.
    *   Implement warnings or logging mechanisms to alert users to potential sensitive data in recordings.
    *   Update documentation to emphasize secure configuration practices and highlight the importance of sanitization.

**4.3. Strengthen Dependency Management and Security Scanning (Medium Priority):**

*   **Recommendation:**  Enhance dependency management and integrate automated security scanning into the development and release pipeline.
    *   **Automated Dependency Vulnerability Scanning:** Integrate tools like `bundler-audit` or `dependency-check` into the CI/CD pipeline to automatically scan for vulnerabilities in VCR's dependencies (including the underlying HTTP client library).
    *   **Regular Dependency Updates:**  Establish a process for regularly reviewing and updating dependencies to their latest secure versions.
    *   **Subresource Integrity (SRI) for CDN Assets (If Applicable):** If VCR uses any CDN-hosted assets (less likely for a library, but consider for documentation website), implement SRI to ensure integrity.
*   **Actionable Steps:**
    *   Integrate dependency vulnerability scanning into the GitHub Actions workflow.
    *   Document the process for dependency updates and security patching.
    *   Consider using a dependency management tool that provides security advisories and automated updates.

**4.4. Enhance Documentation on Security Best Practices (High Priority):**

*   **Recommendation:**  Create a dedicated "Security Best Practices" section in the VCR documentation, explicitly addressing:
    *   **Sensitive Data Handling:**  Detailed guidance on identifying and sanitizing sensitive data in cassettes, with examples and best practices.
    *   **Secure Cassette Storage:**  Recommendations for secure storage locations and access controls for cassette files, especially in shared environments.
    *   **Configuration Security:**  Guidance on secure configuration options and potential security pitfalls.
    *   **Regular Auditing of Cassettes:**  Advise users to periodically review cassette files to ensure they do not inadvertently contain sensitive data and that sanitization rules are still effective.
*   **Actionable Steps:**
    *   Create a dedicated security documentation section.
    *   Develop comprehensive content covering the recommended security best practices.
    *   Prominently link to the security documentation from the main README and usage guides.

**4.5. Promote Community Security Contributions and Reporting (Low Priority, Long-Term):**

*   **Recommendation:**  Encourage community involvement in security by:
    *   **Security Bug Bounty Program (Optional):** Consider establishing a bug bounty program to incentivize security researchers to find and report vulnerabilities.
    *   **Clear Security Reporting Process:**  Provide a clear and easy-to-find process for reporting security vulnerabilities to the VCR maintainers (e.g., a dedicated email address or security.txt file).
    *   **Publicly Acknowledge Security Contributors:**  Acknowledge and thank community members who responsibly report security vulnerabilities.
*   **Actionable Steps:**
    *   Establish a security reporting process and document it clearly.
    *   Consider a bug bounty program if resources allow and security becomes a higher priority.
    *   Actively engage with security researchers and the community on security-related discussions.

### 5. Actionable and Tailored Mitigation Strategies

The recommendations above are already tailored and actionable. To further emphasize actionability, here's a summary of key actions with assigned priorities:

| Recommendation                                      | Priority | Actionable Steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          