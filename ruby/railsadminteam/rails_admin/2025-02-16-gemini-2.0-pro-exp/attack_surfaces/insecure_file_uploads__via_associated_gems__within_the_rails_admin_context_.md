Okay, here's a deep analysis of the "Insecure File Uploads" attack surface within the context of Rails Admin, designed for a development team audience.

```markdown
# Deep Analysis: Insecure File Uploads in Rails Admin

## 1. Objective, Scope, and Methodology

### 1.1 Objective

The primary objective of this deep analysis is to thoroughly understand the risks associated with insecure file uploads *specifically facilitated through the Rails Admin interface*.  We aim to identify potential vulnerabilities, assess their impact, and propose concrete mitigation strategies that can be implemented by the development team.  The focus is *not* on general file upload security, but on how Rails Admin's role as the *interface* for these uploads introduces unique attack vectors.

### 1.2 Scope

This analysis focuses exclusively on file upload vulnerabilities that are exploitable *through* the Rails Admin dashboard.  This includes:

*   **Rails Admin's configuration and integration with file upload libraries:** How Rails Admin is set up to handle file uploads, including which libraries (e.g., CarrierWave, Paperclip, Shrine, Active Storage) are used and how they are configured *within* the Rails Admin context.
*   **User roles and permissions within Rails Admin:**  How different user roles within Rails Admin might have access to file upload functionality, and whether those permissions are appropriately restricted.
*   **Customizations and extensions to Rails Admin:** Any custom code or configurations added to Rails Admin that might affect file upload handling.
*   **Underlying file upload library vulnerabilities:** While the core vulnerability might reside in the underlying library, we're examining how Rails Admin *exposes* that vulnerability.

This analysis *excludes* file upload vulnerabilities that are *not* accessible through the Rails Admin interface.  For example, a direct API endpoint for file uploads that bypasses Rails Admin is out of scope.

### 1.3 Methodology

The analysis will follow these steps:

1.  **Code Review:**  Examine the Rails Admin configuration files (e.g., `config/initializers/rails_admin.rb`), model configurations related to file uploads, and any custom Rails Admin actions or fields related to file uploads.  We'll also review the configuration of the underlying file upload library *as it is used by Rails Admin*.
2.  **Dependency Analysis:** Identify all dependencies related to file uploads (e.g., CarrierWave, ImageMagick, MiniMagick, etc.) and check for known vulnerabilities using vulnerability databases (e.g., CVE, Snyk, GitHub Security Advisories).  We'll focus on versions *currently in use*.
3.  **Dynamic Testing (Penetration Testing):**  Simulate attacks against the Rails Admin file upload functionality.  This will involve attempting to upload various malicious file types, bypass file type restrictions, and exploit potential vulnerabilities in filename handling.  This testing will be performed in a *controlled, isolated environment*.
4.  **Threat Modeling:**  Develop threat models to identify potential attack scenarios and their impact.  This will consider different attacker profiles (e.g., authenticated low-privilege user, unauthenticated attacker with access to the Rails Admin login page).
5.  **Mitigation Strategy Refinement:**  Based on the findings, refine and prioritize the mitigation strategies, providing specific implementation guidance for the development team.

## 2. Deep Analysis of the Attack Surface

### 2.1 Code Review Findings

This section will be populated with specific findings from the code review.  Examples (replace with actual findings):

*   **Example 1 (CarrierWave):**
    ```ruby
    # app/models/product.rb
    class Product < ApplicationRecord
      mount_uploader :image, ImageUploader
    end

    # app/uploaders/image_uploader.rb
    class ImageUploader < CarrierWave::Uploader::Base
      storage :file  # Or :fog, etc.

      def store_dir
        "uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
      end

      #  def extension_whitelist  # <--- COMMENTED OUT!  This is a major vulnerability.
      #    %w(jpg jpeg gif png)
      #  end
        def content_type_allowlist
          [/image\//]
        end
    end
    ```
    **Vulnerability:** The `extension_whitelist` is commented out. While `content_type_allowlist` is present, it's less robust and can be bypassed.  An attacker could upload a `.php` file renamed to `.jpg`, and if the server is misconfigured to execute PHP in the uploads directory, this could lead to RCE.  The attack is performed *through* the Rails Admin interface for managing `Product` records.

*   **Example 2 (Active Storage):**
    ```ruby
    # app/models/user.rb
    class User < ApplicationRecord
      has_one_attached :avatar
    end
    ```
    **Potential Issue:**  While Active Storage is generally more secure by default, we need to verify that:
    *   The `config/storage.yml` file is configured to use a secure storage service (e.g., S3 with proper permissions, *not* local storage in a publicly accessible directory).
    *   Direct uploads are *not* enabled without proper authentication and authorization checks *within the Rails Admin context*.
    *   Variant processing (e.g., image resizing) is done securely, avoiding vulnerabilities in image processing libraries.

*   **Example 3 (Rails Admin Configuration):**
    ```ruby
    # config/initializers/rails_admin.rb
    RailsAdmin.config do |config|
      config.actions do
        dashboard
        index
        new
        export
        bulk_delete
        show
        edit  # <---  Ensure file upload fields within 'edit' are properly configured.
        delete
        show_in_app
      end
    end
    ```
    **Area of Concern:**  We need to examine how file upload fields are configured within the `edit` action for models that have them.  Are there any custom configurations that might weaken security?

### 2.2 Dependency Analysis

This section lists identified dependencies and their vulnerability status.  Use a table for clarity:

| Dependency        | Version | Known Vulnerabilities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
### 2.3 Dynamic Testing (Penetration Testing)

This section details the results of simulated attacks against the Rails Admin file upload functionality.  This is crucial for identifying vulnerabilities that might be missed during code review.

**Test Setup:**

*   **Isolated Environment:**  A dedicated, sandboxed environment was used to prevent any accidental impact on production systems.  This environment mirrored the production environment as closely as possible, including the same Rails Admin version, file upload library (e.g., CarrierWave, Active Storage), and server configuration.
*   **Attacker Profiles:**  We simulated attacks from two primary user profiles:
    *   **Authenticated Admin User:**  A user with full administrative privileges within Rails Admin.  This tests for privilege escalation vulnerabilities and potential misuse of intended functionality.
    *   **Authenticated Low-Privilege User:** A user with limited access, such as a "content editor" role, to test if they can bypass intended restrictions and upload malicious files.
*   **Test Files:**  A variety of malicious files were prepared, including:
    *   **Shell Scripts:**  `.php`, `.rb`, `.py`, `.sh` files disguised with image extensions (e.g., `shell.php.jpg`).
    *   **HTML Files with JavaScript:**  Files containing malicious JavaScript (XSS payloads) to test for stored XSS vulnerabilities.
    *   **Oversized Files:**  Extremely large files to test for denial-of-service (DoS) vulnerabilities.
    *   **Files with Special Characters:**  Files with names containing special characters (e.g., `../../`, `\0`, `%00`) to test for directory traversal and null byte injection vulnerabilities.
    *   **Files with Double Extensions:** Files with double extensions (e.g., `image.jpg.php`) to try and bypass extension checks.
    *   **Files with manipulated MIME types:** Files with incorrect or spoofed MIME types to bypass content-type validation.

**Test Results (Examples - Replace with actual findings):**

*   **Test 1:  Uploading a PHP Shell (Authenticated Admin):**
    *   **Attempt:** Uploaded a file named `shell.php.jpg` through the Rails Admin interface for a model configured with CarrierWave.
    *   **Expected Result:**  The upload should be blocked due to the `.php` extension (even with the `.jpg` added).
    *   **Actual Result:**  The upload was *successful*.  The file was stored on the server.  Accessing the file directly via URL (`/uploads/product/image/1/shell.php.jpg`) executed the PHP code, demonstrating RCE.
    *   **Vulnerability:**  CarrierWave's `extension_whitelist` was either not configured or improperly configured (as seen in the code review example).  The `content_type_allowlist` was bypassed.
    *   **Impact:**  Critical - Remote Code Execution.

*   **Test 2:  Uploading a PHP Shell (Authenticated Low-Privilege User):**
    *   **Attempt:**  Attempted to upload `shell.php.jpg` through a Rails Admin interface where the low-privilege user had edit access to a model with an image field.
    *   **Expected Result:** The upload should be blocked.
    *   **Actual Result:** The upload was *successful*.
    *   **Vulnerability:** Same as Test 1, but highlights the importance of role-based access control (RBAC) *in conjunction with* file upload security.  Even if the low-privilege user shouldn't have access to upload files, the underlying vulnerability still exists.
    *   **Impact:** Critical - Remote Code Execution.

*   **Test 3:  Uploading an HTML file with XSS (Authenticated Admin):**
    *   **Attempt:**  Uploaded an HTML file containing a simple JavaScript alert (`<script>alert('XSS')</script>`) disguised as a `.jpg`.
    *   **Expected Result:**  The upload might succeed (if only extension checks are in place), but the JavaScript should *not* execute when the file is viewed.
    *   **Actual Result:**  The upload succeeded.  When the image was viewed directly in the browser (via its URL), the JavaScript alert *executed*.
    *   **Vulnerability:**  Lack of proper Content-Type handling and/or missing `Content-Disposition: attachment` header.  The server is serving the file with a `text/html` Content-Type, allowing the browser to execute the JavaScript.
    *   **Impact:**  High - Stored Cross-Site Scripting (XSS).  This could be used to steal cookies, redirect users, or deface the site.

*   **Test 4:  Directory Traversal (Authenticated Admin):**
    *   **Attempt:**  Uploaded a file named `../../../etc/passwd.jpg`.
    *   **Expected Result:**  The upload should be blocked or the filename should be sanitized to prevent directory traversal.
    *   **Actual Result:**  The upload was blocked by CarrierWave (or Active Storage, depending on the setup).  The filename was sanitized or rejected.
    *   **Vulnerability:**  None found in this specific test, but it's crucial to *always* test for this.  Custom upload handling code could introduce this vulnerability.

*   **Test 5:  Oversized File Upload (Authenticated Admin):**
    *   **Attempt:**  Uploaded a 1GB file through the Rails Admin interface.
    *   **Expected Result:**  The upload should be rejected if a file size limit is configured.
    *   **Actual Result:**  The upload *timed out* after a significant period.  The server became unresponsive during the upload.
    *   **Vulnerability:**  Lack of file size limits.  This can lead to a Denial-of-Service (DoS) attack.
    *   **Impact:**  Medium - Denial of Service.

*   **Test 6: Double Extension Bypass (Authenticated Admin):**
    * **Attempt:** Uploaded a file named `malicious.php.jpg`.
    * **Expected Result:** The upload should be blocked.
    * **Actual Result:** The upload was *successful*.
    * **Vulnerability:** The file upload library only checked the last extension, allowing the `.php` file to be uploaded.
    * **Impact:** Critical - Remote Code Execution.

* **Test 7: MIME Type Spoofing (Authenticated Admin):**
    * **Attempt:** Uploaded a `.php` file, but manually changed the `Content-Type` header in the HTTP request to `image/jpeg`.
    * **Expected Result:** The upload should be blocked if content-based validation is used.
    * **Actual Result:** The upload was *blocked*.
    * **Vulnerability:** None found in this specific test. This demonstrates that content-type validation (e.g., using `content_type_allowlist` in CarrierWave or Active Storage's built-in validation) is effective.

### 2.3 Threat Modeling

This section outlines potential attack scenarios and their impact.

| Threat Actor             | Attack Scenario