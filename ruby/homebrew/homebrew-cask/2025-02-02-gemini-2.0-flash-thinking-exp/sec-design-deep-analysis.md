## Deep Security Analysis of Homebrew Cask

### 1. Objective, Scope, and Methodology

**Objective:**

This deep security analysis aims to thoroughly evaluate the security posture of Homebrew Cask, a macOS application management tool, based on the provided security design review. The primary objective is to identify potential security vulnerabilities and risks associated with its architecture, components, and operational processes. This analysis will focus on understanding the security implications of each key component, assessing the effectiveness of existing security controls, and recommending specific, actionable mitigation strategies to enhance the overall security of Homebrew Cask and protect its users.  A key focus will be on the supply chain security risks inherent in managing applications sourced from external repositories.

**Scope:**

The scope of this analysis encompasses the following key components and aspects of Homebrew Cask, as outlined in the security design review:

*   **Architecture and Components:**  Analysis of the C4 Context and Container diagrams, including User interaction, Homebrew Cask CLI, Cask Formulae, Download Manager, Installer, Homebrew Core integration, and interaction with Application Repositories.
*   **Data Flow:** Examination of the flow of data, particularly cask formulae and application binaries, from repositories to the user's system, focusing on integrity and authenticity.
*   **Security Controls:** Evaluation of existing security controls (Checksums, Community Review, Homebrew Infrastructure Security, Code Signing) and recommended security controls (Automated Vulnerability Scanning, Enhanced Review Process, Incident Response, User Education, Formulae Signing).
*   **Risk Assessment:** Review of identified business and security risks, critical business processes, and data sensitivity.
*   **Build and Deployment Processes:** Analysis of the build pipeline, code repository, and distribution mechanisms for potential security vulnerabilities.
*   **Assumptions and Questions:** Addressing the assumptions made in the security design review and using the questions to guide deeper investigation areas.

The analysis will specifically exclude:

*   Detailed code-level review of the Homebrew Cask CLI codebase (unless necessary to understand specific security mechanisms).
*   Security analysis of individual applications installed via Homebrew Cask.
*   In-depth security assessment of the Homebrew Core infrastructure beyond its interaction with Homebrew Cask.
*   Penetration testing or dynamic security testing of Homebrew Cask.

**Methodology:**

This analysis will employ a risk-based approach, utilizing the following methodology:

1.  **Decomposition and Component Analysis:** Break down Homebrew Cask into its key components based on the C4 diagrams and descriptions. For each component, analyze its function, data flow, and potential security vulnerabilities.
2.  **Threat Modeling:** Identify potential threats relevant to each component and the overall system, considering the business and security risks outlined in the design review. This will include supply chain attacks, integrity breaches, availability disruptions, and confidentiality concerns (where applicable).
3.  **Security Control Assessment:** Evaluate the effectiveness of existing security controls in mitigating the identified threats. Assess the strengths and weaknesses of each control and identify any gaps.
4.  **Gap Analysis and Risk Prioritization:** Identify security gaps where existing controls are insufficient or absent. Prioritize risks based on their potential impact on business priorities and user security.
5.  **Recommendation and Mitigation Strategy Development:** Develop specific, actionable, and tailored security recommendations and mitigation strategies to address the identified risks and gaps. These recommendations will be practical and applicable to the Homebrew Cask project.
6.  **Documentation and Reporting:** Document the analysis process, findings, identified risks, recommendations, and mitigation strategies in a clear and structured report.

This methodology will ensure a systematic and thorough security analysis focused on providing practical and valuable insights for the Homebrew Cask development team.

### 2. Security Implications of Key Components

#### 2.1 User

*   **Security Implications:**
    *   **Social Engineering:** Users can be tricked into installing malicious casks if they are not security-aware or if the cask names are deceptively similar to legitimate applications.
    *   **Privilege Escalation:** Users might inadvertently grant administrator privileges during installation if prompted by a malicious cask, even if the application itself doesn't require it legitimately.
    *   **Unintentional Misconfiguration:** Users might misconfigure Homebrew Cask or their macOS environment in ways that weaken security, although this is less directly related to Homebrew Cask itself.
*   **Existing Security Controls:** macOS user account and permissions, user awareness (implicitly assumed).
*   **Security Gaps and Risks:** Reliance on user awareness is a weak control. Users may not understand the risks associated with installing software, especially from command-line tools.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **User Education and Warnings (Recommended Security Control - Enhanced):**  Implement more prominent and informative warnings within the Homebrew Cask CLI output when installing casks, especially those from less reputable sources or those requiring administrator privileges.  This should include clear explanations of the risks involved in installing software from the internet and the importance of verifying cask sources.
    *   **Cask Information Display Enhancement:** When displaying cask information (e.g., `brew cask info <cask>`), prominently display the source URL and any relevant security warnings or disclaimers associated with the cask or its source.

#### 2.2 Homebrew Cask CLI

*   **Security Implications:**
    *   **Command Injection:** Vulnerabilities in the CLI's command parsing or execution logic could allow for command injection if user input or cask formulae are not properly sanitized.
    *   **Privilege Escalation (Indirect):** If the CLI itself is compromised or contains vulnerabilities, it could be used to escalate privileges on the user's system, especially if it runs with elevated privileges at any point (though unlikely for the core CLI itself).
    *   **Denial of Service:** Bugs or vulnerabilities in the CLI could be exploited to cause crashes or resource exhaustion, leading to denial of service for application management.
*   **Existing Security Controls:** Code signing of the CLI tool, input validation of user commands (assumed).
*   **Security Gaps and Risks:**  Input validation might not be comprehensive enough to prevent all types of injection attacks. Vulnerabilities in dependencies used by the CLI could also pose a risk.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Automated Security Scanning of CLI Codebase (Recommended Security Control - Enhanced):** Implement regular automated static analysis and vulnerability scanning of the Homebrew Cask CLI codebase as part of the CI/CD pipeline. This should include dependency scanning to identify and address vulnerabilities in third-party libraries.
    *   **Input Validation Hardening:**  Conduct a thorough review of the CLI's input validation logic, particularly for commands that process cask formulae or user-provided arguments. Ensure robust sanitization and validation to prevent command injection and other input-based vulnerabilities.
    *   **Principle of Least Privilege:** Ensure the CLI operates with the minimum necessary privileges. Avoid running any part of the CLI with administrator privileges unless absolutely necessary and only when explicitly requested by the user (e.g., during installation requiring admin rights).

#### 2.3 Cask Formulae

*   **Security Implications:**
    *   **Malicious Formulae Injection:** Attackers could attempt to introduce malicious cask formulae into the repository through compromised accounts, pull request manipulation, or by exploiting vulnerabilities in the review process.
    *   **Formulae Manipulation:** Existing formulae could be modified to point to malicious download sources, alter checksums, or inject malicious installation scripts.
    *   **Formulae Parsing Vulnerabilities:** Vulnerabilities in the Ruby code that parses and executes cask formulae could be exploited to achieve arbitrary code execution.
*   **Existing Security Controls:** Community review of cask formulae, checksum verification of downloaded binaries.
*   **Security Gaps and Risks:** Community review is susceptible to human error and sophisticated attacks. Checksum verification only protects the binary, not the formula itself. Lack of formula signing allows for potential tampering after review but before distribution.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Enhanced Cask Review Process with Dedicated Security Reviewers and Checklists (Recommended Security Control - Implemented):** Establish a dedicated team of security reviewers with expertise in macOS security and scripting. Develop a comprehensive security checklist for cask formula reviews, focusing on:
        *   Source URL legitimacy and reputation.
        *   Installation script security (avoiding insecure practices like `curl | bash`).
        *   Checksum verification implementation.
        *   Absence of suspicious or obfuscated code.
        *   Permissions requested by the application.
    *   **Automated Vulnerability Scanning of Cask Formulae (Recommended Security Control - Implemented):** Implement automated static analysis tools and linters to scan cask formulae for potential security issues, such as:
        *   Use of insecure functions or commands in installation scripts.
        *   Suspicious URL patterns or redirects.
        *   Missing checksums or weak checksum algorithms.
        *   Potential for path traversal or other file system vulnerabilities.
    *   **Signing Cask Formulae (Recommended Security Control - Consider Implementing):** Implement a system for digitally signing cask formulae after review and approval. This would provide a strong guarantee of formula integrity and authenticity, preventing tampering between review and user download. Users could then verify the signature before installation.
    *   **Formulae Repository Integrity Monitoring:** Implement monitoring and alerting for unauthorized changes to the cask formulae repository. This could include file integrity monitoring and anomaly detection on repository activity.

#### 2.4 Download Manager

*   **Security Implications:**
    *   **Man-in-the-Middle (MITM) Attacks:** If downloads are not exclusively over HTTPS, attackers could intercept and modify application binaries during download.
    *   **Download Source Compromise:** If download sources (vendor websites, GitHub releases) are compromised, the Download Manager could fetch and install malicious binaries even if the checksum is correct (if the checksum is also compromised at the source).
    *   **Download Redirection Attacks:** Malicious actors could attempt to redirect downloads to compromised servers serving malicious binaries.
*   **Existing Security Controls:** Checksum verification, HTTPS for download links (recommended).
*   **Security Gaps and Risks:** Reliance on vendor-provided checksums can be problematic if the vendor's site is compromised. HTTPS is recommended but not always enforced.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Enforce HTTPS for Downloads:**  Strictly enforce HTTPS for all download URLs in cask formulae. Reject casks that use HTTP URLs unless there is a very strong and explicitly documented justification (and even then, proceed with extreme caution).
    *   **Checksum Source Diversity (Consider Implementing):** Explore options for verifying checksums from multiple independent sources, if feasible. This could involve fetching checksums from vendor websites and potentially third-party security databases if available. This would mitigate the risk of a single compromised checksum source.
    *   **Download Source Reputation Scoring (Consider Implementing):**  Develop a system to assess and score the reputation of download sources. Casks from less reputable or unknown sources could be flagged with warnings to users. This could be based on domain age, SSL certificate validity, historical data, and community feedback.

#### 2.5 Installer

*   **Security Implications:**
    *   **Malicious Installation Scripts:** Installation scripts within cask formulae could contain malicious commands that compromise the user's system, install malware, or steal data.
    *   **Privilege Escalation via Installer:**  Vulnerabilities in the installer logic or in the way it handles installation scripts could be exploited to escalate privileges.
    *   **File System Manipulation Vulnerabilities:** Installation scripts might contain vulnerabilities that allow for arbitrary file system manipulation, leading to data loss or system instability.
*   **Existing Security Controls:** Operates with user permissions, macOS security prompts for administrator privileges. Community review of installation scripts.
*   **Security Gaps and Risks:** Community review might miss subtle malicious code in complex installation scripts.  Installation scripts are executed with user permissions, which can still be significant.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Installation Script Sandboxing/Isolation (Consider Implementing):** Explore options for sandboxing or isolating the execution environment of installation scripts. This could involve using containers or virtual machines to limit the script's access to the user's system during installation.
    *   **Installation Script Static Analysis (Recommended Security Control - Enhanced):**  Enhance automated static analysis to specifically focus on the security of installation scripts. This should include checks for:
        *   Execution of external commands without proper sanitization.
        *   Use of insecure shell commands (e.g., `sudo` without clear justification).
        *   File system operations outside of expected installation directories.
        *   Network connections initiated by the script (unless explicitly necessary).
    *   **User Review of Installation Scripts (Consider Implementing):**  Provide a mechanism for users to review the installation script of a cask before proceeding with installation. This could be an optional step for advanced users or for casks flagged as potentially risky.

#### 2.6 Homebrew Core

*   **Security Implications:**
    *   **Compromise of Homebrew Core Infrastructure:** If the Homebrew Core infrastructure is compromised, it could be used to distribute malicious cask formulae or even compromise the Homebrew Cask CLI itself if updates are distributed through Homebrew Core.
    *   **Dependency Vulnerabilities:** Homebrew Cask relies on Homebrew Core and its dependencies. Vulnerabilities in these dependencies could indirectly affect Homebrew Cask security.
*   **Existing Security Controls:** Homebrew Core security infrastructure (assumed).
*   **Security Gaps and Risks:** Reliance on the security of an external infrastructure.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Dependency Security Monitoring:**  Maintain awareness of the security posture of Homebrew Core and its dependencies. Stay informed about reported vulnerabilities and ensure timely updates to mitigate risks.
    *   **Independent Security Audit of Homebrew Cask (Consider Implementing):**  Consider commissioning an independent security audit of Homebrew Cask, including its integration with Homebrew Core, to identify any potential vulnerabilities or weaknesses in the overall system.

#### 2.7 Application Repositories (Vendor Websites, GitHub Releases)

*   **Security Implications:**
    *   **Compromised Repositories:** Vendor websites or GitHub release pages could be compromised, leading to the distribution of malicious application binaries.
    *   **Unreliable Availability:** Application repositories might be unreliable or go offline, impacting the availability of applications for installation.
    *   **Lack of HTTPS:** Some repositories might not use HTTPS, increasing the risk of MITM attacks during download (mitigated by recommendation to enforce HTTPS in Download Manager).
*   **Existing Security Controls:** HTTPS for download links (recommended), vendor security practices (assumed).
*   **Accepted Risks:** Reliance on external application vendors and their download sources.
*   **Security Gaps and Risks:**  Limited control over the security of external repositories.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Repository Reputation Tracking (Consider Implementing):**  Maintain a database or scoring system to track the reputation and historical reliability of application repositories. Prioritize casks from reputable and well-established sources.
    *   **Content Delivery Network (CDN) for Popular Casks (Consider Implementing):** For highly popular and frequently downloaded casks, consider mirroring the application binaries on a trusted CDN. This would improve availability and potentially enhance security by reducing reliance on individual vendor repositories.
    *   **Vendor Security Posture Assessment (Consider Implementing):**  For casks from less well-known vendors, attempt to assess their security posture. This could involve checking for security policies, vulnerability disclosure programs, and historical security incidents.

#### 2.8 macOS System

*   **Security Implications:**
    *   **System-Level Compromise:** Malicious casks could exploit vulnerabilities in macOS or installed applications to achieve system-level compromise.
    *   **Data Exfiltration:** Compromised applications installed via casks could exfiltrate user data.
    *   **Denial of Service (System-Wide):** Malicious or faulty applications could cause system instability or denial of service.
*   **Existing Security Controls:** macOS security features (Gatekeeper, SIP, etc.), user account controls.
*   **Security Gaps and Risks:**  Homebrew Cask operates within the user's macOS environment and inherits its security posture. However, vulnerabilities in casks can bypass some macOS security features.
*   **Accepted Risks:** Potential vulnerabilities in application binaries themselves.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Leverage macOS Security Features:**  Ensure Homebrew Cask fully leverages and respects macOS security features like Gatekeeper and System Integrity Protection. Provide clear guidance to users on how to configure macOS security settings for optimal protection.
    *   **Application Permission Review Guidance (User Education - Enhanced):**  Educate users about the importance of reviewing application permissions after installation and how to manage them using macOS privacy settings.
    *   **Incident Response Plan (Recommended Security Control - Implemented):** Develop and implement a formal incident response plan for handling reports of malicious or vulnerable casks. This plan should include procedures for:
        *   Verifying reports of malicious casks.
        *   Quickly removing or disabling malicious casks from the repository.
        *   Notifying users who may have installed the malicious cask.
        *   Conducting post-incident analysis to prevent future occurrences.

#### 2.9 Build Pipeline

*   **Security Implications:**
    *   **Compromised Build Pipeline:** If the build pipeline (GitHub Actions) is compromised, attackers could inject malicious code into the Homebrew Cask CLI binaries or cask formulae updates.
    *   **Supply Chain Attacks via Dependencies:** Vulnerabilities in build dependencies could be exploited to compromise the build process.
    *   **Secrets Management Vulnerabilities:** Improper handling of secrets (e.g., signing keys) in the build pipeline could lead to unauthorized access and code signing.
*   **Existing Security Controls:** Secure CI/CD pipeline configuration, access controls to CI system, secrets management (assumed).
*   **Security Gaps and Risks:**  Build pipelines are complex and can be vulnerable if not properly secured.
*   **Specific Recommendations & Mitigation Strategies:**
    *   **Secure Build Pipeline Hardening:**  Implement robust security measures for the build pipeline, including:
        *   Principle of least privilege for CI system accounts and permissions.
        *   Regular security audits of CI pipeline configurations.
        *   Secure secrets management practices (using dedicated secrets management tools).
        *   Code signing of all CLI binaries produced by the build pipeline.
        *   Immutable build environments to prevent tampering.
    *   **Build Pipeline Integrity Verification:** Implement mechanisms to verify the integrity of the build pipeline itself. This could include using signed commits, audit logging of pipeline activities, and regular security reviews of the pipeline code.
    *   **Software Bill of Materials (SBOM) Generation (Consider Implementing):**  Generate a Software Bill of Materials (SBOM) for Homebrew Cask CLI releases. This would provide transparency into the components and dependencies included in each release, facilitating vulnerability management and supply chain security analysis.

### 3. Actionable and Tailored Mitigation Strategies

The following table summarizes the actionable and tailored mitigation strategies, categorized by security domain and priority:

| Security Domain          | Recommendation                                                                                                                                                                                                                                                           | Priority | Actionable Steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              