Here's a deep security analysis of the `geocoder` Python library, tailored to the provided security design review and focusing on actionable and specific recommendations.

## Deep Security Analysis of Geocoder Library

### 1. Objective, Scope, and Methodology

**Objective:**

The primary objective of this deep security analysis is to identify, analyze, and provide actionable mitigation strategies for potential security vulnerabilities and risks associated with the `geocoder` Python library. This analysis aims to ensure the secure design, development, deployment, and usage of the library, minimizing risks for applications that integrate it. The focus is on understanding the library's architecture, data flow, and dependencies to pinpoint specific security concerns and offer tailored recommendations.

**Scope:**

This analysis encompasses the following aspects of the `geocoder` library:

* **Codebase Analysis:** Reviewing the architecture, modules, and functionalities of the `geocoder` library based on the provided design review and a brief examination of the GitHub repository ([https://github.com/alexreisner/geocoder](https://github.com/alexreisner/geocoder)).
* **Component Security Implications:**  Analyzing the security risks associated with each component identified in the C4 Context and Container diagrams, including the core modules, provider modules, and interactions with external geocoding services.
* **Data Flow Security:** Examining the flow of data, particularly address information and API keys, through the library and its interactions with external services.
* **Dependency Analysis:** Considering the security implications of third-party dependencies used by the library.
* **Deployment and Build Process:**  Analyzing the security aspects of the library's build and deployment pipeline, focusing on potential supply chain risks.
* **Risk Assessment Review:**  Evaluating the identified business and security risks in the provided security design review and expanding on them with specific threats related to the library.

This analysis is limited to the security aspects of the `geocoder` library itself and its immediate dependencies. It does not extend to the security of the external geocoding services or the applications that utilize the library, except where their interaction directly impacts the library's security posture.

**Methodology:**

The analysis will be conducted using the following methodology:

1. **Document Review:**  Thorough review of the provided Security Design Review document, including business and security posture, C4 diagrams, deployment and build process descriptions, risk assessment, and questions/assumptions.
2. **Codebase Exploration (Limited):**  Briefly explore the `geocoder` library's GitHub repository to understand the code structure, identify key modules, and confirm the architecture described in the design review. This will focus on areas relevant to security, such as input handling, API interactions, and dependency management.
3. **Threat Modeling:**  Based on the identified components, data flow, and codebase understanding, develop a threat model to identify potential security threats relevant to the `geocoder` library. This will consider common web application and library vulnerabilities, as well as threats specific to geocoding services.
4. **Vulnerability Analysis:** Analyze potential vulnerabilities based on the threat model, focusing on areas like input validation, dependency vulnerabilities, insecure API interactions, and potential information leakage.
5. **Mitigation Strategy Formulation:**  For each identified threat and vulnerability, develop specific, actionable, and tailored mitigation strategies applicable to the `geocoder` library and its users. These strategies will align with the recommended security controls in the design review.
6. **Recommendation Prioritization:**  Prioritize mitigation strategies based on the severity of the risk and the feasibility of implementation.
7. **Documentation and Reporting:**  Document the analysis process, findings, identified threats, vulnerabilities, and recommended mitigation strategies in a clear and structured report.

### 2. Security Implications of Key Components

Based on the C4 Container diagram and descriptions, we can break down the security implications of each key component:

**a) Python Application (Using Geocoder Library):**

* **Security Implication:** While the Python Application is outside the direct scope of the library's security, it's crucial to recognize that vulnerabilities in the application can indirectly impact the security of geocoding operations. For instance, if the application doesn't securely manage API keys or passes unsanitized user input to the `geocoder` library, it can lead to security issues.
* **Specific Risks:**
    * **API Key Exposure:**  If the application hardcodes API keys or stores them insecurely, it can lead to unauthorized usage of geocoding services and potential cost implications or service disruption.
    * **Input Injection via Application:** If the application doesn't validate user inputs before passing them to the `geocoder` library, it could be vulnerable to injection attacks if the library itself has input validation weaknesses.
    * **Data Leakage from Application:** If the application logs or stores geocoding requests and responses insecurely, it could lead to exposure of sensitive address data or location information.

**b) Geocoder Library (Core Modules: Geocoding, Reverse Geocoding, Configuration):**

* **Security Implication:** The core modules are responsible for the fundamental logic of the library. Vulnerabilities here can have widespread impact on all applications using the library.
* **Specific Risks:**
    * **Input Validation Vulnerabilities:** If the core modules don't properly validate and sanitize input addresses or coordinates, they could be susceptible to injection attacks (e.g., command injection, format string bugs, though less likely in Python, but data corruption is still a risk).
    * **Logic Errors:** Bugs in the core geocoding or reverse geocoding logic could lead to unexpected behavior, potentially causing denial of service or incorrect data processing.
    * **Configuration Vulnerabilities:** Insecure handling of configuration parameters could allow attackers to manipulate the library's behavior, potentially redirecting requests to malicious services or bypassing security controls.

**c) Geocoder Library (Provider Modules: Google, Bing, Nominatim, etc.):**

* **Security Implication:** Provider modules handle interactions with external APIs. Vulnerabilities here can expose API keys, leak data, or lead to denial of service.
* **Specific Risks:**
    * **Insecure API Request Construction:**  If provider modules construct API requests improperly, they might expose API keys in logs or URLs, or be vulnerable to request smuggling if they don't handle URL encoding correctly.
    * **Insufficient Error Handling:**  Poor error handling in provider modules could expose sensitive information in error messages or lead to unexpected application behavior when external services are unavailable or return errors.
    * **Data Parsing Vulnerabilities:**  If provider modules don't securely parse responses from external APIs, they could be vulnerable to injection attacks if the external API responses are maliciously crafted (though less likely, still a consideration).
    * **API Key Management within Library (Less likely but consider):** While API key management is ideally external, if provider modules handle API keys internally in any way (even temporarily), insecure handling could lead to exposure.

**d) External Geocoding Services (Google Maps API, Bing Maps API, etc.):**

* **Security Implication:** The library relies on external services, inheriting their security and availability risks. While the library cannot directly control these, it must handle interactions securely and gracefully.
* **Specific Risks (Inherited and Interaction-Related):**
    * **Service Availability and Reliability:**  Downtime or performance issues with external services can directly impact applications using the library. While not a direct vulnerability, it's a reliability risk.
    * **API Abuse and Rate Limiting:**  If applications using the library don't implement rate limiting, they could unintentionally or maliciously abuse external APIs, leading to service blocking or unexpected costs.
    * **Data Privacy and Compliance:**  The library and applications using it must comply with the data privacy policies of the external geocoding services and relevant regulations (GDPR, CCPA) regarding the handling of location data.
    * **Man-in-the-Middle Attacks (during API communication):** If communication between the library and external services is not strictly over HTTPS, it could be vulnerable to man-in-the-middle attacks, potentially leading to data interception or manipulation.

**e) Deployment and Build Process:**

* **Security Implication:**  Vulnerabilities in the build and deployment process can lead to supply chain attacks, where malicious code is injected into the library before it reaches users.
* **Specific Risks:**
    * **Compromised Build Environment:** If the CI/CD system or developer machines are compromised, attackers could inject malicious code into the library during the build process.
    * **Dependency Poisoning:**  If dependencies are not managed securely, attackers could introduce malicious dependencies that are included in the library package.
    * **Insecure Package Repository:** If the package repository (PyPI or private) is compromised, attackers could replace legitimate library packages with malicious ones.
    * **Lack of Package Integrity Verification:** If users don't verify the integrity of downloaded packages (e.g., using checksums or signatures), they could unknowingly install compromised versions of the library.

### 3. Architecture, Components, and Data Flow Inference

Based on the codebase (briefly explored) and documentation, and the diagrams, we can infer the following architecture, components, and data flow:

**Architecture:**

The `geocoder` library adopts a modular architecture:

* **Core Modules:**  Handle the main geocoding and reverse geocoding logic, abstracting away provider-specific details. This likely includes modules for request construction, response parsing, and result standardization.
* **Provider Modules:**  Each provider module is dedicated to interacting with a specific geocoding service (e.g., Google, Bing, Nominatim). These modules encapsulate the API-specific details, request formats, response structures, and authentication mechanisms for each service.
* **Configuration Module:** Manages library-wide settings, potentially including default providers, API key configurations (though ideally, API keys are managed by the application using the library), and other operational parameters.

**Components:**

* **Geocoder Class:**  The main entry point for users to interact with the library. It likely takes address strings or coordinates as input and delegates requests to appropriate provider modules.
* **Provider-Specific Classes/Functions:**  Classes or functions within each provider module responsible for constructing API requests, sending them to the external service, handling responses, and parsing the results into a standardized format.
* **Result Object:** A standardized data structure to represent geocoding results, regardless of the provider used. This likely includes attributes like latitude, longitude, address components, accuracy, and provider name.

**Data Flow:**

1. **User Input:** The Python Application receives user input (address string or coordinates).
2. **Geocoder Library Invocation:** The application calls the `geocoder` library's `geocode()` or `reverse()` function, passing the user input and specifying the desired provider (or using the default).
3. **Request Construction:** The `Geocoder` class or core module selects the appropriate provider module and constructs an API request based on the input and the provider's API specifications. This may involve encoding the address, adding API keys (if managed by the library, which is less secure), and formatting the request according to the provider's requirements.
4. **API Request to External Service:** The provider module sends the API request over HTTPS to the chosen external geocoding service.
5. **API Response from External Service:** The external service processes the request and returns a response, typically in JSON or XML format.
6. **Response Parsing:** The provider module receives the response and parses it, extracting relevant geocoding information.
7. **Result Standardization:** The provider module transforms the provider-specific response data into a standardized `Result` object format.
8. **Result Return:** The `Geocoder` library returns the standardized `Result` object to the Python Application.
9. **Application Processing:** The Python Application receives the geocoding result and uses it for its intended purpose.

**Data Sensitivity:**

* **Address Data (Input):** Potentially sensitive PII, depending on the application context.
* **Location Coordinates (Output):** Potentially sensitive, especially when linked to individuals or specific locations.
* **API Keys:** Highly sensitive credentials that must be protected.

### 4. Specific Security Recommendations for Geocoder Library

Based on the analysis, here are specific security recommendations tailored to the `geocoder` library:

**a) Input Validation and Sanitization (Core Modules & Provider Modules):**

* **Recommendation:** Implement robust input validation within the core `geocoder` library and provider modules.
    * **Action:**
        * **Whitelist Valid Characters:** For address inputs, define a whitelist of allowed characters (alphanumeric, spaces, common address punctuation) and reject or sanitize inputs containing characters outside this whitelist.
        * **Input Length Limits:** Enforce reasonable length limits on address strings and other input parameters to prevent buffer overflow or denial-of-service attacks.
        * **Format Validation:** If specific input formats are expected (e.g., postal codes, coordinate formats), validate inputs against these formats.
        * **Encoding Handling:** Ensure proper handling of character encodings (UTF-8) to prevent encoding-related vulnerabilities.
* **Rationale:** Prevents injection attacks, data corruption, and unexpected behavior due to malformed inputs.

**b) Secure API Request Construction (Provider Modules):**

* **Recommendation:** Ensure provider modules construct API requests securely, especially regarding API key handling and URL encoding.
    * **Action:**
        * **HTTPS Enforcement:**  Strictly enforce HTTPS for all communication with external geocoding services.
        * **API Key Security:**  Document clearly that API key management is the responsibility of the application using the library.  The library itself should ideally *not* store or manage API keys directly in code or configuration files. If absolutely necessary for certain providers (e.g., for testing/default behavior), provide secure configuration mechanisms (environment variables, secure configuration files) and strongly discourage hardcoding.
        * **URL Encoding:**  Properly URL-encode all dynamic parameters in API requests (especially address strings) to prevent request smuggling or injection vulnerabilities.
        * **Avoid Sensitive Data in Logs:**  Ensure API keys and potentially sensitive address data are not logged in plain text during API request construction or error handling.
* **Rationale:** Prevents API key exposure, man-in-the-middle attacks, and request manipulation.

**c) Robust Error Handling and Response Parsing (Provider Modules & Core Modules):**

* **Recommendation:** Implement comprehensive error handling and secure response parsing in provider and core modules.
    * **Action:**
        * **Graceful Error Handling:**  Handle API errors and service unavailability gracefully. Return informative error messages to the application without exposing sensitive internal details.
        * **Response Validation:** Validate the structure and data types of responses from external APIs before parsing.
        * **Secure Parsing:** Use secure JSON/XML parsing libraries and avoid insecure parsing practices that could be vulnerable to injection attacks (though less likely with well-established libraries, still good practice).
        * **Rate Limit Handling:**  Implement logic to handle rate limiting responses from external APIs gracefully (e.g., implement retry mechanisms with exponential backoff, or return appropriate error codes to the application).
* **Rationale:** Prevents information leakage through error messages, ensures application stability in case of API errors, and mitigates potential parsing vulnerabilities.

**d) Dependency Management and Scanning (Build Process & Documentation):**

* **Recommendation:**  Maintain strict dependency management and implement regular dependency scanning.
    * **Action:**
        * **`requirements.txt` Maintenance:** Keep `requirements.txt` up-to-date and specify dependency versions explicitly to ensure reproducible builds and avoid unexpected dependency updates.
        * **Dependency Scanning in CI/CD:** Integrate dependency scanning tools (e.g., `pip-audit`, `safety`) into the CI/CD pipeline to automatically detect known vulnerabilities in dependencies.
        * **Regular Dependency Updates:**  Establish a process for regularly reviewing and updating dependencies to patch known vulnerabilities.
        * **Documentation on Dependency Security:**  Document the library's dependencies and recommend that users also perform dependency scanning in their applications that use `geocoder`.
* **Rationale:** Mitigates risks associated with vulnerable third-party libraries and ensures a secure supply chain.

**e) Security Documentation and Best Practices (Documentation):**

* **Recommendation:** Provide clear security documentation and best practices for users of the `geocoder` library.
    * **Action:**
        * **API Key Management Guidance:**  Explicitly document that API key management is the responsibility of the application and provide best practices for secure storage and handling of API keys (e.g., using environment variables, secure configuration management, avoiding hardcoding).
        * **Input Validation Recommendations:**  Advise users to perform input validation in their applications *before* passing data to the `geocoder` library, as a defense-in-depth measure.
        * **Rate Limiting Guidance:**  Recommend that applications using the library implement rate limiting or usage quotas to prevent abuse of geocoding services and potential denial-of-service scenarios.
        * **HTTPS Enforcement Recommendation:**  Advise users to ensure HTTPS is used throughout their applications, especially when handling location data.
        * **Security Considerations Section:**  Create a dedicated "Security Considerations" section in the library's documentation, outlining potential security risks and best practices for secure usage.
* **Rationale:** Empowers users to use the library securely and understand their responsibilities in maintaining overall application security.

**f) Build Process Security (CI/CD Pipeline):**

* **Recommendation:** Secure the CI/CD pipeline to prevent supply chain attacks.
    * **Action:**
        * **Secure CI/CD Configuration:**  Follow security best practices for CI/CD system configuration, including access controls, secrets management, and pipeline hardening.
        * **Code Signing (Optional but Recommended):** Consider signing the published Python packages to provide assurance of package integrity and authenticity.
        * **Regular Security Audits of CI/CD:**  Periodically audit the CI/CD pipeline for security vulnerabilities and misconfigurations.
* **Rationale:** Protects the library from supply chain attacks and ensures the integrity of distributed packages.

### 5. Actionable and Tailored Mitigation Strategies

Here are actionable mitigation strategies applicable to the identified threats, tailored to the `geocoder` library:

| Threat                                      | Vulnerability                                  | Mitigation Strategy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    