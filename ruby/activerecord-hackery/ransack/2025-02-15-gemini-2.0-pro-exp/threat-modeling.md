# Threat Model Analysis for activerecord-hackery/ransack

## Threat: [Unvalidated Predicates and Attributes](./threats/unvalidated_predicates_and_attributes.md)

*   **Threat:** Unvalidated Predicates and Attributes

    *   **Description:** An attacker crafts malicious URL parameters or form inputs using unexpected Ransack predicates (e.g., `_sql`, complex `_matches`, or deeply nested `_or`) or attempts to query non-whitelisted attributes. They might try to guess attribute names or use fuzzing techniques.  This leverages Ransack's core functionality of dynamically building queries.
    *   **Impact:**
        *   Denial of Service (DoS): Database overload due to computationally expensive queries generated by Ransack.
        *   Information Disclosure: Exposure of sensitive data or database schema details through error messages or query results returned by Ransack.
        *   Potential (rare) Code Execution: In specific, poorly configured scenarios, and depending on how custom predicates interact with the database, SQL injection *might* be possible through Ransack's `ransacker` feature if it's used insecurely.
    *   **Affected Ransack Component:** `Ransack::Search` object creation and query building, `ransackable_attributes`, `ransackable_predicates`, custom `ransacker` definitions.  This directly involves Ransack's core mechanisms.
    *   **Risk Severity:** Critical (if code execution is possible) or High (for DoS and information disclosure).
    *   **Mitigation Strategies:**
        *   **Strict Whitelisting:** Use `ransackable_attributes` and `ransackable_associations` to *explicitly* define allowed attributes and associations. Never return `true` or `nil` from these methods without understanding the implications. This directly controls Ransack's behavior.
        *   **Predicate Whitelisting:** Use `ransackable_predicates` to control allowed predicates. Avoid overly permissive predicates. This is a Ransack-specific control.
        *   **Custom Predicate Sanitization:** Thoroughly sanitize and validate user input within custom `ransacker` definitions. This addresses vulnerabilities within Ransack's custom predicate feature.
        *   **Input Validation:** Validate the *values* of search parameters (e.g., ensure an ID is an integer), even with whitelisting.
        *   **Rate Limiting:** Implement rate limiting on search endpoints to mitigate DoS attacks exploiting Ransack's query generation.

## Threat: [Unauthorized Attribute Access](./threats/unauthorized_attribute_access.md)

*   **Threat:** Unauthorized Attribute Access

    *   **Description:** An attacker attempts to query attributes that exist in the database but are not included in the `ransackable_attributes` whitelist. They are directly interacting with Ransack's query-building capabilities to try and bypass restrictions.
    *   **Impact:** Information Disclosure: Exposure of sensitive data that should not be accessible through search, facilitated by Ransack.
    *   **Affected Ransack Component:** `Ransack::Search` object, query building based on `ransackable_attributes`. This is a direct misuse of Ransack's intended functionality.
    *   **Risk Severity:** High.
    *   **Mitigation Strategies:**
        *   **Comprehensive Whitelisting:** Ensure `ransackable_attributes` is complete and covers all searchable attributes. Regularly review. This is the primary Ransack-specific defense.
        *   **Generic Error Handling:** Configure Ransack and Rails to return generic error messages, not revealing database details that could aid further attacks against Ransack.
        *   **Authorization Checks:** Combine Ransack with an authorization framework (e.g., Pundit) to enforce access control *in addition to* Ransack's whitelisting.

## Threat: [Unauthorized Association Access](./threats/unauthorized_association_access.md)

*   **Threat:** Unauthorized Association Access

    *   **Description:** An attacker tries to search through associations that are not explicitly allowed via `ransackable_associations`, directly exploiting Ransack's ability to traverse relationships.
    *   **Impact:** Information Disclosure: Access to data from related models that should be restricted, made possible by Ransack's association handling.
    *   **Affected Ransack Component:** `Ransack::Search` object, query building based on `ransackable_associations`. This is a direct attack on Ransack's association features.
    *   **Risk Severity:** High.
    *   **Mitigation Strategies:**
        *   **Strict Association Whitelisting:** Use `ransackable_associations` to *explicitly* list allowed associations. Be very restrictive. This is the key Ransack-specific mitigation.
        *   **Authorization Checks:** Use an authorization framework to ensure users can only search through permitted associations, complementing Ransack's controls.

## Threat: [Reliance on Default Behavior](./threats/reliance_on_default_behavior.md)

*   **Threat:** Reliance on Default Behavior

    *   **Description:** Using Ransack without explicitly configuring whitelisting methods (`ransackable_attributes`, `ransackable_associations`, etc.) relies on potentially overly permissive defaults, making the application vulnerable to various Ransack-specific attacks.
    *   **Impact:** Increased risk of all other Ransack-related vulnerabilities (Unvalidated Predicates, Unauthorized Access).
    *   **Affected Ransack Component:** All Ransack components related to attribute and association access, predicate handling, and sorting. This is a fundamental issue with how Ransack is (not) configured.
    *   **Risk Severity:** High.
    *   **Mitigation Strategies:**
        *   **Explicit Configuration:** *Always* explicitly configure Ransack's whitelisting methods. Never rely on defaults without understanding them. This is the most crucial preventative measure for Ransack.

