## Deep Security Analysis of fastlane

### 1. Objective, Scope, and Methodology

**Objective:**

The objective of this deep security analysis is to thoroughly evaluate the security posture of fastlane, a command-line tool for automating mobile app build, test, and release workflows. This analysis aims to identify potential security vulnerabilities and risks inherent in fastlane's architecture, components, and operational context.  A key focus will be on understanding how fastlane handles sensitive data, interacts with external services, and how its design and implementation might impact the security of mobile application development and deployment pipelines that rely on it. Ultimately, this analysis will provide actionable and tailored mitigation strategies to enhance fastlane's security and minimize risks for its users.

**Scope:**

This security analysis encompasses the following key components of fastlane, as outlined in the security design review:

*   **Command-Line Interface (CLI):**  Analyzing input handling, command parsing, and potential vulnerabilities arising from user interaction.
*   **Core Engine:** Examining the central orchestration logic, workflow execution, configuration processing, and interactions with plugins and external services.
*   **Plugins:** Assessing the security implications of fastlane's plugin architecture, including risks associated with third-party plugins and plugin management.
*   **Configuration Files (Fastfile):**  Evaluating the security of configuration file parsing, interpretation, and the potential for vulnerabilities through malicious or misconfigured Fastfiles.
*   **Credential Manager:**  Analyzing the mechanisms for secure credential storage, retrieval, and usage within fastlane, and identifying potential weaknesses in credential handling.
*   **Interactions with External Systems:**  Considering the security implications of fastlane's communication and data exchange with App Stores, Code Repositories, CI/CD systems, Notification Services, and Secure Storage solutions.

The analysis will primarily focus on fastlane itself and its immediate operational environment. It will not extend to a comprehensive security audit of the underlying operating systems, network infrastructure, or the security of the external services fastlane interacts with, except where these directly impact fastlane's security posture.

**Methodology:**

This deep security analysis will employ the following methodology:

1.  **Architecture and Data Flow Inference:** Based on the provided security design review documentation, including C4 Context and Container diagrams, and general knowledge of fastlane's functionality, we will infer the architecture, key components, and data flow within fastlane. This will involve understanding how data is processed, where sensitive information is handled, and how different components interact.
2.  **Threat Modeling:** For each key component and interaction point, we will perform threat modeling to identify potential security threats and vulnerabilities. This will include considering common attack vectors relevant to command-line tools, automation frameworks, and systems handling sensitive credentials. We will consider threats such as:
    *   Injection attacks (command injection, path injection, etc.)
    *   Credential leakage and insecure credential management
    *   Unauthorized access and privilege escalation
    *   Supply chain vulnerabilities (dependencies, plugins)
    *   Misconfiguration and insecure defaults
    *   Denial of Service
    *   Information Disclosure
3.  **Security Implication Analysis:**  For each identified threat, we will analyze its potential security implications, considering the business risks outlined in the security design review. This will involve assessing the potential impact on confidentiality, integrity, and availability of the mobile app release process and sensitive data.
4.  **Mitigation Strategy Development:**  Based on the identified threats and security implications, we will develop specific, actionable, and tailored mitigation strategies for fastlane. These strategies will be practical to implement within the fastlane ecosystem and will aim to reduce or eliminate the identified risks.
5.  **Recommendation Prioritization:**  Mitigation strategies will be prioritized based on the severity of the associated risk, the feasibility of implementation, and the potential impact on fastlane's functionality and usability.

### 2. Security Implications of Key Components

#### 2.1 Command-Line Interface (CLI)

**Architecture & Data Flow Inference:** The CLI is the user's entry point. It receives commands and arguments, parses them, and passes control to the Core Engine. Data flow is primarily input from the user and output back to the user's terminal.

**Security Implications:**

*   **Command Injection:** If the CLI does not properly sanitize or validate user inputs (commands, arguments, options), it could be vulnerable to command injection attacks. Malicious users might be able to inject arbitrary commands that are executed by the underlying system with the privileges of the fastlane process. This is especially critical if fastlane is run with elevated privileges or in CI/CD environments with access to sensitive resources.
*   **Path Traversal/Injection:** If file paths are constructed based on user input without proper validation, attackers could potentially perform path traversal attacks to access or manipulate files outside of the intended directories. This could lead to reading sensitive configuration files, overwriting critical system files, or executing malicious code from unexpected locations.
*   **Denial of Service (DoS):**  Maliciously crafted inputs or command sequences could potentially cause the CLI to consume excessive resources (CPU, memory), leading to a denial of service. This could disrupt the build and release pipeline.
*   **Information Disclosure through Verbose Output:**  In verbose or debug modes, the CLI might inadvertently output sensitive information (e.g., credentials, API keys, internal paths) to the console or logs, which could be captured and exploited.

**Specific Recommendations & Mitigation Strategies:**

*   **Input Validation and Sanitization:** Implement robust input validation and sanitization for all command-line arguments and options. Use well-vetted libraries for parsing and validating inputs.  Specifically:
    *   **Actionable Mitigation:**  Utilize input validation libraries in Ruby to strictly define expected input formats and types for all CLI parameters. Sanitize inputs to remove or escape potentially harmful characters before passing them to the Core Engine or executing system commands.
*   **Principle of Least Privilege:** Ensure fastlane processes run with the minimum necessary privileges. Avoid running fastlane as root or with overly broad permissions, especially in CI/CD environments.
    *   **Actionable Mitigation:** Document and enforce best practices for running fastlane with restricted user accounts and permissions in both local development and CI/CD environments.
*   **Secure Error Handling and Logging:** Implement secure error handling to prevent information leakage in error messages. Sanitize error messages and logs to avoid exposing sensitive data.  Limit verbosity in production environments.
    *   **Actionable Mitigation:**  Review and sanitize error handling routines to ensure they do not reveal sensitive information. Implement structured logging and configure logging levels appropriately for different environments (development, production).
*   **Regular Security Audits of CLI Input Handling:** Conduct periodic security audits specifically focused on the CLI input parsing and validation logic to identify and remediate potential vulnerabilities.
    *   **Actionable Mitigation:** Include CLI input handling as a specific focus area in periodic security audits and penetration testing exercises.

#### 2.2 Core Engine

**Architecture & Data Flow Inference:** The Core Engine is the heart of fastlane. It receives commands from the CLI, reads and interprets the Fastfile, manages plugins, interacts with the Credential Manager, and orchestrates actions. Data flows through the Core Engine include configuration data from Fastfile, credentials from Credential Manager, plugin code and data, and data exchanged with external services.

**Security Implications:**

*   **Configuration File Vulnerabilities (Fastfile):**  The Fastfile, being Ruby code, introduces flexibility but also potential risks.  If not parsed and executed securely, vulnerabilities could arise from:
    *   **Unsafe Deserialization:** If Fastfile parsing involves deserialization of untrusted data, it could be vulnerable to deserialization attacks.
    *   **Code Execution Vulnerabilities:**  Maliciously crafted Fastfiles could potentially exploit vulnerabilities in the Ruby interpreter or fastlane's code to execute arbitrary code.
    *   **Logic Flaws in Workflow Execution:**  Complex workflows defined in Fastfiles might contain logic flaws that could be exploited to bypass security controls or cause unintended actions.
*   **Plugin Security Risks:** The Core Engine loads and executes plugins, which are essentially extensions to fastlane's functionality. Risks associated with plugins include:
    *   **Malicious Plugins:**  Users might inadvertently install or use malicious plugins that could compromise their system or data.
    *   **Vulnerable Plugins:**  Plugins developed by the community might contain security vulnerabilities that could be exploited.
    *   **Plugin Dependency Vulnerabilities:** Plugins may introduce their own dependencies, which could have known vulnerabilities.
*   **Insecure Interaction with External Services:** The Core Engine interacts with various external services (App Stores, Code Repositories, etc.). Insecure interactions could lead to:
    *   **Man-in-the-Middle (MitM) Attacks:** If communication with external services is not properly secured (e.g., not using HTTPS or weak TLS configurations), it could be vulnerable to MitM attacks, allowing attackers to intercept or modify sensitive data in transit.
    *   **API Key/Token Exposure:**  If API keys or tokens used for authentication with external services are not handled securely within the Core Engine, they could be exposed or leaked.
    *   **Insufficient Rate Limiting/DoS against External Services:**  If the Core Engine does not implement proper rate limiting when interacting with external services, it could potentially be used to launch DoS attacks against those services.
*   **Credential Management Flaws:**  While fastlane has a Credential Manager, vulnerabilities could still arise in how the Core Engine retrieves, uses, and handles credentials. This could include:
    *   **Credential Leakage in Memory or Logs:**  Credentials might be inadvertently stored in memory for longer than necessary or logged in insecure locations.
    *   **Improper Credential Scope:**  Credentials might be used with overly broad permissions, increasing the potential impact of a compromise.

**Specific Recommendations & Mitigation Strategies:**

*   **Secure Fastfile Parsing and Execution:**
    *   **Actionable Mitigation:**  Implement secure coding practices for Fastfile parsing and execution. Avoid unsafe deserialization methods.  Consider sandboxing or isolating Fastfile execution to limit the impact of potential vulnerabilities.
*   **Enhanced Plugin Security Review Process:**
    *   **Actionable Mitigation:**  Establish a more formal security review process for officially recommended or promoted plugins. This could include static analysis, vulnerability scanning, and manual code review by security experts.
    *   **Actionable Mitigation:**  Develop and publish clear security guidelines for plugin developers, emphasizing secure coding practices, input validation, and secure credential handling.
    *   **Actionable Mitigation:**  Implement automated checks for plugins during installation or runtime to detect potential security issues (e.g., known vulnerabilities in plugin dependencies).
*   **Strengthen Secure Communication with External Services:**
    *   **Actionable Mitigation:**  Enforce HTTPS for all communication with external services. Ensure usage of strong TLS configurations and regularly update TLS libraries.
    *   **Actionable Mitigation:**  Implement robust API key/token management within the Core Engine. Use secure credential storage mechanisms provided by the Credential Manager. Minimize the scope and lifetime of API keys/tokens where possible.
    *   **Actionable Mitigation:**  Implement rate limiting and retry mechanisms when interacting with external services to prevent accidental DoS attacks and improve resilience.
*   **Improve Credential Handling within Core Engine:**
    *   **Actionable Mitigation:**  Minimize the time credentials are held in memory. Overwrite credential values in memory after use. Avoid logging credentials in any form.
    *   **Actionable Mitigation:**  Implement the principle of least privilege for credentials. Use service-specific credentials with the minimum necessary permissions.
    *   **Actionable Mitigation:**  Provide clear documentation and examples on how to use the Credential Manager securely and discourage insecure practices like hardcoding credentials in Fastfiles.

#### 2.3 Plugins

**Architecture & Data Flow Inference:** Plugins are extensions that add functionality to fastlane. They are loaded by the Core Engine and can interact with the Core Engine and external services. Data flow depends on the plugin's functionality but can include user inputs, data from external services, and data processed by the plugin itself.

**Security Implications:**

*   **Third-Party Code Risks:** Plugins are often developed by third-party contributors, introducing inherent risks associated with using code from untrusted sources.
*   **Vulnerability Introduction:** Plugins can introduce new vulnerabilities into the fastlane ecosystem, either through insecure coding practices or vulnerable dependencies.
*   **Supply Chain Attacks:**  Malicious actors could potentially compromise plugins or their dependencies to inject malicious code into user workflows.
*   **Lack of Consistent Security Standards:**  Security practices and awareness among plugin developers may vary, leading to inconsistent security quality across plugins.
*   **Plugin Update and Maintenance:**  Outdated or unmaintained plugins can become security liabilities if vulnerabilities are discovered and not patched.

**Specific Recommendations & Mitigation Strategies:**

*   **Plugin Security Scoring/Rating System:**
    *   **Actionable Mitigation:**  Implement a plugin security scoring or rating system within the fastlane plugin ecosystem. This could be based on automated security checks, community reviews, and maintainer reputation. Display security ratings prominently in plugin listings.
*   **Automated Plugin Security Scanning:**
    *   **Actionable Mitigation:**  Develop and integrate automated security scanning tools into the plugin development and distribution process. This could include static analysis, dependency vulnerability scanning, and malware detection.
*   **Community-Driven Plugin Security Reviews:**
    *   **Actionable Mitigation:**  Encourage and facilitate community-driven security reviews of popular and officially recommended plugins. Create a platform for reporting and discussing plugin security issues.
*   **Plugin Sandboxing/Isolation:**
    *   **Actionable Mitigation:**  Explore and implement mechanisms to sandbox or isolate plugins from the Core Engine and the underlying system. This could limit the impact of vulnerabilities in plugins. (This might be technically challenging in Ruby).
*   **Clear Plugin Security Guidelines and Best Practices:**
    *   **Actionable Mitigation:**  Develop and prominently publish comprehensive security guidelines and best practices for plugin developers. Provide code examples and templates demonstrating secure plugin development.
*   **Dependency Management for Plugins:**
    *   **Actionable Mitigation:**  Encourage plugin developers to use dependency management tools (like Bundler) and to regularly update their dependencies. Provide tools or scripts to help plugin developers scan their dependencies for vulnerabilities.
*   **Plugin Vetting for Official Recommendation:**
    *   **Actionable Mitigation:**  Establish a more rigorous vetting process for plugins that are officially recommended or promoted by the fastlane project. This process should include security reviews and adherence to security guidelines.

#### 2.4 Configuration Files (Fastfile)

**Architecture & Data Flow Inference:** Fastfiles are Ruby files that define fastlane workflows. They are read and interpreted by the Core Engine. Data flow involves configuration parameters, script logic, and potentially embedded credentials (though discouraged).

**Security Implications:**

*   **Accidental Credential Exposure:** Developers might inadvertently hardcode sensitive credentials (API keys, passwords) directly into Fastfiles, especially during development or in example configurations. If Fastfiles are committed to version control or shared insecurely, these credentials could be exposed.
*   **Misconfiguration Leading to Security Issues:**  Incorrectly configured Fastfiles could lead to unintended security consequences, such as:
    *   **Overly Permissive Access Control:**  Fastfiles might grant overly broad permissions to fastlane actions, potentially allowing unauthorized actions to be performed.
    *   **Insecure Data Handling:**  Fastfiles might process sensitive data insecurely, leading to data leakage or corruption.
    *   **Logic Errors in Security-Sensitive Workflows:**  Errors in the workflow logic within Fastfiles could bypass security checks or introduce vulnerabilities in the release process.
*   **Version Control Risks:**  If Fastfiles are not properly version controlled and access-controlled, unauthorized modifications could lead to malicious changes in the build and release process.

**Specific Recommendations & Mitigation Strategies:**

*   **Strongly Discourage Hardcoding Credentials in Fastfiles:**
    *   **Actionable Mitigation:**  Enhance documentation and examples to explicitly and strongly discourage hardcoding credentials in Fastfiles. Emphasize the use of Credential Manager and secure environment variable practices.
    *   **Actionable Mitigation:**  Implement static analysis checks that can detect potential hardcoded credentials in Fastfiles and warn users during fastlane execution or code commits.
*   **Configuration Validation and Best Practices Guidance:**
    *   **Actionable Mitigation:**  Develop and provide clear guidelines and best practices for writing secure Fastfiles. This should include recommendations for input validation, secure data handling, and avoiding common misconfiguration pitfalls.
    *   **Actionable Mitigation:**  Consider adding configuration validation features to fastlane that can automatically check Fastfiles for potential security misconfigurations and provide warnings or errors.
*   **Secure Fastfile Storage and Version Control:**
    *   **Actionable Mitigation:**  Document and promote best practices for securely storing and version controlling Fastfiles. Emphasize the importance of access control and audit logging for Fastfile repositories.
*   **Code Review for Fastfile Changes:**
    *   **Actionable Mitigation:**  Recommend code review processes for any changes to Fastfiles, especially in team environments. Security considerations should be a part of the Fastfile code review process.

#### 2.5 Credential Manager

**Architecture & Data Flow Inference:** The Credential Manager is responsible for securely storing and retrieving credentials. It acts as an abstraction layer, supporting various secure storage mechanisms. Data flow involves storing credentials into secure storage and retrieving them when requested by the Core Engine.

**Security Implications:**

*   **Insecure Default Storage Mechanisms:** If the default credential storage mechanisms are not sufficiently secure (e.g., relying solely on environment variables without proper protection), users might inadvertently store credentials insecurely.
*   **Vulnerabilities in Secure Storage Integrations:**  If the Credential Manager integrates with external secure storage solutions (like Keychain or dedicated secret managers), vulnerabilities in these integrations could compromise credential security.
*   **Credential Leakage during Retrieval:**  Even if credentials are stored securely, vulnerabilities in the retrieval process could lead to credential leakage (e.g., logging credentials during retrieval, insecure transmission).
*   **Insufficient Guidance on Secure Storage Options:**  If documentation and guidance on secure credential storage are lacking or unclear, users might choose insecure methods or misconfigure secure storage solutions.

**Specific Recommendations & Mitigation Strategies:**

*   **Promote and Default to Secure Credential Storage:**
    *   **Actionable Mitigation:**  Actively promote and recommend the most secure credential storage mechanisms (e.g., OS Keychain, dedicated secret managers) in documentation and examples. Consider making a more secure option the default if feasible and user-friendly.
*   **Enhanced Documentation and Guidance on Secure Credential Storage:**
    *   **Actionable Mitigation:**  Provide more detailed and prescriptive guidance on secure credential storage options. Offer step-by-step instructions and best practices for using secure storage solutions with fastlane. Include clear warnings against insecure practices.
    *   **Actionable Mitigation:**  Create troubleshooting guides and FAQs to help users resolve common issues related to secure credential storage and retrieval.
*   **Security Audits of Credential Manager and Integrations:**
    *   **Actionable Mitigation:**  Conduct regular security audits of the Credential Manager component and its integrations with secure storage solutions. Focus on identifying and remediating potential vulnerabilities in credential storage, retrieval, and handling.
*   **Credential Rotation and Management Guidance:**
    *   **Actionable Mitigation:**  Provide guidance and best practices on credential rotation and lifecycle management for credentials used with fastlane. Encourage users to regularly rotate credentials and revoke unused ones.
*   **Consider Built-in Secret Management Integration:**
    *   **Actionable Mitigation:**  Explore deeper integration with popular secret management solutions (like HashiCorp Vault, AWS Secrets Manager, etc.) to simplify secure credential management for fastlane users, especially in enterprise environments.

### 3. Actionable and Tailored Mitigation Strategies Summary

| Security Area          | Identified Threat                                  | Specific & Actionable Mitigation Strategies                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     