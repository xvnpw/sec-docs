# BUSINESS POSTURE

- Business Priorities and Goals:
  - Middleman is a static site generator that simplifies website development and deployment.
  - The primary business goal is to enable users to quickly and efficiently create and manage static websites.
  - Key priorities include ease of use, flexibility, performance of generated sites, and maintainability of the generator itself.
- Business Risks:
  - Risk of vulnerabilities in the Middleman core or its dependencies leading to compromised generated websites if security best practices are not followed during development and deployment.
  - Risk of misconfiguration leading to insecure websites.
  - Risk of supply chain attacks through compromised dependencies.
  - Risk of denial of service if generated websites are not deployed with sufficient infrastructure protection.

# SECURITY POSTURE

- Existing Security Controls:
  - security control: Dependency management using Bundler to manage and track project dependencies. (Implemented in `Gemfile` and `Gemfile.lock`)
  - security control: Open source project with community review, increasing the likelihood of identifying and addressing security vulnerabilities. (Described in project documentation and community engagement)
- Accepted Risks:
  - accepted risk: Reliance on third-party dependencies introduces potential vulnerabilities that are outside of the direct control of the Middleman project.
  - accepted risk: Users are responsible for the security of their generated websites and the content they include.
- Recommended Security Controls:
  - recommended security control: Implement automated dependency vulnerability scanning to identify and address known vulnerabilities in project dependencies.
  - recommended security control: Encourage and provide guidelines for secure configuration and deployment practices for generated websites.
  - recommended security control: Implement static analysis security testing (SAST) tools in the development pipeline to identify potential code-level vulnerabilities.
- Security Requirements:
  - Authentication: Not directly applicable to Middleman core as it's a static site generator. Authentication might be relevant if Middleman is extended with CMS or admin functionalities by users.
  - Authorization: Not directly applicable to Middleman core. Authorization might be relevant in the context of user-developed extensions or CMS integrations.
  - Input Validation: Important for user-provided content that is processed by Middleman, such as data files or content within templates, to prevent injection attacks in generated websites.
  - Cryptography: Not a core requirement for Middleman itself. Cryptography might be relevant if users are handling sensitive data within their static sites, but this would be their responsibility, not Middleman's.

# DESIGN

## C4 CONTEXT

```mermaid
flowchart LR
    subgraph "Website Visitors"
        WV[Website Visitors]
    end
    subgraph "Content Creators"
        CC[Content Creators]
    end
    subgraph "Middleman Project"
        MP["Middleman Application"]
    end
    subgraph "Hosting Platform"
        HP[Hosting Platform]
    end
    subgraph "Data Sources (Optional)"
        DS[Data Sources]
    end

    CC --> MP: Creates/Updates Content
    MP --> HP: Deploys Website
    HP --> WV: Serves Website
    MP --> DS: Fetches Data (Optional)
    WV --> HP: Accesses Website
    style MP fill:#f9f,stroke:#333,stroke-width:2px
```

- Context Diagram Elements:
  - - Name: Website Visitors
    - Type: Person
    - Description: Users who access and view the websites generated by Middleman.
    - Responsibilities: Consume website content.
    - Security controls: N/A - Consumers of the website, security is focused on protecting the website itself.
  - - Name: Content Creators
    - Type: Person
    - Description: Users who create and manage content for websites using Middleman.
    - Responsibilities: Create website content, configure Middleman project, deploy website.
    - Security controls: Authentication and authorization to access content management systems if integrated with Middleman (outside of Middleman core). Secure development practices when creating content and configurations.
  - - Name: Middleman Application
    - Type: Software System
    - Description: The Middleman static site generator application, responsible for processing content and templates to generate static websites.
    - Responsibilities: Generate static websites from content and templates, manage project configuration, provide development server.
    - Security controls: Input validation of user-provided content and configurations, dependency vulnerability scanning, secure build process.
  - - Name: Hosting Platform
    - Type: Software System / Infrastructure
    - Description: The platform where the generated static website is hosted and served to website visitors (e.g., Netlify, GitHub Pages, AWS S3).
    - Responsibilities: Host and serve static website files, provide infrastructure for website accessibility.
    - Security controls: Infrastructure security controls (firewalls, access controls), DDoS protection, HTTPS configuration, secure storage of website files.
  - - Name: Data Sources (Optional)
    - Type: Software System / Data Store
    - Description: External data sources that Middleman might integrate with to fetch data for website content (e.g., APIs, databases, CMS).
    - Responsibilities: Provide data to Middleman for website generation.
    - Security controls: Secure APIs, access controls, data encryption in transit and at rest (depending on the data source).

## C4 CONTAINER

```mermaid
flowchart LR
    subgraph "Content Creators"
        CC[Content Creators]
    end
    subgraph "Middleman Application"
        subgraph "Middleman Core"
            MC[Middleman Core]
        end
        subgraph "Extensions"
            ME[Middleman Extensions]
        end
        subgraph "Configuration"
            MF[Middleman Configuration Files]
        end
        subgraph "Output"
            MO[Generated Static Website Files]
        end
    end
    subgraph "Hosting Platform"
        HP[Hosting Platform]
    end

    CC --> MC: Configures and Runs
    MC --> ME: Uses Extensions
    MC --> MF: Reads Configuration
    MC --> MO: Generates Website
    MO --> HP: Deploys Website
    style "Middleman Application" fill:#ccf,stroke:#333,stroke-width:2px
    style MC fill:#eee,stroke:#333,stroke-width:1px
    style ME fill:#eee,stroke:#333,stroke-width:1px
    style MF fill:#eee,stroke:#333,stroke-width:1px
    style MO fill:#eee,stroke:#333,stroke-width:1px
```

- Container Diagram Elements:
  - - Name: Middleman Core
    - Type: Application
    - Description: The core Ruby application of Middleman, responsible for processing project files, templates, and configurations to generate static websites.
    - Responsibilities: Core logic for static site generation, managing extensions, handling routing, processing templates.
    - Security controls: Input validation, dependency management, secure coding practices.
  - - Name: Middleman Extensions
    - Type: Library / Plugins
    - Description: Extensions that add functionalities to Middleman, such as blog engines, image processing, or data integration.
    - Responsibilities: Extend core functionality, provide specific features, integrate with external services.
    - Security controls: Dependency management, code review for extensions, secure extension development guidelines.
  - - Name: Middleman Configuration Files
    - Type: Configuration
    - Description: Files (e.g., `config.rb`, data files) that define the project settings, routes, data, and other configurations for Middleman.
    - Responsibilities: Define project behavior, store configuration data.
    - Security controls: Secure storage of configuration files, input validation of configuration parameters, avoid storing secrets in configuration files directly.
  - - Name: Generated Static Website Files
    - Type: Files
    - Description: The output of Middleman, consisting of HTML, CSS, JavaScript, images, and other static assets that form the final website.
    - Responsibilities: Represent the final website, ready for deployment.
    - Security controls: Ensure generated files do not contain unintended sensitive information, output sanitization if necessary.
  - - Name: Hosting Platform
    - Type: Infrastructure
    - Description: The environment where the generated static website files are deployed and served.
    - Responsibilities: Host and serve website files, provide infrastructure.
    - Security controls: Infrastructure security, access controls, HTTPS, DDoS protection.

## DEPLOYMENT

Deployment to a Static Hosting Platform (e.g., Netlify, GitHub Pages)

```mermaid
flowchart LR
    subgraph "Content Creator's Local Machine"
        DEV[Developer Environment]
    end
    subgraph "Build System (CI/CD)"
        BS[Build Server]
    end
    subgraph "Hosting Platform"
        HP[Hosting Platform]
        subgraph "Content Delivery Network (CDN)"
            CDN[CDN]
        end
        subgraph "Web Servers"
            WS[Web Servers]
        end
        HP --- CDN
        HP --- WS
    end
    DEV --> BS: Pushes Code
    BS --> BS: Builds Website
    BS --> HP: Deploys Website
    HP --> CDN: Caches Content
    CDN --> WV: Serves Website
    WS --> WV: Serves Website (Origin)
    WV[Website Visitors]
    style "Hosting Platform" fill:#eef,stroke:#333,stroke-width:2px
    style CDN fill:#eee,stroke:#333,stroke-width:1px
    style WS fill:#eee,stroke:#333,stroke-width:1px
```

- Deployment Diagram Elements:
  - - Name: Developer Environment
    - Type: Environment
    - Description: The local machine of the content creator where Middleman is installed and used for development and content creation.
    - Responsibilities: Development, content creation, local testing.
    - Security controls: Local machine security practices, secure coding habits.
  - - Name: Build Server (CI/CD)
    - Type: Server / Automation
    - Description: An automated system (e.g., GitHub Actions, Netlify Build) that builds the Middleman project and generates the static website.
    - Responsibilities: Automated build process, dependency management, running Middleman build commands, deployment automation.
    - Security controls: Secure build environment, access controls to build system, secrets management for deployment credentials, build process security checks (dependency scanning, SAST).
  - - Name: Hosting Platform
    - Type: Infrastructure
    - Description: The platform that hosts the generated static website and makes it accessible to website visitors.
    - Responsibilities: Hosting website files, serving website content, providing infrastructure.
    - Security controls: Infrastructure security, access controls, HTTPS, DDoS protection, CDN for performance and security.
  - - Name: Content Delivery Network (CDN)
    - Type: Network
    - Description: A distributed network of servers that caches website content to improve performance and availability for website visitors.
    - Responsibilities: Caching website content, serving content to users from geographically closer locations, DDoS mitigation.
    - Security controls: CDN security features, DDoS protection, secure content delivery.
  - - Name: Web Servers
    - Type: Server
    - Description: Servers within the hosting platform that serve the static website content to website visitors, acting as the origin for the CDN.
    - Responsibilities: Serve website content, handle requests from CDN or directly from users.
    - Security controls: Web server security hardening, access controls, HTTPS configuration.

## BUILD

```mermaid
flowchart LR
    subgraph "Developer"
        DEV[Developer]
    end
    subgraph "Version Control System (VCS)"
        VCS[VCS (e.g., GitHub)]
    end
    subgraph "Build System (CI/CD)"
        BS[Build System]
        subgraph "Dependency Management"
            DM[Dependency Management (Bundler)]
        end
        subgraph "Build Tools"
            BT[Build Tools (Middleman CLI)]
        end
        subgraph "Security Scanners"
            SS[Security Scanners (SAST, Dependency Scan)]
        end
        BS --- DM
        BS --- BT
        BS --- SS
    end
    subgraph "Artifact Repository"
        AR[Artifact Repository (Hosting Platform)]
    end

    DEV --> VCS: Commits Code
    VCS --> BS: Triggers Build
    BS --> DM: Resolves Dependencies
    BS --> BT: Builds Website
    BS --> SS: Runs Security Checks
    BS --> AR: Publishes Artifacts
    style "Build System (CI/CD)" fill:#fcf,stroke:#333,stroke-width:2px
    style DM fill:#eee,stroke:#333,stroke-width:1px
    style BT fill:#eee,stroke:#333,stroke-width:1px
    style SS fill:#eee,stroke:#333,stroke-width:1px
```

- Build Process Elements:
  - - Name: Developer
    - Type: Person
    - Description: Software developer or content creator who writes code and content for the Middleman project.
    - Responsibilities: Writing code, creating content, committing changes to VCS.
    - Security controls: Secure coding practices, local development environment security.
  - - Name: Version Control System (VCS)
    - Type: Software System
    - Description: System like Git and platforms like GitHub, GitLab, used to manage source code and track changes.
    - Responsibilities: Source code management, version control, collaboration.
    - Security controls: Access controls, authentication, audit logs, branch protection.
  - - Name: Build System (CI/CD)
    - Type: Software System
    - Description: Automated system that builds, tests, and deploys the Middleman project.
    - Responsibilities: Automated build process, dependency management, running tests, security checks, deployment.
    - Security controls: Secure build environment, access controls, secrets management, build process integrity, security scanning integration.
  - - Name: Dependency Management (Bundler)
    - Type: Tool
    - Description: Tool used to manage and resolve project dependencies in Ruby projects.
    - Responsibilities: Dependency resolution, ensuring consistent dependency versions.
    - Security controls: Dependency vulnerability scanning, using `Gemfile.lock` to ensure consistent dependencies.
  - - Name: Build Tools (Middleman CLI)
    - Type: Tool
    - Description: Middleman command-line interface used to build the static website.
    - Responsibilities: Executing build commands, generating static website files.
    - Security controls: Secure build process, proper configuration of build tools.
  - - Name: Security Scanners (SAST, Dependency Scan)
    - Type: Tool
    - Description: Tools used to perform static analysis security testing (SAST) and dependency vulnerability scanning during the build process.
    - Responsibilities: Identifying potential security vulnerabilities in code and dependencies.
    - Security controls: Regularly updated vulnerability databases, integration into the build pipeline, reporting and remediation processes.
  - - Name: Artifact Repository (Hosting Platform)
    - Type: Storage
    - Description: Storage location within the hosting platform where the build artifacts (generated static website files) are stored and deployed from.
    - Responsibilities: Storing build artifacts, providing access for deployment.
    - Security controls: Access controls, secure storage, integrity checks of artifacts.

# RISK ASSESSMENT

- Critical Business Processes:
  - Website availability and accessibility to users.
  - Integrity of website content and information presented to users.
- Data to Protect:
  - Website content (HTML, CSS, JavaScript, images, etc.): Sensitivity depends on the website's purpose. For public websites, sensitivity might be low in terms of confidentiality, but integrity and availability are crucial. For websites containing sensitive information, confidentiality, integrity, and availability are all important.
  - Middleman project configuration and source code: Sensitive in terms of intellectual property and potential vulnerabilities if exposed.
  - Dependencies: Risk of vulnerabilities in dependencies affecting the security of generated websites.
  - Build and deployment process: Security of the build and deployment pipeline to prevent supply chain attacks and unauthorized modifications.

# QUESTIONS & ASSUMPTIONS

- Questions:
  - What is the intended use case for websites generated by Middleman? (e.g., marketing website, documentation, blog, e-commerce).
  - What is the sensitivity of the data that will be presented on the generated websites?
  - Are there any specific compliance requirements (e.g., GDPR, HIPAA) that need to be considered?
  - What is the organization's risk appetite regarding security?
  - Are there existing security policies and procedures that need to be followed?
- Assumptions:
  - The primary goal is to generate public-facing static websites.
  - Security focus is on preventing website defacement, data breaches (if sensitive data is present), and ensuring website availability.
  - Standard static website hosting practices will be followed.
  - Content creators are assumed to have basic security awareness but may not be security experts.
  - The organization is looking for practical and cost-effective security measures.